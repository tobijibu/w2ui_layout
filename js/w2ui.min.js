var w2ui=w2ui||{},w2obj=w2obj||{},w2utils=function(e){function t(e){return/^[-+]?[0-9]+$/.test(e)}function i(t){if(null==t)return t;switch(typeof t){case"number":break;case"string":t=String(t).replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;");break;case"object":if(Array.isArray(t)){t=e.extend(!0,[],t);for(i=0;i<t.length;i++)t[i]=this.encodeTags(t[i])}else{t=e.extend(!0,{},t);for(var i in t)t[i]=this.encodeTags(t[i])}}return t}function s(){var e="w2ui_test";try{return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch(e){return!1}}var n={};return{version:"1.5.x",settings:{locale:"en-us",dateFormat:"m/d/yyyy",timeFormat:"hh:mi pm",datetimeFormat:"m/d/yyyy|hh:mi pm",currencyPrefix:"$",currencySuffix:"",currencyPrecision:2,groupSymbol:",",decimalSymbol:".",shortmonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],fullmonths:["January","February","March","April","May","June","July","August","September","October","November","December"],shortdays:["M","T","W","T","F","S","S"],fulldays:["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],weekStarts:"M",dataType:"HTTPJSON",phrases:{},dateStartYear:1950,dateEndYear:2020},isBin:function(e){return/^[0-1]+$/.test(e)},isInt:t,isFloat:function(e){return"string"==typeof e&&(e=e.replace(/\s+/g,"").replace(w2utils.settings.groupSymbol,"").replace(w2utils.settings.decimalSymbol,".")),("number"==typeof e||"string"==typeof e&&""!==e)&&!isNaN(Number(e))},isMoney:function(e){var t=w2utils.settings,i=new RegExp("^"+(t.currencyPrefix?"\\"+t.currencyPrefix+"?":"")+"[-+]?"+(t.currencyPrefix?"\\"+t.currencyPrefix+"?":"")+"[0-9]*[\\"+t.decimalSymbol+"]?[0-9]+"+(t.currencySuffix?"\\"+t.currencySuffix+"?":"")+"$","i");return"string"==typeof e&&(e=e.replace(new RegExp(t.groupSymbol,"g"),"")),"object"!=typeof e&&""!==e&&i.test(e)},isHex:function(e){return/^(0x)?[0-9a-fA-F]+$/.test(e)},isAlphaNumeric:function(e){return/^[a-zA-Z0-9_-]+$/.test(e)},isEmail:function(e){return/^[a-zA-Z0-9._%-]+@[а-яА-Яa-zA-Z0-9.-]+\.[а-яА-Яa-zA-Z]+$/.test(e)},isDate:function(e,i,s){if(!e)return!1;var n,a,r,o="Invalid Date";if(null==i&&(i=w2utils.settings.dateFormat),"function"==typeof e.getUTCFullYear)r=e.getUTCFullYear(),n=e.getUTCMonth()+1,a=e.getUTCDate();else if(parseInt(e)==e&&parseInt(e)>0)e=new Date(parseInt(e)),r=e.getUTCFullYear(),n=e.getUTCMonth()+1,a=e.getUTCDate();else{if(e=String(e),new RegExp("mon","ig").test(i)){i=i.replace(/month/gi,"m").replace(/mon/gi,"m").replace(/dd/gi,"d").replace(/[, ]/gi,"/").replace(/\/\//g,"/").toLowerCase(),e=e.replace(/[, ]/gi,"/").replace(/\/\//g,"/").toLowerCase();for(var l=0,d=w2utils.settings.fullmonths.length;l<d;l++){var u=w2utils.settings.fullmonths[l];e=e.replace(new RegExp(u,"ig"),parseInt(l)+1).replace(new RegExp(u.substr(0,3),"ig"),parseInt(l)+1)}}var c=e.replace(/-/g,"/").replace(/\./g,"/").toLowerCase().split("/"),h=i.replace(/-/g,"/").replace(/\./g,"/").toLowerCase();"mm/dd/yyyy"===h&&(n=c[0],a=c[1],r=c[2]),"m/d/yyyy"===h&&(n=c[0],a=c[1],r=c[2]),"dd/mm/yyyy"===h&&(n=c[1],a=c[0],r=c[2]),"d/m/yyyy"===h&&(n=c[1],a=c[0],r=c[2]),"yyyy/dd/mm"===h&&(n=c[2],a=c[1],r=c[0]),"yyyy/d/m"===h&&(n=c[2],a=c[1],r=c[0]),"yyyy/mm/dd"===h&&(n=c[1],a=c[2],r=c[0]),"yyyy/m/d"===h&&(n=c[1],a=c[2],r=c[0]),"mm/dd/yy"===h&&(n=c[0],a=c[1],r=c[2]),"m/d/yy"===h&&(n=c[0],a=c[1],r=parseInt(c[2])+1900),"dd/mm/yy"===h&&(n=c[1],a=c[0],r=parseInt(c[2])+1900),"d/m/yy"===h&&(n=c[1],a=c[0],r=parseInt(c[2])+1900),"yy/dd/mm"===h&&(n=c[2],a=c[1],r=parseInt(c[0])+1900),"yy/d/m"===h&&(n=c[2],a=c[1],r=parseInt(c[0])+1900),"yy/mm/dd"===h&&(n=c[1],a=c[2],r=parseInt(c[0])+1900),"yy/m/d"===h&&(n=c[1],a=c[2],r=parseInt(c[0])+1900)}return!!t(r)&&!!t(n)&&!!t(a)&&(r=+r,n=+n,a=+a,o=new Date(r,n-1,a),null!=n&&"Invalid Date"!=String(o)&&o.getMonth()+1===n&&o.getDate()===a&&o.getFullYear()===r&&(!0!==s||o))},isTime:function(t,i){if(null==t)return!1;var s,n,a;n=(t=(t=String(t)).toUpperCase()).indexOf("AM")>=0;var r=(a=t.indexOf("PM")>=0)||n;s=r?12:24,t=t.replace("AM","").replace("PM","");var o=(t=e.trim(t)).split(":"),l=parseInt(o[0]||0),d=parseInt(o[1]||0),u=parseInt(o[2]||0);return!!(r&&1===o.length||2===o.length||3===o.length)&&!(""===o[0]||l<0||l>s||!this.isInt(o[0])||o[0].length>2)&&!(o.length>1&&(""===o[1]||d<0||d>59||!this.isInt(o[1])||2!==o[1].length))&&!(o.length>2&&(""===o[2]||u<0||u>59||!this.isInt(o[2])||2!==o[2].length))&&!!(r||s!==l||0===d&&0===u)&&(!r||1!==o.length||0!==l)&&(!0!==i||(a&&12!==l&&(l+=12),n&&12===l&&(l+=12),{hours:l,minutes:d,seconds:u}))},isDateTime:function(e,t,i){null==t&&(t=w2utils.settings.datetimeFormat);var s=t.split("|");if("function"==typeof e.getUTCFullYear)return!0!==i||e;if(parseInt(e)==e&&parseInt(e)>0)return e=new Date(parseInt(e)),!0!==i||e;var n=String(e).indexOf(" "),a=[e.substr(0,n),e.substr(n).trim()];s[0]=s[0].trim(),s[1]&&(s[1]=s[1].trim());var r=w2utils.isDate(a[0],s[0],!0),o=w2utils.isTime(a[1],!0);return!1!==r&&!1!==o&&(!0!==i||(r.setHours(o.hours),r.setMinutes(o.minutes),r.setSeconds(o.seconds),r))},age:function(e){var t;if(""===e||null==e)return"";if(t="function"==typeof e.getUTCFullYear?e:parseInt(e)==e&&parseInt(e)>0?new Date(parseInt(e)):new Date(e),"Invalid Date"==String(t))return"";var i=((new Date).getTime()-t.getTime())/1e3,s="",n="";return i<0?(s=0,n="sec"):i<60?(s=Math.floor(i),n="sec",i<0&&(s=0,n="sec")):i<3600?(s=Math.floor(i/60),n="min"):i<86400?(s=Math.floor(i/60/60),n="hour"):i<2592e3?(s=Math.floor(i/24/60/60),n="day"):i<31536e3?(s=Math.floor(i/30/24/60/60*10)/10,n="month"):i<126144e3?(s=Math.floor(i/365/24/60/60*10)/10,n="year"):i>=126144e3&&(s=Math.floor(i/365.25/24/60/60*10)/10,n="year"),s+" "+n+(s>1?"s":"")},interval:function(e){return e<1e3?"< 1 sec":e<6e4?Math.floor(e/1e3)+" secs":e<36e5?Math.floor(e/6e4)+" mins":e<864e5?Math.floor(e/36e5*10)/10+" hours":e<2628e6?Math.floor(e/864e5*10)/10+" days":e<31536e6?Math.floor(e/2628e6*10)/10+" months":Math.floor(e/31536e5)/10+" years"},date:function(e){if(""===e||null==e||"object"==typeof e&&!e.getMonth)return"";var t=new Date(e);if(w2utils.isInt(e)&&(t=new Date(Number(e))),"Invalid Date"==String(t))return"";var i=w2utils.settings.shortmonths,s=new Date,n=new Date;n.setTime(n.getTime()-864e5);var a=i[t.getMonth()]+" "+t.getDate()+", "+t.getFullYear(),r=i[s.getMonth()]+" "+s.getDate()+", "+s.getFullYear(),o=i[n.getMonth()]+" "+n.getDate()+", "+n.getFullYear(),l=t.getHours()-(t.getHours()>12?12:0)+":"+(t.getMinutes()<10?"0":"")+t.getMinutes()+" "+(t.getHours()>=12?"pm":"am"),d=t.getHours()-(t.getHours()>12?12:0)+":"+(t.getMinutes()<10?"0":"")+t.getMinutes()+":"+(t.getSeconds()<10?"0":"")+t.getSeconds()+" "+(t.getHours()>=12?"pm":"am"),u=a;return a===r&&(u=l),a===o&&(u=w2utils.lang("Yesterday")),'<span title="'+a+" "+d+'">'+u+"</span>"},formatSize:function(e){if(!w2utils.isFloat(e)||""===e)return"";if(0===(e=parseFloat(e)))return 0;var t=parseInt(Math.floor(Math.log(e)/Math.log(1024)));return(Math.floor(e/Math.pow(1024,t)*10)/10).toFixed(0===t?0:1)+" "+(["Bt","KB","MB","GB","TB","PB","EB","ZB"][t]||"??")},formatNumber:function(e,t,i){if(null==e||""===e||"object"==typeof e)return"";var s={minimumFractionDigits:t,maximumFractionDigits:t,useGrouping:i};return(null==t||t<0)&&(s.minimumFractionDigits=0,s.maximumFractionDigits=20),parseFloat(e).toLocaleString(w2utils.settings.locale,s)},formatDate:function(e,t){if(t||(t=this.settings.dateFormat),""===e||null==e||"object"==typeof e&&!e.getMonth)return"";var i=new Date(e);if(w2utils.isInt(e)&&(i=new Date(Number(e))),"Invalid Date"==String(i))return"";var s=i.getFullYear(),n=i.getMonth(),a=i.getDate();return t.toLowerCase().replace("month",w2utils.settings.fullmonths[n]).replace("mon",w2utils.settings.shortmonths[n]).replace(/yyyy/g,s).replace(/yyy/g,s).replace(/yy/g,s>2e3?100+parseInt(String(s).substr(2)):String(s).substr(2)).replace(/(^|[^a-z$])y/g,"$1"+s).replace(/mm/g,(n+1<10?"0":"")+(n+1)).replace(/dd/g,(a<10?"0":"")+a).replace(/th/g,1==a?"st":"th").replace(/th/g,2==a?"nd":"th").replace(/th/g,3==a?"rd":"th").replace(/(^|[^a-z$])m/g,"$1"+(n+1)).replace(/(^|[^a-z$])d/g,"$1"+a)},formatTime:function(e,t){if(w2utils.settings.shortmonths,w2utils.settings.fullmonths,t||(t=this.settings.timeFormat),""===e||null==e||"object"==typeof e&&!e.getMonth)return"";var i=new Date(e);if(w2utils.isInt(e)&&(i=new Date(Number(e))),w2utils.isTime(e)){var s=w2utils.isTime(e,!0);(i=new Date).setHours(s.hours),i.setMinutes(s.minutes)}if("Invalid Date"==String(i))return"";var n="am",a=i.getHours(),r=i.getHours(),o=i.getMinutes(),l=i.getSeconds();return o<10&&(o="0"+o),l<10&&(l="0"+l),-1===t.indexOf("am")&&-1===t.indexOf("pm")||(a>=12&&(n="pm"),a>12&&(a-=12)),t.toLowerCase().replace("am",n).replace("pm",n).replace("hhh",a<10?"0"+a:a).replace("hh24",r<10?"0"+r:r).replace("h24",r).replace("hh",a).replace("mm",o).replace("mi",o).replace("ss",l).replace(/(^|[^a-z$])h/g,"$1"+a).replace(/(^|[^a-z$])m/g,"$1"+o).replace(/(^|[^a-z$])s/g,"$1"+l)},formatDateTime:function(e,t){var i;return""===e||null==e||"object"==typeof e&&!e.getMonth?"":("string"!=typeof t?i=[this.settings.dateFormat,this.settings.timeFormat]:(i=t.split("|"),i[0]=i[0].trim(),i[1]=i.length>1?i[1].trim():this.settings.timeFormat),"h12"==i[1]&&(i[1]="h:m pm"),"h24"==i[1]&&(i[1]="h24:m"),this.formatDate(e,i[0])+" "+this.formatTime(e,i[1]))},stripTags:function(t){if(null==t)return t;switch(typeof t){case"number":break;case"string":t=String(t).replace(/(<([^>]+)>)/gi,"");break;case"object":if(Array.isArray(t))for(t=e.extend(!0,[],t),i=0;i<t.length;i++)t[i]=this.stripTags(t[i]);else{t=e.extend(!0,{},t);for(var i in t)t[i]=this.stripTags(t[i])}}return t},encodeTags:i,decodeTags:function(t){if(null==t)return t;switch(typeof t){case"number":break;case"string":t=String(t).replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&amp;/g,"&");break;case"object":if(Array.isArray(t))for(t=e.extend(!0,[],t),i=0;i<t.length;i++)t[i]=this.decodeTags(t[i]);else{t=e.extend(!0,{},t);for(var i in t)t[i]=this.decodeTags(t[i])}}return t},escapeId:function(e){return""===e||null==e?"":String(e).replace(/([;&,\.\+\*\~'`:"\!\^#$%@\[\]\(\)=<>\|\/? {}\\])/g,"\\$1")},base64encode:function(e){var t,i,s,n,a,r,o,l="",d=0,u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";for(e=function(e){e=String(e).replace(/\r\n/g,"\n");for(var t="",i=0;i<e.length;i++){var s=e.charCodeAt(i);s<128?t+=String.fromCharCode(s):s>127&&s<2048?(t+=String.fromCharCode(s>>6|192),t+=String.fromCharCode(63&s|128)):(t+=String.fromCharCode(s>>12|224),t+=String.fromCharCode(s>>6&63|128),t+=String.fromCharCode(63&s|128))}return t}(e);d<e.length;)t=e.charCodeAt(d++),i=e.charCodeAt(d++),s=e.charCodeAt(d++),n=t>>2,a=(3&t)<<4|i>>4,r=(15&i)<<2|s>>6,o=63&s,isNaN(i)?r=o=64:isNaN(s)&&(o=64),l=l+u.charAt(n)+u.charAt(a)+u.charAt(r)+u.charAt(o);return l},base64decode:function(e){var t,i,s,n,a,r,o,l="",d=0,u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");d<e.length;)n=u.indexOf(e.charAt(d++)),a=u.indexOf(e.charAt(d++)),r=u.indexOf(e.charAt(d++)),o=u.indexOf(e.charAt(d++)),t=n<<2|a>>4,i=(15&a)<<4|r>>2,s=(3&r)<<6|o,l+=String.fromCharCode(t),64!==r&&(l+=String.fromCharCode(i)),64!==o&&(l+=String.fromCharCode(s));return l=function(e){for(var t,i,s="",n=0,a=0;n<e.length;)(a=e.charCodeAt(n))<128?(s+=String.fromCharCode(a),n++):a>191&&a<224?(t=e.charCodeAt(n+1),s+=String.fromCharCode((31&a)<<6|63&t),n+=2):(t=e.charCodeAt(n+1),i=e.charCodeAt(n+2),s+=String.fromCharCode((15&a)<<12|(63&t)<<6|63&i),n+=3);return s}(l)},md5:function(e){function t(e,t,i,s,n,a){return r(function(e,t){return e<<t|e>>>32-t}(r(r(t,e),r(s,a)),n),i)}function i(e,i,s,n,a,r,o){return t(i&s|~i&n,e,i,a,r,o)}function s(e,i,s,n,a,r,o){return t(i&n|s&~n,e,i,a,r,o)}function n(e,i,s,n,a,r,o){return t(i^s^n,e,i,a,r,o)}function a(e,i,s,n,a,r,o){return t(s^(i|~n),e,i,a,r,o)}function r(e,t){var i=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(i>>16)<<16|65535&i}var o=0;return function(e){return function(e){for(var t,i=o?"0123456789ABCDEF":"0123456789abcdef",s="",n=0;n<e.length;n++)t=e.charCodeAt(n),s+=i.charAt(t>>>4&15)+i.charAt(15&t);return s}(function(e){return function(e){for(var t="",i=0;i<32*e.length;i+=8)t+=String.fromCharCode(e[i>>5]>>>i%32&255);return t}(function(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;for(var o=1732584193,l=-271733879,d=-1732584194,u=271733878,c=0;c<e.length;c+=16){var h=o,p=l,f=d,g=u;o=i(o,l,d,u,e[c+0],7,-680876936),u=i(u,o,l,d,e[c+1],12,-389564586),d=i(d,u,o,l,e[c+2],17,606105819),l=i(l,d,u,o,e[c+3],22,-1044525330),o=i(o,l,d,u,e[c+4],7,-176418897),u=i(u,o,l,d,e[c+5],12,1200080426),d=i(d,u,o,l,e[c+6],17,-1473231341),l=i(l,d,u,o,e[c+7],22,-45705983),o=i(o,l,d,u,e[c+8],7,1770035416),u=i(u,o,l,d,e[c+9],12,-1958414417),d=i(d,u,o,l,e[c+10],17,-42063),l=i(l,d,u,o,e[c+11],22,-1990404162),o=i(o,l,d,u,e[c+12],7,1804603682),u=i(u,o,l,d,e[c+13],12,-40341101),d=i(d,u,o,l,e[c+14],17,-1502002290),l=i(l,d,u,o,e[c+15],22,1236535329),o=s(o,l,d,u,e[c+1],5,-165796510),u=s(u,o,l,d,e[c+6],9,-1069501632),d=s(d,u,o,l,e[c+11],14,643717713),l=s(l,d,u,o,e[c+0],20,-373897302),o=s(o,l,d,u,e[c+5],5,-701558691),u=s(u,o,l,d,e[c+10],9,38016083),d=s(d,u,o,l,e[c+15],14,-660478335),l=s(l,d,u,o,e[c+4],20,-405537848),o=s(o,l,d,u,e[c+9],5,568446438),u=s(u,o,l,d,e[c+14],9,-1019803690),d=s(d,u,o,l,e[c+3],14,-187363961),l=s(l,d,u,o,e[c+8],20,1163531501),o=s(o,l,d,u,e[c+13],5,-1444681467),u=s(u,o,l,d,e[c+2],9,-51403784),d=s(d,u,o,l,e[c+7],14,1735328473),l=s(l,d,u,o,e[c+12],20,-1926607734),o=n(o,l,d,u,e[c+5],4,-378558),u=n(u,o,l,d,e[c+8],11,-2022574463),d=n(d,u,o,l,e[c+11],16,1839030562),l=n(l,d,u,o,e[c+14],23,-35309556),o=n(o,l,d,u,e[c+1],4,-1530992060),u=n(u,o,l,d,e[c+4],11,1272893353),d=n(d,u,o,l,e[c+7],16,-155497632),l=n(l,d,u,o,e[c+10],23,-1094730640),o=n(o,l,d,u,e[c+13],4,681279174),u=n(u,o,l,d,e[c+0],11,-358537222),d=n(d,u,o,l,e[c+3],16,-722521979),l=n(l,d,u,o,e[c+6],23,76029189),o=n(o,l,d,u,e[c+9],4,-640364487),u=n(u,o,l,d,e[c+12],11,-421815835),d=n(d,u,o,l,e[c+15],16,530742520),l=n(l,d,u,o,e[c+2],23,-995338651),o=a(o,l,d,u,e[c+0],6,-198630844),u=a(u,o,l,d,e[c+7],10,1126891415),d=a(d,u,o,l,e[c+14],15,-1416354905),l=a(l,d,u,o,e[c+5],21,-57434055),o=a(o,l,d,u,e[c+12],6,1700485571),u=a(u,o,l,d,e[c+3],10,-1894986606),d=a(d,u,o,l,e[c+10],15,-1051523),l=a(l,d,u,o,e[c+1],21,-2054922799),o=a(o,l,d,u,e[c+8],6,1873313359),u=a(u,o,l,d,e[c+15],10,-30611744),d=a(d,u,o,l,e[c+6],15,-1560198380),l=a(l,d,u,o,e[c+13],21,1309151649),o=a(o,l,d,u,e[c+4],6,-145523070),u=a(u,o,l,d,e[c+11],10,-1120210379),d=a(d,u,o,l,e[c+2],15,718787259),l=a(l,d,u,o,e[c+9],21,-343485551),o=r(o,h),l=r(l,p),d=r(d,f),u=r(u,g)}return Array(o,l,d,u)}(function(e){for(var t=Array(e.length>>2),i=0;i<t.length;i++)t[i]=0;for(i=0;i<8*e.length;i+=8)t[i>>5]|=(255&e.charCodeAt(i/8))<<i%32;return t}(e),8*e.length))}(function(e){for(var t,i,s="",n=-1;++n<e.length;)t=e.charCodeAt(n),i=n+1<e.length?e.charCodeAt(n+1):0,55296<=t&&t<=56319&&56320<=i&&i<=57343&&(t=65536+((1023&t)<<10)+(1023&i),n++),t<=127?s+=String.fromCharCode(t):t<=2047?s+=String.fromCharCode(192|t>>>6&31,128|63&t):t<=65535?s+=String.fromCharCode(224|t>>>12&15,128|t>>>6&63,128|63&t):t<=2097151&&(s+=String.fromCharCode(240|t>>>18&7,128|t>>>12&63,128|t>>>6&63,128|63&t));return s}(e)))}(e)},transition:function(t,i,s,n){var a=e(t).width(),r=e(t).height();if(t&&i){switch(t.parentNode.style.cssText+="perspective: 900px; overflow: hidden;",t.style.cssText+="; position: absolute; z-index: 1019; backface-visibility: hidden",i.style.cssText+="; position: absolute; z-index: 1020; backface-visibility: hidden",s){case"slide-left":t.style.cssText+="overflow: hidden; transform: translate3d(0, 0, 0)",i.style.cssText+="overflow: hidden; transform: translate3d("+a+"px, 0, 0)",e(i).show(),window.setTimeout(function(){i.style.cssText+="transition: 0.5s; transform: translate3d(0, 0, 0)",t.style.cssText+="transition: 0.5s; transform: translate3d(-"+a+"px, 0, 0)"},1);break;case"slide-right":t.style.cssText+="overflow: hidden; transform: translate3d(0, 0, 0)",i.style.cssText+="overflow: hidden; transform: translate3d(-"+a+"px, 0, 0)",e(i).show(),window.setTimeout(function(){i.style.cssText+="transition: 0.5s; transform: translate3d(0px, 0, 0)",t.style.cssText+="transition: 0.5s; transform: translate3d("+a+"px, 0, 0)"},1);break;case"slide-down":t.style.cssText+="overflow: hidden; z-index: 1; transform: translate3d(0, 0, 0)",i.style.cssText+="overflow: hidden; z-index: 0; transform: translate3d(0, 0, 0)",e(i).show(),window.setTimeout(function(){i.style.cssText+="transition: 0.5s; transform: translate3d(0, 0, 0)",t.style.cssText+="transition: 0.5s; transform: translate3d(0, "+r+"px, 0)"},1);break;case"slide-up":t.style.cssText+="overflow: hidden; transform: translate3d(0, 0, 0)",i.style.cssText+="overflow: hidden; transform: translate3d(0, "+r+"px, 0)",e(i).show(),window.setTimeout(function(){i.style.cssText+="transition: 0.5s; transform: translate3d(0, 0, 0)",t.style.cssText+="transition: 0.5s; transform: translate3d(0, 0, 0)"},1);break;case"flip-left":t.style.cssText+="overflow: hidden; transform: rotateY(0deg)",i.style.cssText+="overflow: hidden; transform: rotateY(-180deg)",e(i).show(),window.setTimeout(function(){i.style.cssText+="transition: 0.5s; transform: rotateY(0deg)",t.style.cssText+="transition: 0.5s; transform: rotateY(180deg)"},1);break;case"flip-right":t.style.cssText+="overflow: hidden; transform: rotateY(0deg)",i.style.cssText+="overflow: hidden; transform: rotateY(180deg)",e(i).show(),window.setTimeout(function(){i.style.cssText+="transition: 0.5s; transform: rotateY(0deg)",t.style.cssText+="transition: 0.5s; transform: rotateY(-180deg)"},1);break;case"flip-down":t.style.cssText+="overflow: hidden; transform: rotateX(0deg)",i.style.cssText+="overflow: hidden; transform: rotateX(180deg)",e(i).show(),window.setTimeout(function(){i.style.cssText+="transition: 0.5s; transform: rotateX(0deg)",t.style.cssText+="transition: 0.5s; transform: rotateX(-180deg)"},1);break;case"flip-up":t.style.cssText+="overflow: hidden; transform: rotateX(0deg)",i.style.cssText+="overflow: hidden; transform: rotateX(-180deg)",e(i).show(),window.setTimeout(function(){i.style.cssText+="transition: 0.5s; transform: rotateX(0deg)",t.style.cssText+="transition: 0.5s; transform: rotateX(180deg)"},1);break;case"pop-in":t.style.cssText+="overflow: hidden; transform: translate3d(0, 0, 0)",i.style.cssText+="overflow: hidden; transform: translate3d(0, 0, 0); transform: scale(.8); opacity: 0;",e(i).show(),window.setTimeout(function(){i.style.cssText+="transition: 0.5s; transform: scale(1); opacity: 1;",t.style.cssText+="transition: 0.5s;"},1);break;case"pop-out":t.style.cssText+="overflow: hidden; transform: translate3d(0, 0, 0); transform: scale(1); opacity: 1;",i.style.cssText+="overflow: hidden; transform: translate3d(0, 0, 0); opacity: 0;",e(i).show(),window.setTimeout(function(){i.style.cssText+="transition: 0.5s; opacity: 1;",t.style.cssText+="transition: 0.5s; transform: scale(1.7); opacity: 0;"},1);break;default:t.style.cssText+="overflow: hidden; transform: translate3d(0, 0, 0)",i.style.cssText+="overflow: hidden; translate3d(0, 0, 0); opacity: 0;",e(i).show(),window.setTimeout(function(){i.style.cssText+="transition: 0.5s; opacity: 1;",t.style.cssText+="transition: 0.5s"},1)}setTimeout(function(){"slide-down"===s&&(e(t).css("z-index","1019"),e(i).css("z-index","1020")),i&&e(i).css({opacity:"1"}).css(w2utils.cssPrefix({transition:"",transform:""})),t&&e(t).css({opacity:"1"}).css(w2utils.cssPrefix({transition:"",transform:""})),"function"==typeof n&&n()},500)}else console.log("ERROR: Cannot do transition when one of the divs is null")},lock:function(t,i,s){var n={};"object"==typeof i?n=i:(n.msg=i,n.spinner=s),n.msg||0===n.msg||(n.msg=""),w2utils.unlock(t),e(t).prepend('<div class="w2ui-lock"></div><div class="w2ui-lock-msg"></div>');var a=e(t).find(".w2ui-lock"),r=e(t).find(".w2ui-lock-msg");n.msg||r.css({"background-color":"transparent",border:"0px"}),!0===n.spinner&&(n.msg='<div class="w2ui-spinner" '+(n.msg?"":'style="width: 35px; height: 35px"')+"></div>"+n.msg),null!=n.opacity&&a.css("opacity",n.opacity),"function"==typeof a.fadeIn?(a.fadeIn(200),r.html(n.msg).fadeIn(200)):(a.show(),r.html(n.msg).show(0))},unlock:function(i,s){t(s)?(e(i).find(".w2ui-lock").fadeOut(s),setTimeout(function(){e(i).find(".w2ui-lock").remove(),e(i).find(".w2ui-lock-msg").remove()},s)):(e(i).find(".w2ui-lock").remove(),e(i).find(".w2ui-lock-msg").remove())},message:function(t,i){function s(i,s){if(null==a&&!0===(a=s.trigger({phase:"before",type:"open",target:"self"})).isCancelled)return c.css("z-index",c.data("old-z-index")),void e(t.box).find("#w2ui-message"+p).remove();var n=i.data("prev_focus");i.remove(),n&&n.length>0?n.focus():r&&r.focus&&r.focus(),c.css("z-index",c.data("old-z-index")),s.trigger(e.extend(a,{phase:"after"}))}var n,a,r=this;e().w2tag(),i||(i={width:200,height:100}),null==i.on&&e.extend(i,w2utils.event),null==i.width&&(i.width=200),null==i.height&&(i.height=100);var o=parseInt(e(t.box).width()),l=parseInt(e(t.box).height()),d=parseInt(e(t.box).find(t.title).css("height")||0);i.width>o&&(i.width=o-10),i.height>l-d&&(i.height=l-10-d),i.originalWidth=i.width,i.originalHeight=i.height,parseInt(i.width)<0&&(i.width=o+i.width),parseInt(i.width)<10&&(i.width=10),parseInt(i.height)<0&&(i.height=l+i.height-d),parseInt(i.height)<10&&(i.height=10),null==i.hideOnClick&&(i.hideOnClick=!1);var u=e(t.box).data("options")||{};(null==i.width||i.width>u.width-10)&&(i.width=u.width-10),(null==i.height||i.height>u.height-d-5)&&(i.height=u.height-d-5),i.originalHeight<0&&(i.height=l+i.originalHeight-d),i.originalWidth<0&&(i.width=o+2*i.originalWidth);var c=e(t.box).find(t.title),h=e(t.box).find(".w2ui-message.w2ui-closing");e(t.box).find(".w2ui-message.w2ui-closing").length>0&&(clearTimeout(n),s(h,h.data("options")||{}));var p=e(t.box).find(".w2ui-message").length;if(""===e.trim(i.html)&&""===e.trim(i.body)&&""===e.trim(i.buttons)){if(0===p)return;var f=e(t.box).find("#w2ui-message"+(p-1)),i=f.data("options")||{};if(!0===(a=i.trigger({phase:"before",type:"close",target:"self"})).isCancelled)return;f.css(w2utils.cssPrefix({transition:"0.15s",transform:"translateY(-"+i.height+"px)"})).addClass("w2ui-closing"),1==p?this.unlock&&(t.param?this.unlock(t.param,150):this.unlock(150)):e(t.box).find("#w2ui-message"+(p-2)).css("z-index",1500),n=setTimeout(function(){s(f,i)},150)}else{""===e.trim(i.body)&&""===e.trim(i.buttons)||(i.html='<div class="w2ui-message-body">'+(i.body||"")+'</div><div class="w2ui-message-buttons">'+(i.buttons||"")+"</div>"),e(t.box).find(".w2ui-message").css("z-index",1390),c.data("old-z-index",c.css("z-index")),c.css("z-index",1501),e(t.box).find(t.body).before('<div id="w2ui-message'+p+'" onmousedown="event.stopPropagation();"    class="w2ui-message" style="display: none; z-index: 1500; '+(0===c.length?"top: 0px;":"top: "+w2utils.getSize(c,"height")+"px;")+(null!=i.width?"width: "+i.width+"px; left: "+(o-i.width)/2+"px;":"left: 10px; right: 10px;")+(null!=i.height?"height: "+i.height+"px;":"bottom: 6px;")+w2utils.cssPrefix("transition",".3s",!0)+'"'+(!0===i.hideOnClick?t.param?'onclick="'+t.path+".message('"+t.param+"');\"":'onclick="'+t.path+'.message();"':"")+"></div>"),e(t.box).find("#w2ui-message"+p).data("options",i).data("prev_focus",e(":focus"));var g=e(t.box).find("#w2ui-message"+p).css("display");if(e(t.box).find("#w2ui-message"+p).css(w2utils.cssPrefix({transform:"none"==g?"translateY(-"+i.height+"px)":"translateY(0px)"})),"none"==g){if(e(t.box).find("#w2ui-message"+p).show().html(i.html),i.box=e(t.box).find("#w2ui-message"+p),!0===(a=i.trigger({phase:"before",type:"open",target:"self"})).isCancelled)return c.css("z-index",c.data("old-z-index")),void e(t.box).find("#w2ui-message"+p).remove();setTimeout(function(){e(t.box).find("#w2ui-message"+p).css(w2utils.cssPrefix({transform:"none"==g?"translateY(0px)":"translateY(-"+i.height+"px)"}))},1),0===p&&this.lock&&(t.param?this.lock(t.param):this.lock()),setTimeout(function(){e(t.box).find("#w2ui-message"+p).css(w2utils.cssPrefix({transition:"0s"})),i.trigger(e.extend(a,{phase:"after"}))},350)}}},naturalCompare:function(e,t){function i(e,t,n){if(n){for(s=t;(n=i(e,s))<76&&n>65;)++s;return+e.slice(t-1,s)}return(n=l&&l.indexOf(e.charAt(t)))>-1?n+76:(n=e.charCodeAt(t)||0)<45||n>127?n:n<46?65:n<48?n-1:n<58?n+18:n<65?n-11:n<91?n+11:n<97?n-37:n<123?n+5:n-63}var s,n,a=1,r=0,o=0,l=String.alphabet;if((e+="")!=(t+=""))for(;a;)if(n=i(e,r++),a=i(t,o++),n<76&&a<76&&n>66&&a>66&&(n=i(e,r,r),a=i(t,o,r=s),o=s),n!=a)return n<a?-1:1;return 0},lang:function(e){var t=this.settings.phrases[e];return null==t?e:t},locale:function(t,i){return t||(t="en-us"),"string"!=typeof t?void(w2utils.settings=e.extend(!0,w2utils.settings,t)):(5===t.length&&(t="locale/"+t+".json"),w2utils.settings.phrases={},void e.ajax({url:t,type:"GET",dataType:"JSON",success:function(t,s,n){w2utils.settings=e.extend(!0,w2utils.settings,t),"function"==typeof i&&i()},error:function(e,i,s){console.log("ERROR: Cannot load locale "+t)}}))},getSize:function(t,i){var s=e(t),n={left:parseInt(s.css("border-left-width"))||0,right:parseInt(s.css("border-right-width"))||0,top:parseInt(s.css("border-top-width"))||0,bottom:parseInt(s.css("border-bottom-width"))||0},a={left:parseInt(s.css("margin-left"))||0,right:parseInt(s.css("margin-right"))||0,top:parseInt(s.css("margin-top"))||0,bottom:parseInt(s.css("margin-bottom"))||0},r={left:parseInt(s.css("padding-left"))||0,right:parseInt(s.css("padding-right"))||0,top:parseInt(s.css("padding-top"))||0,bottom:parseInt(s.css("padding-bottom"))||0};switch(i){case"top":return n.top+a.top+r.top;case"bottom":return n.bottom+a.bottom+r.bottom;case"left":return n.left+a.left+r.left;case"right":return n.right+a.right+r.right;case"width":return n.left+n.right+a.left+a.right+r.left+r.right+parseInt(s.width());case"height":return n.top+n.bottom+a.top+a.bottom+r.top+r.bottom+parseInt(s.height());case"+width":return n.left+n.right+a.left+a.right+r.left+r.right;case"+height":return n.top+n.bottom+a.top+a.bottom+r.top+r.bottom}return 0},getStrWidth:function(t,s){var n,a='<div id="_tmp_width" style="position: absolute; top: -900px;'+(s||"")+'">'+i(t)+"</div>";return e("body").append(a),n=e("#_tmp_width").width(),e("#_tmp_width").remove(),n},scrollBarSize:function(){return n.scrollBarSize?n.scrollBarSize:(e("body").append('<div id="_scrollbar_width" style="position: absolute; top: -300px; width: 100px; height: 100px; overflow-y: scroll;">    <div style="height: 120px">1</div></div>'),n.scrollBarSize=100-e("#_scrollbar_width > div").width(),e("#_scrollbar_width").remove(),String(navigator.userAgent).indexOf("MSIE")>=0&&(n.scrollBarSize=n.scrollBarSize/2),n.scrollBarSize)},checkName:function(e,t){return e&&null!=e.name?null!=w2ui[e.name]?(console.log('ERROR: The parameter "name" is not unique. There are other objects already created with the same name (obj: '+e.name+")."),!1):!!w2utils.isAlphaNumeric(e.name)||(console.log('ERROR: The parameter "name" has to be alpha-numeric (a-z, 0-9, dash and underscore). '),!1):(console.log('ERROR: The parameter "name" is required but not supplied in $().'+t+"()."),!1)},checkUniqueId:function(t,i,s,n){e.isArray(i)||(i=[i]);for(var a=0;a<i.length;a++)if(i[a].id===t)return console.log('ERROR: The parameter "id='+t+'" is not unique within the current '+s+". (obj: "+n+")"),!1;return!0},parseRoute:function(e){var t=[],i=e.replace(/\/\(/g,"(?:/").replace(/\+/g,"__plus__").replace(/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?/g,function(e,i,s,n,a,r){return t.push({name:n,optional:!!r}),i=i||"",(r?"":i)+"(?:"+(r?i:"")+(s||"")+(a||s&&"([^/.]+?)"||"([^/]+?)")+")"+(r||"")}).replace(/([\/.])/g,"\\$1").replace(/__plus__/g,"(.+)").replace(/\*/g,"(.*)");return{path:new RegExp("^"+i+"$","i"),keys:t}},cssPrefix:function(t,i,s){var n={},a={},r="";e.isPlainObject(t)?(n=t,!0===i&&(s=!0)):n[t]=i;for(var o in n)a[o]=n[o],a["-webkit-"+o]=n[o],a["-moz-"+o]=n[o].replace("-webkit-","-moz-"),a["-ms-"+o]=n[o].replace("-webkit-","-ms-"),a["-o-"+o]=n[o].replace("-webkit-","-o-");if(!0===s)for(var o in a)r+=o+": "+a[o]+"; ";else r=a;return r},parseColor:function(e){if("string"!=typeof e)return null;"#"==(e=e.trim().toUpperCase())[0]&&(e=e.substr(1));var t={};if(3==e.length)t={r:parseInt(e[0]+e[0],16),g:parseInt(e[1]+e[1],16),b:parseInt(e[2]+e[2],16),a:1};else if(6==e.length)t={r:parseInt(e.substr(0,2),16),g:parseInt(e.substr(2,2),16),b:parseInt(e.substr(4,2),16),a:1};else if(e.length>4&&"RGB("==e.substr(0,4))i=e.replace("RGB","").replace(/\(/g,"").replace(/\)/g,"").split(","),t={r:parseInt(i[0],10),g:parseInt(i[1],10),b:parseInt(i[2],10),a:1};else{if(!(e.length>5&&"RGBA("==e.substr(0,5)))return null;var i=e.replace("RGBA","").replace(/\(/g,"").replace(/\)/g,"").split(",");t={r:parseInt(i[0],10),g:parseInt(i[1],10),b:parseInt(i[2],10),a:parseFloat(i[3])}}return t},hsv2rgb:function(e,t,i,s){var n,a,r,o,l,d,u,c;switch(1===arguments.length&&(t=e.s,i=e.v,s=e.a,e=e.h),e/=360,t/=100,i/=100,o=Math.floor(6*e),l=6*e-o,d=i*(1-t),u=i*(1-l*t),c=i*(1-(1-l)*t),o%6){case 0:n=i,a=c,r=d;break;case 1:n=u,a=i,r=d;break;case 2:n=d,a=i,r=c;break;case 3:n=d,a=u,r=i;break;case 4:n=c,a=d,r=i;break;case 5:n=i,a=d,r=u}return{r:Math.round(255*n),g:Math.round(255*a),b:Math.round(255*r),a:null!=s?s:1}},rgb2hsv:function(e,t,i,s){1===arguments.length&&(t=e.g,i=e.b,s=e.a,e=e.r);var n,a=Math.max(e,t,i),r=Math.min(e,t,i),o=a-r,l=0===a?0:o/a,d=a/255;switch(a){case r:n=0;break;case e:n=t-i+o*(t<i?6:0),n/=6*o;break;case t:n=i-e+2*o,n/=6*o;break;case i:n=e-t+4*o,n/=6*o}return{h:Math.round(360*n),s:Math.round(100*l),v:Math.round(100*d),a:null!=s?s:1}},getCursorPosition:function(e){if(null==e)return null;var t,i=0,s=e.ownerDocument||e.document,n=s.defaultView||s.parentWindow;if(e.tagName&&"INPUT"==e.tagName.toUpperCase()&&e.selectionStart)i=e.selectionStart;else if(n.getSelection){if((t=n.getSelection()).rangeCount>0){var a=t.getRangeAt(0),r=a.cloneRange();r.selectNodeContents(e),r.setEnd(a.endContainer,a.endOffset),i=r.toString().length}}else if((t=s.selection)&&"Control"!=t.type){var o=t.createRange(),l=s.body.createTextRange();l.moveToElementText(e),l.setEndPoint("EndToEnd",o),i=l.text.length}return i},setCursorPosition:function(t,i,s){var n,a=document.createRange(),r=window.getSelection();if(null!=t){for(var o=0;o<t.childNodes.length;o++){var l=e(t.childNodes[o]).text();if(t.childNodes[o].tagName&&(l=e(t.childNodes[o]).html(),l=l.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&nbsp;/g," ")),i<=l.length){(n=t.childNodes[o]).childNodes&&n.childNodes.length>0&&(n=n.childNodes[0]),n.childNodes&&n.childNodes.length>0&&(n=n.childNodes[0]);break}i-=l.length}null!=n&&(i>n.length&&(i=n.length),a.setStart(n,i),s?a.setEnd(n,s):a.collapse(!0),r.removeAllRanges(),r.addRange(a))}},testLocalStorage:s,hasLocalStorage:s(),isIOS:-1!=navigator.userAgent.toLowerCase().indexOf("iphone")||-1!=navigator.userAgent.toLowerCase().indexOf("ipod")||-1!=navigator.userAgent.toLowerCase().indexOf("ipad")||-1!=navigator.userAgent.toLowerCase().indexOf("mobile")||-1!=navigator.userAgent.toLowerCase().indexOf("android"),isIE:-1!=navigator.userAgent.toLowerCase().indexOf("msie")||-1!=navigator.userAgent.toLowerCase().indexOf("trident")}}(jQuery);w2utils.formatters={number:function(e,t){return parseInt(t)>20&&(t=20),parseInt(t)<0&&(t=0),null==e||""===e?"":w2utils.formatNumber(parseFloat(e),t,!0)},float:function(e,t){return w2utils.formatters.number(e,t)},int:function(e,t){return w2utils.formatters.number(e,0)},money:function(e,t){if(null==e||""===e)return"";var i=w2utils.formatNumber(Number(e),w2utils.settings.currencyPrecision||2);return(w2utils.settings.currencyPrefix||"")+i+(w2utils.settings.currencySuffix||"")},currency:function(e,t){return w2utils.formatters.money(e,t)},percent:function(e,t){return null==e||""===e?"":w2utils.formatNumber(e,t||1)+"%"},size:function(e,t){return null==e||""===e?"":w2utils.formatSize(parseInt(e))},date:function(e,t){if(""===t&&(t=w2utils.settings.dateFormat),null==e||0===e||""===e)return"";var i=w2utils.isDateTime(e,t,!0);return!1===i&&(i=w2utils.isDate(e,t,!0)),'<span title="'+i+'">'+w2utils.formatDate(i,t)+"</span>"},datetime:function(e,t){if(""===t&&(t=w2utils.settings.datetimeFormat),null==e||0===e||""===e)return"";var i=w2utils.isDateTime(e,t,!0);return!1===i&&(i=w2utils.isDate(e,t,!0)),'<span title="'+i+'">'+w2utils.formatDateTime(i,t)+"</span>"},time:function(e,t){if(""===t&&(t=w2utils.settings.timeFormat),"h12"===t&&(t="hh:mi pm"),"h24"===t&&(t="h24:mi"),null==e||0===e||""===e)return"";var i=w2utils.isDateTime(e,t,!0);return!1===i&&(i=w2utils.isDate(e,t,!0)),'<span title="'+i+'">'+w2utils.formatTime(e,t)+"</span>"},timestamp:function(e,t){if(""===t&&(t=w2utils.settings.datetimeFormat),null==e||0===e||""===e)return"";var i=w2utils.isDateTime(e,t,!0);return!1===i&&(i=w2utils.isDate(e,t,!0)),i.toString?i.toString():""},gmt:function(e,t){if(""===t&&(t=w2utils.settings.datetimeFormat),null==e||0===e||""===e)return"";var i=w2utils.isDateTime(e,t,!0);return!1===i&&(i=w2utils.isDate(e,t,!0)),i.toUTCString?i.toUTCString():""},age:function(e,t){if(null==e||0===e||""===e)return"";var i=w2utils.isDateTime(e,null,!0);return!1===i&&(i=w2utils.isDate(e,null,!0)),'<span title="'+i+'">'+w2utils.age(e)+(t?" "+t:"")+"</span>"},interval:function(e,t){return null==e||0===e||""===e?"":w2utils.interval(e)+(t?" "+t:"")},toggle:function(e,t){return e?"Yes":""},password:function(e,t){for(var i="",s=0;s<e.length;s++)i+="*";return i}},w2utils.event={on:function(e,t){var i,s=jQuery;if("string"==typeof e&&-1!=e.indexOf(".")&&(e=(n=e.split("."))[0],i=n[1]),"string"==typeof e&&-1!=e.indexOf(":")){var n=e.split(":");-1!=["complete","done"].indexOf(e[1])&&(e[1]="after"),e={type:n[0],execute:n[1]}}return s.isPlainObject(e)||(e={type:e,scope:i}),(e=s.extend({type:null,execute:"before",target:null,onComplete:null},e)).type?t?(s.isArray(this.handlers)||(this.handlers=[]),void this.handlers.push({edata:e,handler:t})):void console.log("ERROR: You must specify event handler function when calling .on() method of "+this.name):void console.log("ERROR: You must specify event type when calling .on() method of "+this.name)},off:function(e,t){var i,s=jQuery;if("string"==typeof e&&-1!=e.indexOf(".")&&(e=(n=e.split("."))[0],i=n[1]),"string"==typeof e&&-1!=e.indexOf(":")){var n=e.split(":");-1!=["complete","done"].indexOf(e[1])&&(e[1]="after"),e={type:n[0],execute:n[1]}}if(s.isPlainObject(e)||(e={type:e}),(e=s.extend({},{type:null,execute:"before",target:null,onComplete:null},e)).type||i){t||(t=null);for(var a=[],r=0,o=this.handlers.length;r<o;r++){var l=this.handlers[r];(l.edata.type!==e.type&&"*"!==e.type&&(null==l.edata.scope||""!=e.type)||l.edata.target!==e.target&&null!=e.target||l.edata.execute!==e.execute&&null!=e.execute||!(l.handler===t&&null!=t||null!=i&&l.edata.scope==i))&&a.push(l)}this.handlers=a}else console.log("ERROR: You must specify event type when calling .off() method of "+this.name)},trigger:function(e){var t=jQuery;"before"===(e=t.extend({type:null,phase:"before",target:null,doneHandlers:[]},e,{isStopped:!1,isCancelled:!1,done:function(e){this.doneHandlers.push(e)},preventDefault:function(){this.isCancelled=!0},stopPropagation:function(){this.isStopped=!0}})).phase&&(e.onComplete=null);var i,s,n;null==e.target&&(e.target=null),t.isArray(this.handlers)||(this.handlers=[]);for(var a=this.handlers.length-1;a>=0;a--){var r=this.handlers[a];if(!(r.edata.type!==e.type&&"*"!==r.edata.type||r.edata.target!==e.target&&null!=r.edata.target||r.edata.execute!==e.phase&&"*"!==r.edata.execute&&"*"!==r.edata.phase)&&(e=t.extend({},r.edata,e),i=[],(n=new RegExp(/\((.*?)\)/).exec(r.handler))&&(i=n[1].split(/\s*,\s*/)),2===i.length?r.handler.call(this,e.target,e):r.handler.call(this,e),!0===e.isStopped||!0===e.stop))return e}var o="on"+e.type.substr(0,1).toUpperCase()+e.type.substr(1);if("before"===e.phase&&"function"==typeof this[o]&&(s=this[o],i=[],(n=new RegExp(/\((.*?)\)/).exec(s))&&(i=n[1].split(/\s*,\s*/)),2===i.length?s.call(this,e.target,e):s.call(this,e),!0===e.isStopped||!0===e.stop))return e;if(null!=e.object&&"before"===e.phase&&"function"==typeof e.object[o]&&(s=e.object[o],i=[],(n=new RegExp(/\((.*?)\)/).exec(s))&&(i=n[1].split(/\s*,\s*/)),2===i.length?s.call(this,e.target,e):s.call(this,e),!0===e.isStopped||!0===e.stop))return e;if("after"===e.phase){"function"==typeof e.onComplete&&e.onComplete.call(this,e);for(var l=0;l<e.doneHandlers.length;l++)"function"==typeof e.doneHandlers[l]&&e.doneHandlers[l].call(this,e)}return e}},function(e){e.fn.w2render=function(t){e(this).length>0&&("string"==typeof t&&w2ui[t]&&w2ui[t].render(e(this)[0]),"object"==typeof t&&t.render(e(this)[0]))},e.fn.w2destroy=function(e){!e&&this.length>0&&(e=this.attr("name")),"string"==typeof e&&w2ui[e]&&w2ui[e].destroy(),"object"==typeof e&&e.destroy()},e.fn.w2marker=function(){function t(e,t){for(;-1!=t.innerHTML.indexOf('<span class="w2ui-marker">');)t.innerHTML=t.innerHTML.replace(/\<span class=\"w2ui\-marker\"\>((.|\n|\r)*)\<\/span\>/gi,"$1")}var i=Array.prototype.slice.call(arguments,0);return Array.isArray(i[0])&&(i=i[0]),0!==i.length&&i[0]?e(this).each(function(e,s){t(0,s);for(var n=0;n<i.length;n++){var a=i[n];"string"!=typeof a&&(a=String(a)),a=a.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&").replace(/&/g,"&amp;").replace(/</g,"&gt;").replace(/>/g,"&lt;");var r=new RegExp(a+"(?!([^<]+)?>)","gi");s.innerHTML=s.innerHTML.replace(r,function(e){return'<span class="w2ui-marker">'+e+"</span>"})}}):e(this).each(t)},e.fn.w2tag=function(t,i){return 1==arguments.length&&"object"==typeof t&&null!=(i=t).html&&(t=i.html),null!=(i=e.extend({id:null,html:t,position:"right|top",align:"none",left:0,top:0,style:"",css:{},className:"",inputClass:"",onShow:null,onHide:null,hideOnKeyPress:!0,hideOnBlur:!1,hideOnClick:!1,hideOnChange:!0},i)).name&&null==i.id&&(i.id=i.name),""!==i.class&&""===i.inputClass&&(i.inputClass=i.class),0===e(this).length?void e(".w2ui-tag").each(function(t,i){var s=e(i).data("w2tag");s&&s.hide()}):e(this).each(function(s,n){function a(){if(l.box.css("display","block"),l&&l.box&&e(l.attachedTo).offset()){var t=l.getPos();l.box.css({opacity:"1",left:t.left+"px",top:t.top+"px"}).data("w2tag",l).find(".w2ui-tag-body").addClass(t.posClass),l.tmp.pos=t.left+"x"+t.top,e(l.attachedTo).off(".w2tag").css(l.options.css).addClass(l.options.inputClass),l.options.hideOnKeyPress&&e(l.attachedTo).on("keypress.w2tag",l.hide),i.hideOnChange&&("INPUT"==n.nodeName?e(n).on("change.w2tag",l.hide):e(n).find("input").on("change.w2tag",l.hide)),l.options.hideOnBlur&&e(l.attachedTo).on("blur.w2tag",l.hide),l.options.hideOnClick&&e(document).on("click.w2tag",l.hide),"function"==typeof l.options.onShow&&l.options.onShow(),r()}}function r(t){var i=e(l.attachedTo).offset();if(0===e(l.attachedTo).length||0===i.left&&0===i.top||0===l.box.find(".w2ui-tag-body").length)l.hide();else{var s=o();l.tmp.pos!==s.left+"x"+s.top&&(l.box.css(w2utils.cssPrefix({transition:t?"0s":".2s"})).css({left:s.left+"px",top:s.top+"px"}),l.tmp.pos=s.left+"x"+s.top),l.tmp.timer&&clearTimeout(l.tmp.timer),l.tmp.timer=setTimeout(r,100)}}function o(){var t=e(l.attachedTo).offset(),i="w2ui-tag-right",s=parseInt(t.left+l.attachedTo.offsetWidth+(l.options.left?l.options.left:0)),n=parseInt(t.top+(l.options.top?l.options.top:0)),a=l.box.find(".w2ui-tag-body"),r=a[0].offsetWidth,o=a[0].offsetHeight;if("string"==typeof l.options.position&&-1!=l.options.position.indexOf("|")&&(l.options.position=l.options.position.split("|")),"top"==l.options.position)i="w2ui-tag-top",s=parseInt(t.left+(l.options.left?l.options.left:0))-14,n=parseInt(t.top+(l.options.top?l.options.top:0))-o-10;else if("bottom"==l.options.position)i="w2ui-tag-bottom",s=parseInt(t.left+(l.options.left?l.options.left:0))-14,n=parseInt(t.top+l.attachedTo.offsetHeight+(l.options.top?l.options.top:0))+10;else if("left"==l.options.position)i="w2ui-tag-left",s=parseInt(t.left+(l.options.left?l.options.left:0))-r-20,n=parseInt(t.top+(l.options.top?l.options.top:0));else if(Array.isArray(l.options.position)){for(var d=window.innerWidth,u=window.innerHeight,c=0;c<l.options.position.length;c++){var h=l.options.position[c];if("right"==h){if(i="w2ui-tag-right",s=parseInt(t.left+l.attachedTo.offsetWidth+(l.options.left?l.options.left:0)),n=parseInt(t.top+(l.options.top?l.options.top:0)),s+r<=d)break}else if("left"==h){if(i="w2ui-tag-left",s=parseInt(t.left+(l.options.left?l.options.left:0))-r-20,n=parseInt(t.top+(l.options.top?l.options.top:0)),s>=0)break}else if("top"==h){if(i="w2ui-tag-top",s=parseInt(t.left+(l.options.left?l.options.left:0))-14,n=parseInt(t.top+(l.options.top?l.options.top:0))-o-10,s+r<=d&&n>=0)break}else if("bottom"==h&&(i="w2ui-tag-bottom",s=parseInt(t.left+(l.options.left?l.options.left:0))-14,n=parseInt(t.top+l.attachedTo.offsetHeight+(l.options.top?l.options.top:0))+10,s+r<=d&&n+o<=u))break}a.data("posClass")!==i&&a.removeClass("w2ui-tag-right w2ui-tag-left w2ui-tag-top w2ui-tag-bottom").addClass(i).data("posClass",i)}return{left:s,top:n,posClass:i}}var l,d=i.id?i.id:n.id;""==d&&(d=e(n).find("input").attr("id")),d||(d="noid");var u=w2utils.escapeId(d);null!=e(this).data("w2tag")?(l=e(this).data("w2tag"),e.extend(l.options,i)):l={id:d,attachedTo:n,box:e("#w2ui-tag-"+u),options:e.extend({},i),init:a,hide:function(){l.box.length<=0||(l.tmp.timer&&clearTimeout(l.tmp.timer),l.box.remove(),l.options.hideOnClick&&e(document).off(".w2tag"),e(l.attachedTo).off(".w2tag").removeClass(l.options.inputClass).removeData("w2tag"),e(l.attachedTo).length>0&&(e(l.attachedTo)[0].style.cssText=l.tmp.originalCSS),"function"==typeof l.options.onHide&&l.options.onHide())},getPos:o,isMoved:r,tmp:{}},""===t||null==t?l.hide():0!==l.box.length?l.box.find(".w2ui-tag-body").css(l.options.css).attr("style",l.options.style).addClass(l.options.className).html(l.options.html):(l.tmp.originalCSS="",e(l.attachedTo).length>0&&(l.tmp.originalCSS=e(l.attachedTo)[0].style.cssText),e("body").append('<div onclick="event.stopPropagation()" style="display: none;" id="w2ui-tag-'+l.id+'"        class="w2ui-tag '+(e(l.attachedTo).parents(".w2ui-popup, .w2ui-overlay-popup, .w2ui-message").length>0?"w2ui-tag-popup":"")+'">   <div style="margin: -2px 0px 0px -2px; white-space: nowrap;">      <div class="w2ui-tag-body '+l.options.className+'" style="'+(l.options.style||"")+'">'+t+"</div>   </div></div>"),l.box=e("#w2ui-tag-"+u),e(l.attachedTo).data("w2tag",l),setTimeout(a,1))})},e.fn.w2overlay=function(t,i){function s(){var t=e("#w2ui-overlay"+o);if(t.data("element")===r[0]&&0!==t.length){var i=e(r).offset()||{},a=i.left+"x"+i.top;t.data("position")!==a?n():setTimeout(s,250)}}function n(t){if(!t||0===t.button){var s=e("#w2ui-overlay"+o);if(!0===s.data("keepOpen"))return void s.removeData("keepOpen");var n;"function"==typeof i.onHide&&(n=i.onHide()),!1!==n&&(s.remove(),e(document).off(".w2overlay"+o),clearInterval(s.data("timer")))}}function a(){var t=e("#w2ui-overlay"+o),s=t.find(" > div"),n=e("#w2ui-overlay"+o+" div.menu");if(n.css("overflow-y","hidden"),t.length>0){s.height("auto").width("auto");var l=!1,d=s.height(),u=s.width();i.width&&i.width<u&&(u=i.width),u<30&&(u=30),i.tmp.contentHeight&&(d=parseInt(i.tmp.contentHeight),s.height(d),setTimeout(function(){var e=s.find("div.menu");d>e.height()&&s.find("div.menu").css("overflow-y","hidden")},1),setTimeout(function(){var e=s.find("div.menu");"auto"!=e.css("overflow-y")&&e.css("overflow-y","auto")},10)),i.tmp.contentWidth&&"both"!=i.align&&(u=parseInt(i.tmp.contentWidth),s.width(u),setTimeout(function(){u>s.find("div.menu > table").width()&&s.find("div.menu > table").css("overflow-x","hidden")},1),setTimeout(function(){s.find("div.menu > table").css("overflow-x","auto")},10));var c=i.left,h=i.width,p=i.tipLeft;switch(i.align){case"both":c=17,0===i.width&&(i.width=w2utils.getSize(e(r),"width")),i.maxWidth&&i.width>i.maxWidth&&(i.width=i.maxWidth);break;case"left":c=17;break;case"right":c=w2utils.getSize(e(r),"width")-u+10,p=u-40}h=30!==u||h?i.width?i.width:"auto":30;var f=(u-17)/2;"auto"!=h&&(f=(h-17)/2),f<25&&(c=25-f,p=Math.floor(f));var g,m,w;i.contextMenu?(g=i.pageX+8,m=i.pageY-0,w=i.pageY):(g=((v=r.offset()||{}).left>25?v.left:25)+c,m=v.top+w2utils.getSize(r,"height")+i.top+7,w=v.top),t.css({left:g+"px",top:m+"px","min-width":h,"min-height":i.height?i.height:"auto"});var v=s.offset()||{},y=window.innerHeight+e(document).scrollTop()-v.top-7,b=window.innerWidth+e(document).scrollLeft()-v.left-7;if(i.contextMenu&&(y=window.innerHeight+e(document).scrollTop()-i.pageY-15,b=window.innerWidth+e(document).scrollLeft()-i.pageX),y>-50&&y<210||!0===i.openAbove){var x;i.contextMenu?(y=i.pageY-7,x=5):(y=v.top-e(document).scrollTop()-7,x=24),i.maxHeight&&y>i.maxHeight&&(y=i.maxHeight),d>y&&(l=!0,s.height(y).width(u).css({"overflow-y":"auto"}),d=y),t.addClass("bottom-arrow"),t.css("top",w-d-x+i.top+"px"),t.find(">style").html("#w2ui-overlay"+o+":before { margin-left: "+parseInt(p)+"px; }#w2ui-overlay"+o+":after { margin-left: "+parseInt(p)+"px; }")}else i.maxHeight&&y>i.maxHeight&&(y=i.maxHeight),d>y&&(l=!0,s.height(y).width(u).css({"overflow-y":"auto"})),t.addClass("top-arrow"),t.find(">style").html("#w2ui-overlay"+o+":before { margin-left: "+parseInt(p)+"px; }#w2ui-overlay"+o+":after { margin-left: "+parseInt(p)+"px; }");u=s.width(),b=window.innerWidth+e(document).scrollLeft()-v.left-7,i.maxWidth&&b>i.maxWidth&&(b=i.maxWidth),u>b&&"both"!==i.align&&(i.align="right",setTimeout(function(){a()},1)),(i.contextMenu||i.noTip)&&t.find(">style").html("#w2ui-overlay"+o+":before { display: none; }#w2ui-overlay"+o+":after { display: none; }"),l&&"both"!=i.align&&s.width(u+w2utils.scrollBarSize()+2)}n.css("overflow-y","auto"),s.height()<t.height()&&s.css("height",t.height()+"px")}var r=this,o="";1==arguments.length&&(i="object"==typeof t?t:{html:t}),2==arguments.length&&(i.html=t),e.isPlainObject(i)||(i={}),(i=e.extend({},{name:null,html:"",align:"none",left:0,top:0,tipLeft:30,noTip:!1,selectable:!1,width:0,height:0,maxWidth:null,maxHeight:null,contextMenu:!1,pageX:null,pageY:null,originalEvent:null,style:"",class:"",overlayStyle:"",onShow:null,onHide:null,openAbove:!1,tmp:{}},i)).name&&(o="-"+i.name);var l;if(0===this.length||""===i.html||null==i.html)return e("#w2ui-overlay"+o).length>0?"function"==typeof(l=e("#w2ui-overlay"+o)[0].hide)&&l():e("#w2ui-overlay"+o).remove(),e(this);e("#w2ui-overlay"+o).length>0&&(l=e("#w2ui-overlay"+o)[0].hide,e(document).off(".w2overlay"+o),"function"==typeof l&&l()),r.length>0&&(null==r[0].tagName||"BODY"==r[0].tagName.toUpperCase())&&(i.contextMenu=!0),i.contextMenu&&i.originalEvent&&(i.pageX=i.originalEvent.pageX,i.pageY=i.originalEvent.pageY),!i.contextMenu||null!=i.pageX&&null!=i.pageY||console.log("ERROR: to display menu at mouse location, pass options.pageX and options.pageY."),e("body").append('<div id="w2ui-overlay'+o+'" style="display: none; left: 0px; top: 0px; '+i.overlayStyle+'"        class="w2ui-reset w2ui-overlay '+(e(this).parents(".w2ui-popup, .w2ui-overlay-popup, .w2ui-message").length>0?"w2ui-overlay-popup":"")+'">    <style></style>    <div style="min-width: 100%; '+i.style+'" class="'+i.class+'"></div></div>');var d=e("#w2ui-overlay"+o),u=d.find(" > div");u.html(i.html);var c=u.css("background-color");null!=c&&"rgba(0, 0, 0, 0)"!==c&&"transparent"!==c&&d.css({"background-color":c,"border-color":c});var h=e(r).offset()||{};return d.data("element",r.length>0?r[0]:null).data("options",i).data("position",h.left+"x"+h.top).fadeIn("fast").on("click",function(t){e("#w2ui-overlay"+o).data("keepOpen",!0),"LABEL"==t.target.tagName.toUpperCase()&&t.stopPropagation()}).on("mousedown",function(e){var t=e.target.tagName.toUpperCase();-1!=["INPUT","TEXTAREA","SELECT"].indexOf(t)||i.selectable||e.preventDefault()}),d[0].hide=n,d[0].resize=a,setTimeout(function(){a(),e(document).off(".w2overlay"+o).on("click.w2overlay"+o,n),"function"==typeof i.onShow&&i.onShow()},10),s(),e(this)},e.fn.w2menu=function(t,i){function s(){setTimeout(function(){e("#w2ui-overlay"+o+" tr.w2ui-selected").removeClass("w2ui-selected");var t=e("#w2ui-overlay"+o+" tr[index="+i.index+"]"),s=e("#w2ui-overlay"+o+" div.menu").scrollTop();if(t.addClass("w2ui-selected"),i.tmp&&(i.tmp.contentHeight=e("#w2ui-overlay"+o+" table").height()+(i.search?50:10)),i.tmp&&(i.tmp.contentWidth=e("#w2ui-overlay"+o+" table").width()),e("#w2ui-overlay"+o).length>0&&e("#w2ui-overlay"+o)[0].resize(),t.length>0){var n=t[0].offsetTop-5,a=e("#w2ui-overlay"+o+" div.menu").height();e("#w2ui-overlay"+o+" div.menu").scrollTop(s),(n<s||n+t.height()>s+a)&&e("#w2ui-overlay"+o+" div.menu").animate({scrollTop:n-(a-2*t.height())/2},200,"linear")}},1)}function n(){if(i.spinner)return'<table class="w2ui-drop-menu"><tbody><tr><td style="padding: 5px 10px 10px 10px; text-align: center">    <div class="w2ui-spinner" style="width: 18px; height: 18px; position: relative; top: 5px;"></div>     <div style="display: inline-block; padding: 3px; color: #999;">'+w2utils.lang("Loading...")+"</div></td></tr></tbody></table>";for(var e=0,t='<table cellspacing="0" cellpadding="0" class="w2ui-drop-menu"><tbody>',s=null,n=null,a=0;a<i.items.length;a++){var r=i.items[a];if("string"==typeof r?r={id:r,text:r}:(null!=r.text&&null==r.id&&(r.id=r.text),null==r.text&&null!=r.id&&(r.text=r.id),null!=r.caption&&(r.text=r.caption),s=r.img,n=r.icon,null==s&&(s=null),null==n&&(n=null)),-1!=["radio","check"].indexOf(i.type)&&(n=!0===r.checked?"w2ui-icon-check":"w2ui-icon-empty"),!0!==r.hidden){var o="",l=r.text;if("function"==typeof i.render&&(l=i.render(r,i)),s&&(o='<td class="menu-icon"><div class="w2ui-tb-image w2ui-icon '+s+'"></div></td>'),n&&(o='<td class="menu-icon" align="center"><span class="w2ui-icon '+n+'"></span></td>'),null==l||""===l||/^-+$/.test(l))t+='<tr><td colspan="3" style="padding: 6px; pointer-events: none"><div style="border-top: 1px solid silver;"></div></td></tr>';else{var d=e%2==0?"w2ui-item-even":"w2ui-item-odd";!0!==i.altRows&&(d="");var u=1;""===o&&u++,null==r.count&&null==r.hotkey&&u++,null==r.tooltip&&null!=r.hint&&(r.tooltip=r.hint),t+='<tr index="'+a+'" style="'+(r.style?r.style:"")+'" '+(r.tooltip?'title="'+w2utils.lang(r.tooltip)+'"':"")+'        class="'+d+" "+(i.index===a?"w2ui-selected":"")+" "+(!0===r.disabled?"w2ui-disabled":"")+'"        onmousedown="if ('+(!0===r.disabled?"true":"false")+") return;               jQuery.fn.w2menuDown(event, '"+a+'\');"        onclick="event.stopPropagation();                if ('+(!0===r.disabled?"true":"false")+") return;               jQuery.fn.w2menuClick(event, '"+a+"');\">"+o+'   <td class="menu-text" colspan="'+u+'">'+w2utils.lang(l)+'</td>   <td class="menu-count">'+(null!=r.count?"<span>"+r.count+"</span>":"")+(null!=r.hotkey?'<span class="hotkey">'+r.hotkey+"</span>":"")+"</td></tr>",e++}}i.items[a]=r}return 0===e&&(t+='<tr><td style="padding: 13px; color: #999; text-align: center">'+i.msgNoItems+"</div></td></tr>"),t+="</tbody></table>"}i&&"function"==typeof i.items&&(i.items=i.items());var a={type:"normal",index:null,items:[],render:null,msgNoItems:"No items",onSelect:null,tmp:{}},r=this,o="";if("refresh"===t)if(e("#w2ui-overlay"+o).length>0){i=e.extend(e.fn.w2menuOptions,i);p=e("#w2ui-overlay"+o+" div.menu").scrollTop();e("#w2ui-overlay"+o+" div.menu").html(n()),e("#w2ui-overlay"+o+" div.menu").scrollTop(p),s()}else e(this).w2menu(i);else{if("refresh-index"!==t){1===arguments.length?i=t:i.items=t,"object"!=typeof i&&(i={}),i=e.extend({},a,i),e.fn.w2menuOptions=i,i.name&&(o="-"+i.name),"function"==typeof i.select&&"function"!=typeof i.onSelect&&(i.onSelect=i.select),"function"==typeof i.onRender&&"function"!=typeof i.render&&(i.render=i.onRender),e.fn.w2menuClick=function(t,s){var n=!1;-1!=["radio","check"].indexOf(i.type)&&(t.shiftKey||t.metaKey||t.ctrlKey)&&(n=!0),"function"==typeof i.onSelect&&i.onSelect({index:s,item:i.items[s],keepOpen:n,originalEvent:t});var a=e("#w2ui-overlay"+o);a.removeData("keepOpen"),a.length>0&&"function"==typeof a[0].hide&&!n&&a[0].hide()},e.fn.w2menuDown=function(t,s){var n=e(t.target).parents("tr"),a=n.find(".w2ui-icon");if("check"==i.type||"radio"==i.type){var r=i.items[s];r.checked=!r.checked,r.checked?("radio"==i.type&&a.parents("table").find(".w2ui-icon").removeClass("w2ui-icon-check").addClass("w2ui-icon-empty"),"check"==i.type&&null!=r.group&&i.items.forEach(function(e,t){e.group===r.group&&e.checked&&(a.parents("table").find("tr[index="+t+"] .w2ui-icon").removeClass("w2ui-icon-check").addClass("w2ui-icon-empty"),e.checked=!1)}),a.removeClass("w2ui-icon-empty").addClass("w2ui-icon-check")):"check"==i.type&&null==r.group&&a.removeClass("w2ui-icon-check").addClass("w2ui-icon-empty")}n.parent().find("tr").removeClass("w2ui-selected"),n.addClass("w2ui-selected")};var l="";if(i.search){l+='<div style="position: absolute; top: 0px; height: 40px; left: 0px; right: 0px; border-bottom: 1px solid silver; background-color: #ECECEC; padding: 8px 5px;">    <div class="w2ui-icon icon-search" style="position: absolute; margin-top: 4px; margin-left: 6px; width: 11px; background-position: left !important;"></div>    <input id="menu-search" type="text" style="width: 100%; outline: none; padding-left: 20px;" onclick="event.stopPropagation();"/></div>',i.style+=";background-color: #ECECEC",i.index=0;for(var d=0;d<i.items.length;d++)i.items[d].hidden=!1}l+='<div class="menu" style="position: absolute; top: '+(i.search?40:0)+'px; bottom: 0px; width: 100%;">'+n()+"</div>";var u=e(this).w2overlay(l,i);return setTimeout(function(){if(e("#w2ui-overlay"+o+" #menu-search").on("keyup",function(t){var n=this.value,a=!1;switch(t.keyCode){case 13:e("#w2ui-overlay"+o).remove(),e.fn.w2menuClick(t,i.index);break;case 9:case 27:e("#w2ui-overlay"+o).remove(),e.fn.w2menuClick(t,-1);break;case 38:for(i.index=w2utils.isInt(i.index)?parseInt(i.index):0,i.index--;i.index>0&&i.items[i.index].hidden;)i.index--;if(0===i.index&&i.items[i.index].hidden)for(;i.items[i.index]&&i.items[i.index].hidden;)i.index++;i.index<0&&(i.index=0),a=!0;break;case 40:for(i.index=w2utils.isInt(i.index)?parseInt(i.index):0,i.index++;i.index<i.items.length-1&&i.items[i.index].hidden;)i.index++;if(i.index===i.items.length-1&&i.items[i.index].hidden)for(;i.items[i.index]&&i.items[i.index].hidden;)i.index--;i.index>=i.items.length&&(i.index=i.items.length-1),a=!0}if(!a){for(var l=0,d=0;d<i.items.length;d++){var u=i.items[d],c="",h="";-1!==["is","begins with"].indexOf(i.match)&&(c="^"),-1!==["is","ends with"].indexOf(i.match)&&(h="$");try{new RegExp(c+n+h,"i").test(u.text)||"..."===u.text?u.hidden=!1:u.hidden=!0}catch(e){}"enum"===r.type&&-1!==e.inArray(u.id,ids)&&(u.hidden=!0),!0!==u.hidden&&l++}for(i.index=0;i.index<i.items.length-1&&i.items[i.index].hidden;)i.index++;l<=0&&(i.index=-1)}e(r).w2menu("refresh",i),s()}).on("keydown",function(e){9===e.keyCode&&(e.stopPropagation(),e.preventDefault())}),i.search){if(-1!=["text","password"].indexOf(e(r)[0].type)||"TEXTAREA"==e(r)[0].tagName.toUpperCase())return;e("#w2ui-overlay"+o+" #menu-search").focus()}s()},200),s(),u}var c=e("#w2ui-overlay"+o+" div.menu"),h=c.find("tr[index="+i.index+"]"),p=c.scrollTop();if(c.find("tr.w2ui-selected").removeClass("w2ui-selected"),h.addClass("w2ui-selected"),h.length>0){var f=h[0].offsetTop-5,g=c.height();c.scrollTop(p),(f<p||f+h.height()>p+g)&&c.animate({scrollTop:f-(g-2*h.height())/2},200,"linear")}s()}},e.fn.w2color=function(t,i){function s(e){for(var t,i=(e.color,'<div class="w2ui-color" onmousedown="jQuery(this).parents(\'.w2ui-overlay\').data(\'keepOpen\', true)"><div class="w2ui-color-palette"><table cellspacing="5"><tbody>'),s=0;s<o.length;s++){i+="<tr>";for(var n=0;n<o[s].length;n++)t="FFFFFF"==o[s][n]?";border: 1px solid #efefef":"",i+='<td>    <div class="color '+(""===o[s][n]?"no-color":"")+'" style="background-color: #'+o[s][n]+t+';"        name="'+o[s][n]+'" index="'+s+":"+n+'">'+(e.color==o[s][n]?"&#149;":"&#160;")+"    </div></td>",e.color==o[s][n]&&(r=[s,n]);i+="</tr>",s<2&&(i+='<tr><td style="height: 8px" colspan="8"></td></tr>')}return i+="</tbody></table></div>",i+='<div class="w2ui-color-advanced" style="display: none">   <div class="color-info">       <div class="color-preview-bg"><div class="color-preview"></div><div class="color-original"></div></div>       <div class="color-part">           <span>H</span> <input name="h" maxlength="3" max="360" tabindex="101">           <span>R</span> <input name="r" maxlength="3" max="255" tabindex="104">       </div>       <div class="color-part">           <span>S</span> <input name="s" maxlength="3" max="100" tabindex="102">           <span>G</span> <input name="g" maxlength="3" max="255" tabindex="105">       </div>       <div class="color-part">           <span>V</span> <input name="v" maxlength="3" max="100" tabindex="103">           <span>B</span> <input name="b" maxlength="3" max="255" tabindex="106">       </div>       <div class="color-part" style="margin: 30px 0px 0px 2px">           <span style="width: 40px">Opacity</span>            <input name="a" maxlength="5" max="1" style="width: 32px !important" tabindex="107">       </div>   </div>   <div class="palette" name="palette">       <div class="palette-bg"></div>       <div class="value1 move-x move-y"></div>   </div>   <div class="rainbow" name="rainbow">       <div class="value2 move-x"></div>   </div>   <div class="alpha" name="alpha">       <div class="alpha-bg"></div>       <div class="value2 move-x"></div>   </div></div>',i+="<div class=\"w2ui-color-tabs\">   <div class=\"w2ui-color-tab selected\" onclick=\"jQuery(this).addClass('selected').next().removeClass('selected').parents('.w2ui-overlay').find('.w2ui-color-advanced').hide().parent().find('.w2ui-color-palette').show(); jQuery.fn._colorAdvanced = false; jQuery('#w2ui-overlay')[0].resize()\"><span class=\"w2ui-icon w2ui-icon-colors\"></span></div>   <div class=\"w2ui-color-tab\" onclick=\"jQuery(this).addClass('selected').prev().removeClass('selected').parents('.w2ui-overlay').find('.w2ui-color-advanced').show().parent().find('.w2ui-color-palette').hide(); jQuery.fn._colorAdvanced = true; jQuery('#w2ui-overlay')[0].resize()\"><span class=\"w2ui-icon w2ui-icon-settings\"></span></div></div></div><div style=\"clear: both; height: 0\"></div>"}var n=e(this),a=n[0];if(n.data("skipInit"))n.removeData("skipInit");else{var r=[-1,-1];null==e.fn.w2colorPalette&&(e.fn.w2colorPalette=[["000000","333333","555555","777777","888888","999999","AAAAAA","CCCCCC","DDDDDD","EEEEEE","F7F7F7","FFFFFF"],["FF011B","FF9838","FFC300","FFFD59","86FF14","14FF7A","2EFFFC","2693FF","006CE7","9B24F4","FF21F5","FF0099"],["FFEAEA","FCEFE1","FCF4DC","FFFECF","EBFFD9","D9FFE9","E0FFFF","E8F4FF","ECF4FC","EAE6F4","FFF5FE","FCF0F7"],["F4CCCC","FCE5CD","FFF1C2","FFFDA1","D5FCB1","B5F7D0","BFFFFF","D6ECFF","CFE2F3","D9D1E9","FFE3FD","FFD9F0"],["EA9899","F9CB9C","FFE48C","F7F56F","B9F77E","84F0B1","83F7F7","B5DAFF","9FC5E8","B4A7D6","FAB9F6","FFADDE"],["E06666","F6B26B","DEB737","E0DE51","8FDB48","52D189","4EDEDB","76ACE3","6FA8DC","8E7CC3","E07EDA","F26DBD"],["CC0814","E69138","AB8816","B5B20E","6BAB30","27A85F","1BA8A6","3C81C7","3D85C6","674EA7","A14F9D","BF4990"],["99050C","B45F17","80650E","737103","395E14","10783D","13615E","094785","0A5394","351C75","780172","782C5A"]]);var o=e.fn.w2colorPalette;"string"==typeof t&&(t={color:t,transparent:!0}),null==t.onSelect&&null!=i&&(t.onSelect=i),t.transparent&&"333333"==o[0][1]&&(o[0].splice(1,1),o[0].push("")),t.transparent||"333333"==o[0][1]||(o[0].splice(1,0,"333333"),o[0].pop()),t.color&&(t.color=String(t.color).toUpperCase()),"string"==typeof t.color&&"#"==t.color.substr(0,1)&&(t.color=t.color.substr(1)),null==t.fireChange&&(t.fireChange=!0),0===e("#w2ui-overlay").length?e(a).w2overlay(s(t),t):(e("#w2ui-overlay .w2ui-color").parent().html(s(t)),e("#w2ui-overlay").show()),e("#w2ui-overlay .color").off(".w2color").on("mousedown.w2color",function(i){var s=e(i.originalEvent.target).attr("name");r=e(i.originalEvent.target).attr("index").split(":"),"INPUT"==a.tagName.toUpperCase()?(t.fireChange&&e(a).change(),e(a).next().find(">div").css("background-color",s)):e(a).data("_color",s),"function"==typeof t.onSelect&&t.onSelect(s)}).on("mouseup.w2color",function(){setTimeout(function(){e("#w2ui-overlay").length>0&&e("#w2ui-overlay").removeData("keepOpen")[0].hide()},10)}),e("#w2ui-overlay .color-original").off(".w2color").on("click.w2color",function(t){var i=w2utils.parseColor(e(t.target).css("background-color"));null!=i&&(u=i,d=w2utils.rgb2hsv(u),c(d),h(),p())}),e("#w2ui-overlay input").off(".w2color").on("mousedown.w2color",function(t){e("#w2ui-overlay").data("keepOpen",!0),setTimeout(function(){e("#w2ui-overlay").data("keepOpen",!0)},10),t.stopPropagation()}).on("change.w2color",function(){var t=e(this),i=parseFloat(t.val()),s=parseFloat(t.attr("max"));isNaN(i)&&(i=0),s>1&&(i=parseInt(i)),s>0&&i>s&&(t.val(s),i=s),i<0&&(t.val(0),i=0);var n=t.attr("name"),a={};-1!=["r","g","b","a"].indexOf(n)?(u[n]=i,d=w2utils.rgb2hsv(u)):-1!=["h","s","v"].indexOf(n)&&(a[n]=i),c(a),h(),p()});var l,d,u=w2utils.parseColor(t.color);null==u&&(u={r:140,g:150,b:160,a:1},d=w2utils.rgb2hsv(u)),d=w2utils.rgb2hsv(u);var c=function(i,s){null!=i.h&&(d.h=i.h),null!=i.s&&(d.s=i.s),null!=i.v&&(d.v=i.v),null!=i.a&&(u.a=i.a,d.a=i.a);var n="rgba("+(u=w2utils.hsv2rgb(d)).r+","+u.g+","+u.b+","+u.a+")",r=[Number(u.r).toString(16).toUpperCase(),Number(u.g).toString(16).toUpperCase(),Number(u.b).toString(16).toUpperCase()];r.forEach(function(e,t){1==e.length&&(r[t]="0"+e)}),1==u.a&&(n=r[0]+r[1]+r[2]),e("#w2ui-overlay .color-preview").css("background-color",n),e("#w2ui-overlay input").each(function(e,t){t.name&&(null!=u[t.name]&&(t.value=u[t.name]),null!=d[t.name]&&(t.value=d[t.name]),"a"==t.name&&(t.value=u.a))}),s?e("#w2ui-overlay .color-original").css("background-color",n):("INPUT"==a.tagName.toUpperCase()?(e(a).val(n).data("skipInit",!0),t.fireChange&&e(a).change(),e(a).next().find(">div").css("background-color",n)):e(a).data("_color",n),"function"==typeof t.onSelect&&t.onSelect(n))},h=function(){var t=e("#w2ui-overlay .palette .value1"),i=e("#w2ui-overlay .rainbow .value2"),s=e("#w2ui-overlay .alpha .value2"),n=parseInt(t.width())/2,a=parseInt(i.width())/2;t.css({left:150*d.s/100-n,top:125*(100-d.v)/100-n}),i.css("left",d.h/2.4-a),s.css("left",150*u.a-a)},p=function(){var t=w2utils.hsv2rgb(d.h,100,100),i=t.r+","+t.g+","+t.b;e("#w2ui-overlay .palette").css("background-image","linear-gradient(90deg, rgba("+i+",0) 0%, rgba("+i+",1) 100%)")},f=function(t){var i=e(this).find(".value1, .value2"),s=parseInt(i.width())/2;i.hasClass("move-x")&&i.css({left:t.offsetX-s+"px"}),i.hasClass("move-y")&&i.css({top:t.offsetY-s+"px"}),l={$el:i,x:t.pageX,y:t.pageY,width:i.parent().width(),height:i.parent().height(),left:parseInt(i.css("left")),top:parseInt(i.css("top"))},m(t),e("body").off(".w2color").on(v,m).on(w,g)},g=function(t){e("body").off(".w2color")},m=function(e){var t=l.$el,i=e.pageX-l.x,s=e.pageY-l.y,n=l.left+i,a=l.top+s,r=parseInt(t.width())/2;n<-r&&(n=-r),a<-r&&(a=-r),n>l.width-r&&(n=l.width-r),a>l.height-r&&(a=l.height-r),t.hasClass("move-x")&&t.css({left:n+"px"}),t.hasClass("move-y")&&t.css({top:a+"px"});var o=t.parent().attr("name"),d=parseInt(t.css("left"))+r,u=parseInt(t.css("top"))+r;if("palette"==o&&c({s:Math.round(d/l.width*100),v:Math.round(100-u/l.height*100)}),"rainbow"==o){var h=Math.round(2.4*d);c({h:h}),p()}"alpha"==o&&c({a:parseFloat(Number(d/150).toFixed(2))})};!0!==e.fn._colorAdvanced&&!0!==t.advanced||(e("#w2ui-overlay .w2ui-color-tabs :nth-child(2)").click(),e("#w2ui-overlay").removeData("keepOpen")),c({},!0),p(),h();var w="mouseup.w2color",v="mousemove.w2color";w2utils.isIOS&&("touchstart.w2color",w="touchend.w2color",v="touchmove.w2color  "),e("#w2ui-overlay .palette").off(".w2color").on("mousedown.w2color",f),e("#w2ui-overlay .rainbow").off(".w2color").on("mousedown.w2color",f),e("#w2ui-overlay .alpha").off(".w2color").on("mousedown.w2color",f),a.nav=function(t){switch(t){case"up":r[0]--;break;case"down":r[0]++;break;case"right":r[1]++;break;case"left":r[1]--}return r[0]<0&&(r[0]=0),r[0]>o.length-2&&(r[0]=o.length-2),r[1]<0&&(r[1]=0),r[1]>o[0].length-1&&(r[1]=o[0].length-1),color=o[r[0]][r[1]],e(a).data("_color",color),color}}}}(jQuery),function(e,t){if("function"==typeof define&&define.amd)return define(function(){return t});if("undefined"!=typeof exports){if("undefined"!=typeof module&&module.exports)return exports=module.exports=t;e=exports}for(var i in t)e[i]=t[i]}(this,{w2ui:w2ui,w2obj:w2obj,w2utils:w2utils}),function($){var w2grid=function(e){this.name=null,this.box=null,this.header="",this.url="",this.routeData={},this.columns=[],this.columnGroups=[],this.records=[],this.summary=[],this.searches=[],this.searchData=[],this.sortData=[],this.postData={},this.httpHeaders={},this.toolbar={},this.stateId=null,this.show={header:!1,toolbar:!1,footer:!1,columnHeaders:!0,lineNumbers:!1,expandColumn:!1,selectColumn:!1,emptyRecords:!0,toolbarReload:!0,toolbarColumns:!0,toolbarSearch:!0,toolbarInput:!0,toolbarAdd:!1,toolbarEdit:!1,toolbarDelete:!1,toolbarSave:!1,searchAll:!0,statusRange:!0,statusBuffered:!1,statusRecordID:!0,statusSelection:!0,statusResponse:!0,statusSort:!1,statusSearch:!1,recordTitles:!0,selectionBorder:!0,skipRecords:!0,saveRestoreState:!0},this.hasFocus=!1,this.autoLoad=!0,this.fixedBody=!0,this.recordHeight=24,this.lineNumberWidth=null,this.vs_start=150,this.vs_extra=15,this.keyboard=!0,this.selectType="row",this.multiSearch=!0,this.multiSelect=!0,this.multiSort=!0,this.reorderColumns=!1,this.reorderRows=!1,this.markSearch=!0,this.columnTooltip="normal",this.disableCVS=!1,this.textSearch="begins",this.useFieldDot=!0,this.total=0,this.limit=100,this.offset=0,this.style="",this.ranges=[],this.menu=[],this.method=null,this.recid=null,this.parser=null,this.last={field:"",caption:"",logic:"OR",search:"",searchIds:[],selection:{indexes:[],columns:{}},multi:!1,scrollTop:0,scrollLeft:0,colStart:0,colEnd:0,sortData:null,sortCount:0,xhr:null,range_start:null,range_end:null,sel_ind:null,sel_col:null,sel_type:null,edit_col:null,isSafari:/^((?!chrome|android).)*safari/i.test(navigator.userAgent)},$.extend(!0,this,w2obj.grid,e)};$.fn.w2grid=function(e){if($.isPlainObject(e)){if(!w2utils.checkName(e,"w2grid"))return;var t=e.columns,i=e.columnGroups,s=e.records,n=e.searches,a=e.searchData,r=e.sortData,o=e.postData,l=e.httpHeaders,d=e.toolbar,u=new w2grid(e);$.extend(u,{postData:{},httpHeaders:{},records:[],columns:[],searches:[],toolbar:{},sortData:[],searchData:[],handlers:[]}),$.extend(!0,u.toolbar,d);var c;if(t)for(c=0;c<t.length;c++)u.columns[c]=$.extend(!0,{},t[c]);if(i)for(c=0;c<i.length;c++)u.columnGroups[c]=$.extend(!0,{},i[c]);if(n)for(c=0;c<n.length;c++)u.searches[c]=$.extend(!0,{},n[c]);if(a)for(c=0;c<a.length;c++)u.searchData[c]=$.extend(!0,{},a[c]);if(r)for(c=0;c<r.length;c++)u.sortData[c]=$.extend(!0,{},r[c]);if(u.postData=$.extend(!0,{},o),u.httpHeaders=$.extend(!0,{},l),s)for(var h=0;h<s.length;h++){if(null==s[h].recid&&null==s[h][u.recid])return void console.log("ERROR: Cannot add records without recid. (obj: "+u.name+")");u.records[h]=$.extend(!0,{},s[h])}for(var p=0;p<u.columns.length;p++){var f=u.columns[p],g=f.searchable;if(null!=g&&!1!==g&&null==u.getSearch(f.field))if($.isPlainObject(g))u.addSearch($.extend({field:f.field,caption:f.caption,type:"text"},g));else{var m=f.searchable,w="";!0===f.searchable&&(m="text",w='size="20"'),u.addSearch({field:f.field,caption:f.caption,type:m,attr:w})}}return u.initToolbar(),0!==$(this).length&&u.render($(this)[0]),w2ui[u.name]=u,u}var v=w2ui[$(this).attr("name")];return v?arguments.length>0?(v[e]&&v[e].apply(v,Array.prototype.slice.call(arguments,1)),this):v:null},w2grid.prototype={msgDelete:"Are you sure you want to delete selected records?",msgNotJSON:"Returned data is not in valid JSON format.",msgAJAXerror:"AJAX error. See console for more details.",msgRefresh:"Refreshing...",msgNeedReload:"Your remote data source record count has changed, reloading from the first record.",msgEmpty:"",buttons:{reload:{type:"button",id:"w2ui-reload",icon:"w2ui-icon-reload",tooltip:"Reload data in the list"},columns:{type:"drop",id:"w2ui-column-on-off",icon:"w2ui-icon-columns",tooltip:"Show/hide columns",arrow:!1,html:""},search:{type:"html",id:"w2ui-search",html:"<div class=\"w2ui-icon icon-search-down w2ui-search-down\" onclick=\"var obj = w2ui[jQuery(this).parents('div.w2ui-grid').attr('name')]; obj.searchShowFields();\"></div>"},"search-go":{type:"drop",id:"w2ui-search-advanced",icon:"w2ui-icon-search",text:"Search",tooltip:"Open Search Fields"},add:{type:"button",id:"w2ui-add",text:"Add New",tooltip:"Add new record",icon:"w2ui-icon-plus"},edit:{type:"button",id:"w2ui-edit",text:"Edit",tooltip:"Edit selected record",icon:"w2ui-icon-pencil",disabled:!0},delete:{type:"button",id:"w2ui-delete",text:"Delete",tooltip:"Delete selected records",icon:"w2ui-icon-cross",disabled:!0},save:{type:"button",id:"w2ui-save",text:"Save",tooltip:"Save changed records",icon:"w2ui-icon-check"}},operators:{text:["is","begins","contains","ends"],number:["is","between",{oper:"less",text:"less than"},{oper:"more",text:"more than"}],date:["is","between",{oper:"less",text:"before"},{oper:"more",text:"after"}],list:["is"],hex:["is","between"],color:["is","begins","contains","ends"],enum:["in","not in"]},operatorsMap:{text:"text",int:"number",float:"number",money:"number",currency:"number",percent:"number",hex:"hex",alphanumeric:"text",color:"color",date:"date",time:"date",datetime:"date",list:"list",combo:"text",enum:"enum",file:"enum",select:"list",radio:"list",checkbox:"list",toggle:"list"},onAdd:null,onEdit:null,onRequest:null,onLoad:null,onDelete:null,onSave:null,onSelect:null,onUnselect:null,onClick:null,onDblClick:null,onContextMenu:null,onMenuClick:null,onColumnClick:null,onColumnDblClick:null,onColumnResize:null,onColumnAutoResize:null,onSort:null,onSearch:null,onSearchOpen:null,onChange:null,onRestore:null,onExpand:null,onCollapse:null,onError:null,onKeydown:null,onToolbar:null,onColumnOnOff:null,onCopy:null,onPaste:null,onSelectionExtend:null,onEditField:null,onRender:null,onRefresh:null,onReload:null,onResize:null,onDestroy:null,onStateSave:null,onStateRestore:null,onFocus:null,onBlur:null,onReorderRow:null,add:function(e,t){$.isArray(e)||(e=[e]);for(var i=0,s=0;s<e.length;s++){var n=e[s];null!=n.recid||null!=n[this.recid]?(n.w2ui&&!0===n.w2ui.summary?t?this.summary.unshift(n):this.summary.push(n):t?this.records.unshift(n):this.records.push(n),i++):console.log("ERROR: Cannot add record without recid. (obj: "+this.name+")")}return("object"!=typeof this.url?this.url:this.url.get)?(this.refresh(),i):(this.total=this.records.length,this.localSort(!1,!0),this.localSearch(),this.refreshBody(),this.resizeRecords(),i)},find:function(e,t){null==e&&(e={});var i=[],s=!1;for(var n in e)-1!=String(n).indexOf(".")&&(s=!0);for(var a=0;a<this.records.length;a++){var r=!0;for(var n in e){var o=this.records[a][n];s&&-1!=String(n).indexOf(".")&&(o=this.parseField(this.records[a],n)),"not-null"==e[n]?null!=o&&""!==o||(r=!1):e[n]!=o&&(r=!1)}r&&!0!==t&&i.push(this.records[a].recid),r&&!0===t&&i.push(a)}return i},set:function(e,t,i){if("object"==typeof e&&null!==e&&(i=t,t=e,e=null),null==e){for(var s=0;s<this.records.length;s++)$.extend(!0,this.records[s],t);!0!==i&&this.refresh()}else{var n=this.get(e,!0);if(null==n)return!1;!this.records[n]||this.records[n].recid!=e?$.extend(!0,this.summary[n],t):$.extend(!0,this.records[n],t),!0!==i&&this.refreshRow(e,n)}return!0},get:function(e,t){if($.isArray(e)){for(var i=[],s=0;s<e.length;s++){var n=this.get(e[s],t);null!==n&&i.push(n)}return i}var a=this.last.idCache;if(a||(this.last.idCache=a={}),"number"==typeof(s=a[e])){if(s>=0&&s<this.records.length&&this.records[s].recid==e)return!0===t?s:this.records[s];if((s=~s)>=0&&s<this.summary.length&&this.summary[s].recid==e)return!0===t?s:this.summary[s];this.last.idCache=a={}}for(s=0;s<this.records.length;s++)if(this.records[s].recid==e)return a[e]=s,!0===t?s:this.records[s];for(s=0;s<this.summary.length;s++)if(this.summary[s].recid==e)return a[e]=~s,!0===t?s:this.summary[s];return null},getFirst:function(){if(0==this.records.length)return null;var e=this.records[0].recid,t=this.last.searchIds;return this.searchData.length>0&&(e=Array.isArray(t)&&t.length>0?this.records[t[0]].recid:null),e},remove:function(){for(var e=0,t=0;t<arguments.length;t++){for(i=this.records.length-1;i>=0;i--)this.records[i].recid==arguments[t]&&(this.records.splice(i,1),e++);for(var i=this.summary.length-1;i>=0;i--)this.summary[i].recid==arguments[t]&&(this.summary.splice(i,1),e++)}return("object"!=typeof this.url?this.url:this.url.get)||(this.localSort(!1,!0),this.localSearch()),this.refresh(),e},addColumn:function(e,t){var i=0;1==arguments.length?(t=e,e=this.columns.length):("string"==typeof e&&(e=this.getColumn(e,!0)),null==e&&(e=this.columns.length)),$.isArray(t)||(t=[t]);for(var s=0;s<t.length;s++){if(this.columns.splice(e,0,t[s]),t[s].searchable){var n=t[s].searchable,a="";!0===t[s].searchable&&(n="text",a='size="20"'),this.addSearch({field:t[s].field,caption:t[s].caption,type:n,attr:a})}e++,i++}return this.refresh(),i},removeColumn:function(){for(var e=0,t=0;t<arguments.length;t++)for(var i=this.columns.length-1;i>=0;i--)this.columns[i].field==arguments[t]&&(this.columns[i].searchable&&this.removeSearch(arguments[t]),this.columns.splice(i,1),e++);return this.refresh(),e},getColumn:function(e,t){if(0===arguments.length){for(var i=[],s=0;s<this.columns.length;s++)i.push(this.columns[s].field);return i}for(s=0;s<this.columns.length;s++)if(this.columns[s].field==e)return!0===t?s:this.columns[s];return null},toggleColumn:function(){for(var e=0,t=0;t<arguments.length;t++)for(var i=this.columns.length-1;i>=0;i--){var s=this.columns[i];s.field==arguments[t]&&(s.hidden=!s.hidden,e++)}return this.refreshBody(),this.resizeRecords(),e},showColumn:function(){for(var e=0,t=0;t<arguments.length;t++)for(var i=this.columns.length-1;i>=0;i--){var s=this.columns[i];s.gridMinWidth&&delete s.gridMinWidth,s.field==arguments[t]&&!1!==s.hidden&&(s.hidden=!1,e++)}return this.refreshBody(),this.resizeRecords(),this.scroll(),e},hideColumn:function(){for(var e=0,t=0;t<arguments.length;t++)for(var i=this.columns.length-1;i>=0;i--){var s=this.columns[i];s.field==arguments[t]&&!0!==s.hidden&&(s.hidden=!0,e++)}return this.refreshBody(),this.resizeRecords(),this.scroll(),e},addSearch:function(e,t){var i=0;1==arguments.length?(t=e,e=this.searches.length):("string"==typeof e&&(e=this.getSearch(e,!0)),null==e&&(e=this.searches.length)),$.isArray(t)||(t=[t]);for(var s=0;s<t.length;s++)this.searches.splice(e,0,t[s]),e++,i++;return this.searchClose(),i},removeSearch:function(){for(var e=0,t=0;t<arguments.length;t++)for(var i=this.searches.length-1;i>=0;i--)this.searches[i].field==arguments[t]&&(this.searches.splice(i,1),e++);return this.searchClose(),e},getSearch:function(e,t){if(0===arguments.length){for(var i=[],s=0;s<this.searches.length;s++)i.push(this.searches[s].field);return i}for(s=0;s<this.searches.length;s++)if(this.searches[s].field==e)return!0===t?s:this.searches[s];return null},toggleSearch:function(){for(var e=0,t=0;t<arguments.length;t++)for(var i=this.searches.length-1;i>=0;i--)this.searches[i].field==arguments[t]&&(this.searches[i].hidden=!this.searches[i].hidden,e++);return this.searchClose(),e},showSearch:function(){for(var e=0,t=0;t<arguments.length;t++)for(var i=this.searches.length-1;i>=0;i--)this.searches[i].field==arguments[t]&&!1!==this.searches[i].hidden&&(this.searches[i].hidden=!1,e++);return this.searchClose(),e},hideSearch:function(){for(var e=0,t=0;t<arguments.length;t++)for(var i=this.searches.length-1;i>=0;i--)this.searches[i].field==arguments[t]&&!0!==this.searches[i].hidden&&(this.searches[i].hidden=!0,e++);return this.searchClose(),e},getSearchData:function(e){for(var t=0;t<this.searchData.length;t++)if(this.searchData[t].field==e)return this.searchData[t];return null},localSort:function(e,t){function i(e){if(!e.w2ui||null==e.w2ui.parent_recid)return[e];if(e.w2ui._path)return e.w2ui._path;var t=r.get(e.w2ui.parent_recid);return t?i(t).concat(e):(console.log("ERROR: no parent record: "+e.w2ui.parent_recid),[e])}function s(e,t){if(e===t)return 0;for(var i=0;i<r.sortData.length;i++){var s=r.sortData[i].field;r.sortData[i].field_&&(s=r.sortData[i].field_);var a=e[s],o=t[s];-1!=String(s).indexOf(".")&&(a=r.parseField(e,s),o=r.parseField(t,s));var l=r.getColumn(s);if(l&&null!=l.editable&&($.isPlainObject(a)&&a.text&&(a=a.text),$.isPlainObject(o)&&o.text&&(o=o.text)),0!==(d=n(a,o,i,r.sortData[i].direction,l.sortMode||"default")))return d}var d=n(e.recid,t.recid,-1,"asc");return d}function n(e,t,i,s,n){if(e===t)return 0;if((null==e||""===e)&&null!=t&&""!==t)return 1;if(null!=e&&""!==e&&(null==t||""===t))return-1;var a="asc"===s.toLowerCase()?1:-1;if(typeof e!=typeof t)return typeof e>typeof t?a:-a;if(e.constructor.name!=t.constructor.name)return e.constructor.name>t.constructor.name?a:-a;e&&"object"==typeof e&&(e=e.valueOf()),t&&"object"==typeof t&&(t=t.valueOf());var r={}.toString;switch(e&&"object"==typeof e&&e.toString!=r&&(e=String(e)),t&&"object"==typeof t&&t.toString!=r&&(t=String(t)),"string"==typeof e&&(e=$.trim(e.toLowerCase())),"string"==typeof t&&(t=$.trim(t.toLowerCase())),n){case"natural":n=w2utils.naturalCompare}return"function"==typeof n?n(e,t)*a:e>t?a:e<t?-a:0}if("object"!=typeof this.url?this.url:this.url.get)console.log("ERROR: grid.localSort can only be used on local data source, grid.url should be empty.");else if(!$.isEmptyObject(this.sortData)){var a=(new Date).getTime(),r=this;r.selectionSave(),r.prepareData(),t||r.reset();for(var o=0;o<this.sortData.length;o++){var l=this.getColumn(this.sortData[o].field);if(!l)return;"string"==typeof l.render&&(-1!=["date","age"].indexOf(l.render.split(":")[0])&&(this.sortData[o].field_=l.field+"_"),-1!=["time"].indexOf(l.render.split(":")[0])&&(this.sortData[o].field_=l.field+"_"))}return function(){for(var e=0;e<r.records.length;e++){var t=r.records[e];t.w2ui&&null!=t.w2ui.parent_recid&&(t.w2ui._path=i(t))}}(),this.records.sort(function(e,t){return function(e,t){if(!(e.w2ui&&null!=e.w2ui.parent_recid||t.w2ui&&null!=t.w2ui.parent_recid))return s(e,t);for(var n=i(e),a=i(t),r=0;r<Math.min(n.length,a.length);r++){var o=s(n[r],a[r]);if(0!==o)return o}return n.length>a.length?1:n.length<a.length?-1:(console.log("ERROR: two paths should not be equal."),0)}(e,t)}),function(){for(var e=0;e<r.records.length;e++){var t=r.records[e];t.w2ui&&null!=t.w2ui.parent_recid&&(t.w2ui._path=null)}}(),r.selectionRestore(t),a=(new Date).getTime()-a,!0!==e&&r.show.statusSort&&setTimeout(function(){r.status(w2utils.lang("Sorting took")+" "+a/1e3+" "+w2utils.lang("sec"))},10),a}},localSearch:function(e){function t(e){for(var i=0,s=0;s<a.searchData.length;s++){var n=a.searchData[s],o=a.getSearch(n.field);if(null!=n){null==o&&(o={field:n.field,type:n.type});var l=a.parseField(e,o.field),d=null===l||void 0===l||"object"==typeof l&&l.toString==r?"":String(l).toLowerCase();if(null!=n.value)if($.isArray(n.value))var u=n.value[0],c=n.value[1];else u=String(n.value).toLowerCase();switch(n.operator){case"is":if(a.parseField(e,o.field)==n.value)i++;else if("date"==o.type){h=a.parseField(e,o.field+"_")instanceof Date?a.parseField(e,o.field+"_"):a.parseField(e,o.field);(d=w2utils.formatDate(h,"yyyy-mm-dd"))==(u=w2utils.formatDate(w2utils.isDate(u,w2utils.settings.dateFormat,!0),"yyyy-mm-dd"))&&i++}else if("time"==o.type){h=a.parseField(e,o.field+"_")instanceof Date?a.parseField(e,o.field+"_"):a.parseField(e,o.field);(d=w2utils.formatTime(h,"hh24:mi"))==(u=w2utils.formatTime(u,"hh24:mi"))&&i++}else if("datetime"==o.type){h=a.parseField(e,o.field+"_")instanceof Date?a.parseField(e,o.field+"_"):a.parseField(e,o.field);(d=w2utils.formatDateTime(h,"yyyy-mm-dd|hh24:mm:ss"))==(u=w2utils.formatDateTime(w2utils.isDateTime(u,w2utils.settings.datetimeFormat,!0),"yyyy-mm-dd|hh24:mm:ss"))&&i++}break;case"between":if(-1!=["int","float","money","currency","percent"].indexOf(o.type))parseFloat(a.parseField(e,o.field))>=parseFloat(u)&&parseFloat(a.parseField(e,o.field))<=parseFloat(c)&&i++;else if("date"==o.type){var h=a.parseField(e,o.field+"_")instanceof Date?a.parseField(e,o.field+"_"):a.parseField(e,o.field),d=w2utils.isDate(h,w2utils.settings.dateFormat,!0),u=w2utils.isDate(u,w2utils.settings.dateFormat,!0);null!=(c=w2utils.isDate(c,w2utils.settings.dateFormat,!0))&&(c=new Date(c.getTime()+864e5)),d>=u&&d<c&&i++}else if("time"==o.type){var d=a.parseField(e,o.field+"_")instanceof Date?a.parseField(e,o.field+"_"):a.parseField(e,o.field),u=w2utils.isTime(u,!0),c=w2utils.isTime(c,!0);u=(new Date).setHours(u.hours,u.minutes,u.seconds?u.seconds:0,0),c=(new Date).setHours(c.hours,c.minutes,c.seconds?c.seconds:0,0),d>=u&&d<c&&i++}else if("datetime"==o.type){var d=a.parseField(e,o.field+"_")instanceof Date?a.parseField(e,o.field+"_"):a.parseField(e,o.field),u=w2utils.isDateTime(u,w2utils.settings.datetimeFormat,!0);(c=w2utils.isDateTime(c,w2utils.settings.datetimeFormat,!0))&&(c=new Date(c.getTime()+864e5)),d>=u&&d<c&&i++}break;case"less":if(-1!=["int","float","money","currency","percent"].indexOf(o.type))parseFloat(a.parseField(e,o.field))<=parseFloat(n.value)&&i++;else if("date"==o.type){h=a.parseField(e,o.field+"_")instanceof Date?a.parseField(e,o.field+"_"):a.parseField(e,o.field);(d=w2utils.formatDate(w2utils.isDate(h,w2utils.settings.dateFormat,!0),"yyyy-mm-dd"))<=(u=w2utils.formatDate(w2utils.isDate(u,w2utils.settings.dateFormat,!0),"yyyy-mm-dd"))&&i++}else if("time"==o.type){h=a.parseField(e,o.field+"_")instanceof Date?a.parseField(e,o.field+"_"):a.parseField(e,o.field);(d=w2utils.formatTime(h,"hh24:mi"))<=(u=w2utils.formatTime(u,"hh24:mi"))&&i++}else if("datetime"==o.type){var h=a.parseField(e,o.field+"_")instanceof Date?a.parseField(e,o.field+"_"):a.parseField(e,o.field),d=w2utils.formatDateTime(h,"yyyy-mm-dd|hh24:mm:ss"),u=w2utils.formatDateTime(w2utils.isDateTime(u,w2utils.settings.datetimeFormat,!0),"yyyy-mm-dd|hh24:mm:ss");d.length==u.length&&d<=u&&i++}break;case"more":if(-1!=["int","float","money","currency","percent"].indexOf(o.type))parseFloat(a.parseField(e,o.field))>=parseFloat(n.value)&&i++;else if("date"==o.type){h=a.parseField(e,o.field+"_")instanceof Date?a.parseField(e,o.field+"_"):a.parseField(e,o.field);(d=w2utils.formatDate(w2utils.isDate(h,w2utils.settings.dateFormat,!0),"yyyy-mm-dd"))>=(u=w2utils.formatDate(w2utils.isDate(u,w2utils.settings.dateFormat,!0),"yyyy-mm-dd"))&&i++}else if("time"==o.type){h=a.parseField(e,o.field+"_")instanceof Date?a.parseField(e,o.field+"_"):a.parseField(e,o.field);(d=w2utils.formatTime(h,"hh24:mi"))>=(u=w2utils.formatTime(u,"hh24:mi"))&&i++}else if("datetime"==o.type){var h=a.parseField(e,o.field+"_")instanceof Date?a.parseField(e,o.field+"_"):a.parseField(e,o.field),d=w2utils.formatDateTime(h,"yyyy-mm-dd|hh24:mm:ss"),u=w2utils.formatDateTime(w2utils.isDateTime(u,w2utils.settings.datetimeFormat,!0),"yyyy-mm-dd|hh24:mm:ss");d.length==u.length&&d>=u&&i++}break;case"in":h=n.value;n.svalue&&(h=n.svalue),-1!==h.indexOf(d)&&i++,-1!==h.indexOf(w2utils.isFloat(l)?parseFloat(l):l)&&i++;break;case"not in":h=n.value;n.svalue&&(h=n.svalue),-1==h.indexOf(d)&&i++,-1==h.indexOf(w2utils.isFloat(l)?parseFloat(l):l)&&i++;break;case"begins":case"begins with":0===d.indexOf(u)&&i++;break;case"contains":d.indexOf(u)>=0&&i++;break;case"null":null==a.parseField(e,o.field)&&i++;break;case"not null":null!=a.parseField(e,o.field)&&i++;break;case"ends":case"ends with":var p=d.lastIndexOf(u);-1!==p&&p==d.length-u.length&&i++}}}if("OR"==a.last.logic&&0!==i||"AND"==a.last.logic&&i==a.searchData.length)return!0;if(e.w2ui&&e.w2ui.children&&!0!==e.w2ui.expanded)for(var f=0;f<e.w2ui.children.length;f++)if(t(e.w2ui.children[f]))return!0;return!1}function i(e){if(void 0!==e&&!o[e]){o[e]=!0;var t=a.get(e,!0);if(null!=t&&-1==$.inArray(t,a.last.searchIds)){var s=a.records[t];s&&s.w2ui&&i(s.w2ui.parent_recid),a.last.searchIds.push(t)}}}var s="object"!=typeof this.url?this.url:this.url.get;if(!s){var n=(new Date).getTime(),a=this,r={}.toString,o={};if(this.total=this.records.length,this.last.searchIds=[],this.prepareData(),this.searchData.length>0&&!s){this.total=0;for(var l=0;l<this.records.length;l++){var d=this.records[l];t(d)&&(d&&d.w2ui&&i(d.w2ui.parent_recid),this.last.searchIds.push(l))}this.total=this.last.searchIds.length}return n=(new Date).getTime()-n,!0!==e&&a.show.statusSearch&&setTimeout(function(){a.status(w2utils.lang("Search took")+" "+n/1e3+" "+w2utils.lang("sec"))},10),n}console.log("ERROR: grid.localSearch can only be used on local data source, grid.url should be empty.")},getRangeData:function(e,t){var i=this.get(e[0].recid,!0),s=this.get(e[1].recid,!0),n=e[0].column,a=e[1].column,r=[];if(n==a)for(d=i;d<=s;d++){u=(o=this.records[d])[this.columns[n].field]||null;!0!==t?r.push(u):r.push({data:u,column:n,index:d,record:o})}else if(i==s)for(var o=this.records[i],l=n;l<=a;l++){u=o[this.columns[l].field]||null;!0!==t?r.push(u):r.push({data:u,column:l,index:i,record:o})}else for(var d=i;d<=s;d++){o=this.records[d];r.push([]);for(l=n;l<=a;l++){var u=o[this.columns[l].field];!0!==t?r[r.length-1].push(u):r[r.length-1].push({data:u,column:l,index:d,record:o})}}return r},addRange:function(e){var t=0;if("row"==this.selectType)return t;$.isArray(e)||(e=[e]);for(var i=0;i<e.length;i++){if("object"!=typeof e[i]&&(e[i]={name:"selection"}),"selection"==e[i].name){if(!1===this.show.selectionBorder)continue;var s=this.getSelection();if(0===s.length){this.removeRange("selection");continue}var n=s[0],a=s[s.length-1]}else var n=e[i].range[0],a=e[i].range[1];if(n){for(var r={name:e[i].name,range:[{recid:n.recid,column:n.column},{recid:a.recid,column:a.column}],style:e[i].style||""},o=!1,l=0;l<this.ranges.length;l++)if(this.ranges[l].name==e[i].name){o=l;break}!1!==o?this.ranges[o]=r:this.ranges.push(r),t++}}return this.refreshRanges(),t},removeRange:function(){for(var e=0,t=0;t<arguments.length;t++){var i=arguments[t];$("#grid_"+this.name+"_"+i).remove(),$("#grid_"+this.name+"_f"+i).remove();for(var s=this.ranges.length-1;s>=0;s--)this.ranges[s].name==i&&(this.ranges.splice(s,1),e++)}return e},refreshRanges:function(){if(0!==this.ranges.length){for(var e=this,t=(new Date).getTime(),i=$("#grid_"+this.name+"_frecords"),s=$("#grid_"+this.name+"_records"),n=0;n<this.ranges.length;n++){var a=this.ranges[n],r=a.range[0],o=a.range[1];null==r.index&&(r.index=this.get(r.recid,!0)),null==o.index&&(o.index=this.get(o.recid,!0));var l=$("#grid_"+this.name+"_rec_"+w2utils.escapeId(r.recid)+' td[col="'+r.column+'"]'),d=$("#grid_"+this.name+"_rec_"+w2utils.escapeId(o.recid)+' td[col="'+o.column+'"]'),u=$("#grid_"+this.name+"_frec_"+w2utils.escapeId(r.recid)+' td[col="'+r.column+'"]'),c=$("#grid_"+this.name+"_frec_"+w2utils.escapeId(o.recid)+' td[col="'+o.column+'"]'),h=o.column;r.column<this.last.colStart&&o.column>this.last.colStart&&(l=$("#grid_"+this.name+"_rec_"+w2utils.escapeId(r.recid)+' td[col="start"]')),r.column<this.last.colEnd&&o.column>this.last.colEnd&&(h='"end"',d=$("#grid_"+this.name+"_rec_"+w2utils.escapeId(o.recid)+' td[col="end"]'));var p=parseInt($("#grid_"+this.name+"_rec_top").next().attr("index")),f=parseInt($("#grid_"+this.name+"_rec_bottom").prev().attr("index")),g=parseInt($("#grid_"+this.name+"_frec_top").next().attr("index")),m=parseInt($("#grid_"+this.name+"_frec_bottom").prev().attr("index"));0===l.length&&r.index<p&&o.index>p&&(l=$("#grid_"+this.name+"_rec_top").next().find("td[col="+r.column+"]")),0===d.length&&o.index>f&&r.index<f&&(d=$("#grid_"+this.name+"_rec_bottom").prev().find("td[col="+h+"]")),0===u.length&&r.index<g&&o.index>g&&(u=$("#grid_"+this.name+"_frec_top").next().find("td[col="+r.column+"]")),0===c.length&&o.index>m&&r.index<m&&(c=$("#grid_"+this.name+"_frec_bottom").prev().find("td[col="+o.column+"]"));var w=$(this.box).find("#grid_"+this.name+"_editable").find(".w2ui-input"),v=w.attr("recid"),y=w.attr("column");if("selection"!=a.name||a.range[0].recid!=v||a.range[0].column!=y){_=$("#grid_"+this.name+"_f"+a.name);if(u.length>0||c.length>0)if(0===_.length?(i.append('<div id="grid_'+this.name+"_f"+a.name+'" class="w2ui-selection" style="'+a.style+'">'+("selection"==a.name?'<div id="grid_'+this.name+'_resizer" class="w2ui-selection-resizer"></div>':"")+"</div>"),_=$("#grid_"+this.name+"_f"+a.name)):(_.attr("style",a.style),_.find(".w2ui-selection-resizer").show()),0===c.length&&(0===(c=$("#grid_"+this.name+"_frec_"+w2utils.escapeId(o.recid)+" td:last-child")).length&&(c=$("#grid_"+this.name+"_frec_bottom td:first-child")),_.css("border-right","0px"),_.find(".w2ui-selection-resizer").hide()),null!=r.recid&&null!=o.recid&&u.length>0&&c.length>0){var b=u.position().left-1+i.scrollLeft(),x=u.position().top-1+i.scrollTop();_.show().css({left:(b>0?b:0)+"px",top:(x>0?x:0)+"px",width:c.position().left-u.position().left+c.width()+3+"px",height:c.position().top-u.position().top+c.height()+3+"px"})}else _.hide();else _.hide();var _=$("#grid_"+this.name+"_"+a.name);if(l.length>0||d.length>0)if(0===_.length?(s.append('<div id="grid_'+this.name+"_"+a.name+'" class="w2ui-selection" style="'+a.style+'">'+("selection"==a.name?'<div id="grid_'+this.name+'_resizer" class="w2ui-selection-resizer"></div>':"")+"</div>"),_=$("#grid_"+this.name+"_"+a.name)):_.attr("style",a.style),0===l.length&&0===(l=$("#grid_"+this.name+"_rec_"+w2utils.escapeId(r.recid)+" td:first-child")).length&&(l=$("#grid_"+this.name+"_rec_top td:first-child")),0!==c.length&&_.css("border-left","0px"),null!=r.recid&&null!=o.recid&&l.length>0&&d.length>0){var b=l.position().left-1+s.scrollLeft(),x=l.position().top-1+s.scrollTop();_.show().css({left:(b>0?b:0)+"px",top:(x>0?x:0)+"px",width:d.position().left-l.position().left+d.width()+3+"px",height:d.position().top-l.position().top+d.height()+3+"px"})}else _.hide();else _.hide()}}$(this.box).find(".w2ui-selection-resizer").off("mousedown").on("mousedown",function(t){var i=e.getSelection();e.last.move={type:"expand",x:t.screenX,y:t.screenY,divX:0,divY:0,recid:i[0].recid,column:i[0].column,originalRange:[{recid:i[0].recid,column:i[0].column},{recid:i[i.length-1].recid,column:i[i.length-1].column}],newRange:[{recid:i[0].recid,column:i[0].column},{recid:i[i.length-1].recid,column:i[i.length-1].column}]},$(document).off(".w2ui-"+e.name).on("mousemove.w2ui-"+e.name,function(t){var i=e.last.move;if(i&&"expand"==i.type){i.divX=t.screenX-i.x,i.divY=t.screenY-i.y;var s,n,a=t.originalEvent.target;if("TD"!=a.tagName.toUpperCase()&&(a=$(a).parents("td")[0]),null!=$(a).attr("col")&&(n=parseInt($(a).attr("col"))),a=$(a).parents("tr")[0],s=$(a).attr("recid"),i.newRange[1].recid!=s||i.newRange[1].column!=n){var r=$.extend({},i.newRange);return i.newRange=[{recid:i.recid,column:i.column},{recid:s,column:n}],!0===(k=e.trigger($.extend(k,{originalRange:i.originalRange,newRange:i.newRange}))).isCancelled?(i.newRange=r,void(k.newRange=r)):(e.removeRange("grid-selection-expand"),void e.addRange({name:"grid-selection-expand",range:k.newRange,style:"background-color: rgba(100,100,100,0.1); border: 2px dotted rgba(100,100,100,0.5);"}))}}}).on("mouseup.w2ui-"+e.name,function(t){e.removeRange("grid-selection-expand"),delete e.last.move,$(document).off(".w2ui-"+e.name),e.trigger($.extend(k,{phase:"after"}))}),t.preventDefault()}).off("dblclick").on("dblclick",function(t){var i=e.trigger({phase:"before",type:"resizerDblClick",target:e.name,originalEvent:t});!0!==i.isCancelled&&e.trigger($.extend(i,{phase:"after"}))});var k={phase:"before",type:"selectionExtend",target:e.name,originalRange:null,newRange:null};return(new Date).getTime()-t}},select:function(){if(0===arguments.length)return 0;var e=((new Date).getTime(),0),t=this.last.selection;this.multiSelect||this.selectNone();var i={phase:"before",type:"select",target:this.name};1==arguments.length?(i.multiple=!1,$.isPlainObject(arguments[0])?(i.recid=arguments[0].recid,i.column=arguments[0].column):i.recid=arguments[0]):(i.multiple=!0,i.recids=Array.prototype.slice.call(arguments,0));var s=this.trigger(i);if(!0===s.isCancelled)return 0;if("row"==this.selectType)for(o=0;o<arguments.length;o++){l="object"==typeof arguments[o]?arguments[o].recid:arguments[o];if(null!=(h=this.get(l,!0))){var n=null,a=null;if((0!==this.searchData.length||h+1>=this.last.range_start&&h+1<=this.last.range_end)&&(n=$("#grid_"+this.name+"_frec_"+w2utils.escapeId(l)),a=$("#grid_"+this.name+"_rec_"+w2utils.escapeId(l))),"row"==this.selectType){if(-1!=t.indexes.indexOf(h))continue;t.indexes.push(h),n&&a&&(n.addClass("w2ui-selected").data("selected","yes").find(".w2ui-col-number").addClass("w2ui-row-selected"),a.addClass("w2ui-selected").data("selected","yes").find(".w2ui-col-number").addClass("w2ui-row-selected"),n.find(".w2ui-grid-select-check").prop("checked",!0)),e++}}}else{for(var r={},o=0;o<arguments.length;o++){var l="object"==typeof arguments[o]?arguments[o].recid:arguments[o],d="object"==typeof arguments[o]?arguments[o].column:null;if(r[l]=r[l]||[],$.isArray(d))r[l]=d;else if(w2utils.isInt(d))r[l].push(d);else for(var u=0;u<this.columns.length;u++)this.columns[u].hidden||r[l].push(parseInt(u))}var c=[];for(var l in r){var h=this.get(l,!0);if(null!=h){var n=null,a=null;h+1>=this.last.range_start&&h+1<=this.last.range_end&&(n=$("#grid_"+this.name+"_rec_"+w2utils.escapeId(l)),a=$("#grid_"+this.name+"_frec_"+w2utils.escapeId(l)));var p=t.columns[h]||[];-1==t.indexes.indexOf(h)&&t.indexes.push(h);for(f=0;f<r[l].length;f++)-1==p.indexOf(r[l][f])&&p.push(r[l][f]);p.sort(function(e,t){return e-t});for(var f=0;f<r[l].length;f++){var g=r[l][f];-1==c.indexOf(g)&&c.push(g),n&&(n.find("#grid_"+this.name+"_data_"+h+"_"+g).addClass("w2ui-selected"),n.find(".w2ui-col-number").addClass("w2ui-row-selected"),n.data("selected","yes"),n.find(".w2ui-grid-select-check").prop("checked",!0)),a&&(a.find("#grid_"+this.name+"_data_"+h+"_"+g).addClass("w2ui-selected"),a.find(".w2ui-col-number").addClass("w2ui-row-selected"),a.data("selected","yes"),a.find(".w2ui-grid-select-check").prop("checked",!0)),e++}t.columns[h]=p}}for(var m=0;m<c.length;m++)$(this.box).find("#grid_"+this.name+"_column_"+c[m]+" .w2ui-col-header").addClass("w2ui-col-selected")}t.indexes.sort(function(e,t){return e-t});var w=this.records.length>0&&t.indexes.length==this.records.length,v=t.indexes.length>0&&0!==this.searchData.length&&t.indexes.length==this.last.searchIds.length;return w||v?$("#grid_"+this.name+"_check_all").prop("checked",!0):$("#grid_"+this.name+"_check_all").prop("checked",!1),this.status(),this.addRange("selection"),this.trigger($.extend(s,{phase:"after"})),e},unselect:function(){for(var e=0,t=this.last.selection,i=0;i<arguments.length;i++){var s="object"==typeof arguments[i]?arguments[i].recid:arguments[i],n=this.get(s);if(null!=n){var a=this.get(n.recid,!0),r=$("#grid_"+this.name+"_frec_"+w2utils.escapeId(s)),o=$("#grid_"+this.name+"_rec_"+w2utils.escapeId(s));if("row"==this.selectType){if(-1==t.indexes.indexOf(a))continue;if(!0===(h=this.trigger({phase:"before",type:"unselect",target:this.name,recid:s,index:a})).isCancelled)continue;t.indexes.splice(t.indexes.indexOf(a),1),r.removeClass("w2ui-selected w2ui-inactive").removeData("selected").find(".w2ui-col-number").removeClass("w2ui-row-selected"),o.removeClass("w2ui-selected w2ui-inactive").removeData("selected").find(".w2ui-col-number").removeClass("w2ui-row-selected"),0!=r.length&&(r[0].style.cssText="height: "+this.recordHeight+"px; "+r.attr("custom_style"),o[0].style.cssText="height: "+this.recordHeight+"px; "+o.attr("custom_style")),r.find(".w2ui-grid-select-check").prop("checked",!1),e++}else{var l=arguments[i].column;if(!w2utils.isInt(l)){for(var d=[],u=0;u<this.columns.length;u++)this.columns[u].hidden||d.push({recid:s,column:u});return this.unselect.apply(this,d)}var c=t.columns[a];if(!$.isArray(c)||-1==c.indexOf(l))continue;var h=this.trigger({phase:"before",type:"unselect",target:this.name,recid:s,column:l});if(!0===h.isCancelled)continue;c.splice(c.indexOf(l),1),$("#grid_"+this.name+"_rec_"+w2utils.escapeId(s)).find(" > td[col="+l+"]").removeClass("w2ui-selected w2ui-inactive"),$("#grid_"+this.name+"_frec_"+w2utils.escapeId(s)).find(" > td[col="+l+"]").removeClass("w2ui-selected w2ui-inactive");for(var p=!1,f=!1,g=this.getSelection(),u=0;u<g.length;u++)g[u].column==l&&(p=!0),g[u].recid==s&&(f=!0);p||$(this.box).find(".w2ui-grid-columns td[col="+l+"] .w2ui-col-header, .w2ui-grid-fcolumns td[col="+l+"] .w2ui-col-header").removeClass("w2ui-col-selected"),f||$("#grid_"+this.name+"_frec_"+w2utils.escapeId(s)).find(".w2ui-col-number").removeClass("w2ui-row-selected"),e++,0===c.length&&(delete t.columns[a],t.indexes.splice(t.indexes.indexOf(a),1),r.removeData("selected"),r.find(".w2ui-grid-select-check").prop("checked",!1),o.removeData("selected"))}this.trigger($.extend(h,{phase:"after"}))}}var m=this.records.length>0&&t.indexes.length==this.records.length,w=t.indexes.length>0&&0!==this.searchData.length&&t.indexes.length==this.last.searchIds.length;return m||w?$("#grid_"+this.name+"_check_all").prop("checked",!0):$("#grid_"+this.name+"_check_all").prop("checked",!1),this.status(),this.addRange("selection"),e},selectAll:function(){var e=(new Date).getTime();if(!1!==this.multiSelect){var t=this.trigger({phase:"before",type:"select",target:this.name,all:!0});if(!0!==t.isCancelled){for(var i="object"!=typeof this.url?this.url:this.url.get,s=this.last.selection,n=[],a=0;a<this.columns.length;a++)n.push(a);if(s.indexes=[],i||0===this.searchData.length){var r=this.records.length;0==this.searchData.length||i||(r=this.last.searchIds.length);for(a=0;a<r;a++)s.indexes.push(a),"row"!=this.selectType&&(s.columns[a]=n.slice())}else for(a=0;a<this.last.searchIds.length;a++)s.indexes.push(this.last.searchIds[a]),"row"!=this.selectType&&(s.columns[this.last.searchIds[a]]=n.slice());return"row"==this.selectType?($(this.box).find(".w2ui-grid-records tr").not(".w2ui-empty-record").addClass("w2ui-selected").data("selected","yes").find(".w2ui-col-number").addClass("w2ui-row-selected"),$(this.box).find(".w2ui-grid-frecords tr").not(".w2ui-empty-record").addClass("w2ui-selected").data("selected","yes").find(".w2ui-col-number").addClass("w2ui-row-selected"),$(this.box).find("input.w2ui-grid-select-check").prop("checked",!0)):($(this.box).find(".w2ui-grid-columns td .w2ui-col-header, .w2ui-grid-fcolumns td .w2ui-col-header").addClass("w2ui-col-selected"),$(this.box).find(".w2ui-grid-records tr .w2ui-col-number").addClass("w2ui-row-selected"),$(this.box).find(".w2ui-grid-records tr").not(".w2ui-empty-record").find(".w2ui-grid-data").not(".w2ui-col-select").addClass("w2ui-selected").data("selected","yes"),$(this.box).find(".w2ui-grid-frecords tr .w2ui-col-number").addClass("w2ui-row-selected"),$(this.box).find(".w2ui-grid-frecords tr").not(".w2ui-empty-record").find(".w2ui-grid-data").not(".w2ui-col-select").addClass("w2ui-selected").data("selected","yes"),$(this.box).find("input.w2ui-grid-select-check").prop("checked",!0)),1==(s=this.getSelection()).length?this.toolbar.enable("w2ui-edit"):this.toolbar.disable("w2ui-edit"),s.length>=1?this.toolbar.enable("w2ui-delete"):this.toolbar.disable("w2ui-delete"),this.addRange("selection"),$("#grid_"+this.name+"_check_all").prop("checked",!0),this.status(),this.trigger($.extend(t,{phase:"after"})),(new Date).getTime()-e}}},selectNone:function(){var e=(new Date).getTime(),t=this.trigger({phase:"before",type:"unselect",target:this.name,all:!0});if(!0!==t.isCancelled){var i=this.last.selection;return"row"==this.selectType?($(this.box).find(".w2ui-grid-records tr.w2ui-selected").removeClass("w2ui-selected w2ui-inactive").removeData("selected").find(".w2ui-col-number").removeClass("w2ui-row-selected"),$(this.box).find(".w2ui-grid-frecords tr.w2ui-selected").removeClass("w2ui-selected w2ui-inactive").removeData("selected").find(".w2ui-col-number").removeClass("w2ui-row-selected"),$(this.box).find("input.w2ui-grid-select-check").prop("checked",!1)):($(this.box).find(".w2ui-grid-columns td .w2ui-col-header, .w2ui-grid-fcolumns td .w2ui-col-header").removeClass("w2ui-col-selected"),$(this.box).find(".w2ui-grid-records tr .w2ui-col-number").removeClass("w2ui-row-selected"),$(this.box).find(".w2ui-grid-frecords tr .w2ui-col-number").removeClass("w2ui-row-selected"),$(this.box).find(".w2ui-grid-data.w2ui-selected").removeClass("w2ui-selected w2ui-inactive").removeData("selected"),$(this.box).find("input.w2ui-grid-select-check").prop("checked",!1)),i.indexes=[],i.columns={},this.toolbar.disable("w2ui-edit","w2ui-delete"),this.removeRange("selection"),$("#grid_"+this.name+"_check_all").prop("checked",!1),this.status(),this.trigger($.extend(t,{phase:"after"})),(new Date).getTime()-e}},getSelection:function(e){var t=[],i=this.last.selection;if("row"==this.selectType){for(s=0;s<i.indexes.length;s++)this.records[i.indexes[s]]&&(!0===e?t.push(i.indexes[s]):t.push(this.records[i.indexes[s]].recid));return t}for(var s=0;s<i.indexes.length;s++){var n=i.columns[i.indexes[s]];if(this.records[i.indexes[s]])for(var a=0;a<n.length;a++)t.push({recid:this.records[i.indexes[s]].recid,index:parseInt(i.indexes[s]),column:n[a]})}return t},search:function(e,t){for(var i="object"!=typeof this.url?this.url:this.url.get,s=[],n=this.last.multi,a=this.last.logic,r=this.last.field,o=this.last.search,l=!1,d=0;d<this.searches.length;d++)this.searches[d].hidden&&(s.push({field:this.searches[d].field,operator:this.searches[d].operator||"is",type:this.searches[d].type,value:this.searches[d].value||""}),l=!0);if(0===arguments.length){o="";for(d=0;d<this.searches.length;d++){var u=this.searches[d],c=$("#grid_"+this.name+"_operator_"+d).val(),h=$("#grid_"+this.name+"_field_"+d),p=$("#grid_"+this.name+"_field2_"+d),f=h.val(),g=p.val(),m=null,w=null;if(-1!=["int","float","money","currency","percent"].indexOf(u.type)){var v=h.data("w2field"),y=p.data("w2field");v&&(f=v.clean(f)),y&&(g=y.clean(g))}if(-1!=["list","enum"].indexOf(u.type))if(f=h.data("selected")||{},$.isArray(f)){m=[];for(k=0;k<f.length;k++)m.push(w2utils.isFloat(f[k].id)?parseFloat(f[k].id):String(f[k].id).toLowerCase()),delete f[k].hidden;$.isEmptyObject(f)&&(f="")}else w=f.text||"",f=f.id||"";if(""!==f&&null!=f||null!=g&&""!==g){x={field:u.field,type:u.type,operator:c};"between"==c?$.extend(x,{value:[f,g]}):"in"==c&&"string"==typeof f?$.extend(x,{value:f.split(",")}):"not in"==c&&"string"==typeof f?$.extend(x,{value:f.split(",")}):$.extend(x,{value:f}),m&&$.extend(x,{svalue:m}),w&&$.extend(x,{text:w});try{"date"==u.type&&"between"==c&&(x.value[0]=f,x.value[1]=g),"date"==u.type&&"is"==c&&(x.value=f)}catch(e){}s.push(x)}}n=!0,a="AND"}if("string"==typeof e&&(1==arguments.length&&(t=e,e="all"),r=e,o=t,n=!1,a=l?"AND":"OR",null!=t))if("all"==e.toLowerCase())if(this.searches.length>0)for(d=0;d<this.searches.length;d++){if("text"==(u=this.searches[d]).type||"alphanumeric"==u.type&&w2utils.isAlphaNumeric(t)||"int"==u.type&&w2utils.isInt(t)||"float"==u.type&&w2utils.isFloat(t)||"percent"==u.type&&w2utils.isFloat(t)||("hex"==u.type||"color"==u.type)&&w2utils.isHex(t)||"currency"==u.type&&w2utils.isMoney(t)||"money"==u.type&&w2utils.isMoney(t)||"date"==u.type&&w2utils.isDate(t)||"time"==u.type&&w2utils.isTime(t)||"datetime"==u.type&&w2utils.isDateTime(t)||"enum"==u.type&&w2utils.isAlphaNumeric(t)||"list"==u.type&&w2utils.isAlphaNumeric(t)){x={field:u.field,type:u.type,operator:null!=u.operator?u.operator:"text"==u.type?this.textSearch:"is",value:t};""!=$.trim(t)&&s.push(x)}if(-1!=["int","float","money","currency","percent"].indexOf(u.type)&&2==$.trim(String(t)).split("-").length){var b=$.trim(String(t)).split("-"),x={field:u.field,type:u.type,operator:null!=u.operator?u.operator:"between",value:[b[0],b[1]]};s.push(x)}if(-1!=["list","enum"].indexOf(u.type)){for(var _=[],k=0;k<u.options.items;k++){x=u.options.items[k];try{var C=new RegExp(t,"i");C.test(x)&&_.push(k),x.text&&C.test(x.text)&&_.push(x.id)}catch(e){}}if(_.length>0){x={field:u.field,type:u.type,operator:null!=u.operator?u.operator:"in",value:_};s.push(x)}}}else for(d=0;d<this.columns.length;d++){x={field:this.columns[d].field,type:"text",operator:this.textSearch,value:t};s.push(x)}else{var T=$("#grid_"+this.name+"_search_all");if(null==(u=this.getSearch(e))&&(u={field:e,type:"text"}),u.field==e&&(this.last.caption=u.caption),""!==t){var S=this.textSearch,D=t;if(-1!=["date","time","datetime"].indexOf(u.type)&&(S="is"),-1!=["list","enum"].indexOf(u.type)&&(S="is",D=(x=T.data("selected"))&&!$.isEmptyObject(x)?x.id:""),"int"==u.type&&""!==t&&(S="is",-1!=String(t).indexOf("-")&&2==(x=t.split("-")).length&&(S="between",D=[parseInt(x[0]),parseInt(x[1])]),-1!=String(t).indexOf(","))){x=t.split(",");S="in",D=[];for(d=0;d<x.length;d++)D.push(x[d])}null!=u.operator&&(S=u.operator);x={field:u.field,type:u.type,operator:S,value:D};s.push(x)}}if($.isArray(e)){var z="AND";"string"==typeof t&&"OR"!=(z=t.toUpperCase())&&"AND"!=z&&(z="AND"),o="",n=!0,a=z;for(d=0;d<e.length;d++){var O=e[d];if(null==(u=this.getSearch(O.field))&&(u={type:"text",operator:this.textSearch}),$.isArray(O.value))for(k=0;k<O.value.length;k++)"string"==typeof O.value[k]&&(O.value[k]=O.value[k].toLowerCase());s.push($.extend(!0,{},u,O))}}var I=this.trigger({phase:"before",type:"search",multi:0===arguments.length,target:this.name,searchData:s,searchField:e||"multi",searchValue:e?t:"multi"});!0!==I.isCancelled&&(this.searchData=I.searchData,this.last.field=r,this.last.search=o,this.last.multi=n,this.last.logic=a,this.last.scrollTop=0,this.last.scrollLeft=0,this.last.selection.indexes=[],this.last.selection.columns={},this.searchClose(),i?(this.last.xhr_offset=0,this.reload()):(this.localSearch(),this.refresh()),this.trigger($.extend(I,{phase:"after"})))},searchOpen:function(){if(this.box&&0!==this.searches.length){var e=this,t=e.toolbar.get("w2ui-search-advanced"),i="#tb_"+e.toolbar.name+"_item_"+w2utils.escapeId(t.id)+" table.w2ui-button",s=this.trigger({phase:"before",type:"searchOpen",target:this.name});return!0===s.isCancelled?void setTimeout(function(){e.toolbar.uncheck("w2ui-search-advanced")},1):void $("#tb_"+this.name+"_toolbar_item_w2ui-search-advanced").w2overlay({html:this.getSearchesHTML(),name:this.name+"-searchOverlay",left:-10,class:"w2ui-grid-searches",onShow:function(){e.initSearches(),$("#w2ui-overlay-"+e.name+"-searchOverlay .w2ui-grid-searches").data("grid-name",e.name);var n=$("#w2ui-overlay-"+this.name+"-searchOverlay .w2ui-grid-searches *[rel=search]");n.length>0&&n[0].focus(),t.checked||(t.checked=!0,$(i).addClass("checked")),e.trigger($.extend(s,{phase:"after"}))},onHide:function(){t.checked=!1,$(i).removeClass("checked")}})}},searchClose:function(){this.box&&0!==this.searches.length&&(this.toolbar&&this.toolbar.uncheck("w2ui-search-advanced"),$().w2overlay({name:this.name+"-searchOverlay"}))},searchReset:function(e){for(var t=[],i=!1,s=0;s<this.searches.length;s++)this.searches[s].hidden&&(t.push({field:this.searches[s].field,operator:this.searches[s].operator||"is",type:this.searches[s].type,value:this.searches[s].value||""}),i=!0);var n=this.trigger({phase:"before",type:"search",reset:!0,target:this.name,searchData:t});if(!0!==n.isCancelled){if(this.searchData=n.searchData,this.last.search="",this.last.logic=i?"AND":"OR",this.searches.length>0)if(this.multiSearch&&this.show.searchAll)this.last.field="all",this.last.caption=w2utils.lang("All Fields");else{for(var a=0;a<this.searches.length&&(this.searches[a].hidden||!1===this.searches[a].simple);)a++;a>=this.searches.length?(this.last.field="",this.last.caption=""):(this.last.field=this.searches[a].field,this.last.caption=this.searches[a].caption)}this.last.multi=!1,this.last.xhr_offset=0,this.last.scrollTop=0,this.last.scrollLeft=0,this.last.selection.indexes=[],this.last.selection.columns={},this.searchClose(),$("#grid_"+this.name+"_search_all").val("").removeData("selected"),e||this.reload(),this.trigger($.extend(n,{phase:"after"}))}},searchShowFields:function(){for(var e=this,t=$("#grid_"+this.name+"_search_all"),i='<div class="w2ui-select-field"><table><tbody>',s=-1;s<this.searches.length;s++){var n=this.searches[s];if(-1==s){if(!this.multiSearch||!this.show.searchAll)continue;n={field:"all",caption:w2utils.lang("All Fields")}}else if(!0===this.searches[s].hidden||!1===this.searches[s].simple)continue;i+="<tr "+(w2utils.isIOS?"onTouchStart":"onClick")+"=\"w2ui['"+this.name+"'].initAllField('"+n.field+"');      event.stopPropagation(); jQuery('#grid_"+this.name+"_search_all').w2overlay({ name: '"+this.name+'-searchFields\' });">   <td>       <span class="w2ui-column-check w2ui-icon-'+(n.field==this.last.field?"check":"empty")+'"></span>   </td>   <td>'+n.caption+"</td></tr>"}i+="</tbody></table></div>",setTimeout(function(){$(t).w2overlay({html:i,name:e.name+"-searchFields",left:-10})},1)},initAllField:function(e,t){var i=$("#grid_"+this.name+"_search_all");if("all"==e){var s={field:"all",caption:w2utils.lang("All Fields")};i.w2field("clear"),i.change()}else{if(null==(s=this.getSearch(e)))return;var n=s.type;-1!=["enum","select"].indexOf(n)&&(n="list"),i.w2field(n,$.extend({},s.options,{suffix:"",autoFormat:!1,selected:t})),-1!=["list","enum","date","time","datetime"].indexOf(s.type)&&(this.last.search="",this.last.item="",i.val(""))}""!=this.last.search?(this.last.caption=s.caption,this.search(s.field,this.last.search)):(this.last.field=s.field,this.last.caption=s.caption),i.attr("placeholder",w2utils.lang(s.caption)),$().w2overlay({name:this.name+"-searchFields"})},clear:function(e){this.total=0,this.records=[],this.summary=[],this.last.xhr_offset=0,this.last.idCache={},this.reset(!0),e||this.refresh()},reset:function(e){this.last.scrollTop=0,this.last.scrollLeft=0,this.last.selection={indexes:[],columns:{}},this.last.range_start=null,this.last.range_end=null,$("#grid_"+this.name+"_records").prop("scrollTop",0),e||this.refresh()},skip:function(e,t){("object"!=typeof this.url?this.url:this.url.get)?(this.offset=parseInt(e),this.offset>this.total&&(this.offset=this.total-this.limit),(this.offset<0||!w2utils.isInt(this.offset))&&(this.offset=0),this.clear(!0),this.reload(t)):console.log("ERROR: grid.skip() can only be called when you have remote data source.")},load:function(e,t){return null==e?void console.log('ERROR: You need to provide url argument when calling .load() method of "'+this.name+'" object.'):(this.clear(!0),void this.request("get",{},e,t))},reload:function(e){var t=this,i="object"!=typeof this.url?this.url:this.url.get;t.selectionSave(),i?this.load(i,function(){t.selectionRestore(),"function"==typeof e&&e()}):(this.reset(!0),this.localSearch(),this.selectionRestore(),"function"==typeof e&&e({status:"success"}))},request:function(e,t,i,s){if(null==t&&(t={}),""!=i&&null!=i||(i=this.url),""!=i&&null!=i){var n={};if(w2utils.isInt(this.offset)||(this.offset=0),w2utils.isInt(this.last.xhr_offset)||(this.last.xhr_offset=0),n.cmd=e,n.selected=this.getSelection(),n.limit=this.limit,n.offset=parseInt(this.offset)+parseInt(this.last.xhr_offset),n.search=this.searchData,n.searchLogic=this.last.logic,n.sort=this.sortData,0===this.searchData.length&&(delete n.search,delete n.searchLogic),0===this.sortData.length&&delete n.sort,$.extend(n,this.postData),$.extend(n,t),"get"==e){if(!0===(a=this.trigger({phase:"before",type:"request",target:this.name,url:i,postData:n,httpHeaders:this.httpHeaders})).isCancelled)return void("function"==typeof s&&s({status:"error",message:"Request aborted."}))}else var a={url:i,postData:n,httpHeaders:this.httpHeaders};var r=this;if(0===this.last.xhr_offset)r.lock(w2utils.lang(r.msgRefresh),!0);else{var o=$("#grid_"+this.name+"_rec_more, #grid_"+this.name+"_frec_more");!0===this.autoLoad?o.show().find("td").html('<div><div style="width: 20px; height: 20px;" class="w2ui-spinner"></div></div>'):o.find("td").html("<div>"+w2utils.lang("Load")+" "+r.limit+" "+w2utils.lang("More")+"...</div>")}if(this.last.xhr)try{this.last.xhr.abort()}catch(e){}if(i="object"!=typeof a.url?a.url:a.url.get,"save"==n.cmd&&"object"==typeof a.url&&(i=a.url.save),"delete"==n.cmd&&"object"==typeof a.url&&(i=a.url.remove),!$.isEmptyObject(r.routeData)){var l=w2utils.parseRoute(i);if(l.keys.length>0)for(var d=0;d<l.keys.length;d++)null!=r.routeData[l.keys[d].name]&&(i=i.replace(new RegExp(":"+l.keys[d].name,"g"),r.routeData[l.keys[d].name]))}var u={type:"POST",url:i,data:a.postData,headers:a.httpHeaders,dataType:"text"};"HTTP"==w2utils.settings.dataType&&(u.data="object"==typeof u.data?String($.param(u.data,!1)).replace(/%5B/g,"[").replace(/%5D/g,"]"):u.data),"HTTPJSON"==w2utils.settings.dataType&&(u.data={request:JSON.stringify(u.data)}),"RESTFULL"==w2utils.settings.dataType&&(u.type="GET","save"==n.cmd&&(u.type="PUT"),"delete"==n.cmd&&(u.type="DELETE"),u.data="object"==typeof u.data?String($.param(u.data,!1)).replace(/%5B/g,"[").replace(/%5D/g,"]"):u.data),"RESTFULLJSON"==w2utils.settings.dataType&&(u.type="GET","save"==n.cmd&&(u.type="PUT"),"delete"==n.cmd&&(u.type="DELETE"),u.data=JSON.stringify(u.data),u.contentType="application/json"),"JSON"==w2utils.settings.dataType&&(u.type="POST",u.data=JSON.stringify(u.data),u.contentType="application/json"),this.method&&(u.type=this.method),this.last.xhr_cmd=n.cmd,this.last.xhr_start=(new Date).getTime(),this.last.xhr=$.ajax(u).done(function(t,i,n){r.requestComplete(i,e,s)}).fail(function(t,i,n){var a={status:i,error:n,rawResponseText:t.responseText},o=r.trigger({phase:"before",type:"error",error:a,xhr:t});if(!0!==o.isCancelled){if("abort"!=i){var l;try{l=$.parseJSON(t.responseText)}catch(e){}console.log("ERROR: Server communication failed.","\n   EXPECTED:",{status:"success",total:5,records:[{recid:1,field:"value"}]},"\n         OR:",{status:"error",message:"error message"},"\n   RECEIVED:","object"==typeof l?l:t.responseText),r.requestComplete("error",e,s)}r.trigger($.extend(o,{phase:"after"}))}}),"get"==e&&this.trigger($.extend(a,{phase:"after"}))}},requestComplete:function(status,cmd,callBack){var obj=this;this.unlock(),setTimeout(function(){obj.show.statusResponse&&obj.status(w2utils.lang("Server Response")+" "+((new Date).getTime()-obj.last.xhr_start)/1e3+" "+w2utils.lang("sec"))},10),this.last.pull_more=!1,this.last.pull_refresh=!0;var event_name="load";"save"==this.last.xhr_cmd&&(event_name="save"),"delete"==this.last.xhr_cmd&&(event_name="delete");var edata=this.trigger({phase:"before",target:this.name,type:event_name,xhr:this.last.xhr,status:status});if(!0!==edata.isCancelled){var data,responseText=this.last.xhr.responseText;if("error"!=status){if(null!=responseText&&""!=responseText){if("object"==typeof responseText)data=responseText;else if("function"==typeof obj.parser)"object"!=typeof(data=obj.parser(responseText))&&console.log("ERROR: Your parser did not return proper object");else try{eval("data = "+responseText)}catch(e){}if(null==data?data={status:"error",message:w2utils.lang(this.msgNotJSON),responseText:responseText}:Array.isArray(data)&&(data={status:"success",records:data}),obj.recid&&data.records)for(var i=0;i<data.records.length;i++)data.records[i].recid=data.records[i][obj.recid];if("error"==data.status)obj.error(data.message);else{if("get"==cmd){if(null==data.total&&(data.total=-1),null==data.records&&(data.records=[]),data.records.length==this.limit?this.last.xhr_hasMore=!0:(this.last.xhr_hasMore=!1,this.total=this.last.xhr_offset+data.records.length),0===this.last.xhr_offset)this.records=[],this.summary=[],w2utils.isInt(data.total)&&(this.total=parseInt(data.total));else if(-1!=data.total&&parseInt(data.total)!=parseInt(this.total))return void this.message(w2utils.lang(this.msgNeedReload),function(){delete this.last.xhr_offset,this.reload()}.bind(this));if(data.records)for(var r=0;r<data.records.length;r++)this.records.push(data.records[r]);if(data.summary){this.summary=[];for(var r=0;r<data.summary.length;r++)this.summary.push(data.summary[r])}}if("delete"==cmd)return this.reset(),void this.reload()}}}else data={status:"error",message:w2utils.lang(this.msgAJAXerror),responseText:responseText},obj.error(w2utils.lang(this.msgAJAXerror));var url="object"!=typeof this.url?this.url:this.url.get;url||(this.localSort(),this.localSearch()),this.total=parseInt(this.total),0===this.last.xhr_offset?this.refresh():(this.scroll(),this.resize()),"function"==typeof callBack&&callBack(data),this.trigger($.extend(edata,{phase:"after"}))}else"function"==typeof callBack&&callBack({status:"error",message:"Request aborted."})},error:function(e){var t=this.trigger({target:this.name,type:"error",message:e,xhr:this.last.xhr});return!0===t.isCancelled?void("function"==typeof callBack&&callBack({status:"error",message:"Request aborted."})):(this.message(e),void this.trigger($.extend(t,{phase:"after"})))},getChanges:function(e){var t=[];if(void 0===e)var e=this.records;for(var i=0;i<e.length;i++){var s=e[i];s.w2ui&&(null!=s.w2ui.changes&&t.push($.extend(!0,{recid:s.recid},s.w2ui.changes)),!0!==s.w2ui.expanded&&s.w2ui.children&&s.w2ui.children.length&&$.merge(t,this.getChanges(s.w2ui.children)))}return t},mergeChanges:function(){for(var changes=this.getChanges(),c=0;c<changes.length;c++){var record=this.get(changes[c].recid);for(var s in changes[c])if("recid"!=s){"object"==typeof changes[c][s]&&(changes[c][s]=changes[c][s].text);try{-1!=s.indexOf(".")?eval("record['"+s.replace(/\./g,"']['")+"'] = changes[c][s]"):record[s]=changes[c][s]}catch(e){console.log("ERROR: Cannot merge. ",e.message||"",e)}record.w2ui&&delete record.w2ui.changes}}this.refresh()},save:function(){var e=this,t=this.getChanges(),i=this.trigger({phase:"before",target:this.name,type:"save",changes:t});!0!==i.isCancelled&&(("object"!=typeof this.url?this.url:this.url.save)?this.request("save",{changes:i.changes},null,function(t){"error"!==t.status&&e.mergeChanges(),e.trigger($.extend(i,{phase:"after"}))}):(this.mergeChanges(),this.trigger($.extend(i,{phase:"after"}))))},editField:function(e,t,i,s){function n(e){try{var t="DIV"==this.tagName.toUpperCase()?$(this).text():this.value,i=$("#grid_"+a.name+"_editable"),s="font-family: "+$(this).css("font-family")+"; font-size: "+$(this).css("font-size")+"; white-space: pre;",n=w2utils.getStrWidth(t,s);n+20>i.width()&&i.width(n+20)}catch(e){}}var a=this;if(!0!==this.last.inEditMode){var r=a.get(e,!0),o=a.getCellEditable(r,t);if(o){var l=a.records[r],d=a.columns[t],u=!0===d.frozen?"_f":"_";if(-1!=["enum","file"].indexOf(o.type))return void console.log('ERROR: input types "enum" and "file" are not supported in inline editing.');var c=a.trigger({phase:"before",type:"editField",target:a.name,recid:e,column:t,value:i,index:r,originalEvent:s});if(!0!==c.isCancelled&&(i=c.value,this.last.inEditMode=!0,this.last._edit={value:i,index:r,column:t,recid:e},this.selectNone(),this.select({recid:e,column:t}),-1==["checkbox","check"].indexOf(o.type))){var h=$("#grid_"+a.name+u+"rec_"+w2utils.escapeId(e)),p=h.find("[col="+t+"] > div");$(this.box).find("div.w2ui-edit-box").remove(),"row"!=this.selectType&&($("#grid_"+this.name+u+"selection").attr("id","grid_"+this.name+"_editable").removeClass("w2ui-selection").addClass("w2ui-edit-box").prepend('<div style="position: absolute; top: 0px; bottom: 0px; left: 0px; right: 0px;"></div>').find(".w2ui-selection-resizer").remove(),p=$("#grid_"+this.name+"_editable >div:first-child")),null==o.inTag&&(o.inTag=""),null==o.outTag&&(o.outTag=""),null==o.style&&(o.style=""),null==o.items&&(o.items=[]);var f=l.w2ui&&l.w2ui.changes&&null!=l.w2ui.changes[d.field]?w2utils.stripTags(l.w2ui.changes[d.field]):w2utils.stripTags(l[d.field]);null==f&&(f="");var g="object"!=typeof f?f:"";null!=c.old_value&&(g=c.old_value),null!=i&&(f=i);var m=null!=d.style?d.style+";":"";switch("string"==typeof d.render&&-1!=["number","int","float","money","percent","size"].indexOf(d.render.split(":")[0])&&(m+="text-align: right;"),o.items.length>0&&!$.isPlainObject(o.items[0])&&(o.items=w2obj.field.prototype.normMenu(o.items)),o.type){case"select":for(var w="",v=0;v<o.items.length;v++)w+='<option value="'+o.items[v].id+'"'+(o.items[v].id==f?' selected="selected"':"")+">"+o.items[v].text+"</option>";p.addClass("w2ui-editable").html('<select id="grid_'+a.name+"_edit_"+e+"_"+t+'" column="'+t+'" class="w2ui-input"    style="width: 100%; pointer-events: auto; padding: 0 0 0 3px; margin: 0px; border-left: 0; border-right: 0; border-radius: 0px;            outline: none; font-family: inherit;'+m+o.style+'"     field="'+d.field+'" recid="'+e+'"     '+o.inTag+">"+w+"</select>"+o.outTag),setTimeout(function(){p.find("select").on("change",function(e){delete a.last.move}).on("blur",function(e){1!=$(this).data("keep-open")&&a.editChange.call(a,this,r,t,e)})},10);break;case"div":b="font-family: "+(y=h.find("[col="+t+"] > div")).css("font-family")+"; font-size: "+y.css("font-size")+";";p.addClass("w2ui-editable").html('<div id="grid_'+a.name+"_edit_"+e+"_"+t+'" class="w2ui-input"    contenteditable style="'+b+m+o.style+'" autocorrect="off" autocomplete="off" spellcheck="false"     field="'+d.field+'" recid="'+e+'" column="'+t+'" '+o.inTag+"></div>"+o.outTag),null==i&&p.find("div.w2ui-input").text("object"!=typeof f?f:"");x=p.find("div.w2ui-input").get(0);setTimeout(function(){var e=x;$(e).on("blur",function(i){1!=$(this).data("keep-open")&&a.editChange.call(a,e,r,t,i)})},10),null!=i&&$(x).text("object"!=typeof f?f:"");break;default:var y=h.find("[col="+t+"] > div"),b="font-family: "+y.css("font-family")+"; font-size: "+y.css("font-size");p.addClass("w2ui-editable").html('<input id="grid_'+a.name+"_edit_"+e+"_"+t+'" autocorrect="off" autocomplete="off" spellcheck="false" type="text"     style="'+b+"; width: 100%; height: 100%; padding: 3px; border-color: transparent; outline: none; border-radius: 0;        pointer-events: auto; "+m+o.style+'"     field="'+d.field+'" recid="'+e+'" column="'+t+'" class="w2ui-input"'+o.inTag+"/>"+o.outTag),"number"==o.type&&(f=w2utils.formatNumber(f)),"date"==o.type&&(f=w2utils.formatDate(w2utils.isDate(f,o.format,!0)||new Date,o.format)),null==i&&p.find("input").val("object"!=typeof f?f:"");var x=p.find("input").get(0);$(x).w2field(o.type,$.extend(o,{selected:f})),setTimeout(function(){var e=x;"list"==o.type&&(e=$($(x).data("w2field").helpers.focus).find("input"),"object"!=typeof f&&""!=f&&e.val(f).css({opacity:1}).prev().css({opacity:1}),p.find("input").on("change",function(e){a.editChange.call(a,x,r,t,e)})),$(e).on("blur",function(e){1!=$(this).data("keep-open")&&a.editChange.call(a,x,r,t,e)})},10),null!=i&&$(x).val("object"!=typeof f?f:"")}setTimeout(function(){a.last.inEditMode&&(p.find("input, select, div.w2ui-input").data("old_value",g).on("mousedown",function(e){e.stopPropagation()}).on("click",function(e){"div"==o.type?n.call(p.find("div.w2ui-input")[0],null):n.call(p.find("input, select")[0],null)}).on("paste",function(e){var t=e.originalEvent;e.preventDefault();var i=t.clipboardData.getData("text/plain");document.execCommand("insertHTML",!1,i)}).on("keydown",function(i){var s=this,u="DIV"==s.tagName.toUpperCase()?$(s).text():$(s).val();switch(i.keyCode){case 8:"list"!=o.type||$(x).data("w2field")||i.preventDefault();break;case 9:case 13:i.preventDefault();break;case 37:0===w2utils.getCursorPosition(s)&&i.preventDefault();break;case 39:w2utils.getCursorPosition(s)==u.length&&(w2utils.setCursorPosition(s,u.length),i.preventDefault())}setTimeout(function(){switch(i.keyCode){case 9:var o=e,u=i.shiftKey?a.prevCell(r,t,!0):a.nextCell(r,t,!0);if(null==u){var c=i.shiftKey?a.prevRow(r,t):a.nextRow(r,t);if(null!=c&&c!=r){o=a.records[c].recid;for(var h=0;h<a.columns.length;h++){var p=a.getCellEditable(r,h);if(null!=p&&-1==["checkbox","check"].indexOf(p.type)&&(u=parseInt(h),!i.shiftKey))break}}}!1===o&&(o=e),null==u&&(u=t),s.blur(),setTimeout(function(){"row"!=a.selectType?(a.selectNone(),a.select({recid:o,column:u})):a.editField(o,u,null,i)},1),i.preventDefault&&i.preventDefault();break;case 13:s.blur();var f=i.shiftKey?a.prevRow(r,t):a.nextRow(r,t);null!=f&&f!=r&&setTimeout(function(){"row"!=a.selectType?(a.selectNone(),a.select({recid:a.records[f].recid,column:t})):a.editField(a.records[f].recid,t,null,i)},1),"DIV"==s.tagName.toUpperCase()&&i.preventDefault();break;case 27:var g=a.parseField(l,d.field);l.w2ui&&l.w2ui.changes&&null!=l.w2ui.changes[d.field]&&(g=l.w2ui.changes[d.field]),null!=$(s).data("old_value")&&(g=$(s).data("old_value")),"DIV"==s.tagName.toUpperCase()?$(s).text(null!=g?g:""):s.value=null!=g?g:"",s.blur(),setTimeout(function(){a.select({recid:e,column:t})},1)}n.call(s,i)},1)}).on("keyup",function(e){n.call(this,e)}),setTimeout(function(){if(a.last.inEditMode){var e=p.find(".w2ui-input"),t=null!=$(e).val()?$(e).val().length:0;"div"==o.type&&(t=$(e).text().length),e.length>0&&(e.focus(),clearTimeout(a.last.kbd_timer),"SELECT"!=e[0].tagName.toUpperCase()&&w2utils.setCursorPosition(e[0],t),e[0].resize=n,n.call(e[0],null))}},50),a.trigger($.extend(c,{phase:"after",input:p.find("input, select, div.w2ui-input")})))},5)}}}else if(13==s.keyCode){var r=this.last._edit.index,t=this.last._edit.column,e=this.last._edit.recid;this.editChange({type:"custom",value:this.last._edit.value},this.get(e,!0),t,s);var _=s.shiftKey?this.prevRow(r,t):this.nextRow(r,t);null!=_&&_!=r&&setTimeout(function(){"row"!=a.selectType?(a.selectNone(),a.select({recid:a.records[_].recid,column:t})):a.editField(a.records[_].recid,t,null,s)},1),this.last.inEditMode=!1}else{var k=$(this.box).find("div.w2ui-edit-box .w2ui-input");k.length>0&&"DIV"==k[0].tagName&&(k.text(k.text()+i),w2utils.setCursorPosition(k[0],k.text().length))}},editChange:function(e,t,i,s){var n=this;setTimeout(function(){var e=$(n.box).find("#grid_"+n.name+"_focus");e.is(":focus")||e.focus()},10);var a=t<0;t=t<0?-t-1:t;var r=(a?this.summary:this.records)[t],o=this.columns[i],l=$("#grid_"+this.name+(!0===o.frozen?"_frec_":"_rec_")+w2utils.escapeId(r.recid)),d=e.tagName&&"DIV"==e.tagName.toUpperCase()?$(e).text():e.value,u=this.parseField(r,o.field),c=$(e).data("w2field");c&&("list"==c.type&&(d=$(e).data("selected")),($.isEmptyObject(d)||null==d)&&(d=""),$.isPlainObject(d)||(d=c.clean(d))),"checkbox"==e.type&&(r.w2ui&&!1===r.w2ui.editable&&(e.checked=!e.checked),d=e.checked);var h={phase:"before",type:"change",target:this.name,input_id:e.id,recid:r.recid,index:t,column:i,originalEvent:s.originalEvent?s.originalEvent:s,value_new:d,value_previous:r.w2ui&&r.w2ui.changes&&r.w2ui.changes.hasOwnProperty(o.field)?r.w2ui.changes[o.field]:u,value_original:u};for(null!=$(s.target).data("old_value")&&(h.value_previous=$(s.target).data("old_value"));;){if("object"!=typeof(d=h.value_new)&&String(u)!=String(d)||"object"==typeof d&&d&&d.id!=u&&("object"!=typeof u||null==u||d.id!=u.id)){if(!0!==(h=this.trigger($.extend(h,{type:"change",phase:"before"}))).isCancelled){if(d!==h.value_new)continue;r.w2ui=r.w2ui||{},r.w2ui.changes=r.w2ui.changes||{},r.w2ui.changes[o.field]=h.value_new,this.trigger($.extend(h,{phase:"after"}))}}else if(!0!==(h=this.trigger($.extend(h,{type:"restore",phase:"before"}))).isCancelled){if(d!==h.value_new)continue;r.w2ui&&r.w2ui.changes&&delete r.w2ui.changes[o.field],r.w2ui&&$.isEmptyObject(r.w2ui.changes)&&delete r.w2ui.changes,this.trigger($.extend(h,{phase:"after"}))}break}var p=$(l).find("[col="+i+"]");a||(r.w2ui&&r.w2ui.changes&&null!=r.w2ui.changes[o.field]?p.addClass("w2ui-changed"):p.removeClass("w2ui-changed"),p.replaceWith(this.getCellHTML(t,i,a))),$(this.box).find("div.w2ui-edit-box").remove(),this.show.toolbarSave&&(this.getChanges().length>0?this.toolbar.enable("w2ui-save"):this.toolbar.disable("w2ui-save")),n.last.inEditMode=!1},delete:function(e){var t=((new Date).getTime(),this),i=this.trigger({phase:"before",target:this.name,type:"delete",force:e});if(!0!==i.isCancelled){e=i.force,setTimeout(function(){$().w2tag()},20);var s=this.getSelection();if(0!==s.length){if(""!=this.msgDelete&&!e)return void this.message({width:350,height:170,body:'<div class="w2ui-centered">'+w2utils.lang(t.msgDelete)+"</div>",buttons:'<button class="w2ui-btn w2ui-btn-red" onclick="w2ui[\''+this.name+"'].delete(true)\">"+w2utils.lang("Yes")+'</button><button class="w2ui-btn" onclick="w2ui[\''+this.name+"'].message()\">"+w2utils.lang("No")+"</button>",onOpen:function(e){var i=$(this.box).find("input, textarea, select, button");i.off(".message").on("blur.message",function(e){i.index(e.target)+1===i.length&&(i.get(0).focus(),e.preventDefault())}).on("keydown.message",function(e){27==e.keyCode&&t.message()}),setTimeout(function(){$(this.box).find(".w2ui-btn:last-child").focus(),clearTimeout(t.last.kbd_timer)},25)}});if(this.message(),"object"!=typeof this.url?this.url:this.url.remove)this.request("delete");else if("object"!=typeof s[0])this.selectNone(),this.remove.apply(this,s);else{for(var n=0;n<s.length;n++){var a=this.columns[s[n].column].field,r=this.get(s[n].recid,!0),o=this.records[r];null!=r&&"recid"!=a&&(this.records[r][a]="",o.w2ui&&o.w2ui.changes&&delete o.w2ui.changes[a])}this.update()}this.trigger($.extend(i,{phase:"after"}))}}},click:function(e,t){var i=(new Date).getTime(),s=null,n=this;if(!(1==this.last.cancelClick||t&&t.altKey)){if("object"==typeof e&&null!==e&&(s=e.column,e=e.recid),null==t&&(t={}),i-parseInt(this.last.click_time)<350&&this.last.click_recid==e&&"click"==t.type)return void this.dblClick(e,t);this.last.bubbleEl&&($(this.last.bubbleEl).w2tag(),this.last.bubbleEl=null),this.last.click_time=i;var a=this.last.click_recid;this.last.click_recid=e,null==s&&t.target&&("TD"!=(m=t.target).tagName.toUpperCase()&&(m=$(m).parents("td")[0]),null!=$(m).attr("col")&&(s=parseInt($(m).attr("col"))));var r=this.trigger({phase:"before",target:this.name,type:"click",recid:e,column:s,originalEvent:t});if(!0!==r.isCancelled){var n=this,o=this.getSelection();$("#grid_"+this.name+"_check_all").prop("checked",!1);var l=this.get(e,!0),d=(this.records[l],[]);if(n.last.sel_ind=l,n.last.sel_col=s,n.last.sel_recid=e,n.last.sel_type="click",t.shiftKey&&o.length>0&&n.multiSelect){if(o[0].recid){var u=this.get(o[0].recid,!0),c=this.get(e,!0);if(s>o[0].column)var h=o[0].column,p=s;else var h=s,p=o[0].column;for(var f=h;f<=p;f++)d.push(f)}else var u=this.get(a,!0),c=this.get(e,!0);var g=[];if(u>c){var m=u;u=c,c=m}for(var w="object"!=typeof this.url?this.url:this.url.get,v=u;v<=c;v++)if(!(this.searchData.length>0)||w||-1!=$.inArray(v,this.last.searchIds))if("row"==this.selectType)g.push(this.records[v].recid);else for(var y=0;y<d.length;y++)g.push({recid:this.records[v].recid,column:d[y]});this.select.apply(this,g)}else{var b=this.last.selection,x=-1!=b.indexes.indexOf(l),_=!1;if($(t.target).parents("td").hasClass("w2ui-col-select")&&(_=!0),(t.ctrlKey||t.shiftKey||t.metaKey||_)&&this.multiSelect||this.showSelectColumn){var k=$(t.target).parents("tr").find(".w2ui-grid-select-check").is(":checked");"row"==this.selectType||-1!=$.inArray(s,b.columns[l])||k||(x=!1),!0===x?this.unselect({recid:e,column:s}):this.select({recid:e,column:s})}else"row"!=this.selectType&&-1==$.inArray(s,b.columns[l])&&(x=!1),o.length>300?this.selectNone():this.unselect.apply(this,o),!0===x&&1==o.length?this.unselect({recid:e,column:s}):this.select({recid:e,column:s})}this.status(),n.initResize(),this.trigger($.extend(r,{phase:"after"}))}}},columnClick:function(e,t){var i=this.trigger({phase:"before",type:"columnClick",target:this.name,field:e,originalEvent:t});if(!0!==i.isCancelled){if("row"==this.selectType)(n=this.getColumn(e))&&n.sortable&&this.sort(e,null,!(!t||!t.ctrlKey&&!t.metaKey)),"line-number"==i.field&&(this.getSelection().length>=this.records.length?this.selectNone():this.selectAll());else if("line-number"==i.field)this.getSelection().length>=this.records.length?this.selectNone():this.selectAll();else{t.shiftKey||t.metaKey||t.ctrlKey||this.selectNone();var s=this.getSelection(),n=this.getColumn(i.field,!0),a=[],r=[];if(0!=s.length&&t.shiftKey){var o=n,l=s[0].column;o>l&&(o=s[0].column,l=n);for(d=o;d<=l;d++)r.push(d)}else r.push(n);if(!0!==(i=this.trigger({phase:"before",type:"columnSelect",target:this.name,columns:r})).isCancelled){for(var d=0;d<this.records.length;d++)a.push({recid:this.records[d].recid,column:r});this.select.apply(this,a)}this.trigger($.extend(i,{phase:"after"}))}this.trigger($.extend(i,{phase:"after"}))}},columnDblClick:function(e,t){var i=this.trigger({phase:"before",type:"columnDblClick",target:this.name,field:e,originalEvent:t});!0!==i.isCancelled&&this.trigger($.extend(i,{phase:"after"}))},focus:function(e){var t=this,i=this.trigger({phase:"before",type:"focus",target:this.name,originalEvent:e});return!0!==i.isCancelled&&(this.hasFocus=!0,$(this.box).find(".w2ui-inactive").removeClass("w2ui-inactive"),setTimeout(function(){var e=$(t.box).find("#grid_"+t.name+"_focus");e.is(":focus")||e.focus()},10),void this.trigger($.extend(i,{phase:"after"})))},blur:function(e){var t=this.trigger({phase:"before",type:"blur",target:this.name,originalEvent:e});return!0!==t.isCancelled&&(this.hasFocus=!1,$(this.box).find(".w2ui-selected").addClass("w2ui-inactive"),$(this.box).find(".w2ui-selection").addClass("w2ui-inactive"),void this.trigger($.extend(t,{phase:"after"})))},keydown:function(e){function t(){var e=Math.floor(o[0].scrollTop/s.recordHeight)+1;(!s.records[e]||e<2)&&(e=0),s.select({recid:s.records[e].recid,column:0})}function i(){if("click"!=s.last.sel_type)return!1;if("row"!=s.selectType){if(s.last.sel_type="key",l.length>1){for(var e=0;e<l.length;e++)if(l[e].recid==s.last.sel_recid&&l[e].column==s.last.sel_col){l.splice(e,1);break}return s.unselect.apply(s,l),!0}return!1}return s.last.sel_type="key",l.length>1&&(l.splice(l.indexOf(s.records[s.last.sel_ind].recid),1),s.unselect.apply(s,l),!0)}var s=this,n="object"!=typeof this.url?this.url:this.url.get;if(!0===s.keyboard){var a=s.trigger({phase:"before",type:"keydown",target:s.name,originalEvent:e});if(!0!==a.isCancelled){if($(this.box).find(">.w2ui-message").length>0)return void(27==e.keyCode&&this.message());var r=!1,o=$("#grid_"+s.name+"_records"),l=s.getSelection();0===l.length&&(r=!0);var d=l[0]||null,u=[],c=l[l.length-1];if("object"==typeof d&&null!=d){d=l[0].recid,u=[];for(var h=0;l[h]&&l[h].recid==d;)u.push(l[h].column),h++;c=l[l.length-1].recid}var p=s.get(d,!0),f=s.get(c,!0),g=(s.get(d),$("#grid_"+s.name+"_rec_"+(null!=p?w2utils.escapeId(s.records[p].recid):"none"))),m=!1,w=e.keyCode,v=e.shiftKey;switch(w){case 8:case 46:(this.show.toolbarDelete||this.onDelete)&&s.delete(),m=!0,e.stopPropagation();break;case 27:s.selectNone(),m=!0;break;case 65:if(!e.metaKey&&!e.ctrlKey)break;s.selectAll(),m=!0;break;case 13:if("row"==this.selectType&&!0===s.show.expandColumn){if(g.length<=0)break;s.toggle(d,e),m=!0}else{for(k=0;k<this.columns.length;k++)if(this.getCellEditable(p,k)){u.push(parseInt(k));break}"row"==this.selectType&&this.last._edit.column&&(u=[this.last._edit.column]),u.length>0&&(s.editField(d,u[0],null,e),m=!0)}break;case 37:if(r){t();break}if("row"==this.selectType){if(g.length<=0)break;!(y=this.records[p].w2ui||{})||null==y.parent_recid||Array.isArray(y.children)&&0!==y.children.length&&y.expanded?s.collapse(d,e):(s.unselect(d),s.collapse(y.parent_recid,e),s.select(y.parent_recid))}else{_=s.prevCell(p,u[0]);if(v||null!=_||(this.selectNone(),_=0),null!=_)if(v&&s.multiSelect){if(i())return;var y=[],b=[],x=[];if(0===u.indexOf(this.last.sel_col)&&u.length>1){for(S=0;S<l.length;S++)-1==y.indexOf(l[S].recid)&&y.push(l[S].recid),x.push({recid:l[S].recid,column:u[u.length-1]});s.unselect.apply(s,x),s.scrollIntoView(p,u[u.length-1],!0)}else{for(S=0;S<l.length;S++)-1==y.indexOf(l[S].recid)&&y.push(l[S].recid),b.push({recid:l[S].recid,column:_});s.select.apply(s,b),s.scrollIntoView(p,_,!0)}}else e.metaKey=!1,s.click({recid:d,column:_},e),s.scrollIntoView(p,_,!0);else if(!v)if(l.length>1)s.selectNone();else for(T=1;T<l.length;T++)s.unselect(l[T])}m=!0;break;case 39:if(r){t();break}if("row"==this.selectType){if(g.length<=0)break;s.expand(d,e)}else{C=s.nextCell(p,u[u.length-1]);if(v||null!=C||(this.selectNone(),C=this.columns.length-1),null!=C)if(v&&39==w&&s.multiSelect){if(i())return;var y=[],b=[],x=[];if(u.indexOf(this.last.sel_col)==u.length-1&&u.length>1){for(S=0;S<l.length;S++)-1==y.indexOf(l[S].recid)&&y.push(l[S].recid),x.push({recid:l[S].recid,column:u[0]});s.unselect.apply(s,x),s.scrollIntoView(p,u[0],!0)}else{for(S=0;S<l.length;S++)-1==y.indexOf(l[S].recid)&&y.push(l[S].recid),b.push({recid:l[S].recid,column:C});s.select.apply(s,b),s.scrollIntoView(p,C,!0)}}else e.metaKey=!1,s.click({recid:d,column:C},e),s.scrollIntoView(p,C,!0);else if(!v)if(l.length>1)s.selectNone();else for(T=0;T<l.length-1;T++)s.unselect(l[T])}m=!0;break;case 38:if(r&&t(),g.length<=0)break;var _=s.prevRow(p,u[0]);if(v||null!=_||(_=0==this.searchData.length||n?0:this.last.searchIds[0]),null!=_){if(v&&s.multiSelect){if(i())return;if("row"==s.selectType)s.last.sel_ind>_&&s.last.sel_ind!=f?s.unselect(s.records[f].recid):s.select(s.records[_].recid);else if(s.last.sel_ind>_&&s.last.sel_ind!=f){_=f;for(var y=[],k=0;k<u.length;k++)y.push({recid:s.records[_].recid,column:u[k]});s.unselect.apply(s,y)}else{for(var y=[],k=0;k<u.length;k++)y.push({recid:s.records[_].recid,column:u[k]});s.select.apply(s,y)}}else l.length>300?this.selectNone():this.unselect.apply(this,l),s.click({recid:s.records[_].recid,column:u[0]},e);s.scrollIntoView(_),e.preventDefault&&e.preventDefault()}else if(!v)if(l.length>1)s.selectNone();else for(T=1;T<l.length;T++)s.unselect(l[T]);break;case 40:if(r&&t(),g.length<=0)break;var C=s.nextRow(f,u[0]);if(v||null!=C||(C=0==this.searchData.length||n?this.records.length-1:this.last.searchIds[this.last.searchIds.length-1]),null!=C){if(v&&s.multiSelect){if(i())return;if("row"==s.selectType)this.last.sel_ind<C&&this.last.sel_ind!=p?s.unselect(s.records[p].recid):s.select(s.records[C].recid);else if(this.last.sel_ind<C&&this.last.sel_ind!=p){C=p;for(var y=[],k=0;k<u.length;k++)y.push({recid:s.records[C].recid,column:u[k]});s.unselect.apply(s,y)}else{for(var y=[],k=0;k<u.length;k++)y.push({recid:s.records[C].recid,column:u[k]});s.select.apply(s,y)}}else l.length>300?this.selectNone():this.unselect.apply(this,l),s.click({recid:s.records[C].recid,column:u[0]},e);s.scrollIntoView(C),m=!0}else if(!v)if(l.length>1)s.selectNone();else for(var T=0;T<l.length-1;T++)s.unselect(l[T]);break;case 17:case 91:if(r)break;s.last.isSafari&&(s.last.copy_event=s.copy(!1,e),$("#grid_"+s.name+"_focus").val(s.last.copy_event.text).select());break;case 67:(e.metaKey||e.ctrlKey)&&(s.last.isSafari?s.copy(s.last.copy_event,e):(s.last.copy_event=s.copy(!1,e),$("#grid_"+s.name+"_focus").val(s.last.copy_event.text).select(),s.copy(s.last.copy_event,e)));break;case 88:if(r)break;(e.ctrlKey||e.metaKey)&&(s.last.isSafari?s.copy(s.last.copy_event,e):(s.last.copy_event=s.copy(!1,e),$("#grid_"+s.name+"_focus").val(s.last.copy_event.text).select(),s.copy(s.last.copy_event,e)))}for(var y=[32,187,189,192,219,220,221,186,222,188,190,191],S=48;S<=111;S++)y.push(S);-1==y.indexOf(w)||e.ctrlKey||e.metaKey||m||(0===u.length&&u.push(0),m=!1,setTimeout(function(){var t=$("#grid_"+s.name+"_focus"),i=t.val();t.val(""),s.editField(d,u[0],i,e)},1)),m&&e.preventDefault&&e.preventDefault(),s.trigger($.extend(a,{phase:"after"}))}}},scrollIntoView:function(e,t,i){var s=this.records.length;if(0==this.searchData.length||this.url||(s=this.last.searchIds.length),0!==s){if(null==e){var n=this.getSelection();if(0===n.length)return;$.isPlainObject(n[0])?(e=n[0].index,t=n[0].column):e=this.get(n[0],!0)}var a=$("#grid_"+this.name+"_records"),r=this.last.searchIds.length;if(r>0&&(e=this.last.searchIds.indexOf(e)),a.height()<this.recordHeight*(r>0?r:s)&&a.length>0){var o=Math.floor(a[0].scrollTop/this.recordHeight),l=o+Math.floor(a.height()/this.recordHeight);e==o&&(!0===i?a.prop({scrollTop:a.scrollTop()-a.height()/1.3}):(a.stop(),a.animate({scrollTop:a.scrollTop()-a.height()/1.3},250,"linear"))),e==l&&(!0===i?a.prop({scrollTop:a.scrollTop()+a.height()/1.3}):(a.stop(),a.animate({scrollTop:a.scrollTop()+a.height()/1.3},250,"linear"))),(e<o||e>l)&&(!0===i?a.prop({scrollTop:(e-1)*this.recordHeight}):(a.stop(),a.animate({scrollTop:(e-1)*this.recordHeight},250,"linear")))}if(null!=t){for(var d=0,u=0,c=w2utils.scrollBarSize(),h=0;h<=t;h++){var p=this.columns[h];p.frozen||p.hidden||(d=u,u+=parseInt(p.sizeCalculated))}a.width()<u-a.scrollLeft()?!0===i?a.prop({scrollLeft:d-c}):a.animate({scrollLeft:d-c},250,"linear"):d<a.scrollLeft()&&(!0===i?a.prop({scrollLeft:u-a.width()+2*c}):a.animate({scrollLeft:u-a.width()+2*c},250,"linear"))}}},dblClick:function(e,t){var i=null;if("object"==typeof e&&null!==e&&(i=e.column,e=e.recid),null==t&&(t={}),null==i&&t.target){var s=t.target;"TD"!=s.tagName.toUpperCase()&&(s=$(s).parents("td")[0]),i=parseInt($(s).attr("col"))}var n=this.get(e,!0),a=this.records[n],r=this.trigger({phase:"before",target:this.name,type:"dblClick",recid:e,column:i,originalEvent:t});!0!==r.isCancelled&&(this.selectNone(),this.getCellEditable(n,i)?this.editField(e,i,null,t):(this.select({recid:e,column:i}),(this.show.expandColumn||a.w2ui&&Array.isArray(a.w2ui.children))&&this.toggle(e)),this.trigger($.extend(r,{phase:"after"})))},contextMenu:function(e,t,i){var s=this;if("text"!=s.last.userSelect){null==i&&(i={offsetX:0,offsetY:0,target:$("#grid_"+s.name+"_rec_"+e)[0]}),null==i.offsetX&&(i.offsetX=i.layerX-i.target.offsetLeft,i.offsetY=i.layerY-i.target.offsetTop),w2utils.isFloat(e)&&(e=parseFloat(e));var n=this.getSelection();if("row"==this.selectType)-1==n.indexOf(e)&&s.click(e);else{var a=$(i.target);"TD"!=a[0].tagName.toUpperCase()&&(a=$(i.target).parents("td"));var r=!1;t=a.attr("col");for(var o=0;o<n.length;o++)n[o].recid!=e&&n[o].column!=t||(r=!0);r||null==e||s.click({recid:e,column:t}),r||null==t||s.columnClick(this.columns[t].field,i)}var l=s.trigger({phase:"before",type:"contextMenu",target:s.name,originalEvent:i,recid:e,column:t});!0!==l.isCancelled&&(s.menu.length>0&&$(s.box).find(i.target).w2menu(s.menu,{originalEvent:i,contextMenu:!0,onSelect:function(t){s.menuClick(e,parseInt(t.index),t.originalEvent)}}),i.preventDefault&&i.preventDefault(),s.trigger($.extend(l,{phase:"after"})))}},menuClick:function(e,t,i){var s=this,n=s.trigger({phase:"before",type:"menuClick",target:s.name,originalEvent:i,recid:e,menuIndex:t,menuItem:s.menu[t]});!0!==n.isCancelled&&s.trigger($.extend(n,{phase:"after"}))},toggle:function(e){var t=this.get(e);return t.w2ui=t.w2ui||{},!0===t.w2ui.expanded?this.collapse(e):this.expand(e)},expand:function(e){var t=this.get(e,!0),i=this.records[t];i.w2ui=i.w2ui||{};var s=w2utils.escapeId(e),n=i.w2ui.children;if(Array.isArray(n)){if(!0===i.w2ui.expanded||0===n.length)return!1;if(!0===(a=this.trigger({phase:"before",type:"expand",target:this.name,recid:e})).isCancelled)return!1;i.w2ui.expanded=!0,n.forEach(function(e){e.w2ui=e.w2ui||{},e.w2ui.parent_recid=i.recid,null==e.w2ui.children&&(e.w2ui.children=[])}),this.records.splice.apply(this.records,[t+1,0].concat(n)),this.total+=n.length,("object"!=typeof this.url?this.url:this.url.get)||(this.localSort(!0,!0),this.searchData.length>0&&this.localSearch(!0)),this.refresh(),this.trigger($.extend(a,{phase:"after"}))}else{if($("#grid_"+this.name+"_rec_"+s+"_expanded_row").length>0||!0!==this.show.expandColumn)return!1;if("none"==i.w2ui.expanded)return!1;$("#grid_"+this.name+"_rec_"+s).after('<tr id="grid_'+this.name+"_rec_"+e+'_expanded_row" class="w2ui-expanded-row">    <td colspan="100" class="w2ui-expanded2">        <div id="grid_'+this.name+"_rec_"+e+'_expanded"></div>    </td>    <td class="w2ui-grid-data-last"></td></tr>'),$("#grid_"+this.name+"_frec_"+s).after('<tr id="grid_'+this.name+"_frec_"+e+'_expanded_row" class="w2ui-expanded-row">'+(this.show.lineNumbers?'<td class="w2ui-col-number"></td>':"")+'    <td class="w2ui-grid-data w2ui-expanded1" colspan="100">       <div id="grid_'+this.name+"_frec_"+e+'_expanded"></div>   </td></tr>');var a=this.trigger({phase:"before",type:"expand",target:this.name,recid:e,box_id:"grid_"+this.name+"_rec_"+e+"_expanded",fbox_id:"grid_"+this.name+"_frec_"+s+"_expanded"});if(!0===a.isCancelled)return $("#grid_"+this.name+"_rec_"+s+"_expanded_row").remove(),$("#grid_"+this.name+"_frec_"+s+"_expanded_row").remove(),!1;var r=$(this.box).find("#grid_"+this.name+"_rec_"+e+"_expanded"),o=$(this.box).find("#grid_"+this.name+"_frec_"+e+"_expanded"),l=r.find("> div:first-child").height();r.height()<l&&r.css({height:l+"px"}),o.height()<l&&o.css({height:l+"px"}),$("#grid_"+this.name+"_rec_"+s).attr("expanded","yes").addClass("w2ui-expanded"),$("#grid_"+this.name+"_frec_"+s).attr("expanded","yes").addClass("w2ui-expanded"),$("#grid_"+this.name+"_cell_"+this.get(e,!0)+"_expand div").html("-"),i.w2ui.expanded=!0,this.trigger($.extend(a,{phase:"after"})),this.resizeRecords()}return!0},collapse:function(e){function t(e){e.w2ui.expanded=!1;for(var i=0;i<e.w2ui.children.length;i++){var s=e.w2ui.children[i];s.w2ui.expanded&&t(s)}}var i=this,s=this.get(e,!0),n=this.records[s];n.w2ui=n.w2ui||{};var a=w2utils.escapeId(e),r=n.w2ui.children;if(Array.isArray(r)){if(!0!==n.w2ui.expanded)return!1;if(!0===(c=this.trigger({phase:"before",type:"collapse",target:this.name,recid:e})).isCancelled)return!1;t(n);for(var o=[],l=n;null!=l;l=this.get(l.w2ui.parent_recid))o.push(l.w2ui.parent_recid);for(var d=s+1,u=d;!(this.records.length<=u+1||null==this.records[u+1].w2ui||o.indexOf(this.records[u+1].w2ui.parent_recid)>=0);)u++;this.records.splice(d,u-d+1),this.total-=u-d+1,("object"!=typeof this.url?this.url:this.url.get)||this.searchData.length>0&&this.localSearch(!0),this.refresh(),i.trigger($.extend(c,{phase:"after"}))}else{if(0===$("#grid_"+this.name+"_rec_"+a+"_expanded_row").length||!0!==this.show.expandColumn)return!1;var c=this.trigger({phase:"before",type:"collapse",target:this.name,recid:e,box_id:"grid_"+this.name+"_rec_"+a+"_expanded",fbox_id:"grid_"+this.name+"_frec_"+a+"_expanded"});if(!0===c.isCancelled)return!1;$("#grid_"+this.name+"_rec_"+a).removeAttr("expanded").removeClass("w2ui-expanded"),$("#grid_"+this.name+"_frec_"+a).removeAttr("expanded").removeClass("w2ui-expanded"),$("#grid_"+this.name+"_cell_"+this.get(e,!0)+"_expand div").html("+"),$("#grid_"+i.name+"_rec_"+a+"_expanded").css("height","0px"),$("#grid_"+i.name+"_frec_"+a+"_expanded").css("height","0px"),setTimeout(function(){$("#grid_"+i.name+"_rec_"+a+"_expanded_row").remove(),$("#grid_"+i.name+"_frec_"+a+"_expanded_row").remove(),n.w2ui.expanded=!1,i.trigger($.extend(c,{phase:"after"})),i.resizeRecords()},300)}return!0},sort:function(e,t,i){var s=this.trigger({phase:"before",type:"sort",target:this.name,field:e,direction:t,multiField:i});if(!0!==s.isCancelled){if(null!=e){for(var n=this.sortData.length,a=0;a<this.sortData.length;a++)if(this.sortData[a].field==e){n=a;break}if(null==t)if(null==this.sortData[n])t="asc";else switch(null==this.sortData[n].direction&&(this.sortData[n].direction=""),this.sortData[n].direction.toLowerCase()){case"asc":t="desc";break;case"desc":t="asc";break;default:t="asc"}!1===this.multiSort&&(this.sortData=[],n=0),1!=i&&(this.sortData=[],n=0),null==this.sortData[n]&&(this.sortData[n]={}),this.sortData[n].field=e,this.sortData[n].direction=t}else this.sortData=[];("object"!=typeof this.url?this.url:this.url.get)?(this.trigger($.extend(s,{phase:"after",direction:t})),this.last.xhr_offset=0,this.reload()):(this.localSort(!0,!0),this.searchData.length>0&&this.localSearch(!0),this.last.scrollTop=0,$("#grid_"+this.name+"_records").prop("scrollTop",0),this.trigger($.extend(s,{phase:"after",direction:t})),this.refresh())}},copy:function(e,t){if($.isPlainObject(e))return this.trigger($.extend(e,{phase:"after"})),e.text;var i=this.getSelection();if(0===i.length)return"";var s="";if("object"==typeof i[0]){for(var n=i[0].column,a=i[0].column,r=[],o=0;o<i.length;o++)i[o].column<n&&(n=i[o].column),i[o].column>a&&(a=i[o].column),-1==r.indexOf(i[o].index)&&r.push(i[o].index);r.sort(function(e,t){return e-t});for(var l=0;l<r.length;l++){for(var d=r[l],u=n;u<=a;u++)!0!==(h=this.columns[u]).hidden&&(s+=this.getCellCopy(d,u)+"\t");s=s.substr(0,s.length-1),s+="\n"}}else{for(u=0;u<this.columns.length;u++)if(!0!==(h=this.columns[u]).hidden){var c=h.caption?h.caption:h.field;h.caption&&h.caption.length<3&&h.tooltip&&(c=h.tooltip),s+='"'+w2utils.stripTags(c)+'"\t'}s=s.substr(0,s.length-1),s+="\n";for(o=0;o<i.length;o++){for(var d=this.get(i[o],!0),u=0;u<this.columns.length;u++){var h=this.columns[u];!0!==h.hidden&&(s+='"'+this.getCellCopy(d,u)+'"\t')}s=s.substr(0,s.length-1),s+="\n"}}if(s=s.substr(0,s.length-1),null==e)return!0===(p=this.trigger({phase:"before",type:"copy",target:this.name,text:s,cut:88==t.keyCode,originalEvent:t})).isCancelled?"":(s=p.text,this.trigger($.extend(p,{phase:"after"})),s);if(!1===e){var p=this.trigger({phase:"before",type:"copy",target:this.name,text:s,cut:88==t.keyCode,originalEvent:t});return!0===p.isCancelled?"":(s=p.text,p)}},getCellCopy:function(e,t){return w2utils.stripTags(this.getCellHTML(e,t))},paste:function(e){var t=this.getSelection(),i=this.get(t[0].recid,!0),s=t[0].column,n=this.trigger({phase:"before",type:"paste",target:this.name,text:e,index:i,column:s});if(!0!==n.isCancelled){if(e=n.text,"row"==this.selectType||0===t.length)return console.log("ERROR: You can paste only if grid.selectType = 'cell' and when at least one cell selected."),void this.trigger($.extend(n,{phase:"after"}));for(var a=[],e=e.split("\n"),r=0;r<e.length;r++){var o=e[r].split("\t"),l=0,d=this.records[i],u=[];if(null!=d){for(var c=0;c<o.length;c++)this.columns[s+l]&&(this.setCellPaste(d,s+l,o[c]),u.push(s+l),l++);for(var h=0;h<u.length;h++)a.push({recid:d.recid,column:u[h]});i++}}this.selectNone(),this.select.apply(this,a),this.refresh(),this.trigger($.extend(n,{phase:"after"}))}},setCellPaste:function(e,t,i){var s=this.columns[t].field;e.w2ui=e.w2ui||{},e.w2ui.changes=e.w2ui.changes||{},e.w2ui.changes[s]=i},resize:function(){var e=this,t=(new Date).getTime();if(this.box&&$(this.box).attr("name")==this.name){$(this.box).find("> div.w2ui-grid-box").css("width",$(this.box).width()).css("height",$(this.box).height());var i=this.trigger({phase:"before",type:"resize",target:this.name});if(!0!==i.isCancelled)return e.resizeBoxes(),e.resizeRecords(),e.toolbar&&e.toolbar.resize&&e.toolbar.resize(),this.trigger($.extend(i,{phase:"after"})),(new Date).getTime()-t}},update:function(e){var t=(new Date).getTime();if(null==this.box)return 0;if(null==e){for(s=this.last.range_start-1;s<=this.last.range_end-1;s++)if(!(s<0)){(a=this.records[s]||{}).w2ui||(a.w2ui={});for(n=0;n<this.columns.length;n++){r=$(this.box).find("#grid_"+this.name+"_rec_"+w2utils.escapeId(a.recid));(o=$(this.box).find("#grid_"+this.name+"_data_"+s+"_"+n)).replaceWith(this.getCellHTML(s,n,!1)),o=$(this.box).find("#grid_"+this.name+"_data_"+s+"_"+n),null==a.w2ui.style||$.isEmptyObject(a.w2ui.style)?o.attr("style",""):("string"==typeof a.w2ui.style&&r.attr("style",a.w2ui.style),$.isPlainObject(a.w2ui.style)&&"string"==typeof a.w2ui.style[n]&&o.attr("style",a.w2ui.style[n])),null==a.w2ui.class||$.isEmptyObject(a.w2ui.class)||("string"==typeof a.w2ui.class&&r.addClass(a.w2ui.class),$.isPlainObject(a.w2ui.class)&&"string"==typeof a.w2ui.class[n]&&o.addClass(a.w2ui.class[n]))}}}else for(var i=0;i<e.length;i++){var s=e[i].index,n=e[i].column;if(!(s<0))if(null!=s&&null!=n){var a=this.records[s]||{},r=$(this.box).find("#grid_"+this.name+"_rec_"+w2utils.escapeId(a.recid)),o=$(this.box).find("#grid_"+this.name+"_data_"+s+"_"+n);a.w2ui||(a.w2ui={}),o.replaceWith(this.getCellHTML(s,n,!1)),o=$(this.box).find("#grid_"+this.name+"_data_"+s+"_"+n),null==a.w2ui.style||$.isEmptyObject(a.w2ui.style)?o.attr("style",""):("string"==typeof a.w2ui.style&&r.attr("style",a.w2ui.style),$.isPlainObject(a.w2ui.style)&&"string"==typeof a.w2ui.style[n]&&o.attr("style",a.w2ui.style[n])),null==a.w2ui.class||$.isEmptyObject(a.w2ui.class)||("string"==typeof a.w2ui.class&&r.addClass(a.w2ui.class),$.isPlainObject(a.w2ui.class)&&"string"==typeof a.w2ui.class[n]&&o.addClass(a.w2ui.class[n]))}else console.log("ERROR: Wrong argument for grid.update(cells), cells should be [{ index: X, column: Y }, ...]")}return(new Date).getTime()-t},refreshCell:function(e,t){var i=this.get(e,!0),s=!this.records[i]||this.records[i].recid!=e,n=this.getColumn(t,!0),a=s?this.summary[i]:this.records[i],r=this.columns[n],o=$(this.box).find("#grid_"+this.name+"_data_"+i+"_"+n);return null!=a&&(o.replaceWith(this.getCellHTML(i,n,s)),o=$(this.box).find("#grid_"+this.name+"_data_"+i+"_"+n),a.w2ui&&a.w2ui.changes&&null!=a.w2ui.changes[r.field]?o.addClass("w2ui-changed"):o.removeClass("w2ui-changed"),a.w2ui&&null!=a.w2ui.style&&!$.isEmptyObject(a.w2ui.style)?("string"==typeof a.w2ui.style&&$(this.box).find("#grid_"+this.name+"_rec_"+w2utils.escapeId(a.recid)).attr("style",a.w2ui.style),$.isPlainObject(a.w2ui.style)&&"string"==typeof a.w2ui.style[n]&&o.attr("style",a.w2ui.style[n])):o.attr("style",""),void(a.w2ui&&null!=a.w2ui.class&&!$.isEmptyObject(a.w2ui.class)&&("string"==typeof a.w2ui.class&&$(this.box).find("#grid_"+this.name+"_rec_"+w2utils.escapeId(a.recid)).addClass(a.w2ui.class),$.isPlainObject(a.w2ui.class)&&"string"==typeof a.w2ui.class[n]&&o.addClass(a.w2ui.class[n]))))},refreshRow:function(e,t){var i=$(this.box).find("#grid_"+this.name+"_frec_"+w2utils.escapeId(e)),s=$(this.box).find("#grid_"+this.name+"_rec_"+w2utils.escapeId(e));if(i.length>0){null==t&&(t=this.get(e,!0));var n=i.attr("line"),a=!this.records[t]||this.records[t].recid!=e,r="object"!=typeof this.url?this.url:this.url.get;if(this.searchData.length>0&&!r)for(var o=0;o<this.last.searchIds.length;o++)this.last.searchIds[o]==t&&(t=o);var l=this.getRecordHTML(t,n,a);$(i).replaceWith(l[0]),$(s).replaceWith(l[1]);var d=this.records[t].w2ui?this.records[t].w2ui.style:"";if("string"==typeof d){var i=$(this.box).find("#grid_"+this.name+"_frec_"+w2utils.escapeId(e)),s=$(this.box).find("#grid_"+this.name+"_rec_"+w2utils.escapeId(e));i.attr("custom_style",d),s.attr("custom_style",d),i.hasClass("w2ui-selected")&&(d=d.replace("background-color","none")),i[0].style.cssText="height: "+this.recordHeight+"px;"+d,s[0].style.cssText="height: "+this.recordHeight+"px;"+d}a&&this.resize()}},refresh:function(){var e=this,t=(new Date).getTime(),i="object"!=typeof this.url?this.url:this.url.get;if(this.total<=0&&!i&&0===this.searchData.length&&(this.total=this.records.length),this.toolbar.disable("w2ui-edit","w2ui-delete"),this.box){var s=this.trigger({phase:"before",target:this.name,type:"refresh"});if(!0!==s.isCancelled){if(this.show.header?$("#grid_"+this.name+"_header").html(this.header+"&#160;").show():$("#grid_"+this.name+"_header").hide(),this.show.toolbar){if(this.toolbar&&this.toolbar.get("w2ui-column-on-off")&&this.toolbar.get("w2ui-column-on-off").checked);else if($("#grid_"+this.name+"_toolbar").show(),"object"==typeof this.toolbar)for(var n=this.toolbar.items,a=0;a<n.length;a++)"w2ui-search"!=n[a].id&&"break"!=n[a].type&&this.toolbar.refresh(n[a].id)}else $("#grid_"+this.name+"_toolbar").hide();this.searchClose();var r=$("#grid_"+e.name+"_search_all");!this.multiSearch&&"all"==this.last.field&&this.searches.length>0&&(this.last.field=this.searches[0].field,this.last.caption=this.searches[0].caption);for(var o=0;o<this.searches.length;o++)this.searches[o].field==this.last.field&&(this.last.caption=this.searches[o].caption);if(this.last.multi?(r.attr("placeholder","["+w2utils.lang("Multiple Fields")+"]"),r.w2field("clear")):r.attr("placeholder",w2utils.lang(this.last.caption)),r.val()!=this.last.search){var l=this.last.search;(n=r.data("w2field"))&&(l=n.format(l)),r.val(l)}e.refreshBody(),this.show.footer?$("#grid_"+this.name+"_footer").html(this.getFooterHTML()).show():$("#grid_"+this.name+"_footer").hide();var d=$("#grid_"+this.name+"_searchClear");d.hide(),this.searchData.some(function(t){var i=e.getSearch(t.field);if(e.last.multi||i&&!i.hidden&&"list"!=i.type)return d.show(),!0});var u=this.last.selection,c=this.records.length>0&&u.indexes.length==this.records.length,h=u.indexes.length>0&&0!==this.searchData.length&&u.indexes.length==this.last.searchIds.length;c||h?$("#grid_"+this.name+"_check_all").prop("checked",!0):$("#grid_"+this.name+"_check_all").prop("checked",!1),this.status();for(var p=e.find({"w2ui.expanded":!0},!0),f=0;f<p.length;f++)(n=e.records[p[f]].w2ui)&&!Array.isArray(n.children)&&(n.expanded=!1);return e.markSearch&&setTimeout(function(){for(var t=[],i=0;i<e.searchData.length;i++){var s=e.searchData[i],n=e.getSearch(s.field);if(n&&!n.hidden){var a=e.getColumn(s.field,!0);t.push({field:s.field,search:s.value,col:a})}}t.length>0&&t.forEach(function(t){$(e.box).find('td[col="'+t.col+'"]').not(".w2ui-head").w2marker(t.search)})},50),this.show.toolbarSave&&(this.getChanges().length>0?this.toolbar.enable("w2ui-save"):this.toolbar.disable("w2ui-save")),this.trigger($.extend(s,{phase:"after"})),e.resize(),e.addRange("selection"),setTimeout(function(){e.resize(),e.scroll()},1),e.reorderColumns&&!e.last.columnDrag?e.last.columnDrag=e.initColumnDrag():!e.reorderColumns&&e.last.columnDrag&&e.last.columnDrag.remove(),(new Date).getTime()-t}}},refreshBody:function(){var e=this,t=this.find({"w2ui.summary":!0},!0);if(t.length>0){for(i=0;i<t.length;i++)this.summary.push(this.records[t[i]]);for(var i=t.length-1;i>=0;i--)this.records.splice(t[i],1)}this.scroll();var s=this.getRecordsHTML(),n=this.getColumnsHTML(),a='<div id="grid_'+this.name+'_frecords" class="w2ui-grid-frecords" style="margin-bottom: '+(w2utils.scrollBarSize()-1)+'px;">'+s[0]+'</div><div id="grid_'+this.name+'_records" class="w2ui-grid-records" onscroll="w2ui[\''+this.name+"'].scroll(event);\">"+s[1]+'</div><div id="grid_'+this.name+'_scroll1" class="w2ui-grid-scroll1" style="height: '+w2utils.scrollBarSize()+'px"></div><div id="grid_'+this.name+'_fcolumns" class="w2ui-grid-fcolumns">    <table><tbody>'+n[0]+'</tbody></table></div><div id="grid_'+this.name+'_columns" class="w2ui-grid-columns">    <table><tbody>'+n[1]+"</tbody></table></div>",r=$("#grid_"+this.name+"_body",e.box).html(a),o=$("#grid_"+this.name+"_records",e.box);if(r.data("scrolldata",{lastTime:0,lastDelta:0,time:0}).find(".w2ui-grid-frecords").on("mousewheel DOMMouseScroll ",function(t){t.preventDefault();var i=t.originalEvent,s=r.data("scrolldata"),n=$(this).siblings(".w2ui-grid-records").addBack().filter(".w2ui-grid-records"),a=null!=typeof i.wheelDelta?-1*i.wheelDelta/120:(i.detail||i.deltaY)/3,l=n.scrollTop();s.time=+new Date,s.lastTime<s.time-150&&(s.lastDelta=0),s.lastTime=s.time,s.lastDelta+=a,a=Math.abs(s.lastDelta)<1?0:Math.round(s.lastDelta),r.data("scrolldata",s),a*=(Math.round(o.height()/e.recordHeight)-1)*e.recordHeight/4,n.stop().animate({scrollTop:l+a},250,"linear")}),0===this.records.length&&this.msgEmpty?$("#grid_"+this.name+"_body").append('<div id="grid_'+this.name+'_empty_msg" class="w2ui-grid-empty-msg"><div>'+this.msgEmpty+"</div></div>"):$("#grid_"+this.name+"_empty_msg").length>0&&$("#grid_"+this.name+"_empty_msg").remove(),this.summary.length>0){var l=this.getSummaryHTML();$("#grid_"+this.name+"_fsummary").html(l[0]).show(),$("#grid_"+this.name+"_summary").html(l[1]).show()}else $("#grid_"+this.name+"_fsummary").hide(),$("#grid_"+this.name+"_summary").hide()},render:function(e){function t(e){var t=s.last.move;if(t&&-1!=["select","select-column"].indexOf(t.type)&&(t.divX=e.screenX-t.x,t.divY=e.screenY-t.y,!(Math.abs(t.divX)<=1&&Math.abs(t.divY)<=1))){if(s.last.cancelClick=!0,1==s.reorderRows&&s.last.move.reorder){if((o=(h=$(e.target).parents("tr")).attr("recid"))!=t.from){var i=($("#grid_"+s.name+"_rec_"+t.recid),$("#grid_"+s.name+"_rec_"+o));$(s.box).find(".tmp-ghost").css("border-top","0px"),i.addClass("tmp-ghost").css("border-top","2px solid #769EFC"),t.lastY=e.screenY,t.to=o}var n=$("#grid_"+s.name+"_ghost"),a=$(s.box).find(".w2ui-grid-records");return void n.css({top:t.pos.top+t.divY+a.scrollTop(),left:t.pos.left})}t.start&&t.recid&&(s.selectNone(),t.start=!1);var r=[],o="TR"==e.target.tagName.toUpperCase()?$(e.target).attr("recid"):$(e.target).parents("tr").attr("recid");if(null==o){if("row"==s.selectType)return;if(s.last.move&&"select"==s.last.move.type)return;var l=parseInt($(e.target).parents("td").attr("col"));if(isNaN(l))s.removeRange("column-selection"),$(s.box).find(".w2ui-grid-columns .w2ui-col-header, .w2ui-grid-fcolumns .w2ui-col-header").removeClass("w2ui-col-selected"),$(s.box).find(".w2ui-col-number").removeClass("w2ui-row-selected"),delete t.colRange;else{var d=l+"-"+l;t.column<l&&(d=t.column+"-"+l),t.column>l&&(d=l+"-"+t.column);for(var u=[],h=d.split("-"),p=parseInt(h[0]);p<=parseInt(h[1]);p++)u.push(p);if(t.colRange!=d&&!0!==(c=s.trigger({phase:"before",type:"columnSelect",target:s.name,columns:u,isCancelled:!1})).isCancelled){null==t.colRange&&s.selectNone();h=d.split("-");$(s.box).find(".w2ui-grid-columns .w2ui-col-header, .w2ui-grid-fcolumns .w2ui-col-header").removeClass("w2ui-col-selected");for(var f=parseInt(h[0]);f<=parseInt(h[1]);f++)$(s.box).find("#grid_"+s.name+"_column_"+f+" .w2ui-col-header").addClass("w2ui-col-selected");$(s.box).find(".w2ui-col-number").not(".w2ui-head").addClass("w2ui-row-selected"),t.colRange=d,s.removeRange("column-selection"),s.addRange({name:"column-selection",range:[{recid:s.records[0].recid,column:h[0]},{recid:s.records[s.records.length-1].recid,column:h[1]}],style:"background-color: rgba(90, 145, 234, 0.1)"})}}}else{var g=s.get(t.recid,!0);if(null==g||s.records[g]&&s.records[g].recid!=t.recid)return;var m=s.get(o,!0);if(null==m)return;var w=parseInt(t.column),v=parseInt("TD"==e.target.tagName.toUpperCase()?$(e.target).attr("col"):$(e.target).parents("td").attr("col"));if(isNaN(w)&&isNaN(v)&&(w=0,v=s.columns.length-1),g>m){h=g;g=m,m=h}h="ind1:"+g+",ind2;"+m+",col1:"+w+",col2:"+v;if(t.range==h)return;t.range=h;for(var y=g;y<=m;y++)if(!(s.last.searchIds.length>0&&-1==s.last.searchIds.indexOf(y)))if("row"!=s.selectType){if(w>v){h=w;w=v,v=h}for(var h=[],b=w;b<=v;b++)s.columns[b].hidden||r.push({recid:s.records[y].recid,column:parseInt(b)})}else r.push(s.records[y].recid);if("row"!=s.selectType){for(var x=s.getSelection(),h=[],_=0;_<r.length;_++){for(var k=!1,C=0;C<x.length;C++)r[_].recid==x[C].recid&&r[_].column==x[C].column&&(k=!0);k||h.push({recid:r[_].recid,column:r[_].column})}s.select.apply(s,h);for(var h=[],C=0;C<x.length;C++){for(var k=!1,_=0;_<r.length;_++)r[_].recid==x[C].recid&&r[_].column==x[C].column&&(k=!0);k||h.push({recid:x[C].recid,column:x[C].column})}s.unselect.apply(s,h)}else if(s.multiSelect){for(var x=s.getSelection(),_=0;_<r.length;_++)-1==x.indexOf(r[_])&&s.select(r[_]);for(C=0;C<x.length;C++)-1==r.indexOf(x[C])&&s.unselect(x[C])}}}}function i(e){var t=s.last.move;if(setTimeout(function(){delete s.last.cancelClick},1),!$(e.target).parents().hasClass(".w2ui-head")&&!$(e.target).hasClass(".w2ui-head")){if(t&&-1!=["select","select-column"].indexOf(t.type)){if(null!=t.colRange&&!0!==c.isCancelled){for(var i=t.colRange.split("-"),n=[],a=0;a<s.records.length;a++){for(var r=[],o=parseInt(i[0]);o<=parseInt(i[1]);o++)r.push(o);n.push({recid:s.records[a].recid,column:r})}s.removeRange("column-selection"),s.trigger($.extend(c,{phase:"after"})),s.select.apply(s,n)}if(1==s.reorderRows&&s.last.move.reorder){var l=s.trigger({phase:"before",target:s.name,type:"reorderRow",recid:t.from,moveAfter:t.to});if(!0===l.isCancelled)return $("#grid_"+s.name+"_ghost").remove(),void s.refresh();var d=s.get(t.from,!0),u=s.get(t.to,!0),i=s.records[d];null!=d&&null!=u&&(s.records.splice(d,1),d>u?s.records.splice(u,0,i):s.records.splice(u-1,0,i)),$("#grid_"+s.name+"_ghost").remove(),s.refresh(),s.trigger($.extend(l,{phase:"after"}))}}delete s.last.move,$(document).off(".w2ui-"+s.name)}}var s=this,n=(new Date).getTime();if(null!=e&&($(this.box).find("#grid_"+this.name+"_body").length>0&&$(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-grid").html(""),this.box=e),this.box){var a="object"!=typeof this.url?this.url:this.url.get,r=this.trigger({phase:"before",target:this.name,type:"render",box:e});if(!0!==r.isCancelled){if(this.reset(!0),!this.last.field)if(this.multiSearch&&this.show.searchAll)this.last.field="all",this.last.caption=w2utils.lang("All Fields");else{for(var o=0;o<this.searches.length&&(this.searches[o].hidden||!1===this.searches[o].simple);)o++;o>=this.searches.length?(this.last.field="",this.last.caption=""):(this.last.field=this.searches[o].field,this.last.caption=this.searches[o].caption)}if($(this.box).attr("name",this.name).addClass("w2ui-reset w2ui-grid").html('<div class="w2ui-grid-box">    <div id="grid_'+this.name+'_header" class="w2ui-grid-header"></div>    <div id="grid_'+this.name+'_toolbar" class="w2ui-grid-toolbar"></div>    <div id="grid_'+this.name+'_body" class="w2ui-grid-body"></div>    <div id="grid_'+this.name+'_fsummary" class="w2ui-grid-body w2ui-grid-summary"></div>    <div id="grid_'+this.name+'_summary" class="w2ui-grid-body w2ui-grid-summary"></div>    <div id="grid_'+this.name+'_footer" class="w2ui-grid-footer"></div>    <textarea id="grid_'+this.name+'_focus" class="w2ui-grid-focus-input"></textarea></div>'),"row"!=this.selectType&&$(this.box).addClass("w2ui-ss"),$(this.box).length>0&&($(this.box)[0].style.cssText+=this.style),this.initToolbar(),null!=this.toolbar&&this.toolbar.render($("#grid_"+this.name+"_toolbar")[0]),this.last.field&&"all"!=this.last.field){var l=this.searchData;setTimeout(function(){s.initAllField(s.last.field,1==l.length?l[0].value:null)},1)}$("#grid_"+this.name+"_footer").html(this.getFooterHTML()),this.last.state||(this.last.state=this.stateSave(!0)),this.stateRestore(),a&&this.refresh();for(var d=!1,u=0;u<this.searches.length;u++)if(this.searches[u].hidden){d=!0;break}d?(this.searchReset(!1),a||setTimeout(function(){s.searchReset()},1)):this.reload(),$(this.box).find("#grid_"+this.name+"_focus").on("focus",function(e){clearTimeout(s.last.kbd_timer),s.hasFocus||s.focus()}).on("blur",function(e){clearTimeout(s.last.kbd_timer),s.last.kbd_timer=setTimeout(function(){s.hasFocus&&s.blur()},100)}).on("paste",function(e){var t=this;setTimeout(function(){w2ui[s.name].paste(t.value),t.value=""},1)}).on("keydown",function(e){w2ui[s.name].keydown.call(w2ui[s.name],e)});var c;return $(this.box).on("mousedown",function(e){if(1==e.which&&("text"==s.last.userSelect&&(delete s.last.userSelect,$(s.box).find(".w2ui-grid-body").css(w2utils.cssPrefix("user-select","none"))),!("row"==s.selectType&&($(e.target).parents().hasClass("w2ui-head")||$(e.target).hasClass("w2ui-head"))||s.last.move&&"expand"==s.last.move.type))){if(e.altKey)$(s.box).find(".w2ui-grid-body").css(w2utils.cssPrefix("user-select","text")),s.selectNone(),s.last.move={type:"text-select"},s.last.userSelect="text";else{for(var n=e.target,a={x:e.offsetX-10,y:e.offsetY-10},r=!1;n&&(!n.classList||!n.classList.contains("w2ui-grid"));)n.tagName&&"TD"==n.tagName.toUpperCase()&&(r=!0),n.tagName&&"TR"!=n.tagName.toUpperCase()&&1==r&&(a.x+=n.offsetLeft,a.y+=n.offsetTop),n=n.parentNode;s.last.move={x:e.screenX,y:e.screenY,divX:0,divY:0,focusX:a.x,focusY:a.y,recid:$(e.target).parents("tr").attr("recid"),column:parseInt("TD"==e.target.tagName.toUpperCase()?$(e.target).attr("col"):$(e.target).parents("td").attr("col")),type:"select",ghost:!1,start:!0},null==s.last.move.recid&&(s.last.move.type="select-column");var o=e.target,l=$(s.box).find("#grid_"+s.name+"_focus");if(s.last.move){var d=s.last.move.focusX,u=s.last.move.focusY,c=$(o).parents("table").parent();(c.hasClass("w2ui-grid-records")||c.hasClass("w2ui-grid-frecords")||c.hasClass("w2ui-grid-columns")||c.hasClass("w2ui-grid-fcolumns")||c.hasClass("w2ui-grid-summary"))&&(d=s.last.move.focusX-$(s.box).find("#grid_"+s.name+"_records").scrollLeft(),u=s.last.move.focusY-$(s.box).find("#grid_"+s.name+"_records").scrollTop()),($(o).hasClass("w2ui-grid-footer")||$(o).parents("div.w2ui-grid-footer").length>0)&&(u=$(s.box).find("#grid_"+s.name+"_footer").position().top),c.hasClass("w2ui-scroll-wrapper")&&c.parent().hasClass("w2ui-toolbar")&&(d=s.last.move.focusX-c.scrollLeft()),l.css({left:d-10,top:u})}setTimeout(function(){-1!=["INPUT","TEXTAREA","SELECT"].indexOf(o.tagName.toUpperCase())?$(o).focus():l.is(":focus")||l.focus()},50),s.multiSelect||s.reorderRows||"drag"!=s.last.move.type||delete s.last.move}if(1==s.reorderRows){var h=e.target;if("TD"!=h.tagName.toUpperCase()&&(h=$(h).parents("td")[0]),$(h).hasClass("w2ui-col-number")){s.selectNone(),s.last.move.reorder=!0;var p=$(s.box).find(".w2ui-even.w2ui-empty-record").css("background-color"),f=$(s.box).find(".w2ui-odd.w2ui-empty-record").css("background-color");$(s.box).find(".w2ui-even td").not(".w2ui-col-number").css("background-color",p),$(s.box).find(".w2ui-odd td").not(".w2ui-col-number").css("background-color",f);var g=s.last.move;if(!g.ghost){var m=$("#grid_"+s.name+"_rec_"+g.recid),n=m.parents("table").find("tr:first-child").clone();g.offsetY=e.offsetY,g.from=g.recid,g.pos=m.position(),g.ghost=$(m).clone(!0),g.ghost.removeAttr("id"),m.find("td").remove(),m.append('<td colspan="1000" style="height: '+s.recordHeight+'px; background-color: #eee; border-bottom: 1px dashed #aaa; border-top: 1px dashed #aaa;"></td>'),(v=$(s.box).find(".w2ui-grid-records")).append('<table id="grid_'+s.name+'_ghost" style="position: absolute; z-index: 999999; opacity: 0.7; pointer-events: none;"></table>'),$("#grid_"+s.name+"_ghost").append(n).append(g.ghost)}var w=$("#grid_"+s.name+"_ghost"),v=$(s.box).find(".w2ui-grid-records");w.css({top:g.pos.top+v.scrollTop(),left:g.pos.left,"border-top":"1px solid #aaa","border-bottom":"1px solid #aaa"})}else s.last.move.reorder=!1}$(document).on("mousemove.w2ui-"+s.name,t).on("mouseup.w2ui-"+s.name,i),e.stopPropagation()}}),this.trigger($.extend(r,{phase:"after"})),0===$(".w2ui-layout").length&&$(window).off("resize.w2ui-"+this.name).on("resize.w2ui-"+this.name,function(e){w2ui[s.name].resize()}),(new Date).getTime()-n}}},destroy:function(){var e=this.trigger({phase:"before",target:this.name,type:"destroy"});!0!==e.isCancelled&&($(this.box).off(),"object"==typeof this.toolbar&&this.toolbar.destroy&&this.toolbar.destroy(),$(this.box).find("#grid_"+this.name+"_body").length>0&&$(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-grid").html(""),delete w2ui[this.name],this.trigger($.extend(e,{phase:"after"})))},initColumnOnOff:function(){if(this.show.toolbarColumns){for(var e=this,t='<div class="w2ui-col-on-off"><table><tbody><tr id="grid_'+this.name+'_column_ln_check" onclick="w2ui[\''+e.name+'\'].columnOnOff(event, \'line-numbers\'); event.stopPropagation();">   <td style="width: 30px; text-align: center; padding-right: 3px; color: #888;">      <span class="w2ui-column-check w2ui-icon-'+(e.show.lineNumbers?"check":"empty")+'"></span>   </td>   <td>      <label>'+w2utils.lang("Line #")+"</label>   </td></tr>",i=0;i<this.columns.length;i++){var s=this.columns[i],n=this.columns[i].caption;!1!==s.hideable&&(!n&&this.columns[i].tooltip&&(n=this.columns[i].tooltip),n||(n="- column "+(parseInt(i)+1)+" -"),t+='<tr id="grid_'+this.name+"_column_"+i+'_check"        onclick="w2ui[\''+e.name+"'].columnOnOff(event, '"+s.field+'\'); event.stopPropagation();">   <td style="width: 30px; text-align: center; padding-right: 3px; color: #888;">      <span class="w2ui-column-check w2ui-icon-'+(s.hidden?"empty":"check")+'"></span>   </td>   <td>       <label>'+w2utils.stripTags(n)+"</label>   </td></tr>")}var a="object"!=typeof this.url?this.url:this.url.get;(a&&e.show.skipRecords||e.show.saveRestoreState)&&(t+='<tr style="pointer-events: none"><td colspan="2"><div style="border-top: 1px solid #ddd;"></div></td></tr>'),a&&e.show.skipRecords&&(t+='<tr><td colspan="2" style="padding: 0px">    <div style="cursor: pointer; padding: 2px 8px; cursor: default">'+w2utils.lang("Skip")+'        <input type="text" style="width: 60px" value="'+this.offset+'"             onkeydown="if ([48,49,50,51,52,53,54,55,56,57,58,13,8,46,37,39].indexOf(event.keyCode) == -1) { event.preventDefault() }"            onkeypress="if (event.keyCode == 13) {                w2ui[\''+e.name+"'].skip(this.value);                jQuery('.w2ui-overlay')[0].hide();             }\"/> "+w2utils.lang("Records")+"    </div></td></tr>"),e.show.saveRestoreState&&(t+='<tr><td colspan="2" onclick="var obj = w2ui[\''+e.name+"']; obj.toolbar.uncheck('w2ui-column-on-off'); obj.stateSave();\">    <div style=\"cursor: pointer; padding: 4px 8px; cursor: default\">"+w2utils.lang("Save Grid State")+'</div></td></tr><tr><td colspan="2" onclick="var obj = w2ui[\''+e.name+"']; obj.toolbar.uncheck('w2ui-column-on-off'); obj.stateReset();\">    <div style=\"cursor: pointer; padding: 4px 8px; cursor: default\">"+w2utils.lang("Restore Default State")+"</div></td></tr>"),t+="</tbody></table></div>",this.toolbar.get("w2ui-column-on-off").html=t}},initColumnDrag:function(e){function t(){r.pressed=!1,clearTimeout(r.timeout)}function i(e){r.timeout&&clearTimeout(r.timeout);var t=this;r.pressed=!0,r.timeout=setTimeout(function(){if(r.pressed){var i,o,l,d,u,c=["w2ui-col-number","w2ui-col-expand","w2ui-col-select"].concat(["w2ui-head-last"]);if($(e.originalEvent.target).parents().hasClass("w2ui-head")){for(var h=0,p=c.length;h<p;h++)if($(e.originalEvent.target).parents().hasClass(c[h]))return;if(r.numberPreColumnsPresent=$(a.box).find(".w2ui-head.w2ui-col-number, .w2ui-head.w2ui-col-expand, .w2ui-head.w2ui-col-select").length,r.columnHead=d=$(e.originalEvent.target).parents(".w2ui-head"),u=parseInt(d.attr("col"),10),!0===(i=a.trigger({type:"columnDragStart",phase:"before",originalEvent:e,origColumnNumber:u,target:d[0]})).isCancelled)return!1;o=r.columns=$(a.box).find(".w2ui-head:not(.w2ui-head-last)"),$(document).on("mouseup",n),$(document).on("mousemove",s),r.originalPos=parseInt($(e.originalEvent.target).parent(".w2ui-head").attr("col"),10),r.ghost=$(t).clone(!0),$(r.ghost).find('[col]:not([col="'+r.originalPos+'"]), .w2ui-toolbar, .w2ui-grid-header').remove(),$(r.ghost).find(".w2ui-col-number, .w2ui-col-expand, .w2ui-col-select").remove(),$(r.ghost).find(".w2ui-grid-body").css({top:0}),l=$(r.ghost).find('[col="'+r.originalPos+'"]'),$(document.body).append(r.ghost),$(r.ghost).css({width:0,height:0,margin:0,position:"fixed",zIndex:999999,opacity:0}).addClass(".w2ui-grid-ghost").animate({width:l.width(),height:$(a.box).find(".w2ui-grid-body:first").height(),left:e.pageX,top:e.pageY,opacity:.8},0),r.offsets=[];for(var h=0,p=o.length;h<p;h++)r.offsets.push($(o[h]).offset().left);a.trigger($.extend(i,{phase:"after"}))}}},150)}function s(e){if(r.pressed){var t=e.originalEvent.pageX,i=e.originalEvent.pageY,s=r.offsets,n=$(".w2ui-head:not(.w2ui-head-last)").width();r.targetInt=Math.max(r.numberPreColumnsPresent,function(e,t,i){if(e<=t[0])return 0;if(e>=t[t.length-1]+i)return t.length;for(var s=0,n=t.length;s<n;s++){var a=t[s],r=t[s+1]||t[s]+i,o=(r-t[s])/2+t[s];if(e>a&&e<=o)return s;if(e>o&&e<=r)return s+1}return intersection}(t,s,n)),function(e){r.marker||r.markerLeft||(r.marker=$('<div class="col-intersection-marker"><div class="top-marker"></div><div class="bottom-marker"></div></div>'),r.markerLeft=$('<div class="col-intersection-marker"><div class="top-marker"></div><div class="bottom-marker"></div></div>')),r.lastInt&&r.lastInt===e||(r.lastInt=e,r.marker.remove(),r.markerLeft.remove(),$(".w2ui-head").removeClass("w2ui-col-intersection"),e>=r.columns.length?($(r.columns[r.columns.length-1]).children("div:last").append(r.marker.addClass("right").removeClass("left")),$(r.columns[r.columns.length-1]).addClass("w2ui-col-intersection")):e<=r.numberPreColumnsPresent?($(r.columns[r.numberPreColumnsPresent]).prepend(r.marker.addClass("left").removeClass("right")).css({position:"relative"}),$(r.columns[r.numberPreColumnsPresent]).prev().addClass("w2ui-col-intersection")):($(r.columns[e]).children("div:last").prepend(r.marker.addClass("left").removeClass("right")),$(r.columns[e]).prev().children("div:last").append(r.markerLeft.addClass("right").removeClass("left")).css({position:"relative"}),$(r.columns[e-1]).addClass("w2ui-col-intersection")))}(r.targetInt),function(e,t){$(r.ghost).css({left:e-10,top:t-10})}(t,i)}}function n(e){r.pressed=!1;var t,i,o,l,d,u=$(".w2ui-grid-ghost");return!0!==(t=a.trigger({type:"columnDragEnd",phase:"before",originalEvent:e,target:r.columnHead[0]})).isCancelled&&(o=a.columns[r.originalPos],l=a.columns,d=$(r.columns[Math.min(r.lastInt,r.columns.length-1)]),(i=r.lastInt<r.columns.length?parseInt(d.attr("col")):l.length)!==r.originalPos+1&&i!==r.originalPos&&d&&d.length?($(r.ghost).animate({top:$(a.box).offset().top,left:d.offset().left,width:0,height:0,opacity:.2},300,function(){$(this).remove(),u.remove()}),l.splice(i,0,$.extend({},o)),l.splice(l.indexOf(o),1)):($(r.ghost).remove(),u.remove()),$(document).off("mouseup",n),$(document).off("mousemove",s),r.marker&&r.marker.remove(),r={},a.refresh(),void a.trigger($.extend(t,{phase:"after",targetColumnNumber:i-1})))}if(this.columnGroups&&this.columnGroups.length)throw"Draggable columns are not currently supported with column groups.";var a=this,r={};return r.lastInt=null,r.pressed=!1,r.timeout=null,r.columnHead=null,$(a.box).on("mousedown",i),$(a.box).on("mouseup",t),{remove:function(){$(a.box).off("mousedown",i),$(a.box).off("mouseup",t),$(a.box).find(".w2ui-head").removeAttr("draggable"),a.last.columnDrag=!1}}},columnOnOff:function(e,t){var i=$(e.target).parents("tr").find(".w2ui-column-check"),s=this.trigger({phase:"before",target:this.name,type:"columnOnOff",field:t,originalEvent:e});if(!0!==s.isCancelled){for(var n=this,a=!(e.shiftKey||e.metaKey||e.ctrlKey||$(e.target).hasClass("w2ui-column-check")),r=n.find({"w2ui.expanded":!0},!0),o=0;o<r.length;o++){var l=this.records[o].w2ui;l&&!Array.isArray(l.children)&&(this.records[o].w2ui.expanded=!1)}if("line-numbers"==t)this.show.lineNumbers=!this.show.lineNumbers,this.show.lineNumbers?i.addClass("w2ui-icon-check").removeClass("w2ui-icon-empty"):i.addClass("w2ui-icon-empty").removeClass("w2ui-icon-check"),this.refreshBody(),this.resizeRecords();else{var d=this.getColumn(t);d.hidden?(i.addClass("w2ui-icon-check").removeClass("w2ui-icon-empty"),setTimeout(function(){n.showColumn(d.field)},a?0:50)):(i.addClass("w2ui-icon-empty").removeClass("w2ui-icon-check"),setTimeout(function(){n.hideColumn(d.field)},a?0:50))}a&&setTimeout(function(){$().w2overlay({name:n.name+"_toolbar"})},40),this.trigger($.extend(s,{phase:"after"}))}},scrollToColumn:function(e){if(null!=e){for(var t=0,i=!1,s=0;s<this.columns.length;s++){var n=this.columns[s];if(n.field==e){i=!0;break}n.frozen||n.hidden||(t+=parseInt(n.sizeCalculated?n.sizeCalculated:n.size))}i&&(this.last.scrollLeft=t+1,this.scroll())}},initToolbar:function(){s=this;if(null==this.toolbar.render){var e=this.toolbar.items;if(this.toolbar.items=[],this.toolbar=$().w2toolbar($.extend(!0,{},this.toolbar,{name:this.name+"_toolbar",owner:this})),this.show.toolbarReload&&this.toolbar.items.push($.extend(!0,{},this.buttons.reload)),this.show.toolbarColumns&&this.toolbar.items.push($.extend(!0,{},this.buttons.columns)),(this.show.toolbarReload||this.show.toolbarColumns)&&this.toolbar.items.push({type:"break",id:"w2ui-break0"}),this.show.toolbarInput){var t='<div class="w2ui-toolbar-search"><table cellpadding="0" cellspacing="0"><tbody><tr>    <td>'+this.buttons.search.html+'</td>    <td>        <input type="text" id="grid_'+this.name+'_search_all" class="w2ui-search-all" tabindex="-1"             placeholder="'+w2utils.lang(this.last.caption)+'" value="'+this.last.search+'"            onfocus="clearTimeout(w2ui[\''+this.name+'\'].last.kbd_timer);"            onkeydown="if (event.keyCode == 13 &amp;&amp; w2utils.isIE) this.onchange();"            onchange="                var grid = w2ui[\''+this.name+"'];                 var val = this.value;                 var sel = jQuery(this).data('selected');                var fld = jQuery(this).data('w2field');                 if (fld) val = fld.clean(val);                if (fld &amp;&amp; fld.type == 'list' &amp;&amp; sel &amp;&amp; typeof sel.id == 'undefined') {                   grid.searchReset();                } else {                   grid.search(grid.last.field, val);                }            \"/>    </td>    <td>        <div class=\"w2ui-search-clear\" id=\"grid_"+this.name+'_searchClear"               onclick="var obj = w2ui[\''+this.name+'\']; obj.searchReset();" style="display: none"        >&#160;&#160;</div>    </td></tr></tbody></table></div>';this.toolbar.items.push({type:"html",id:"w2ui-search",html:t})}if(this.show.toolbarSearch&&this.multiSearch&&this.searches.length>0&&this.toolbar.items.push($.extend(!0,{},this.buttons["search-go"])),(this.show.toolbarSearch||this.show.toolbarInput)&&(this.show.toolbarAdd||this.show.toolbarEdit||this.show.toolbarDelete||this.show.toolbarSave)&&this.toolbar.items.push({type:"break",id:"w2ui-break1"}),this.show.toolbarAdd&&this.toolbar.items.push($.extend(!0,{},this.buttons.add)),this.show.toolbarEdit&&this.toolbar.items.push($.extend(!0,{},this.buttons.edit)),this.show.toolbarDelete&&this.toolbar.items.push($.extend(!0,{},this.buttons.delete)),this.show.toolbarSave&&((this.show.toolbarAdd||this.show.toolbarDelete||this.show.toolbarEdit)&&this.toolbar.items.push({type:"break",id:"w2ui-break2"}),this.toolbar.items.push($.extend(!0,{},this.buttons.save))),e)for(var i=0;i<e.length;i++)this.toolbar.items.push(e[i]);var s=this;this.toolbar.on("click",function(e){var t=s.trigger({phase:"before",type:"toolbar",target:e.target,originalEvent:e});if(!0!==t.isCancelled){var i=e.target;switch(i){case"w2ui-reload":if(!0===(r=s.trigger({phase:"before",type:"reload",target:s.name})).isCancelled)return!1;s.reload(),s.trigger($.extend(r,{phase:"after"}));break;case"w2ui-column-on-off":s.initColumnOnOff(),s.initResize(),s.resize();break;case"w2ui-search-advanced":this.get(i).checked?s.searchClose():s.searchOpen(),s.toolbar.tooltipHide("w2ui-search-advanced"),e.preventDefault();break;case"w2ui-add":if(!0===(r=s.trigger({phase:"before",target:s.name,type:"add",recid:null})).isCancelled)return!1;s.trigger($.extend(r,{phase:"after"})),setTimeout(function(){$().w2tag()},20);break;case"w2ui-edit":var n=s.getSelection(),a=null;1==n.length&&(a=n[0]);var r=s.trigger({phase:"before",target:s.name,type:"edit",recid:a});if(!0===r.isCancelled)return!1;s.trigger($.extend(r,{phase:"after"})),setTimeout(function(){$().w2tag()},20);break;case"w2ui-delete":s.delete();break;case"w2ui-save":s.save()}s.trigger($.extend(t,{phase:"after"}))}})}},initResize:function(){var e=this;$(this.box).find(".w2ui-resizer").off("click").on("click",function(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0,e.preventDefault&&e.preventDefault()}).off("mousedown").on("mousedown",function(t){t||(t=window.event),e.resizing=!0,e.last.tmp={x:t.screenX,y:t.screenY,gx:t.screenX,gy:t.screenY,col:parseInt($(this).attr("name"))},t.stopPropagation?t.stopPropagation():t.cancelBubble=!0,t.preventDefault&&t.preventDefault();for(var i=0;i<e.columns.length;i++)e.columns[i].hidden||(null==e.columns[i].sizeOriginal&&(e.columns[i].sizeOriginal=e.columns[i].size),e.columns[i].size=e.columns[i].sizeCalculated);var s={phase:"before",type:"columnResize",target:e.name,column:e.last.tmp.col,field:e.columns[e.last.tmp.col].field};s=e.trigger($.extend(s,{resizeBy:0,originalEvent:t}));$(document).on("mousemove","body",function(t){if(1==e.resizing){if(t||(t=window.event),!0===(s=e.trigger($.extend(s,{resizeBy:t.screenX-e.last.tmp.gx,originalEvent:t}))).isCancelled)return void(s.isCancelled=!1);e.last.tmp.x=t.screenX-e.last.tmp.x,e.last.tmp.y=t.screenY-e.last.tmp.y,e.columns[e.last.tmp.col].size=parseInt(e.columns[e.last.tmp.col].size)+e.last.tmp.x+"px",e.resizeRecords(),e.scroll(),e.last.tmp.x=t.screenX,e.last.tmp.y=t.screenY}}),$(document).on("mouseup","body",function(t){delete e.resizing,$(document).off("mousemove","body"),$(document).off("mouseup","body"),e.resizeRecords(),e.scroll(),e.trigger($.extend(s,{phase:"after",originalEvent:t}))})}).off("dblclick").on("dblclick",function(t){var i=parseInt($(this).attr("name")),s=e.columns[i],n=0;if(!1===s.autoResize)return!0;t.stopPropagation?t.stopPropagation():t.cancelBubble=!0,t.preventDefault&&t.preventDefault(),$('.w2ui-grid-records td[col="'+i+'"] > div',e.box).each(function(){var e=this.offsetWidth-this.scrollWidth;e<n&&(n=e-3)});var a={phase:"before",type:"columnAutoResize",target:e.name,column:s,field:s.field};return!0===(a=e.trigger($.extend(a,{resizeBy:Math.abs(n),originalEvent:t}))).isCancelled?void(a.isCancelled=!1):(n<0&&(s.size=Math.min(parseInt(s.size)+Math.abs(n),s.max||1/0)+"px",e.resizeRecords(),e.resizeRecords(),e.scroll()),void e.trigger($.extend(a,{phase:"after",originalEvent:t})))}).each(function(e,t){var i=$(t).parent();$(t).css({height:"25px","margin-left":i.width()-3+"px"})})},resizeBoxes:function(){var e=$("#grid_"+this.name+"_header"),t=$("#grid_"+this.name+"_toolbar"),i=$("#grid_"+this.name+"_fsummary"),s=$("#grid_"+this.name+"_summary"),n=$("#grid_"+this.name+"_footer"),a=$("#grid_"+this.name+"_body");this.show.header&&e.css({top:"0px",left:"0px",right:"0px"}),this.show.toolbar&&t.css({top:0+(this.show.header?w2utils.getSize(e,"height"):0)+"px",left:"0px",right:"0px"}),this.summary.length>0&&(i.css({bottom:0+(this.show.footer?w2utils.getSize(n,"height"):0)+"px"}),s.css({bottom:0+(this.show.footer?w2utils.getSize(n,"height"):0)+"px",right:"0px"})),this.show.footer&&n.css({bottom:"0px",left:"0px",right:"0px"}),a.css({top:0+(this.show.header?w2utils.getSize(e,"height"):0)+(this.show.toolbar?w2utils.getSize(t,"height"):0)+"px",bottom:0+(this.show.footer?w2utils.getSize(n,"height"):0)+(this.summary.length>0?w2utils.getSize(s,"height"):0)+"px",left:"0px",right:"0px"})},resizeRecords:function(){function e(e,t,i){var s="",n="",a="";s+='<tr class="'+(e%2?"w2ui-even":"w2ui-odd")+' w2ui-empty-record" style="height: '+t+'px">',n+='<tr class="'+(e%2?"w2ui-even":"w2ui-odd")+' w2ui-empty-record" style="height: '+t+'px">',i.show.lineNumbers&&(s+='<td class="w2ui-col-number"></td>'),i.show.selectColumn&&(s+='<td class="w2ui-grid-data w2ui-col-select"></td>'),i.show.expandColumn&&(s+='<td class="w2ui-grid-data w2ui-col-expand"></td>'),n+='<td class="w2ui-grid-data-spacer" col="start" style="border-right: 0"></td>';for(var r=0;r<i.columns.length;r++){var o=i.columns[r];(o.hidden||r<i.last.colStart||r>i.last.colEnd)&&!o.frozen||(a='<td class="w2ui-grid-data" '+(null!=o.attr?o.attr:"")+' col="'+r+'"></td>',o.frozen?s+=a:n+=a)}s+='<td class="w2ui-grid-data-last"></td> </tr>',n+='<td class="w2ui-grid-data-last" col="end"></td> </tr>',$("#grid_"+i.name+"_frecords > table").append(s),$("#grid_"+i.name+"_records > table").append(n)}var t=this;$(this.box).find(".w2ui-empty-record").remove();var i=$(this.box),s=$(this.box).find("> div.w2ui-grid-box"),n=$("#grid_"+this.name+"_header"),a=$("#grid_"+this.name+"_toolbar"),r=$("#grid_"+this.name+"_summary"),o=$("#grid_"+this.name+"_fsummary"),l=$("#grid_"+this.name+"_footer"),d=$("#grid_"+this.name+"_body"),u=$("#grid_"+this.name+"_columns"),c=$("#grid_"+this.name+"_fcolumns"),h=$("#grid_"+this.name+"_records"),p=$("#grid_"+this.name+"_frecords"),f=$("#grid_"+this.name+"_scroll1"),g=8*String(this.total).length+10;g<34&&(g=34),null!=this.lineNumberWidth&&(g=this.lineNumberWidth);for(var m=!1,w=!1,v=0,y=0;y<t.columns.length;y++)t.columns[y].frozen||t.columns[y].hidden||(v+=parseInt(t.columns[y].sizeCalculated?t.columns[y].sizeCalculated:t.columns[y].size));if(h.width()<v&&(m=!0),d.height()-u.height()<$(h).find(">table").height()+(m?w2utils.scrollBarSize():0)&&(w=!0),this.fixedBody){b=s.height()-(this.show.header?w2utils.getSize(n,"height"):0)-(this.show.toolbar?w2utils.getSize(a,"height"):0)-("none"!=r.css("display")?w2utils.getSize(r,"height"):0)-(this.show.footer?w2utils.getSize(l,"height"):0);d.css("height",b)}else{var b=w2utils.getSize(u,"height")+w2utils.getSize($("#grid_"+t.name+"_records table"),"height")+(m?w2utils.scrollBarSize():0);t.height=b+w2utils.getSize(s,"+height")+(t.show.header?w2utils.getSize(n,"height"):0)+(t.show.toolbar?w2utils.getSize(a,"height"):0)+("none"!=r.css("display")?w2utils.getSize(r,"height"):0)+(t.show.footer?w2utils.getSize(l,"height"):0),s.css("height",t.height),d.css("height",b),i.css("height",w2utils.getSize(s,"height")+w2utils.getSize(i,"+height"))}var x=this.records.length,_="object"!=typeof this.url?this.url:this.url.get;if(0==this.searchData.length||_||(x=this.last.searchIds.length),this.fixedBody||(w=!1),m||w?(u.find("> table > tbody > tr:nth-child(1) td.w2ui-head-last").css("width",w2utils.scrollBarSize()).show(),h.css({top:(this.columnGroups.length>0&&this.show.columns?1:0)+w2utils.getSize(u,"height")+"px","-webkit-overflow-scrolling":"touch","overflow-x":m?"auto":"hidden","overflow-y":w?"auto":"hidden"})):(u.find("> table > tbody > tr:nth-child(1) td.w2ui-head-last").hide(),h.css({top:(this.columnGroups.length>0&&this.show.columns?1:0)+w2utils.getSize(u,"height")+"px",overflow:"hidden"}),h.length>0&&(this.last.scrollTop=0,this.last.scrollLeft=0)),m?(p.css("margin-bottom",w2utils.scrollBarSize()),f.show()):(p.css("margin-bottom",0),f.hide()),p.css({overflow:"hidden",top:h.css("top")}),this.show.emptyRecords&&!w){var k=Math.floor(h.height()/this.recordHeight)-1,C=0;if(h[0]&&(C=h[0].scrollHeight-k*this.recordHeight),C>=this.recordHeight&&(C-=this.recordHeight,k++),this.fixedBody){for(var T=x;T<k;T++)e(T,this.recordHeight,this);e(k,C,this)}}if(d.length>0){for(var S=parseInt(d.width())-(w?w2utils.scrollBarSize():0)-(this.show.lineNumbers?g:0)-(this.show.selectColumn?26:0)-(this.show.expandColumn?26:0)-1,D=S,z=0,O=!1,y=0;y<this.columns.length;y++)(R=this.columns[y]).gridMinWidth>0&&(R.gridMinWidth>D&&!0!==R.hidden&&(R.hidden=!0,O=!0),R.gridMinWidth<D&&!0===R.hidden&&(R.hidden=!1,O=!0));if(!0===O)return void this.refresh();for(y=0;y<this.columns.length;y++)(R=this.columns[y]).hidden||("px"==String(R.size).substr(String(R.size).length-2).toLowerCase()?(S-=parseFloat(R.size),this.columns[y].sizeCalculated=R.size,this.columns[y].sizeType="px"):(z+=parseFloat(R.size),this.columns[y].sizeType="%",delete R.sizeCorrected));if(100!=z&&z>0)for(y=0;y<this.columns.length;y++)(R=this.columns[y]).hidden||"%"==R.sizeType&&(R.sizeCorrected=Math.round(100*parseFloat(R.size)*100/z)/100+"%");for(y=0;y<this.columns.length;y++)(R=this.columns[y]).hidden||"%"==R.sizeType&&(null!=this.columns[y].sizeCorrected?this.columns[y].sizeCalculated=Math.floor(S*parseFloat(R.sizeCorrected)/100)-1+"px":this.columns[y].sizeCalculated=Math.floor(S*parseFloat(R.size)/100)-1+"px")}for(var I=0,y=0;y<this.columns.length;y++)(R=this.columns[y]).hidden||(null==R.min&&(R.min=20),parseInt(R.sizeCalculated)<parseInt(R.min)&&(R.sizeCalculated=R.min+"px"),parseInt(R.sizeCalculated)>parseInt(R.max)&&(R.sizeCalculated=R.max+"px"),I+=parseInt(R.sizeCalculated));var j=parseInt(D)-parseInt(I);if(j>0&&z>0)for(y=0;;){var R=this.columns[y];if(null!=R)if(R.hidden||"px"==R.sizeType)y++;else{if(R.sizeCalculated=parseInt(R.sizeCalculated)+1+"px",0===--j)break;y++}else y=0}else j>0&&u.find("> table > tbody > tr:nth-child(1) td.w2ui-head-last").css("width",w2utils.scrollBarSize()).show();var E=1;this.show.lineNumbers&&(E+=g),this.show.selectColumn&&(E+=26),this.show.expandColumn&&(E+=26);for(y=0;y<this.columns.length;y++)this.columns[y].hidden||this.columns[y].frozen&&(E+=parseInt(this.columns[y].sizeCalculated));c.css("width",E),p.css("width",E),o.css("width",E),f.css("width",E),u.css("left",E),h.css("left",E),r.css("left",E),u.find("> table > tbody > tr:nth-child(1) td").add(c.find("> table > tbody > tr:nth-child(1) td")).each(function(e,i){$(i).hasClass("w2ui-col-number")&&$(i).css("width",g);var s=$(i).attr("col");if(null!=s){if("start"==s){for(var n=0,a=0;a<t.last.colStart;a++)!t.columns[a]||t.columns[a].frozen||t.columns[a].hidden||(n+=parseInt(t.columns[a].sizeCalculated));$(i).css("width",n+"px")}t.columns[s]&&$(i).css("width",t.columns[s].sizeCalculated)}if($(i).hasClass("w2ui-head-last"))if(t.last.colEnd+1<t.columns.length){for(var n=0,a=t.last.colEnd+1;a<t.columns.length;a++)!t.columns[a]||t.columns[a].frozen||t.columns[a].hidden||(n+=parseInt(t.columns[a].sizeCalculated));$(i).css("width",n+"px")}else $(i).css("width",w2utils.scrollBarSize()+(j>0&&0===z?j:0)+"px")}),3==u.find("> table > tbody > tr").length&&u.find("> table > tbody > tr:nth-child(1) td").add(c.find("> table > tbody > tr:nth-child(1) td")).html("").css({height:"0px",border:"0px",padding:"0px",margin:"0px"}),h.find("> table > tbody > tr:nth-child(1) td").add(p.find("> table > tbody > tr:nth-child(1) td")).each(function(e,i){$(i).hasClass("w2ui-col-number")&&$(i).css("width",g);var s=$(i).attr("col");if(null!=s){if("start"==s){for(var n=0,a=0;a<t.last.colStart;a++)!t.columns[a]||t.columns[a].frozen||t.columns[a].hidden||(n+=parseInt(t.columns[a].sizeCalculated));$(i).css("width",n+"px")}t.columns[s]&&$(i).css("width",t.columns[s].sizeCalculated)}if($(i).hasClass("w2ui-grid-data-last")&&0===$(i).parents(".w2ui-grid-frecords").length)if(t.last.colEnd+1<t.columns.length){for(var n=0,a=t.last.colEnd+1;a<t.columns.length;a++)!t.columns[a]||t.columns[a].frozen||t.columns[a].hidden||(n+=parseInt(t.columns[a].sizeCalculated));$(i).css("width",n+"px")}else $(i).css("width",(j>0&&0===z?j:0)+"px")}),r.find("> table > tbody > tr:nth-child(1) td").add(o.find("> table > tbody > tr:nth-child(1) td")).each(function(e,i){$(i).hasClass("w2ui-col-number")&&$(i).css("width",g);var s=$(i).attr("col");if(null!=s){if("start"==s){for(var n=0,a=0;a<t.last.colStart;a++)!t.columns[a]||t.columns[a].frozen||t.columns[a].hidden||(n+=parseInt(t.columns[a].sizeCalculated));$(i).css("width",n+"px")}t.columns[s]&&$(i).css("width",t.columns[s].sizeCalculated)}$(i).hasClass("w2ui-grid-data-last")&&0===$(i).parents(".w2ui-grid-frecords").length&&$(i).css("width",w2utils.scrollBarSize()+(j>0&&0===z?j:0)+"px")}),this.initResize(),this.refreshRanges(),(this.last.scrollTop||this.last.scrollLeft)&&h.length>0&&(u.prop("scrollLeft",this.last.scrollLeft),h.prop("scrollTop",this.last.scrollTop),h.prop("scrollLeft",this.last.scrollLeft))},getSearchesHTML:function(){for(var e=this,t='<table cellspacing="0"><tbody>',i=!1,s=0;s<this.searches.length;s++){var n=this.searches[s];if(n.type=String(n.type).toLowerCase(),!n.hidden){var a="";0==i&&(a='<button class="w2ui-btn close-btn" onclick="obj = w2ui[\''+this.name+"']; if (obj) obj.searchClose()\">X</button>",i=!0),null==n.inTag&&(n.inTag=""),null==n.outTag&&(n.outTag=""),null==n.style&&(n.style=""),null==n.type&&(n.type="text");var r='<select id="grid_'+this.name+"_operator_"+s+'" class="w2ui-input"    onchange="w2ui[\''+this.name+"'].initOperator(this, "+s+')">'+function(t,i){var s="",n=e.operators[e.operatorsMap[t]];null!=i&&(n=i);for(var a=0;a<n.length;a++){var r=n[a],o=r;Array.isArray(r)?(o=r[1],r=r[0],null==o&&(o=r)):$.isPlainObject(r)&&(o=r.text,r=r.oper),s+='<option value="'+r+'">'+w2utils.lang(o)+"</option>\n"}return s}(n.type,n.operators)+"</select>";switch(t+='<tr>    <td class="close-btn">'+a+'</td>    <td class="caption">'+(n.caption||"")+'</td>    <td class="operator">'+r+'</td>    <td class="value">',n.type){case"text":case"alphanumeric":case"hex":case"color":case"list":case"combo":case"enum":o="width: 250px;";-1!=["hex","color"].indexOf(n.type)&&(o="width: 90px;"),t+='<input rel="search" type="text" id="grid_'+this.name+"_field_"+s+'" name="'+n.field+'"    class="w2ui-input" style="'+o+n.style+'" '+n.inTag+"/>";break;case"int":case"float":case"money":case"currency":case"percent":case"date":case"time":case"datetime":var o="width: 90px";"datetime"==n.type&&(o="width: 140px;"),t+='<input rel="search" type="text" class="w2ui-input" style="'+o+n.style+'" id="grid_'+this.name+"_field_"+s+'" name="'+n.field+'" '+n.inTag+'/><span id="grid_'+this.name+"_range_"+s+'" style="display: none">&#160;-&#160;&#160;<input rel="search" type="text" class="w2ui-input" style="'+o+n.style+'" id="grid_'+this.name+"_field2_"+s+'" name="'+n.field+'" '+n.inTag+"/></span>";break;case"select":t+='<select rel="search" class="w2ui-input" style="'+n.style+'" id="grid_'+this.name+"_field_"+s+'"  name="'+n.field+'" '+n.inTag+"></select>"}t+=n.outTag+"    </td></tr>"}}return t+='<tr>    <td colspan="4" class="actions">        <div>        <button class="w2ui-btn" onclick="obj = w2ui[\''+this.name+"']; if (obj) { obj.searchReset(); }\">"+w2utils.lang("Reset")+'</button>        <button class="w2ui-btn w2ui-btn-blue" onclick="obj = w2ui[\''+this.name+"']; if (obj) { obj.search(); }\">"+w2utils.lang("Search")+"</button>        </div>    </td></tr></tbody></table>"},initOperator:function(e,t){var i=this,s=i.searches[t],n=$("#grid_"+i.name+"_range_"+t),a=$("#grid_"+i.name+"_field_"+t),r=a.parent().find("span input");switch(a.show(),n.hide(),$(e).val()){case"between":n.show(),r.w2field(s.type,s.options);break;case"not null":case"null":a.hide(),a.val("1"),a.change()}},initSearches:function(){for(var e=this,t=0;t<this.searches.length;t++){var i=this.searches[t],s=this.getSearchData(i.field);i.type=String(i.type).toLowerCase();var n=e.operators[e.operatorsMap[i.type]];i.operators&&(n=i.operators);var a=n[0];$.isPlainObject(a)&&(a=a.oper),"object"!=typeof i.options&&(i.options={}),"text"==i.type&&(a=this.textSearch);for(l=0;l<n.length;l++){var r=n[l];if($.isPlainObject(r)&&(r=r.oper),i.operator==r){a=i.operator;break}}switch(i.type){case"text":case"alphanumeric":$("#grid_"+this.name+"_field_"+t).w2field(i.type,i.options);break;case"int":case"float":case"hex":case"color":case"money":case"currency":case"percent":case"date":case"time":case"datetime":$("#grid_"+this.name+"_field_"+t).w2field(i.type,i.options),$("#grid_"+this.name+"_field2_"+t).w2field(i.type,i.options),setTimeout(function(){$("#grid_"+e.name+"_field_"+t).keydown(),$("#grid_"+e.name+"_field2_"+t).keydown()},1);break;case"list":case"combo":case"enum":o=i.options;"list"==i.type&&(o.selected={}),"enum"==i.type&&(o.selected=[]),s&&(o.selected=s.value),$("#grid_"+this.name+"_field_"+t).w2field(i.type,$.extend({openOnFocus:!0},o)),s&&null!=s.text&&$("#grid_"+this.name+"_field_"+t).data("selected",{id:s.value,text:s.text});break;case"select":for(var o='<option value="">--</option>',l=0;l<i.options.items.length;l++){var d=i.options.items[l];if($.isPlainObject(i.options.items[l])){var u=d.id,c=d.text;null==u&&null!=d.value&&(u=d.value),null==c&&null!=d.caption&&(c=d.caption),null==u&&(u=""),o+='<option value="'+u+'">'+c+"</option>"}else o+='<option value="'+d+'">'+d+"</option>"}$("#grid_"+this.name+"_field_"+t).html(o)}null!=s?("int"==s.type&&-1!=["in","not in"].indexOf(s.operator)&&$("#grid_"+this.name+"_field_"+t).w2field("clear").val(s.value),$("#grid_"+this.name+"_operator_"+t).val(s.operator).trigger("change"),$.isArray(s.value)?-1!=["in","not in"].indexOf(s.operator)?$("#grid_"+this.name+"_field_"+t).val(s.value).trigger("change"):($("#grid_"+this.name+"_field_"+t).val(s.value[0]).trigger("change"),$("#grid_"+this.name+"_field2_"+t).val(s.value[1]).trigger("change")):null!=s.value&&$("#grid_"+this.name+"_field_"+t).val(s.value).trigger("change")):$("#grid_"+this.name+"_operator_"+t).val(a).trigger("change")}$("#w2ui-overlay-"+this.name+"-searchOverlay .w2ui-grid-searches *[rel=search]").on("keypress",function(t){13==t.keyCode&&(e.search(),$().w2overlay({name:e.name+"-searchOverlay"}))})},getColumnsHTML:function(){function e(e){var i="<tr>",s="<tr>";t.show.lineNumbers&&(i+='<td class="w2ui-head w2ui-col-number"        onclick="w2ui[\''+t.name+"'].columnClick('line-number', event);\"       ondblclick=\"w2ui['"+t.name+"'].columnDblClick('line-number', event);\">    <div>#</div></td>"),t.show.selectColumn&&(i+='<td class="w2ui-head w2ui-col-select"       onclick="if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true;">    <div>        <input type="checkbox" id="grid_'+t.name+'_check_all" tabindex="-1"            style="'+(0==t.multiSelect?"display: none;":"")+'"            onmousedown="if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true;"            onclick="var grid = w2ui[\''+t.name+"'];               if (this.checked) grid.selectAll(); else grid.selectNone();               if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true;               clearTimeout(grid.last.kbd_timer); /* keep focus */            \"/>    </div></td>"),t.show.expandColumn&&(i+='<td class="w2ui-head w2ui-col-expand">    <div>&#160;</div></td>');var n,a=0,r=0;s+='<td id="grid_'+t.name+'_column_start" class="w2ui-head" col="start" style="border-right: 0"></td>';for(var o=0;o<t.columns.length;o++){var l=t.columns[o];if(null==l.size&&(l.size="100%"),o==r&&(n=t.columnGroups[a++]||{},r+=n.span),(!(o<t.last.colStart||o>t.last.colEnd)||l.frozen)&&!l.hidden&&(!0!==n.master||e)){var d=t.getColumnCellHTML(o);l&&l.frozen?i+=d:s+=d}}return i+='<td class="w2ui-head w2ui-head-last"><div>&#160;</div></td>',s+='<td class="w2ui-head w2ui-head-last" col="end"><div>&#160;</div></td>',i+="</tr>",s+="</tr>",[i,s]}var t=this,i="",s="";if(this.show.columnHeaders)if(this.columnGroups.length>0){var n=e(!0),a=function(){var e="<tr>",i="<tr>",s="";""!=t.columnGroups[t.columnGroups.length-1].caption&&t.columnGroups.push({caption:""}),t.show.lineNumbers&&(e+='<td class="w2ui-head w2ui-col-number">    <div style="height: '+(t.recordHeight+1)+'px">&#160;</div></td>'),t.show.selectColumn&&(e+='<td class="w2ui-head w2ui-col-select">    <div style="height: 25px">&#160;</div></td>'),t.show.expandColumn&&(e+='<td class="w2ui-head w2ui-col-expand">    <div style="height: 25px">&#160;</div></td>');var n=0;i+='<td id="grid_'+t.name+'_column_start" class="w2ui-head" col="start" style="border-right: 0"></td>';for(var a=0;a<t.columnGroups.length;a++){var r=t.columnGroups[a],o=t.columns[n];null!=r.colspan&&(r.span=r.colspan),null!=r.span&&r.span==parseInt(r.span)||(r.span=1);for(var l=0,d=n;d<n+r.span;d++)t.columns[d]&&!t.columns[d].hidden&&l++;if(a==t.columnGroups.length-1&&l++,l<=0);else if(!0===r.master){for(var u="",c=0;c<t.sortData.length;c++)t.sortData[c].field==o.field&&("asc"===(t.sortData[c].direction||"").toLowerCase()&&(u="w2ui-sort-up"),"desc"===(t.sortData[c].direction||"").toLowerCase()&&(u="w2ui-sort-down"));var h="";!1!==o.resizable&&(h='<div class="w2ui-resizer" name="'+n+'"></div>'),s='<td id="grid_'+t.name+"_column_"+n+'" class="w2ui-head '+u+'" col="'+n+'"     rowspan="2" colspan="'+l+'"     oncontextmenu = "w2ui[\''+t.name+"'].contextMenu(null, "+n+', event);"    onclick="w2ui[\''+t.name+"'].columnClick('"+o.field+"', event);\"    ondblclick=\"w2ui['"+t.name+"'].columnDblClick('"+o.field+"', event);\">"+h+'    <div class="w2ui-col-group w2ui-col-header '+(u?"w2ui-col-sorted":"")+'">        <div class="'+u+'"></div>'+(o.caption?o.caption:"&#160;")+"    </div></td>",o&&o.frozen?e+=s:i+=s}else s='<td id="grid_'+t.name+"_column_"+n+'" class="w2ui-head" col="'+n+'"         colspan="'+l+'">    <div class="w2ui-col-group">'+(r.caption?r.caption:"&#160;")+"    </div></td>",o&&o.frozen?e+=s:i+=s;n+=r.span}return e+="<td></td></tr>",i+='<td id="grid_'+t.name+'_column_end" class="w2ui-head" col="end"></td></tr>',[e,i]}(),r=e(!1);i=n[0]+a[0]+r[0],s=n[1]+a[1]+r[1]}else{var o=e(!0);i=o[0],s=o[1]}return[i,s]},getColumnCellHTML:function(e){var t=this.columns[e];if(null==t)return"";for(var i=!this.reorderColumns||this.columnGroups&&this.columnGroups.length?"":" w2ui-reorder-cols-head ",s="",n=0;n<this.sortData.length;n++)this.sortData[n].field==t.field&&("asc"===(this.sortData[n].direction||"").toLowerCase()&&(s="w2ui-sort-up"),"desc"===(this.sortData[n].direction||"").toLowerCase()&&(s="w2ui-sort-down"));var a=this.last.selection.columns,r=!1;for(var o in a)for(n=0;n<a[o].length;n++)a[o][n]==e&&(r=!0);return'<td id="grid_'+this.name+"_column_"+e+'" col="'+e+'" class="w2ui-head '+s+i+'" '+("normal"==this.columnTooltip&&t.tooltip?'title="'+t.tooltip+'" ':"")+"    onmouseover = \"w2ui['"+this.name+"'].columnTooltipShow('"+e+"', event);\"    onmouseout  = \"w2ui['"+this.name+"'].columnTooltipHide('"+e+"', event);\"    oncontextmenu = \"w2ui['"+this.name+"'].contextMenu(null, "+e+', event);"    onclick="w2ui[\''+this.name+"'].columnClick('"+t.field+"', event);\"    ondblclick=\"w2ui['"+this.name+"'].columnDblClick('"+t.field+"', event);\">"+(!1!==t.resizable?'<div class="w2ui-resizer" name="'+e+'"></div>':"")+'    <div class="w2ui-col-header '+(s?"w2ui-col-sorted":"")+" "+(r?"w2ui-col-selected":"")+'">        <div class="'+s+'"></div>'+(t.caption?t.caption:"&#160;")+"    </div></td>"},columnTooltipShow:function(e){if("normal"!=this.columnTooltip){var t=$(this.box).find("#grid_"+this.name+"_column_"+e),i=this.columns[e],s=this.columnTooltip;t.prop("_mouse_over",!0),setTimeout(function(){!0===t.prop("_mouse_over")&&!0!==t.prop("_mouse_tooltip")&&(t.prop("_mouse_tooltip",!0),t.w2tag(i.tooltip,{position:s}))},1)}},columnTooltipHide:function(e){if("normal"!=this.columnTooltip){var t=$(this.box).find("#grid_"+this.name+"_column_"+e);this.columns[e],t.removeProp("_mouse_over"),setTimeout(function(){!0!==t.prop("_mouse_over")&&!0===t.prop("_mouse_tooltip")&&(t.removeProp("_mouse_tooltip"),t.w2tag())},1)}},getRecordsHTML:function(){var e=this.records.length,t="object"!=typeof this.url?this.url:this.url.get;0==this.searchData.length||t||(e=this.last.searchIds.length),e>this.vs_start?this.last.show_extra=this.vs_extra:this.last.show_extra=this.vs_start;var i=$("#grid_"+this.name+"_records"),s=Math.floor((i.height()||0)/this.recordHeight)+this.last.show_extra+1;(!this.fixedBody||s>e)&&(s=e);var n=this.getRecordHTML(-1,0),a="<table><tbody>"+n[0],r="<table><tbody>"+n[1];a+='<tr id="grid_'+this.name+'_frec_top" line="top" style="height: 0px">    <td colspan="2000"></td></tr>',r+='<tr id="grid_'+this.name+'_rec_top" line="top" style="height: 0px">    <td colspan="2000"></td></tr>';for(var o=0;o<s;o++)n=this.getRecordHTML(o,o+1),a+=n[0],r+=n[1];return a+='<tr id="grid_'+this.name+'_frec_bottom" line="bottom" style="height: '+(e-s)*this.recordHeight+'px">    <td colspan="2000" style="border: 0"></td></tr><tr id="grid_'+this.name+'_frec_more" style="display: none; visibility: hidden">    <td colspan="2000" class="w2ui-load-more"></td></tr></tbody></table>',r+='<tr id="grid_'+this.name+'_rec_bottom" line="bottom" style="height: '+(e-s)*this.recordHeight+'px">    <td colspan="2000" style="border: 0"></td></tr><tr id="grid_'+this.name+'_rec_more" style="display: none">    <td colspan="2000" class="w2ui-load-more"></td></tr></tbody></table>',this.last.range_start=0,this.last.range_end=s,[a,r]},getSummaryHTML:function(){if(0!==this.summary.length){for(var e=this.getRecordHTML(-1,0),t="<table><tbody>"+e[0],i="<table><tbody>"+e[1],s=0;s<this.summary.length;s++)e=this.getRecordHTML(s,s+1,!0),t+=e[0],i+=e[1];return t+="</tbody></table>",i+="</tbody></table>",[t,i]}},scroll:function(e){function t(){i.markSearch&&(clearTimeout(i.last.marker_timer),i.last.marker_timer=setTimeout(function(){for(var e=[],t=0;t<i.searchData.length;t++){var s=i.searchData[t],n=i.getSearch(s.field);if(n&&!n.hidden){var a=i.getColumn(s.field,!0);e.push({field:s.field,search:s.value,col:a})}}e.length>0&&e.forEach(function(e){$(i.box).find('td[col="'+e.col+'"]').not(".w2ui-head").w2marker(e.search)})},50))}var i=((new Date).getTime(),this),s="object"!=typeof this.url?this.url:this.url.get,n=$("#grid_"+this.name+"_records"),a=$("#grid_"+this.name+"_frecords");if(e){var r=e.target.scrollTop,o=e.target.scrollLeft;i.last.scrollTop=r,i.last.scrollLeft=o,$("#grid_"+i.name+"_columns")[0].scrollLeft=o,$("#grid_"+i.name+"_summary")[0].scrollLeft=o,a[0].scrollTop=r}this.last.bubbleEl&&($(this.last.bubbleEl).w2tag(),this.last.bubbleEl=null);var l=null,d=null;if(i.disableCVS||i.columnGroups.length>0)l=0,d=i.columns.length-1;else{for(var u=n.width(),c=0,h=0;h<i.columns.length;h++)if(!i.columns[h].frozen&&!i.columns[h].hidden){var p=parseInt(i.columns[h].sizeCalculated?i.columns[h].sizeCalculated:i.columns[h].size);c+p+30>i.last.scrollLeft&&null==l&&(l=h),c+p-30>i.last.scrollLeft+u&&null==d&&(d=h),c+=p}null==d&&(d=i.columns.length-1)}if(null!=l&&(l<0&&(l=0),d<0&&(d=0),l==d&&(l>0?l--:d++),l!=i.last.colStart||d!=i.last.colEnd)){var f=$(i.box),g=Math.abs(l-i.last.colStart),m=Math.abs(d-i.last.colEnd);if(g<5&&m<5){var w=f.find(".w2ui-grid-columns #grid_"+i.name+"_column_start"),v=f.find(".w2ui-grid-columns .w2ui-head-last"),y=f.find("#grid_"+i.name+"_records .w2ui-grid-data-spacer"),b=f.find("#grid_"+i.name+"_records .w2ui-grid-data-last"),x=f.find("#grid_"+i.name+"_summary .w2ui-grid-data-spacer"),_=f.find("#grid_"+i.name+"_summary .w2ui-grid-data-last");if(l>i.last.colStart)for(h=i.last.colStart;h<l;h++)f.find("#grid_"+i.name+"_columns #grid_"+i.name+"_column_"+h).remove(),f.find("#grid_"+i.name+'_records td[col="'+h+'"]').remove(),f.find("#grid_"+i.name+'_summary td[col="'+h+'"]').remove();if(d<i.last.colEnd)for(h=i.last.colEnd;h>d;h--)f.find("#grid_"+i.name+"_columns #grid_"+i.name+"_column_"+h).remove(),f.find("#grid_"+i.name+'_records td[col="'+h+'"]').remove(),f.find("#grid_"+i.name+'_summary td[col="'+h+'"]').remove();if(l<i.last.colStart)for(h=i.last.colStart-1;h>=l;h--)i.columns[h]&&(i.columns[h].frozen||i.columns[h].hidden)||(w.after(i.getColumnCellHTML(h)),y.each(function(e,t){var s=$(t).parent().attr("index"),n='<td class="w2ui-grid-data" col="'+h+'" style="height: 0px"></td>';null!=s&&(n=i.getCellHTML(parseInt(s),h,!1)),$(t).after(n)}),x.each(function(e,t){var s=$(t).parent().attr("index"),n='<td class="w2ui-grid-data" col="'+h+'" style="height: 0px"></td>';null!=s&&(n=i.getCellHTML(parseInt(s),h,!0)),$(t).after(n)}));if(d>i.last.colEnd)for(h=i.last.colEnd+1;h<=d;h++)i.columns[h]&&(i.columns[h].frozen||i.columns[h].hidden)||(v.before(i.getColumnCellHTML(h)),b.each(function(e,t){var s=$(t).parent().attr("index"),n='<td class="w2ui-grid-data" col="'+h+'" style="height: 0px"></td>';null!=s&&(n=i.getCellHTML(parseInt(s),h,!1)),$(t).before(n)}),_.each(function(e,t){var s=$(t).parent().attr("index")||-1,n=i.getCellHTML(parseInt(s),h,!0);$(t).before(n)}));i.last.colStart=l,i.last.colEnd=d,i.resizeRecords()}else{i.last.colStart=l,i.last.colEnd=d;var k=this.getColumnsHTML(),C=this.getRecordsHTML(),T=this.getSummaryHTML(),S=f.find("#grid_"+this.name+"_columns"),D=f.find("#grid_"+this.name+"_records"),z=f.find("#grid_"+this.name+"_frecords"),O=f.find("#grid_"+this.name+"_summary");S.find("tbody").html(k[1]),z.html(C[0]),D.prepend(C[1]),null!=T&&O.html(T[1]),setTimeout(function(){D.find("> table").not("table:first-child").remove(),O[0]&&(O[0].scrollLeft=i.last.scrollLeft)},1),i.resizeRecords()}}var I=this.records.length;if(0==this.searchData.length||s||(I=this.last.searchIds.length),0!==I&&0!==n.length&&0!==n.height()&&(I>this.vs_start?this.last.show_extra=this.vs_extra:this.last.show_extra=this.vs_start,!(n.height()<I*this.recordHeight&&"hidden"==n.css("overflow-y")))){var j=Math.round(n[0].scrollTop/this.recordHeight+1),R=j+(Math.round(n.height()/this.recordHeight)-1);if(j>I&&(j=I),R>=I-1&&(R=I),$("#grid_"+this.name+"_footer .w2ui-footer-right").html((i.show.statusRange?w2utils.formatNumber(this.offset+j)+"-"+w2utils.formatNumber(this.offset+R)+(-1!=this.total?" "+w2utils.lang("of")+" "+w2utils.formatNumber(this.total):""):"")+(s&&i.show.statusBuffered?" ("+w2utils.lang("buffered")+" "+w2utils.formatNumber(I)+(this.offset>0?", skip "+w2utils.formatNumber(this.offset):"")+")":"")),s||this.fixedBody&&!(-1!=this.total&&this.total<=this.vs_start)){var E=Math.floor(n[0].scrollTop/this.recordHeight)-this.last.show_extra,F=E+Math.floor(n.height()/this.recordHeight)+2*this.last.show_extra+1;E<1&&(E=1),F>this.total&&-1!=this.total&&(F=this.total);var M=n.find("#grid_"+this.name+"_rec_top"),A=n.find("#grid_"+this.name+"_rec_bottom"),N=a.find("#grid_"+this.name+"_frec_top"),H=a.find("#grid_"+this.name+"_frec_bottom");-1!=String(M.next().prop("id")).indexOf("_expanded_row")&&(M.next().remove(),N.next().remove()),this.total>F&&-1!=String(A.prev().prop("id")).indexOf("_expanded_row")&&(A.prev().remove(),H.prev().remove());var P=parseInt(M.next().attr("line")),L=parseInt(A.prev().attr("line"));if(P<E||1==P||this.last.pull_refresh){if(F<=L+this.last.show_extra-2&&F!=this.total)return;for(this.last.pull_refresh=!1;;){B=a.find("#grid_"+this.name+"_frec_top").next();if("bottom"==(W=n.find("#grid_"+this.name+"_rec_top").next()).attr("line"))break;if(!(parseInt(W.attr("line"))<E))break;B.remove(),W.remove()}"top"==(U=(Y=n.find("#grid_"+this.name+"_rec_bottom").prev()).attr("line"))&&(U=E);for(h=parseInt(U)+1;h<=F;h++)if(this.records[h-1]){(W=this.records[h-1].w2ui)&&!Array.isArray(W.children)&&(W.expanded=!1);K=this.getRecordHTML(h-1,h);A.before(K[1]),H.before(K[0])}t(),setTimeout(function(){i.refreshRanges()},0)}else{if(E>=P-this.last.show_extra+2&&E>1)return;for(;;){var B=a.find("#grid_"+this.name+"_frec_bottom").prev();if("top"==(W=n.find("#grid_"+this.name+"_rec_bottom").prev()).attr("line"))break;if(!(parseInt(W.attr("line"))>F))break;B.remove(),W.remove()}var Y=n.find("#grid_"+this.name+"_rec_top").next(),U=Y.attr("line");"bottom"==U&&(U=F);for(h=parseInt(U)-1;h>=E;h--)if(this.records[h-1]){var W=this.records[h-1].w2ui;W&&!Array.isArray(W.children)&&(W.expanded=!1);var K=this.getRecordHTML(h-1,h);M.after(K[1]),N.after(K[0])}t(),setTimeout(function(){i.refreshRanges()},0)}var X=(E-1)*i.recordHeight,q=(I-F)*i.recordHeight;if(q<0&&(q=0),M.css("height",X+"px"),N.css("height",X+"px"),A.css("height",q+"px"),H.css("height",q+"px"),i.last.range_start=E,i.last.range_end=F,Math.floor(n[0].scrollTop/this.recordHeight)+Math.floor(n.height()/this.recordHeight)+10>I&&!0!==this.last.pull_more&&(I<this.total-this.offset||-1==this.total&&this.last.xhr_hasMore))if(!0===this.autoLoad)this.last.pull_more=!0,this.last.xhr_offset+=this.limit,this.request("get");else{var Q=$("#grid_"+this.name+"_rec_more, #grid_"+this.name+"_frec_more");"none"==Q.css("display")&&Q.show().on("click",function(){i.last.pull_more=!0,i.last.xhr_offset+=i.limit,i.request("get"),$(this).find("td").html('<div><div style="width: 20px; height: 20px;" class="w2ui-spinner"></div></div>')}),(Q.find("td .w2ui-spinner").length>0||-1==Q.find("td").text().indexOf("Load"))&&Q.find("td").html("<div>"+w2utils.lang("Load")+" "+i.limit+" "+w2utils.lang("More")+"...</div>")}I>=this.total-this.offset&&-1!=this.total&&$("#grid_"+this.name+"_rec_more, #grid_"+this.name+"_frec_more").hide()}}},getRecordHTML:function(e,t,i){var s,n="",a="",r="",o=this.last.selection;if(-1==e){a+='<tr line="0">',r+='<tr line="0">',this.show.lineNumbers&&(a+='<td class="w2ui-col-number" style="height: 0px;"></td>'),this.show.selectColumn&&(a+='<td class="w2ui-col-select" style="height: 0px;"></td>'),this.show.expandColumn&&(a+='<td class="w2ui-col-expand" style="height: 0px;"></td>'),r+='<td class="w2ui-grid-data w2ui-grid-data-spacer" col="start" style="height: 0px; width: 0px;"></td>';for(x=0;x<this.columns.length;x++)if(n='<td class="w2ui-grid-data" col="'+x+'" style="height: 0px;"></td>',(m=this.columns[x]).frozen&&!m.hidden)a+=n;else{if(m.hidden||x<this.last.colStart||x>this.last.colEnd)continue;r+=n}return a+='<td class="w2ui-grid-data-last" style="height: 0px"></td>',r+='<td class="w2ui-grid-data-last" col="end" style="height: 0px"></td>',a+="</tr>",r+="</tr>",[a,r]}var l="object"!=typeof this.url?this.url:this.url.get;if(!0!==i)if(this.searchData.length>0&&!l){if(e>=this.last.searchIds.length)return"";e=this.last.searchIds[e],s=this.records[e]}else{if(e>=this.records.length)return"";s=this.records[e]}else{if(e>=this.summary.length)return"";s=this.summary[e]}if(!s)return"";null==s.recid&&null!=this.recid&&null!=s[this.recid]&&(s.recid=s[this.recid]);var d=(w2utils.escapeId(s.recid),!1);-1!=o.indexes.indexOf(e)&&(d=!0);var u=s.w2ui?s.w2ui.style:"";null!=u&&"string"==typeof u||(u="");var c=s.w2ui?s.w2ui.class:"";if(null!=c&&"string"==typeof c||(c=""),a+='<tr id="grid_'+this.name+"_frec_"+s.recid+'" recid="'+s.recid+'" line="'+t+'" index="'+e+'"  class="'+(t%2==0?"w2ui-even":"w2ui-odd")+" "+c+(d&&"row"==this.selectType?" w2ui-selected":"")+(s.w2ui&&!1===s.w2ui.editable?" w2ui-no-edit":"")+(s.w2ui&&!0===s.w2ui.expanded?" w2ui-expanded":"")+'" '+(!0!==i?w2utils.isIOS?"    onclick  = \"w2ui['"+this.name+"'].dblClick(jQuery(this).attr('recid'), event);\"":"    onclick  = \"w2ui['"+this.name+"'].click(jQuery(this).attr('recid'), event);\"    oncontextmenu = \"w2ui['"+this.name+"'].contextMenu(jQuery(this).attr('recid'), null, event);\"":"")+("row"==this.selectType?" onmouseover=\"jQuery('#grid_"+this.name+"_rec_'+ w2utils.escapeId(jQuery(this).attr('recid'))).addClass('w2ui-record-hover')\" onmouseout =\"jQuery('#grid_"+this.name+"_rec_'+ w2utils.escapeId(jQuery(this).attr('recid'))).removeClass('w2ui-record-hover')\"":"")+' style="height: '+this.recordHeight+"px; "+(d||""==u?u.replace("background-color","none"):u)+'" '+(""!=u?'custom_style="'+u+'"':"")+">",r+='<tr id="grid_'+this.name+"_rec_"+s.recid+'" recid="'+s.recid+'" line="'+t+'" index="'+e+'"  class="'+(t%2==0?"w2ui-even":"w2ui-odd")+" "+c+(d&&"row"==this.selectType?" w2ui-selected":"")+(s.w2ui&&!1===s.w2ui.editable?" w2ui-no-edit":"")+(s.w2ui&&!0===s.w2ui.expanded?" w2ui-expanded":"")+'" '+(!0!==i?w2utils.isIOS?"    onclick  = \"var obj = w2ui['"+this.name+"']; obj.dblClick(jQuery(this).attr('recid'), event);\"":"    onclick  = \"var obj = w2ui['"+this.name+"']; obj.click(jQuery(this).attr('recid'), event);\"    oncontextmenu = \"var obj = w2ui['"+this.name+"']; obj.contextMenu(jQuery(this).attr('recid'), null, event);\"":"")+("row"==this.selectType?" onmouseover=\"jQuery('#grid_"+this.name+"_frec_' + w2utils.escapeId(jQuery(this).attr('recid'))).addClass('w2ui-record-hover')\" onmouseout =\"jQuery('#grid_"+this.name+"_frec_' + w2utils.escapeId(jQuery(this).attr('recid'))).removeClass('w2ui-record-hover')\"":"")+' style="height: '+this.recordHeight+"px; "+(d||""==u?u.replace("background-color","none"):u)+'" '+(""!=u?'custom_style="'+u+'"':"")+">",this.show.lineNumbers&&(a+='<td id="grid_'+this.name+"_cell_"+e+"_number"+(i?"_s":"")+'"    class="w2ui-col-number '+(d?" w2ui-row-selected":"")+'"'+(this.reorderRows?' style="cursor: move"':"")+">"+(!0!==i?this.getLineHTML(t,s):"")+"</td>"),this.show.selectColumn){s&&s.w2ui&&!0===s.w2ui.hideCheckBox&&!0,a+='<td id="grid_'+this.name+"_cell_"+e+"_select"+(i?"_s":"")+'" class="w2ui-grid-data w2ui-col-select">'+(!0===i||s.w2ui&&!0===s.w2ui.hideCheckBox?"":'    <div>        <input class="w2ui-grid-select-check" type="checkbox" tabindex="-1" '+(d?'checked="checked"':"")+' style="pointer-events: none"/>    </div>')+"</td>"}if(this.show.expandColumn){var h="";h=s.w2ui&&!0===s.w2ui.expanded?"-":"+",s.w2ui&&"none"==s.w2ui.expanded&&(h=""),s.w2ui&&"spinner"==s.w2ui.expanded&&(h='<div class="w2ui-spinner" style="width: 16px; margin: -2px 2px;"></div>'),a+='<td id="grid_'+this.name+"_cell_"+e+"_expand"+(i?"_s":"")+'" class="w2ui-grid-data w2ui-col-expand">'+(!0!==i?'    <div ondblclick="if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true;"             onclick="w2ui[\''+this.name+"'].toggle(jQuery(this).parents('tr').attr('recid'));                 if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true;\">        "+h+" </div>":"")+"</td>"}r+='<td class="w2ui-grid-data-spacer" col="start" style="border-right: 0"></td>';for(var p=0,f=0;;){var g=1,m=this.columns[p];if(null==m)break;if(m.hidden)p++,f>0&&f--;else if(f>0){if(p++,null==this.columns[p])break;s.w2ui.colspan[this.columns[p-1].field]=0,f--}else{if(s.w2ui){var w=s.w2ui.colspan,v=this.columns[p].field;w&&0===w[v]&&delete w[v]}if(!(p<this.last.colStart||p>this.last.colEnd)||m.frozen){if(s.w2ui&&"object"==typeof s.w2ui.colspan){var y=parseInt(s.w2ui.colspan[m.field])||null;if(y>1){for(var b=0,x=p;x<p+y&&!(x>=this.columns.length);x++)this.columns[x].hidden&&b++;g=y-b,f=y-1}}var _=this.getCellHTML(e,p,i,g);m.frozen?a+=_:r+=_,p++}else p++}}return a+='<td class="w2ui-grid-data-last"></td>',r+='<td class="w2ui-grid-data-last" col="end"></td>',a+="</tr>",r+="</tr>",[a,r]},getLineHTML:function(e){return"<div>"+e+"</div>"},getCellHTML:function(e,t,i,s){var n=this.columns[t];if(null==n)return"";var a=!0!==i?this.records[e]:this.summary[e],r=-1!==e?this.getCellValue(e,t,i):"",o=-1!==e?this.getCellEditable(e,t):"",l="max-height: "+parseInt(this.recordHeight)+"px;",d=!i&&a&&a.w2ui&&a.w2ui.changes&&null!=a.w2ui.changes[n.field],u="",c="",h=this.last.selection,p=!1,f="";if(-1!=h.indexes.indexOf(e)&&(p=!0),null==s&&(s=a&&a.w2ui&&a.w2ui.colspan&&a.w2ui.colspan[n.field]?a.w2ui.colspan[n.field]:1),0===t&&a&&a.w2ui&&Array.isArray(a.w2ui.children)){for(var g=0,m=this.get(a.w2ui.parent_recid,!0);null!=m&&(g++,null!=(b=this.records[m].w2ui)&&null!=b.parent_recid);)m=this.get(b.parent_recid,!0);if(a.w2ui.parent_recid)for(var w=0;w<g;w++)f+='<span class="w2ui-show-children w2ui-icon-empty"></span>';f+='<span class="w2ui-show-children '+(a.w2ui.children.length>0?a.w2ui.expanded?"w2ui-icon-collapse":"w2ui-icon-expand":"w2ui-icon-empty")+'"  onclick="event.stopPropagation(); w2ui[\''+this.name+"'].toggle(jQuery(this).parents('tr').attr('recid'))\"></span>"}if(!0===n.info&&(n.info={}),null!=n.info&&(n.info.icon||(n.info.icon="w2ui-icon-info"),f+='<span class="w2ui-info '+n.info.icon+'" style="'+(n.info.style||"")+'"  onclick="event.stopPropagation(); w2ui[\''+this.name+"'].showBubble("+e+", "+t+')"></span>'),null!=n.render&&-1!==e){if("function"==typeof n.render&&((r=$.trim(n.render.call(this,a,e,t,r))).length<4||"<div"!=r.substr(0,4).toLowerCase())&&(r='<div style="'+l+'">'+f+String(r)+"</div>"),"object"==typeof n.render){var v=n.render[r];null!=v&&""!==v||(v=r),r='<div style="'+l+'">'+f+v+"</div>"}if("string"==typeof n.render){var y=n.render.toLowerCase().indexOf(":"),b=[];-1==y?(b[0]=n.render.toLowerCase(),b[1]=""):(b[0]=n.render.toLowerCase().substr(0,y),b[1]=n.render.toLowerCase().substr(y+1));var x=w2utils.formatters[b[0]];r='<div style="'+l+'">'+f+("function"==typeof x?x(r,b[1]):"")+"</div>"}}else{if(o&&-1!=["checkbox","check"].indexOf(o.type)){var _=i?-(e+1):e;l+="text-align: center;",r='<input tabindex="-1" type="checkbox" '+(r?'checked="checked"':"")+" onclick=\"    var obj = w2ui['"+this.name+"'];     obj.editChange.call(obj, this, "+_+", "+t+', event); "/>',f=""}if(this.show.recordTitles){var k=w2utils.stripTags(String(r).replace(/"/g,"''"));null!=n.title&&("function"==typeof n.title&&(k=n.title.call(this,a,e,t)),"string"==typeof n.title&&(k=n.title))}r='<div style="'+l+'" title="'+(k||"")+'">'+f+String(r)+"</div>"}if(null==r&&(r=""),"string"==typeof n.render){b=n.render.toLowerCase().split(":");-1!=["number","int","float","money","currency","percent","size"].indexOf(b[0])&&(u+="text-align: right;")}a&&a.w2ui&&("object"==typeof a.w2ui.style&&("string"==typeof a.w2ui.style[t]&&(u+=a.w2ui.style[t]+";"),"string"==typeof a.w2ui.style[n.field]&&(u+=a.w2ui.style[n.field]+";")),"object"==typeof a.w2ui.class&&("string"==typeof a.w2ui.class[t]&&(c+=a.w2ui.class[t]+" "),"string"==typeof a.w2ui.class[n.field]&&(c+=a.w2ui.class[n.field]+" ")));var C=!1;return p&&-1!=$.inArray(t,h.columns[e])&&(C=!0),r='<td class="w2ui-grid-data'+(C?" w2ui-selected":"")+" "+c+(d?" w2ui-changed":"")+'"    id="grid_'+this.name+"_data_"+e+"_"+t+'" col="'+t+'"    style="'+u+(null!=n.style?n.style:"")+'" '+(null!=n.attr?n.attr:"")+(s>1?'colspan="'+s+'"':"")+">"+r+"</td>",-1===e&&!0===i&&(r='<td class="w2ui-grid-data" col="'+t+'" style="height: 0px; '+u+'" '+(s>1?'colspan="'+s+'"':"")+"></td>"),r},showBubble:function(e,t){var i="",s=this.columns[t].info,n=this.records[e],a=$(this.box).find("#grid_"+this.name+"_data_"+e+"_"+t+" .w2ui-info");if(this.last.bubbleEl&&$(this.last.bubbleEl).w2tag(),this.last.bubbleEl=a,null==s.fields){s.fields=[];for(l=0;l<this.columns.length;l++){var r=this.columns[l];s.fields.push(r.field+("string"==typeof r.render?":"+r.render:""))}}var o=s.fields;if("function"==typeof o&&(o=o(n,e,t)),"function"==typeof s.render)i=s.render(n,e,t);else if($.isArray(o)){i='<table cellpadding="0" cellspacing="0">';for(var l=0;l<o.length;l++)if(""!=(c=String(o[l]).split(":"))[0]&&"-"!=c[0]&&"--"!=c[0]&&"---"!=c[0]){null==(r=this.getColumn(c[0]))&&(r={field:c[0],caption:c[0]});h=r?this.parseField(n,r.field):"";c.length>1&&(w2utils.formatters[c[1]]?h=w2utils.formatters[c[1]](h,c[2]||null):console.log('ERROR: w2utils.formatters["'+c[1]+'"] does not exists.')),(!0===s.showEmpty||null!=h&&""!=h)&&(null!=s.maxLength&&"string"==typeof h&&h.length>s.maxLength&&(h=h.substr(0,s.maxLength)+"..."),i+="<tr><td>"+r.caption+"</td><td>"+((0===h?"0":h)||"")+"</td></tr>")}else i+='<tr><td colspan=2><div style="border-top: '+(""==c[0]?"0":"1")+'px solid #C1BEBE; margin: 6px 0px;"></div></td></tr>';i+="</table>"}else if($.isPlainObject(o)){i='<table cellpadding="0" cellspacing="0">';for(var d in o){var u=o[d];if(""!=u&&"-"!=u&&"--"!=u&&"---"!=u){var c=String(u).split(":");null==(r=this.getColumn(c[0]))&&(r={field:c[0],caption:c[0]});var h=r?this.parseField(n,r.field):"";c.length>1&&(w2utils.formatters[c[1]]?h=w2utils.formatters[c[1]](h,c[2]||null):console.log('ERROR: w2utils.formatters["'+c[1]+'"] does not exists.')),"function"==typeof u&&(h=u(n,e,t)),(!0===s.showEmpty||null!=h&&""!=h)&&(null!=s.maxLength&&"string"==typeof h&&h.length>s.maxLength&&(h=h.substr(0,s.maxLength)+"..."),i+="<tr><td>"+d+"</td><td>"+(h||"")+"</td></tr>")}else i+='<tr><td colspan=2><div style="border-top: '+(""==u?"0":"1")+'px solid #C1BEBE; margin: 6px 0px;"></div></td></tr>'}i+="</table>"}$(a).w2tag($.extend({html:i,left:-4,position:"bottom|top",className:"w2ui-info-bubble",style:"",hideOnClick:!0},s.options||{}))},getCellEditable:function(e,t){var i=this.columns[t],s=this.records[e];if(!s||!i)return null;var n=s.w2ui?s.w2ui.editable:null;if(!1===n)return null;if((null==n||!0===n)&&"function"==typeof(n=i?i.editable:null)){var a=this.getCellValue(e,t,!1);n=n.call(this,s,e,t,a)}return n},getCellValue:function(e,t,i){var s=this.columns[t],n=!0!==i?this.records[e]:this.summary[e],a=this.parseField(n,s.field);return n&&n.w2ui&&n.w2ui.changes&&null!=n.w2ui.changes[s.field]&&(a=n.w2ui.changes[s.field]),$.isPlainObject(a)&&(s.options&&s.options.items?(val=s.options.items.find(function(e){return e.id==a.id}),a=val?val.text:a.id):(null!=a.text&&(a=a.text),null!=a.id&&(a=a.id))),null==a&&(a=""),a},getFooterHTML:function(){return'<div>    <div class="w2ui-footer-left"></div>    <div class="w2ui-footer-right"></div>    <div class="w2ui-footer-center"></div></div>'},status:function(e){if(null!=e)$("#grid_"+this.name+"_footer").find(".w2ui-footer-left").html(e);else{var t="",i=this.getSelection();if(i.length>0&&(this.show.statusSelection&&i.length>1&&(t=String(i.length).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,")+" "+w2utils.lang("selected")),this.show.statusRecordID&&1==i.length)){var s=i[0];"object"==typeof s&&(s=s.recid+", "+w2utils.lang("Column")+": "+s.column),t=w2utils.lang("Record ID")+": "+s+" "}$("#grid_"+this.name+"_footer .w2ui-footer-left").html(t),1==i.length?this.toolbar.enable("w2ui-edit"):this.toolbar.disable("w2ui-edit"),i.length>=1?this.toolbar.enable("w2ui-delete"):this.toolbar.disable("w2ui-delete")}},lock:function(e,t){var i=this,s=Array.prototype.slice.call(arguments,0);s.unshift(this.box),setTimeout(function(){$(i.box).find("#grid_"+i.name+"_empty_msg").remove(),w2utils.lock.apply(window,s)},10)},unlock:function(e){var t=this.box;setTimeout(function(){$(t).find(".w2ui-message").not(".w2ui-closing").length>0||w2utils.unlock(t,e)},25)},stateSave:function(e){if(!w2utils.hasLocalStorage)return null;for(var t={columns:[],show:$.extend({},this.show),last:{search:this.last.search,multi:this.last.multi,logic:this.last.logic,caption:this.last.caption,field:this.last.field,scrollTop:this.last.scrollTop,scrollLeft:this.last.scrollLeft},sortData:[],searchData:[]},i=0;i<this.columns.length;i++){var s=this.columns[i];t.columns.push({field:s.field,hidden:!!s.hidden,frozen:!!s.frozen,size:s.size?s.size:null,sizeCalculated:s.sizeCalculated?s.sizeCalculated:null,sizeOriginal:s.sizeOriginal?s.sizeOriginal:null,sizeType:s.sizeType?s.sizeType:null})}for(i=0;i<this.sortData.length;i++)t.sortData.push($.extend({},this.sortData[i]));for(i=0;i<this.searchData.length;i++)t.searchData.push($.extend({},this.searchData[i]));if(!0!==e){var n=this.trigger({phase:"before",type:"stateSave",target:this.name,state:t});if(!0===n.isCancelled)return void("function"==typeof callBack&&callBack({status:"error",message:"Request aborted."}));try{var a=$.parseJSON(localStorage.w2ui||"{}");a||(a={}),a.states||(a.states={}),a.states[this.stateId||this.name]=t,localStorage.w2ui=JSON.stringify(a)}catch(e){return delete localStorage.w2ui,null}this.trigger($.extend(n,{phase:"after"}))}return t},stateRestore:function(e){var t=this,i="object"!=typeof this.url?this.url:this.url.get;if(!e)try{if(!w2utils.hasLocalStorage)return!1;(o=$.parseJSON(localStorage.w2ui||"{}"))||(o={}),o.states||(o.states={}),e=o.states[this.stateId||this.name]}catch(e){return delete localStorage.w2ui,null}var s=this.trigger({phase:"before",type:"stateRestore",target:this.name,state:e});if(!0!==s.isCancelled){if($.isPlainObject(e)){$.extend(this.show,e.show),$.extend(this.last,e.last);for(var n=this.last.scrollTop,a=this.last.scrollLeft,r=0;r<e.columns.length;r++){var o=e.columns[r],l=this.getColumn(o.field,!0);null!==l&&($.extend(this.columns[l],o),r!==l&&this.columns.splice(r,0,this.columns.splice(l,1)[0]))}this.sortData.splice(0,this.sortData.length);for(r=0;r<e.sortData.length;r++)this.sortData.push(e.sortData[r]);this.searchData.splice(0,this.searchData.length);for(r=0;r<e.searchData.length;r++)this.searchData.push(e.searchData[r]);setTimeout(function(){i||(t.sortData.length>0&&t.localSort(),t.searchData.length>0&&t.localSearch()),t.last.scrollTop=n,t.last.scrollLeft=a,t.refresh()},1)}return this.trigger($.extend(s,{phase:"after"})),!0}"function"==typeof callBack&&callBack({status:"error",message:"Request aborted."})},stateReset:function(){if(this.stateRestore(this.last.state),w2utils.hasLocalStorage)try{var e=$.parseJSON(localStorage.w2ui||"{}");e.states&&e.states[this.stateId||this.name]&&delete e.states[this.stateId||this.name],localStorage.w2ui=JSON.stringify(e)}catch(e){return delete localStorage.w2ui,null}},parseField:function(e,t){if(this.useFieldDot){var i="";try{i=e;for(var s=String(t).split("."),n=0;n<s.length;n++)i=i[s[n]]}catch(e){i=""}return i}return e?e[t]:""},prepareData:function(){function e(i){for(var s=0;s<t.columns.length;s++){var n=t.columns[s];if(null!=i[n.field]&&"string"==typeof n.render){if(-1!=["number","int","float","money","currency","percent"].indexOf(n.render.split(":")[0])&&"number"!=typeof i[n.field]&&(i[n.field]=parseFloat(i[n.field])),-1!=["date","age"].indexOf(n.render.split(":")[0])&&!i[n.field+"_"]){var a=i[n.field];w2utils.isInt(a)&&(a=parseInt(a)),i[n.field+"_"]=new Date(a)}if(-1!=["time"].indexOf(n.render))if(w2utils.isTime(i[n.field])){r=w2utils.isTime(i[n.field],!0);(a=new Date).setHours(r.hours,r.minutes,r.seconds?r.seconds:0,0),i[n.field+"_"]||(i[n.field+"_"]=a)}else{r=i[n.field];w2utils.isInt(r)&&(r=parseInt(r));var r=null!=r?new Date(r):new Date;(a=new Date).setHours(r.getHours(),r.getMinutes(),r.getSeconds(),0),i[n.field+"_"]||(i[n.field+"_"]=a)}}}if(i.w2ui&&i.w2ui.children&&!0!==i.w2ui.expanded)for(var o=0;o<i.w2ui.children.length;o++)e(i.w2ui.children[o])}for(var t=this,i=0;i<this.records.length;i++)e(this.records[i])},nextCell:function(e,t,i){var s=t+1;if(s>=this.columns.length)return null;var n=this.records[e].w2ui,a=(this.columns[t],this.columns[s]),r=n&&n.colspan&&!isNaN(n.colspan[a.field])?parseInt(n.colspan[a.field]):1;if(null==a)return null;if(a&&a.hidden||0===r)return this.nextCell(e,s,i);if(i){var o=this.getCellEditable(e,t);if(null==o||-1!=["checkbox","check"].indexOf(o.type))return this.nextCell(e,s,i)}return s},prevCell:function(e,t,i){var s=t-1;if(s<0)return null;var n=this.records[e].w2ui,a=this.columns[s],r=n&&n.colspan&&!isNaN(n.colspan[a.field])?parseInt(n.colspan[a.field]):1;if(null==a)return null;if(a&&a.hidden||0===r)return this.prevCell(e,s,i);if(i){var o=this.getCellEditable(e,t);if(null==o||-1!=["checkbox","check"].indexOf(o.type))return this.prevCell(e,s,i)}return s},nextRow:function(e,t){var i=this.last.searchIds,s=null;if(e+1<this.records.length&&0===i.length||i.length>0&&e<i[i.length-1]){if(e++,i.length>0)for(;!(-1!=$.inArray(e,i)||e>this.records.length);)e++;var n=this.records[e].w2ui,a=this.columns[t];s=0===(n&&n.colspan&&null!=a&&!isNaN(n.colspan[a.field])?parseInt(n.colspan[a.field]):1)?this.nextRow(e,t):e}return s},prevRow:function(e,t){var i=this.last.searchIds,s=null;if(e>0&&0===i.length||i.length>0&&e>i[0]){if(e--,i.length>0)for(;!(-1!=$.inArray(e,i)||e<0);)e--;var n=this.records[e].w2ui,a=this.columns[t];s=0===(n&&n.colspan&&null!=a&&!isNaN(n.colspan[a.field])?parseInt(n.colspan[a.field]):1)?this.prevRow(e,t):e}return s},selectionSave:function(){return this.last._selection=this.getSelection(),this.last._selection},selectionRestore:function(e){var t=(new Date).getTime();this.last.selection={indexes:[],columns:{}};for(var i=this.last.selection,s=this.last._selection,n=0;n<s.length;n++)if($.isPlainObject(s[n]))null!=(a=this.get(s[n].recid,!0))&&(-1==i.indexes.indexOf(a)&&i.indexes.push(a),i.columns[a]||(i.columns[a]=[]),i.columns[a].push(s[n].column));else{var a=this.get(s[n],!0);null!=a&&i.indexes.push(a)}return delete this.last._selection,!0!==e&&this.refresh(),(new Date).getTime()-t},message:function(e,t){"string"==typeof e&&(e={width:e.length<300?350:550,height:e.length<300?170:250,body:'<div class="w2ui-centered">'+e+"</div>",buttons:'<button class="w2ui-btn" onclick="w2ui[\''+this.name+"'].message()\">Ok</button>",onOpen:function(e){setTimeout(function(){$(this.box).find(".w2ui-btn").focus()},25)},onClose:function(e){"function"==typeof t&&t()}}),w2utils.message.call(this,{box:this.box,path:"w2ui."+this.name,title:".w2ui-grid-header:visible",body:".w2ui-grid-box"},e)}},$.extend(w2grid.prototype,w2utils.event),w2obj.grid=w2grid}(jQuery),function(e){var t=function(t){this.box=null,this.name=null,this.panels=[],this.tmp={},this.padding=1,this.resizer=4,this.style="",e.extend(!0,this,w2obj.layout,t)},i=["top","left","main","preview","right","bottom"];e.fn.w2layout=function(s){if(e.isPlainObject(s)){if(!w2utils.checkName(s,"w2layout"))return;var n=s.panels||[],a=new t(s);e.extend(a,{handlers:[],panels:[]});for(var r=0,o=n.length;r<o;r++)a.panels[r]=e.extend(!0,{},t.prototype.panel,n[r]),(e.isPlainObject(a.panels[r].tabs)||e.isArray(a.panels[r].tabs))&&function(t,i,s){var n=t.get(i);null!=n&&null==s&&(s=n.tabs),null!=n&&null!=s&&(e.isArray(s)&&(s={tabs:s}),e().w2destroy(t.name+"_"+i+"_tabs"),n.tabs=e().w2tabs(e.extend({},s,{owner:t,name:t.name+"_"+i+"_tabs"})),n.show.tabs=!0)}(a,n[r].type),(e.isPlainObject(a.panels[r].toolbar)||e.isArray(a.panels[r].toolbar))&&function(t,i,s){var n=t.get(i);null!=n&&null==s&&(s=n.toolbar),null!=n&&null!=s&&(e.isArray(s)&&(s={items:s}),e().w2destroy(t.name+"_"+i+"_toolbar"),n.toolbar=e().w2toolbar(e.extend({},s,{owner:t,name:t.name+"_"+i+"_toolbar"})),n.show.toolbar=!0)}(a,n[r].type);for(var l=0;l<i.length;l++)null==a.get(i[l])&&a.panels.push(e.extend(!0,{},t.prototype.panel,{type:i[l],hidden:"main"!==i[l],size:50}));return e(this).length>0&&a.render(e(this)[0]),w2ui[a.name]=a,a}var d=w2ui[e(this).attr("name")];return d?arguments.length>0?(d[s]&&d[s].apply(d,Array.prototype.slice.call(arguments,1)),this):d:null},t.prototype={onShow:null,onHide:null,onResizing:null,onResizerClick:null,onRender:null,onRefresh:null,onContent:null,onResize:null,onDestroy:null,panel:{type:null,title:"",size:100,minSize:20,maxSize:!1,hidden:!1,resizable:!1,overflow:"auto",style:"",content:"",tabs:null,toolbar:null,width:null,height:null,show:{toolbar:!1,tabs:!1},onRefresh:null,onShow:null,onHide:null},html:function(e,t,i){return this.content(e,t,i)},content:function(t,i,s){var n=this,a=this.get(t);if("css"==t)return e("#layout_"+n.name+"_panel_css").html("<style>"+i+"</style>"),!0;if(null==a)return!1;if(null==i)return a.content;var r=this.trigger({phase:"before",type:"content",target:t,object:a,content:i,transition:s});if(!0!==r.isCancelled){if(i instanceof jQuery)return console.log("ERROR: You can not pass jQuery object to w2layout.content() method"),!1;var o="#layout_"+this.name+"_panel_"+a.type,l=e(o+"> .w2ui-panel-content"),d=0;if(l.length>0&&(e(o).scrollTop(0),d=e(l).position().top),""===a.content)a.content=i,this.refresh(t);else{if(a.content=i,!a.hidden&&null!=s&&""!==s){var u=e(o+"> .w2ui-panel-content");u.after('<div class="w2ui-panel-content new-panel" style="'+u[0].style.cssText+'"></div>');var c=e(o+"> .w2ui-panel-content.new-panel");u.css("top",d),c.css("top",d),"object"==typeof i?(i.box=c[0],i.render()):c.html(i),w2utils.transition(u[0],c[0],s,function(){u.remove(),c.removeClass("new-panel"),c.css("overflow",a.overflow),n.resize(),-1!=window.navigator.userAgent.indexOf("MSIE")&&setTimeout(function(){n.resize()},100)})}this.refresh(t)}return n.trigger(e.extend(r,{phase:"after"})),n.resize(),-1!=window.navigator.userAgent.indexOf("MSIE")&&setTimeout(function(){n.resize()},100),!0}},message:function(t,i){var s=this;"string"==typeof i&&(i={width:i.length<300?350:550,height:i.length<300?170:250,body:'<div class="w2ui-centered">'+i+"</div>",buttons:'<button class="w2ui-btn" onclick="w2ui[\''+this.name+"'].message('"+t+"')\">Ok</button>",onOpen:function(t){setTimeout(function(){e(this.box).find(".w2ui-btn").focus()},25)}});var n,a=this.get(t),r=e("#layout_"+this.name+"_panel_"+a.type).css("overflow");i&&(i.onClose&&(n=i.onClose),i.onClose=function(t){"function"==typeof n&&n(t),t.done(function(){e("#layout_"+s.name+"_panel_"+a.type).css("overflow",r)})}),e("#layout_"+this.name+"_panel_"+a.type).css("overflow","hidden"),w2utils.message.call(this,{box:e("#layout_"+this.name+"_panel_"+a.type),param:t,path:"w2ui."+this.name,title:".w2ui-panel-title:visible",body:".w2ui-panel-content"},i)},load:function(t,i,s,n){var a=this;return"css"==t?(e.get(i,function(e,i,s){a.content(t,s.responseText),n&&n()}),!0):null!=this.get(t)&&(e.get(i,function(e,i,r){a.content(t,r.responseText,s),n&&n(),a.resize(),-1!=window.navigator.userAgent.indexOf("MSIE")&&setTimeout(function(){a.resize()},100)}),!0)},sizeTo:function(t,i,s){var n=this;return null!=n.get(t)&&(e(n.box).find(" > div > .w2ui-panel").css(w2utils.cssPrefix("transition",!0!==s?".2s":"0s")),setTimeout(function(){n.set(t,{size:i})},1),setTimeout(function(){e(n.box).find(" > div > .w2ui-panel").css(w2utils.cssPrefix("transition","0s")),n.resize()},500),!0)},show:function(t,i){var s=this,n=this.trigger({phase:"before",type:"show",target:t,object:this.get(t),immediate:i});if(!0!==n.isCancelled){var a=s.get(t);return null!=a&&(a.hidden=!1,!0===i?(e("#layout_"+s.name+"_panel_"+t).css({opacity:"1"}),s.trigger(e.extend(n,{phase:"after"})),s.resize()):(e("#layout_"+s.name+"_panel_"+t).css({opacity:"0"}),e(s.box).find(" > div > .w2ui-panel").css(w2utils.cssPrefix("transition",".2s")),setTimeout(function(){s.resize()},1),setTimeout(function(){e("#layout_"+s.name+"_panel_"+t).css({opacity:"1"})},250),setTimeout(function(){e(s.box).find(" > div > .w2ui-panel").css(w2utils.cssPrefix("transition","0s")),s.trigger(e.extend(n,{phase:"after"})),s.resize()},500)),!0)}},hide:function(t,i){var s=this,n=this.trigger({phase:"before",type:"hide",target:t,object:this.get(t),immediate:i});if(!0!==n.isCancelled){var a=s.get(t);return null!=a&&(a.hidden=!0,!0===i?(e("#layout_"+s.name+"_panel_"+t).css({opacity:"0"}),s.trigger(e.extend(n,{phase:"after"})),s.resize()):(e(s.box).find(" > div > .w2ui-panel").css(w2utils.cssPrefix("transition",".2s")),e("#layout_"+s.name+"_panel_"+t).css({opacity:"0"}),setTimeout(function(){s.resize()},1),setTimeout(function(){e(s.box).find(" > div > .w2ui-panel").css(w2utils.cssPrefix("transition","0s")),s.trigger(e.extend(n,{phase:"after"})),s.resize()},500)),!0)}},toggle:function(e,t){var i=this.get(e);return null!=i&&(i.hidden?this.show(e,t):this.hide(e,t))},set:function(t,i){var s=this.get(t,!0);return null!=s&&(e.extend(this.panels[s],i),null==i.content&&null==i.resizable||this.refresh(t),this.resize(),!0)},get:function(e,t){for(var i=0;i<this.panels.length;i++)if(this.panels[i].type==e)return!0===t?i:this.panels[i];return null},el:function(t){var i=e("#layout_"+this.name+"_panel_"+t+"> .w2ui-panel-content");return 1!=i.length?null:i[0]},hideToolbar:function(t){var i=this.get(t);i&&(i.show.toolbar=!1,e("#layout_"+this.name+"_panel_"+t+"> .w2ui-panel-toolbar").hide(),this.resize())},showToolbar:function(t){var i=this.get(t);i&&(i.show.toolbar=!0,e("#layout_"+this.name+"_panel_"+t+"> .w2ui-panel-toolbar").show(),this.resize())},toggleToolbar:function(e){var t=this.get(e);t&&(t.show.toolbar?this.hideToolbar(e):this.showToolbar(e))},assignToolbar:function(t,i){"string"==typeof i&&null!=w2ui[i]&&(i=w2ui[i]);var s=this.get(t);s.toolbar=i;var n=e(this.box).find(t+"> .w2ui-panel-toolbar");null!=s.toolbar?(0===n.find("[name="+s.toolbar.name+"]").length?n.w2render(s.toolbar):null!=s.toolbar&&s.toolbar.refresh(),this.showToolbar(t),this.refresh(t)):(n.html(""),this.hideToolbar(t))},hideTabs:function(t){var i=this.get(t);i&&(i.show.tabs=!1,e("#layout_"+this.name+"_panel_"+t+"> .w2ui-panel-tabs").hide(),this.resize())},showTabs:function(t){var i=this.get(t);i&&(i.show.tabs=!0,e("#layout_"+this.name+"_panel_"+t+"> .w2ui-panel-tabs").show(),this.resize())},toggleTabs:function(e){var t=this.get(e);t&&(t.show.tabs?this.hideTabs(e):this.showTabs(e))},render:function(t){var s=this,n=(new Date).getTime(),a=s.trigger({phase:"before",type:"render",target:s.name,box:t});if(!0!==a.isCancelled){if(null!=t&&(e(s.box).find("#layout_"+s.name+"_panel_main").length>0&&e(s.box).removeAttr("name").removeClass("w2ui-layout").html(""),s.box=t),!s.box)return!1;e(s.box).attr("name",s.name).addClass("w2ui-layout").html("<div></div>"),e(s.box).length>0&&(e(s.box)[0].style.cssText+=s.style);for(var r=0;r<i.length;r++){var o=(s.get(i[r]),'<div id="layout_'+s.name+"_panel_"+i[r]+'" class="w2ui-panel">    <div class="w2ui-panel-title"></div>    <div class="w2ui-panel-tabs"></div>    <div class="w2ui-panel-toolbar"></div>    <div class="w2ui-panel-content"></div></div><div id="layout_'+s.name+"_resizer_"+i[r]+'" class="w2ui-resizer"></div>');e(s.box).find(" > div").append(o)}return e(s.box).find(" > div").append('<div id="layout_'+s.name+'_panel_css" style="position: absolute; top: 10000px;"></div>'),s.refresh(),s.trigger(e.extend(a,{phase:"after"})),setTimeout(function(){(function(){s.tmp.events={resize:function(e){w2ui[s.name].resize()},resizeStart:function(t,n){if(s.box){n||(n=window.event),e(document).off("mousemove",s.tmp.events.mouseMove).on("mousemove",s.tmp.events.mouseMove),e(document).off("mouseup",s.tmp.events.mouseUp).on("mouseup",s.tmp.events.mouseUp),s.tmp.resize={type:t,x:n.screenX,y:n.screenY,diff_x:0,diff_y:0,value:0};for(var a=0;a<i.length;a++){var r=e(s.el(i[a])).parent().find(".w2ui-lock");r.length>0?r.attr("locked","previous"):s.lock(i[a],{opacity:0})}"left"!=t&&"right"!=t||(s.tmp.resize.value=parseInt(e("#layout_"+s.name+"_resizer_"+t)[0].style.left)),"top"!=t&&"preview"!=t&&"bottom"!=t||(s.tmp.resize.value=parseInt(e("#layout_"+s.name+"_resizer_"+t)[0].style.top))}},mouseMove:function(t){if(s.box&&(t||(t=window.event),null!=s.tmp.resize)){var i=s.get(s.tmp.resize.type),n=s.tmp.resize,a=s.trigger({phase:"before",type:"resizing",target:s.name,object:i,originalEvent:t,panel:n?n.type:"all",diff_x:n?n.diff_x:0,diff_y:n?n.diff_y:0});if(!0!==a.isCancelled){var r=e("#layout_"+s.name+"_resizer_"+n.type),o=t.screenX-n.x,l=t.screenY-n.y,d=s.get("main");switch(r.hasClass("active")||r.addClass("active"),n.type){case"left":i.minSize-o>i.width&&(o=i.minSize-i.width),i.maxSize&&i.width+o>i.maxSize&&(o=i.maxSize-i.width),d.minSize+o>d.width&&(o=d.width-d.minSize);break;case"right":i.minSize+o>i.width&&(o=i.width-i.minSize),i.maxSize&&i.width-o>i.maxSize&&(o=i.width-i.maxSize),d.minSize-o>d.width&&(o=d.minSize-d.width);break;case"top":i.minSize-l>i.height&&(l=i.minSize-i.height),i.maxSize&&i.height+l>i.maxSize&&(l=i.maxSize-i.height),d.minSize+l>d.height&&(l=d.height-d.minSize);break;case"preview":case"bottom":i.minSize+l>i.height&&(l=i.height-i.minSize),i.maxSize&&i.height-l>i.maxSize&&(l=i.height-i.maxSize),d.minSize-l>d.height&&(l=d.minSize-d.height)}switch(n.diff_x=o,n.diff_y=l,n.type){case"top":case"preview":case"bottom":n.diff_x=0,r.length>0&&(r[0].style.top=n.value+n.diff_y+"px");break;case"left":case"right":n.diff_y=0,r.length>0&&(r[0].style.left=n.value+n.diff_x+"px")}s.trigger(e.extend(a,{phase:"after"}))}}},mouseUp:function(t){if(s.box&&(t||(t=window.event),e(document).off("mousemove",s.tmp.events.mouseMove),e(document).off("mouseup",s.tmp.events.mouseUp),null!=s.tmp.resize)){for(var n=0;n<i.length;n++){var a=e(s.el(i[n])).parent().find(".w2ui-lock");"previous"==a.attr("locked")?a.removeAttr("locked"):s.unlock(i[n])}if(0!==s.tmp.diff_x||0!==s.tmp.resize.diff_y){var r,o,l=s.get("top"),d=s.get("bottom"),u=s.get(s.tmp.resize.type),c=parseInt(e(s.box).height()),h=parseInt(e(s.box).width()),p=String(u.size);switch(s.tmp.resize.type){case"top":r=parseInt(u.sizeCalculated)+s.tmp.resize.diff_y,o=0;break;case"bottom":r=parseInt(u.sizeCalculated)-s.tmp.resize.diff_y,o=0;break;case"preview":r=parseInt(u.sizeCalculated)-s.tmp.resize.diff_y,o=(l&&!l.hidden?l.sizeCalculated:0)+(d&&!d.hidden?d.sizeCalculated:0);break;case"left":r=parseInt(u.sizeCalculated)+s.tmp.resize.diff_x,o=0;break;case"right":r=parseInt(u.sizeCalculated)-s.tmp.resize.diff_x,o=0}"%"==p.substr(p.length-1)?u.size=Math.floor(100*r/("left"==u.type||"right"==u.type?h:c-o)*100)/100+"%":"-"==String(u.size).substr(0,1)?u.size=parseInt(u.size)-u.sizeCalculated+r:u.size=r,s.resize()}e("#layout_"+s.name+"_resizer_"+s.tmp.resize.type).removeClass("active"),delete s.tmp.resize}}},e(window).on("resize",s.tmp.events.resize)})(),s.resize()},0),(new Date).getTime()-n}},refresh:function(t){var i=this;null==t&&(t=null);var s=(new Date).getTime(),n=i.trigger({phase:"before",type:"refresh",target:null!=t?t:i.name,object:i.get(t)});if(!0!==n.isCancelled){if("string"==typeof t){var a=i.get(t);if(null==a)return;var r="#layout_"+i.name+"_panel_"+a.type,o="#layout_"+i.name+"_resizer_"+a.type;e(r).css({display:a.hidden?"none":"block"}),a.resizable?e(o).show():e(o).hide(),"object"==typeof a.content&&"function"==typeof a.content.render?(a.content.box=e(r+"> .w2ui-panel-content")[0],setTimeout(function(){e(r+"> .w2ui-panel-content").length>0&&(e(r+"> .w2ui-panel-content").removeClass().removeAttr("name").addClass("w2ui-panel-content").css("overflow",a.overflow)[0].style.cssText+=";"+a.style),a.content&&"function"==typeof a.content.render&&a.content.render()},1)):e(r+"> .w2ui-panel-content").length>0&&(e(r+"> .w2ui-panel-content").removeClass().removeAttr("name").addClass("w2ui-panel-content").html(a.content).css("overflow",a.overflow)[0].style.cssText+=";"+a.style);var l=e(i.box).find(r+"> .w2ui-panel-tabs");a.show.tabs?0===l.find("[name="+a.tabs.name+"]").length&&null!=a.tabs?l.w2render(a.tabs):a.tabs.refresh():l.html("").removeClass("w2ui-tabs").hide(),l=e(i.box).find(r+"> .w2ui-panel-toolbar"),a.show.toolbar?0===l.find("[name="+a.toolbar.name+"]").length&&null!=a.toolbar?l.w2render(a.toolbar):a.toolbar.refresh():l.html("").removeClass("w2ui-toolbar").hide(),l=e(i.box).find(r+"> .w2ui-panel-title"),a.title?l.html(a.title).show():l.html("").hide()}else{if(0===e("#layout_"+i.name+"_panel_main").length)return void i.render();i.resize();for(var d=0;d<this.panels.length;d++)i.refresh(this.panels[d].type)}return i.trigger(e.extend(n,{phase:"after"})),(new Date).getTime()-s}},resize:function(){if(!this.box)return!1;var t=(new Date).getTime(),s=this.tmp.resize,n=this.trigger({phase:"before",type:"resize",target:this.name,panel:s?s.type:"all",diff_x:s?s.diff_x:0,diff_y:s?s.diff_y:0});if(!0!==n.isCancelled){this.padding<0&&(this.padding=0);var a=parseInt(e(this.box).width()),r=parseInt(e(this.box).height());e(this.box).find(" > div").css({width:a+"px",height:r+"px"});for(var o,l,d,u,c,h=this,p=this.get("main"),f=this.get("preview"),g=this.get("left"),m=this.get("right"),w=this.get("top"),v=this.get("bottom"),y=null!=f&&!0!==f.hidden,b=null!=g&&!0!==g.hidden,x=null!=m&&!0!==m.hidden,_=null!=w&&!0!==w.hidden,k=null!=v&&!0!==v.hidden,C=0;C<i.length;C++)if("main"!==i[C]&&(s=this.get(i[C]))){var T=String(s.size||0);if("%"==T.substr(T.length-1)){var $=r;"preview"==s.type&&($=$-(w&&!w.hidden?w.sizeCalculated:0)-(v&&!v.hidden?v.sizeCalculated:0)),s.sizeCalculated=parseInt(("left"==s.type||"right"==s.type?a:$)*parseFloat(s.size)/100)}else s.sizeCalculated=parseInt(s.size);s.sizeCalculated=Math.max(s.sizeCalculated,parseInt(s.minSize))}"-"==String(m.size).substr(0,1)&&(b&&"-"==g.size.substr(0,1)?console.log("ERROR: you cannot have both left panel.size and right panel.size be negative."):m.sizeCalculated=a-(b?g.sizeCalculated:0)+parseInt(m.size)),"-"==String(g.size).substr(0,1)&&(x&&"-"==m.size.substr(0,1)?console.log("ERROR: you cannot have both left panel.size and right panel.size be negative."):g.sizeCalculated=a-(x?m.sizeCalculated:0)+parseInt(g.size)),null!=w&&!0!==w.hidden?(o=0,l=0,d=a,u=w.sizeCalculated,e("#layout_"+this.name+"_panel_top").css({display:"block",left:o+"px",top:l+"px",width:d+"px",height:u+"px"}).show(),w.width=d,w.height=u,w.resizable&&(l=w.sizeCalculated-(0===this.padding?this.resizer:0),u=this.resizer>this.padding?this.resizer:this.padding,e("#layout_"+this.name+"_resizer_top").show().css({display:"block",left:o+"px",top:l+"px",width:d+"px",height:u+"px",cursor:"ns-resize"}).off("mousedown").on("mousedown",function(t){var i=h.trigger({phase:"before",type:"resizerClick",target:"top",originalEvent:t});if(!0!==i.isCancelled)return w2ui[h.name].tmp.events.resizeStart("top",t),h.trigger(e.extend(i,{phase:"after"})),!1}))):(e("#layout_"+this.name+"_panel_top").hide(),e("#layout_"+this.name+"_resizer_top").hide()),null!=g&&!0!==g.hidden?(o=0,l=0+(_?w.sizeCalculated+this.padding:0),d=g.sizeCalculated,u=r-(_?w.sizeCalculated+this.padding:0)-(k?v.sizeCalculated+this.padding:0),c=e("#layout_"+this.name+"_panel_left"),-1!=window.navigator.userAgent.indexOf("MSIE")&&c.length>0&&c[0].clientHeight<c[0].scrollHeight&&(d+=17),c.css({display:"block",left:o+"px",top:l+"px",width:d+"px",height:u+"px"}).show(),g.width=d,g.height=u,g.resizable&&(o=g.sizeCalculated-(0===this.padding?this.resizer:0),d=this.resizer>this.padding?this.resizer:this.padding,e("#layout_"+this.name+"_resizer_left").show().css({display:"block",left:o+"px",top:l+"px",width:d+"px",height:u+"px",cursor:"ew-resize"}).off("mousedown").on("mousedown",function(t){var i=h.trigger({phase:"before",type:"resizerClick",target:"left",originalEvent:t});if(!0!==i.isCancelled)return w2ui[h.name].tmp.events.resizeStart("left",t),h.trigger(e.extend(i,{phase:"after"})),!1}))):(e("#layout_"+this.name+"_panel_left").hide(),e("#layout_"+this.name+"_resizer_left").hide()),null!=m&&!0!==m.hidden?(o=a-m.sizeCalculated,l=0+(_?w.sizeCalculated+this.padding:0),d=m.sizeCalculated,u=r-(_?w.sizeCalculated+this.padding:0)-(k?v.sizeCalculated+this.padding:0),e("#layout_"+this.name+"_panel_right").css({display:"block",left:o+"px",top:l+"px",width:d+"px",height:u+"px"}).show(),m.width=d,m.height=u,m.resizable&&(o-=this.padding,d=this.resizer>this.padding?this.resizer:this.padding,e("#layout_"+this.name+"_resizer_right").show().css({display:"block",left:o+"px",top:l+"px",width:d+"px",height:u+"px",cursor:"ew-resize"}).off("mousedown").on("mousedown",function(t){var i=h.trigger({phase:"before",type:"resizerClick",target:"right",originalEvent:t});if(!0!==i.isCancelled)return w2ui[h.name].tmp.events.resizeStart("right",t),h.trigger(e.extend(i,{phase:"after"})),!1}))):(e("#layout_"+this.name+"_panel_right").hide(),e("#layout_"+this.name+"_resizer_right").hide()),null!=v&&!0!==v.hidden?(o=0,l=r-v.sizeCalculated,d=a,u=v.sizeCalculated,e("#layout_"+this.name+"_panel_bottom").css({display:"block",left:o+"px",top:l+"px",width:d+"px",height:u+"px"}).show(),v.width=d,v.height=u,v.resizable&&(l-=0===this.padding?0:this.padding,u=this.resizer>this.padding?this.resizer:this.padding,e("#layout_"+this.name+"_resizer_bottom").show().css({display:"block",left:o+"px",top:l+"px",width:d+"px",height:u+"px",cursor:"ns-resize"}).off("mousedown").on("mousedown",function(t){var i=h.trigger({phase:"before",type:"resizerClick",target:"bottom",originalEvent:t});if(!0!==i.isCancelled)return w2ui[h.name].tmp.events.resizeStart("bottom",t),h.trigger(e.extend(i,{phase:"after"})),!1}))):(e("#layout_"+this.name+"_panel_bottom").hide(),e("#layout_"+this.name+"_resizer_bottom").hide()),o=0+(b?g.sizeCalculated+this.padding:0),l=0+(_?w.sizeCalculated+this.padding:0),d=a-(b?g.sizeCalculated+this.padding:0)-(x?m.sizeCalculated+this.padding:0),u=r-(_?w.sizeCalculated+this.padding:0)-(k?v.sizeCalculated+this.padding:0)-(y?f.sizeCalculated+this.padding:0),c=e("#layout_"+this.name+"_panel_main"),-1!=window.navigator.userAgent.indexOf("MSIE")&&c.length>0&&c[0].clientHeight<c[0].scrollHeight&&(d+=17),c.css({display:"block",left:o+"px",top:l+"px",width:d+"px",height:u+"px"}),p.width=d,p.height=u,null!=f&&!0!==f.hidden?(o=0+(b?g.sizeCalculated+this.padding:0),l=r-(k?v.sizeCalculated+this.padding:0)-f.sizeCalculated,d=a-(b?g.sizeCalculated+this.padding:0)-(x?m.sizeCalculated+this.padding:0),u=f.sizeCalculated,c=e("#layout_"+this.name+"_panel_preview"),-1!=window.navigator.userAgent.indexOf("MSIE")&&c.length>0&&c[0].clientHeight<c[0].scrollHeight&&(d+=17),c.css({display:"block",left:o+"px",top:l+"px",width:d+"px",height:u+"px"}).show(),f.width=d,f.height=u,f.resizable&&(l-=0===this.padding?0:this.padding,u=this.resizer>this.padding?this.resizer:this.padding,e("#layout_"+this.name+"_resizer_preview").show().css({display:"block",left:o+"px",top:l+"px",width:d+"px",height:u+"px",cursor:"ns-resize"}).off("mousedown").on("mousedown",function(t){var i=h.trigger({phase:"before",type:"resizerClick",target:"preview",originalEvent:t});if(!0!==i.isCancelled)return w2ui[h.name].tmp.events.resizeStart("preview",t),h.trigger(e.extend(i,{phase:"after"})),!1}))):(e("#layout_"+this.name+"_panel_preview").hide(),e("#layout_"+this.name+"_resizer_preview").hide());for(var S=0;S<i.length;S++){var D=this.get(i[S]),z="#layout_"+this.name+"_panel_"+i[S]+" > .w2ui-panel-",O=0;D&&(D.title&&(O+=w2utils.getSize(e(z+"title").css({top:O+"px",display:"block"}),"height")),D.show.tabs&&(null!=D.tabs&&w2ui[this.name+"_"+i[S]+"_tabs"]&&w2ui[this.name+"_"+i[S]+"_tabs"].resize(),O+=w2utils.getSize(e(z+"tabs").css({top:O+"px",display:"block"}),"height")),D.show.toolbar&&(null!=D.toolbar&&w2ui[this.name+"_"+i[S]+"_toolbar"]&&w2ui[this.name+"_"+i[S]+"_toolbar"].resize(),O+=w2utils.getSize(e(z+"toolbar").css({top:O+"px",display:"block"}),"height"))),e(z+"content").css({display:"block"}).css({top:O+"px"})}return clearTimeout(this._resize_timer),this._resize_timer=setTimeout(function(){for(var t in w2ui)if("function"==typeof w2ui[t].resize){null==w2ui[t].panels&&w2ui[t].resize();var i=e(w2ui[t].box).parents(".w2ui-layout");i.length>0&&i.attr("name")==h.name&&w2ui[t].resize()}},100),this.trigger(e.extend(n,{phase:"after"})),(new Date).getTime()-t}},destroy:function(){var t=this.trigger({phase:"before",type:"destroy",target:this.name});if(!0!==t.isCancelled)return null!=w2ui[this.name]&&(e(this.box).find("#layout_"+this.name+"_panel_main").length>0&&e(this.box).removeAttr("name").removeClass("w2ui-layout").html(""),delete w2ui[this.name],this.trigger(e.extend(t,{phase:"after"})),this.tmp.events&&this.tmp.events.resize&&e(window).off("resize",this.tmp.events.resize),!0)},lock:function(e,t,s){if(-1!=i.indexOf(e)){var n=Array.prototype.slice.call(arguments,0);n[0]="#layout_"+this.name+"_panel_"+e,w2utils.lock.apply(window,n)}else console.log("ERROR: First parameter needs to be the a valid panel name.")},unlock:function(e,t){if(-1!=i.indexOf(e)){var s="#layout_"+this.name+"_panel_"+e;w2utils.unlock(s,t)}else console.log("ERROR: First parameter needs to be the a valid panel name.")}},e.extend(t.prototype,w2utils.event),w2obj.layout=t}(jQuery);var w2popup={};!function(e){e.fn.w2popup=function(t,i){null==t&&(i={},t="open"),e.isPlainObject(t)&&(i=t,t="open"),"load"===(t=t.toLowerCase())&&"string"==typeof i&&(i=e.extend({url:i},arguments.length>2?arguments[2]:{})),"open"===t&&null!=i.url&&(t="load"),i=i||{};var s={};if(e(this).length>0&&"open"==t){if(e(this).find("div[rel=title], div[rel=body], div[rel=buttons]").length>0){if(e("#w2ui-popup").length>0){var n=e("#w2ui-popup").data("options");w2popup._prev={template:w2popup._template,title:n.title,body:n.body,buttons:n.buttons}}w2popup._template=this,e(this).find("div[rel=title]").length>0&&(s.title=e(this).find("div[rel=title]")),e(this).find("div[rel=body]").length>0&&(s.body=e(this).find("div[rel=body]"),s.style=e(this).find("div[rel=body]")[0].style.cssText),e(this).find("div[rel=buttons]").length>0&&(s.buttons=e(this).find("div[rel=buttons]"))}else s.title="&#160;",s.body=e(this).html();0!==parseInt(e(this).css("width"))&&(s.width=parseInt(e(this).css("width"))),0!==parseInt(e(this).css("height"))&&(s.height=parseInt(e(this).css("height")))}return w2popup[t](e.extend({},s,i))},w2popup={defaults:{title:"",body:"",buttons:"",style:"",color:"#000",opacity:.4,speed:.3,modal:!1,maximized:!1,keyboard:!0,width:500,height:300,showClose:!0,showMax:!1,transition:null},status:"closed",handlers:[],onOpen:null,onClose:null,onMax:null,onMin:null,onToggle:null,onKeydown:null,open:function(t){function i(t){return t||(t=window.event),w2popup.status="moving",m.resizing=!0,m.isLocked=1==e("#w2ui-popup > .w2ui-lock").length,m.x=t.screenX,m.y=t.screenY,m.pos_x=e("#w2ui-popup").position().left,m.pos_y=e("#w2ui-popup").position().top,m.isLocked||w2popup.lock({opacity:0}),e(document).on("mousemove",m.mvMove),e(document).on("mouseup",m.mvStop),t.stopPropagation?t.stopPropagation():t.cancelBubble=!0,!!t.preventDefault&&void t.preventDefault()}var s=this;if("closing"!=w2popup.status){var n=e("#w2ui-popup").data("options"),t=e.extend({},this.defaults,n,{title:"",body:"",buttons:""},t,{maximized:!1});setTimeout(function(){e("#w2ui-popup").data("options",t)},100),0===e("#w2ui-popup").length&&(w2popup.onMax=null,w2popup.onMin=null,w2popup.onToggle=null,w2popup.onOpen=null,w2popup.onClose=null,w2popup.onKeydown=null),t.onOpen&&(w2popup.onOpen=t.onOpen),t.onClose&&(w2popup.onClose=t.onClose),t.onMax&&(w2popup.onMax=t.onMax),t.onMin&&(w2popup.onMin=t.onMin),t.onToggle&&(w2popup.onToggle=t.onToggle),t.onKeydown&&(w2popup.onKeydown=t.onKeydown),t.width=parseInt(t.width),t.height=parseInt(t.height);var a,r;void 0==window.innerHeight?(a=parseInt(document.documentElement.offsetWidth),r=parseInt(document.documentElement.offsetHeight),"IE7"===w2utils.engine&&(a+=21,r+=4)):(a=parseInt(window.innerWidth),r=parseInt(window.innerHeight)),a-10<t.width&&(t.width=a-10),r-10<t.height&&(t.height=r-10);var o=(r-t.height)/2*.6,l=(a-t.width)/2;if(0===e("#w2ui-popup").length){if(!0===(h=this.trigger({phase:"before",type:"open",target:"popup",options:t,present:!1})).isCancelled)return;w2popup.status="opening",w2popup.lockScreen(t);var d="";t.showClose&&(d+='<div class="w2ui-popup-button w2ui-popup-close" onmousedown="event.stopPropagation()" onclick="w2popup.close()">Close</div>'),t.showMax&&(d+='<div class="w2ui-popup-button w2ui-popup-max" onmousedown="event.stopPropagation()" onclick="w2popup.toggle()">Max</div>');c='<div id="w2ui-popup" class="w2ui-popup" style="opacity: 0; left: '+l+"px; top: "+o+"px;     width: "+parseInt(t.width)+"px; height: "+parseInt(t.height)+"px; "+w2utils.cssPrefix("transform","scale(0.8)",!0)+'"></div>';e("body").append(c);var u=e("#w2ui-popup");u.find("div[rel=title], div[rel=body], div[rel=buttons]").length>0&&((m=u.find("div[rel=title]")).length>0&&(t.title=m.html(),m.remove()),(m=u.find("div[rel=buttons]")).length>0&&(t.buttons=m.html(),m.remove()),(m=u.find("div[rel=body]")).length>0?t.body=m.html():t.body=u.html());var c='<div class="w2ui-popup-title" style="'+(t.title?"":"display: none")+'">'+d+'</div><div class="w2ui-box" style="'+(t.title?"":"top: 0px !important;")+(t.buttons?"":"bottom: 0px !important;")+'">    <div class="w2ui-popup-body'+(""!==!t.title?" w2ui-popup-no-title":"")+(t.buttons?"":" w2ui-popup-no-buttons")+'" style="'+t.style+'">    </div></div><div class="w2ui-popup-buttons" style="'+(t.buttons?"":"display: none")+'"></div><input class="w2ui-popup-hidden" style="position: absolute; top: -100px"/>';e("#w2ui-popup").html(c),t.title&&e("#w2ui-popup .w2ui-popup-title").append(t.title),t.buttons&&e("#w2ui-popup .w2ui-popup-buttons").append(t.buttons),t.body&&e("#w2ui-popup .w2ui-popup-body").append(t.body),setTimeout(function(){e("#w2ui-popup").css("opacity","1").css(w2utils.cssPrefix({transition:t.speed+"s opacity, "+t.speed+"s -webkit-transform",transform:"scale(1)"})),s.focus()},1),setTimeout(function(){e("#w2ui-popup").css(w2utils.cssPrefix("transform","")),w2popup.status="open",setTimeout(function(){s.trigger(e.extend(h,{phase:"after"}))},100)},1e3*t.speed)}else{null==w2popup._prev&&null!=w2popup._template&&s.restoreTemplate();var h=this.trigger({phase:"before",type:"open",target:"popup",options:t,present:!0});if(!0===h.isCancelled)return;w2popup.status="opening",null!=n&&(n.maximized||n.width==t.width&&n.height==t.height||w2popup.resize(t.width,t.height),t.prevSize=t.width+"px:"+t.height+"px",t.maximized=n.maximized);var p=e("#w2ui-popup .w2ui-box").clone();p.removeClass("w2ui-box").addClass("w2ui-box-temp").find(".w2ui-popup-body").empty().append(t.body),"string"==typeof t.body&&p.find("div[rel=title], div[rel=body], div[rel=buttons]").length>0&&((m=p.find("div[rel=title]")).length>0&&(t.title=m.html(),m.remove()),(m=p.find("div[rel=buttons]")).length>0&&(t.buttons=m.html(),m.remove()),(m=p.find("div[rel=body]")).length>0?t.body=m.html():t.body=p.html(),p.html(t.body)),e("#w2ui-popup .w2ui-box").after(p),t.buttons?(e("#w2ui-popup .w2ui-popup-buttons").show().html("").append(t.buttons),e("#w2ui-popup .w2ui-popup-body").removeClass("w2ui-popup-no-buttons"),e("#w2ui-popup .w2ui-box, #w2ui-popup .w2ui-box-temp").css("bottom","")):(e("#w2ui-popup .w2ui-popup-buttons").hide().html(""),e("#w2ui-popup .w2ui-popup-body").addClass("w2ui-popup-no-buttons"),e("#w2ui-popup .w2ui-box, #w2ui-popup .w2ui-box-temp").css("bottom","0px")),t.title?(e("#w2ui-popup .w2ui-popup-title").show().html((t.showClose?'<div class="w2ui-popup-button w2ui-popup-close" onmousedown="event.stopPropagation()" onclick="w2popup.close()">Close</div>':"")+(t.showMax?'<div class="w2ui-popup-button w2ui-popup-max" onmousedown="event.stopPropagation()" onclick="w2popup.toggle()">Max</div>':"")).append(t.title),e("#w2ui-popup .w2ui-popup-body").removeClass("w2ui-popup-no-title"),e("#w2ui-popup .w2ui-box, #w2ui-popup .w2ui-box-temp").css("top","")):(e("#w2ui-popup .w2ui-popup-title").hide().html(""),e("#w2ui-popup .w2ui-popup-body").addClass("w2ui-popup-no-title"),e("#w2ui-popup .w2ui-box, #w2ui-popup .w2ui-box-temp").css("top","0px"));var f=e("#w2ui-popup .w2ui-box")[0],g=e("#w2ui-popup .w2ui-box-temp")[0];w2utils.transition(f,g,t.transition,function(){s.restoreTemplate(),e(f).remove(),e(g).removeClass("w2ui-box-temp").addClass("w2ui-box");var i=e(g).find(".w2ui-popup-body");1==i.length&&(i[0].style.cssText=t.style),e("#w2ui-popup").data("prev-size",null),s.focus(),w2popup.status="open",s.trigger(e.extend(h,{phase:"after"}))})}t._last_focus=e(":focus"),t.keyboard&&e(document).on("keydown",this.keydown);var m={resizing:!1,mvMove:function(t){1==m.resizing&&(t||(t=window.event),m.div_x=t.screenX-m.x,m.div_y=t.screenY-m.y,e("#w2ui-popup").css(w2utils.cssPrefix({transition:"none",transform:"translate3d("+m.div_x+"px, "+m.div_y+"px, 0px)"})))},mvStop:function(t){1==m.resizing&&(t||(t=window.event),w2popup.status="open",m.div_x=t.screenX-m.x,m.div_y=t.screenY-m.y,e("#w2ui-popup").css({left:m.pos_x+m.div_x+"px",top:m.pos_y+m.div_y+"px"}).css(w2utils.cssPrefix({transition:"none",transform:"translate3d(0px, 0px, 0px)"})),m.resizing=!1,e(document).off("mousemove",m.mvMove),e(document).off("mouseup",m.mvStop),m.isLocked||w2popup.unlock())}};return e("#w2ui-popup .w2ui-popup-title").on("mousedown",function(e){w2popup.get().maximized||i(e)}),this}setTimeout(function(){s.open.call(s,t)},100)},keydown:function(t){var i=e("#w2ui-popup").data("options");if(!i||i.keyboard){var s=w2popup.trigger({phase:"before",type:"keydown",target:"popup",options:i,originalEvent:t});if(!0!==s.isCancelled){switch(t.keyCode){case 27:t.preventDefault(),e("#w2ui-popup .w2ui-message").length>0?w2popup.message():w2popup.close()}w2popup.trigger(e.extend(s,{phase:"after"}))}}},close:function(t){var i=this,t=e.extend({},e("#w2ui-popup").data("options"),t);if(0!==e("#w2ui-popup").length&&"closed"!=this.status){if("opening"==this.status)return void setTimeout(function(){w2popup.close()},100);var s=this.trigger({phase:"before",type:"close",target:"popup",options:t});!0!==s.isCancelled&&(w2popup.status="closing",e("#w2ui-popup").css("opacity","0").css(w2utils.cssPrefix({transition:t.speed+"s opacity, "+t.speed+"s -webkit-transform",transform:"scale(0.9)"})),w2popup.unlockScreen(t),setTimeout(function(){i.restoreTemplate(),e("#w2ui-popup").remove(),w2popup.status="closed",t._last_focus.length>0&&t._last_focus.focus(),i.trigger(e.extend(s,{phase:"after"}))},1e3*t.speed),t.keyboard&&e(document).off("keydown",this.keydown))}},toggle:function(){var t=this,i=e("#w2ui-popup").data("options"),s=this.trigger({phase:"before",type:"toggle",target:"popup",options:i});!0!==s.isCancelled&&(!0===i.maximized?w2popup.min():w2popup.max(),setTimeout(function(){t.trigger(e.extend(s,{phase:"after"}))},1e3*i.speed+50))},max:function(){var t=this,i=e("#w2ui-popup").data("options");if(!0!==i.maximized){var s=this.trigger({phase:"before",type:"max",target:"popup",options:i});!0!==s.isCancelled&&(w2popup.status="resizing",i.prevSize=e("#w2ui-popup").css("width")+":"+e("#w2ui-popup").css("height"),w2popup.resize(1e4,1e4,function(){w2popup.status="open",i.maximized=!0,t.trigger(e.extend(s,{phase:"after"})),e("#w2ui-popup .w2ui-grid, #w2ui-popup .w2ui-form, #w2ui-popup .w2ui-layout").each(function(){var t=e(this).attr("name");w2ui[t]&&w2ui[t].resize&&w2ui[t].resize()})}))}},min:function(){var t=this,i=e("#w2ui-popup").data("options");if(!0===i.maximized){var s=i.prevSize.split(":"),n=this.trigger({phase:"before",type:"min",target:"popup",options:i});!0!==n.isCancelled&&(w2popup.status="resizing",w2popup.resize(parseInt(s[0]),parseInt(s[1]),function(){w2popup.status="open",i.maximized=!1,i.prevSize=null,t.trigger(e.extend(n,{phase:"after"})),e("#w2ui-popup .w2ui-grid, #w2ui-popup .w2ui-form, #w2ui-popup .w2ui-layout").each(function(){var t=e(this).attr("name");w2ui[t]&&w2ui[t].resize&&w2ui[t].resize()})}))}},get:function(){return e("#w2ui-popup").data("options")},set:function(e){w2popup.open(e)},clear:function(){e("#w2ui-popup .w2ui-popup-title").html(""),e("#w2ui-popup .w2ui-popup-body").html(""),e("#w2ui-popup .w2ui-popup-buttons").html("")},reset:function(){w2popup.open(w2popup.defaults)},load:function(t){function i(i,s){if(delete t.url,e("body").append('<div id="w2ui-tmp" style="display: none">'+i+"</div>"),null!=s&&e("#w2ui-tmp #"+s).length>0?e("#w2ui-tmp #"+s).w2popup(t):e("#w2ui-tmp > div").w2popup(t),e("#w2ui-tmp > style").length>0){var n=e("<div>").append(e("#w2ui-tmp > style").clone()).html();0===e("#w2ui-popup #div-style").length&&e("#w2ui-popup").append('<div id="div-style" style="position: absolute; left: -100; width: 1px"></div>'),e("#w2ui-popup #div-style").html(n)}e("#w2ui-tmp").remove()}if(w2popup.status="loading",null!=t.url){var s=String(t.url).split("#"),n=s[0],a=s[1];null==t&&(t={});var r=e("#w2ui-popup").data(n);null!=r?i(r,a):e.get(n,function(t,s,r){i(r.responseText,a),e("#w2ui-popup").data(n,r.responseText)})}else console.log("ERROR: The url parameter is empty.")},message:function(t){var i=this;e().w2tag(),t||(t={width:200,height:100});var s=parseInt(e("#w2ui-popup").width()),n=parseInt(e("#w2ui-popup").height());t.originalWidth=t.width,t.originalHeight=t.height,parseInt(t.width)<10&&(t.width=10),parseInt(t.height)<10&&(t.height=10),null==t.hideOnClick&&(t.hideOnClick=!1);var a=e("#w2ui-popup").data("options")||{},r=parseInt(e("#w2ui-popup > .w2ui-popup-title").css("height"));(null==t.width||t.width>a.width-10)&&(t.width=a.width-10),(null==t.height||t.height>a.height-r-5)&&(t.height=a.height-r-5),t.originalHeight<0&&(t.height=n+t.originalHeight-r),t.originalWidth<0&&(t.width=s+2*t.originalWidth);var o=e("#w2ui-popup .w2ui-popup-title"),l=e("#w2ui-popup .w2ui-message").length;if(""===e.trim(t.html)&&""===e.trim(t.body)&&""===e.trim(t.buttons)){var d=e("#w2ui-popup #w2ui-message"+(l-1)),t=d.data("options")||{};d.css(w2utils.cssPrefix({transition:"0.15s",transform:"translateY(-"+t.height+"px)"})),1==l?w2popup.unlock(150):e("#w2ui-popup #w2ui-message"+(l-2)).css("z-index",1500),setTimeout(function(){var e=d.data("prev_focus");d.remove(),e&&e.length>0?e.focus():i.focus(),"function"==typeof t.onClose&&t.onClose()},150)}else{""===e.trim(t.body)&&""===e.trim(t.buttons)||(t.html='<div class="w2ui-message-body">'+t.body+'</div><div class="w2ui-message-buttons">'+t.buttons+"</div>"),e("#w2ui-popup .w2ui-message").css("z-index",1390),o.css("z-index",1501),e("#w2ui-popup .w2ui-box").before('<div id="w2ui-message'+l+'" class="w2ui-message" style="display: none; z-index: 1500; '+(0===o.length?"top: 0px;":"top: "+w2utils.getSize(o,"height")+"px;")+(null!=t.width?"width: "+t.width+"px; left: "+(s-t.width)/2+"px;":"left: 10px; right: 10px;")+(null!=t.height?"height: "+t.height+"px;":"bottom: 6px;")+w2utils.cssPrefix("transition",".3s",!0)+'"'+(!0===t.hideOnClick?'onclick="w2popup.message();"':"")+"></div>"),e("#w2ui-popup #w2ui-message"+l).data("options",t).data("prev_focus",e(":focus"));var u=e("#w2ui-popup #w2ui-message"+l).css("display");e("#w2ui-popup #w2ui-message"+l).css(w2utils.cssPrefix({transform:"none"==u?"translateY(-"+t.height+"px)":"translateY(0px)"})),"none"==u&&(e("#w2ui-popup #w2ui-message"+l).show().html(t.html),setTimeout(function(){e("#w2ui-popup #w2ui-message"+l).css(w2utils.cssPrefix({transform:"none"==u?"translateY(0px)":"translateY(-"+t.height+"px)"}))},1),0===l&&w2popup.lock(),setTimeout(function(){i.focus(),e("#w2ui-popup #w2ui-message"+l).css(w2utils.cssPrefix({transition:"0s"})),"function"==typeof t.onOpen&&t.onOpen()},350))}},focus:function(){var t=null,i=e("#w2ui-popup"),s="input:visible, button:visible, select:visible, textarea:visible";e(i).find(s).off(".keep-focus");var n=e("#w2ui-popup .w2ui-message").length-1,a=e("#w2ui-popup #w2ui-message"+n);if(a.length>0)(r=e(a[a.length-1]).find("button")).length>0&&r[0].focus(),t=a;else if(i.length>0){var r=i.find(".w2ui-popup-buttons button");r.length>0&&r[0].focus(),t=i}e(t).find(s).on("blur.keep-focus",function(i){setTimeout(function(){var i=e(":focus");if(i.length>0&&!e(t).find(s).is(i)||i.hasClass("w2ui-popup-hidden")){var n=e(t).find(s);n.length>0&&n[0].focus()}},1)})},lock:function(t,i){var s=Array.prototype.slice.call(arguments,0);s.unshift(e("#w2ui-popup")),w2utils.lock.apply(window,s)},unlock:function(t){w2utils.unlock(e("#w2ui-popup"),t)},lockScreen:function(t){return!(e("#w2ui-lock").length>0||(null==t&&(t=e("#w2ui-popup").data("options")),null==t&&(t={}),t=e.extend({},w2popup.defaults,t),e("body").append('<div id="w2ui-lock"     onmousewheel="if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true; if (event.preventDefault) event.preventDefault(); else return false;"    style="position: '+("IE5"==w2utils.engine?"absolute":"fixed")+"; z-Index: 1199; left: 0px; top: 0px;            padding: 0px; margin: 0px; background-color: "+t.color+'; width: 100%; height: 100%; opacity: 0;"></div>'),setTimeout(function(){e("#w2ui-lock").css("opacity",t.opacity).css(w2utils.cssPrefix("transition",t.speed+"s opacity"))},1),1==t.modal?(e("#w2ui-lock").on("mousedown",function(){e("#w2ui-lock").css("opacity","0.6").css(w2utils.cssPrefix("transition",".1s"))}),e("#w2ui-lock").on("mouseup",function(){setTimeout(function(){e("#w2ui-lock").css("opacity",t.opacity).css(w2utils.cssPrefix("transition",".1s"))},100)})):e("#w2ui-lock").on("mousedown",function(){w2popup.close()}),0))},unlockScreen:function(t){return 0!==e("#w2ui-lock").length&&(null==t&&(t=e("#w2ui-popup").data("options")),null==t&&(t={}),t=e.extend({},w2popup.defaults,t),e("#w2ui-lock").css("opacity","0").css(w2utils.cssPrefix("transition",t.speed+"s opacity")),setTimeout(function(){e("#w2ui-lock").remove()},1e3*t.speed),!0)},resizeMessages:function(){e("#w2ui-popup").data("options"),e("#w2ui-popup .w2ui-message").each(function(){var t=e(this).data("options"),i=e("#w2ui-popup");parseInt(t.width)<10&&(t.width=10),parseInt(t.height)<10&&(t.height=10);var s=parseInt(i.find("> .w2ui-popup-title").css("height")),n=parseInt(i.width()),a=parseInt(i.height());t.width=t.originalWidth,t.width>n-10&&(t.width=n-10),t.height=t.originalHeight,t.height>a-s-5&&(t.height=a-s-5),t.originalHeight<0&&(t.height=a+t.originalHeight-s),t.originalWidth<0&&(t.width=n+2*t.originalWidth),e(this).css({left:(n-t.width)/2+"px",width:t.width+"px",height:t.height+"px"})})},resize:function(t,i,s){var n=this,a=e("#w2ui-popup").data("options");t=parseInt(t),i=parseInt(i);var r,o;void 0==window.innerHeight?(r=parseInt(document.documentElement.offsetWidth),o=parseInt(document.documentElement.offsetHeight),"IE7"===w2utils.engine&&(r+=21,o+=4)):(r=parseInt(window.innerWidth),o=parseInt(window.innerHeight)),r-10<t&&(t=r-10),o-10<i&&(i=o-10);var l=(o-i)/2*.6,d=(r-t)/2;e("#w2ui-popup").css(w2utils.cssPrefix({transition:a.speed+"s width, "+a.speed+"s height, "+a.speed+"s left, "+a.speed+"s top"})).css({top:l,left:d,width:t,height:i});var u=setInterval(function(){n.resizeMessages()},10);setTimeout(function(){clearInterval(u),a.width=t,a.height=i,n.resizeMessages(),"function"==typeof s&&s()},1e3*a.speed+50)},restoreTemplate:function(){var t=e("#w2ui-popup").data("options");if(null!=t){var i=w2popup._template,s=t.title,n=t.body,a=t.buttons;if(w2popup._prev?(i=w2popup._prev.template,s=w2popup._prev.title,n=w2popup._prev.body,a=w2popup._prev.buttons,delete w2popup._prev):delete w2popup._template,null!=i){var r=e(i);if(0===r.length)return;"body"==e(n).attr("rel")?(s&&r.append(s),n&&r.append(n),a&&r.append(a)):r.append(n)}}}},e.extend(w2popup,w2utils.event)}(jQuery);var w2alert=function(e,t,i){var s=jQuery;return null==t&&(t=w2utils.lang("Notification")),s("#w2ui-popup").length>0&&"closing"!=w2popup.status?w2popup.message({width:400,height:170,body:'<div class="w2ui-centered w2ui-alert-msg" style="font-size: 13px;">'+e+"</div>",buttons:'<button onclick="w2popup.message();" class="w2ui-popup-btn w2ui-btn">'+w2utils.lang("Ok")+"</button>",onOpen:function(){s("#w2ui-popup .w2ui-message .w2ui-popup-btn").focus()},onClose:function(){"function"==typeof i&&i()}}):w2popup.open({width:450,height:220,showMax:!1,showClose:!1,title:t,body:'<div class="w2ui-centered w2ui-alert-msg" style="font-size: 13px;">'+e+"</div>",buttons:'<button onclick="w2popup.close();" class="w2ui-popup-btn w2ui-btn">'+w2utils.lang("Ok")+"</button>",onOpen:function(e){setTimeout(function(){s("#w2ui-popup .w2ui-popup-btn").focus()},1)},onKeydown:function(e){s("#w2ui-popup .w2ui-popup-btn").focus().addClass("clicked")},onClose:function(){"function"==typeof i&&i()}}),{ok:function(e){return i=e,this},done:function(e){return i=e,this}}},w2confirm=function(e,t,i){var s=jQuery,n={},a={msg:"",title:w2utils.lang("Confirmation"),width:s("#w2ui-popup").length>0?400:450,height:s("#w2ui-popup").length>0?170:220,yes_text:"Yes",yes_class:"",yes_style:"",yes_callBack:null,no_text:"No",no_class:"",no_style:"",no_callBack:null,callBack:null};return 1==arguments.length&&"object"==typeof e?s.extend(n,a,e):"function"==typeof t?s.extend(n,a,{msg:e,callBack:t}):s.extend(n,a,{msg:e,title:t,callBack:i}),"object"==typeof n.btn_yes&&(n.yes_text=n.btn_yes.text||n.yes_text,n.yes_class=n.btn_yes.class||n.yes_class,n.yes_style=n.btn_yes.style||n.yes_style,n.yes_callBack=n.btn_yes.callBack||n.yes_callBack),"object"==typeof n.btn_no&&(n.no_text=n.btn_no.text||n.no_text,n.no_class=n.btn_no.class||n.no_class,n.no_style=n.btn_no.style||n.no_style,n.no_callBack=n.btn_no.callBack||n.no_callBack),s("#w2ui-popup").length>0&&"closing"!=w2popup.status&&w2popup.get()?(n.width>w2popup.get().width&&(n.width=w2popup.get().width),n.height>w2popup.get().height-50&&(n.height=w2popup.get().height-50),w2popup.message({width:n.width,height:n.height,body:'<div class="w2ui-centered w2ui-confirm-msg" style="font-size: 13px;">'+n.msg+"</div>",buttons:'<button id="Yes" class="w2ui-popup-btn w2ui-btn '+n.yes_class+'" style="'+n.yes_style+'">'+w2utils.lang(n.yes_text)+'</button><button id="No" class="w2ui-popup-btn w2ui-btn '+n.no_class+'" style="'+n.no_style+'">'+w2utils.lang(n.no_text)+"</button>",onOpen:function(){s("#w2ui-popup .w2ui-message .w2ui-btn").on("click.w2confirm",function(e){w2popup._confirm_btn=e.target.id,w2popup.message()})},onClose:function(){s("#w2ui-popup .w2ui-message .w2ui-btn").off("click.w2confirm"),setTimeout(function(){"function"==typeof n.callBack&&n.callBack(w2popup._confirm_btn),"Yes"==w2popup._confirm_btn&&"function"==typeof n.yes_callBack&&n.yes_callBack(),"No"==w2popup._confirm_btn&&"function"==typeof n.no_callBack&&n.no_callBack()},300)}})):(w2utils.isInt(n.height)||(n.height=n.height+50),w2popup.open({width:n.width,height:n.height,title:n.title,modal:!0,showClose:!1,body:'<div class="w2ui-centered w2ui-confirm-msg" style="font-size: 13px;">'+n.msg+"</div>",buttons:'<button id="Yes" class="w2ui-popup-btn w2ui-btn '+n.yes_class+'" style="'+n.yes_style+'">'+w2utils.lang(n.yes_text)+'</button><button id="No" class="w2ui-popup-btn w2ui-btn '+n.no_class+'" style="'+n.no_style+'">'+w2utils.lang(n.no_text)+"</button>",onOpen:function(e){setTimeout(function(){s("#w2ui-popup .w2ui-popup-btn").on("click",function(e){w2popup.close(),"function"==typeof n.callBack&&n.callBack(e.target.id),"Yes"==e.target.id&&"function"==typeof n.yes_callBack&&n.yes_callBack(),"No"==e.target.id&&"function"==typeof n.no_callBack&&n.no_callBack()}),s("#w2ui-popup .w2ui-popup-btn#Yes").focus()},1)},onKeydown:function(e){if(0===s("#w2ui-popup .w2ui-message").length)switch(e.originalEvent.keyCode){case 13:s("#w2ui-popup .w2ui-popup-btn#Yes").focus().addClass("clicked"),w2popup.close();break;case 27:s("#w2ui-popup .w2ui-popup-btn#No").focus().click(),w2popup.close()}}})),{yes:function(e){return n.yes_callBack=e,this},no:function(e){return n.no_callBack=e,this}}},w2prompt=function(e,t,i){var s=jQuery,n={},a={label:"",value:"",attrs:"",textarea:!1,title:w2utils.lang("Notification"),ok_text:w2utils.lang("Ok"),cancel_text:w2utils.lang("Cancel"),width:s("#w2ui-popup").length>0?400:450,height:s("#w2ui-popup").length>0?170:220,callBack:null};return 1==arguments.length&&"object"==typeof e?s.extend(n,a,e):"function"==typeof t?s.extend(n,a,{label:e,callBack:t}):s.extend(n,a,{label:e,title:t,callBack:i}),s("#w2ui-popup").length>0&&"closing"!=w2popup.status&&w2popup.get()?(n.width>w2popup.get().width&&(n.width=w2popup.get().width),n.height>w2popup.get().height-50&&(n.height=w2popup.get().height-50),w2popup.message({width:n.width,height:n.height,body:n.textarea?'<div class="w2ui-prompt" style="font-size: 13px; padding: 15px 10px 0 10px;">  <div style="padding-bottom: 5px">'+n.label+'</div>  <textarea id="w2prompt" '+n.attrs+"></textarea></div>":'<div class="w2ui-prompt w2ui-centered" style="font-size: 13px;">  <label style="margin-right: 10px;">'+n.label+'</label>  <input id="w2prompt" '+n.attrs+"></div>",buttons:'<button id="Ok" class="w2ui-popup-btn w2ui-btn">'+n.ok_text+'</button><button id="Cancel" class="w2ui-popup-btn w2ui-btn">'+n.cancel_text+"</button>",onOpen:function(){s("#w2prompt").val(n.value),s("#w2ui-popup .w2ui-message .w2ui-btn#Ok").on("click.w2prompt",function(e){w2popup._prompt_value=s("#w2prompt").val(),w2popup.message()}),s("#w2ui-popup .w2ui-message .w2ui-btn#Cancel").on("click.w2prompt",function(e){w2popup._prompt_value=null,w2popup.message()}),setTimeout(function(){s("#w2prompt").focus()},100)},onClose:function(){s("#w2ui-popup .w2ui-message .w2ui-btn").off("click.w2prompt"),setTimeout(function(){"function"==typeof n.callBack&&null!=w2popup._prompt_value&&n.callBack(w2popup._prompt_value)},300)}})):(w2utils.isInt(n.height)||(n.height=n.height+50),w2popup.open({width:n.width,height:n.height,title:n.title,modal:!0,showClose:!1,body:n.textarea?'<div class="w2ui-prompt" style="font-size: 13px; padding: 15px 10px 0 10px;">  <div style="padding-bottom: 5px">'+n.label+'</div>  <textarea id="w2prompt" '+n.attrs+"></textarea></div>":'<div class="w2ui-prompt w2ui-centered" style="font-size: 13px;">  <label style="margin-right: 10px;">'+n.label+'</label>  <input id="w2prompt" '+n.attrs+"></div>",buttons:'<button id="Ok" class="w2ui-popup-btn w2ui-btn">'+n.ok_text+'</button><button id="Cancel" class="w2ui-popup-btn w2ui-btn">'+n.cancel_text+"</button>",onOpen:function(e){setTimeout(function(){s("#w2prompt").val(n.value),s("#w2prompt").w2field("text"),s("#w2ui-popup .w2ui-popup-btn#Ok").on("click",function(e){w2popup._prompt_value=s("#w2prompt").val(),w2popup.close(),"function"==typeof n.callBack&&n.callBack(w2popup._prompt_value)}),s("#w2ui-popup .w2ui-popup-btn#Cancel").on("click",function(e){w2popup._prompt_value=null,w2popup.close()}),s("#w2ui-popup .w2ui-popup-btn#Ok"),setTimeout(function(){s("#w2prompt").focus()},100)},1)},onKeydown:function(e){if(0===s("#w2ui-popup .w2ui-message").length)switch(e.originalEvent.keyCode){case 13:s("#w2ui-popup .w2ui-popup-btn#Ok").focus().addClass("clicked"),w2popup.close();break;case 27:w2popup.close()}}})),{change:function(e){return s("#w2prompt").on("keyup",e).keyup(),this},ok:function(e){return n.callBack=e,this}}};!function(e){var t=function(t){this.box=null,this.name=null,this.active=null,this.flow="down",this.tooltip="top|left",this.tabs=[],this.routeData={},this.right="",this.style="",e.extend(this,{handlers:[]}),e.extend(!0,this,w2obj.tabs,t)};e.fn.w2tabs=function(i){if(e.isPlainObject(i)){if(!w2utils.checkName(i,"w2tabs"))return;for(var s=i.tabs||[],n=new t(i),a=0;a<s.length;a++)n.tabs[a]=e.extend({},t.prototype.tab,s[a]);return 0!==e(this).length&&n.render(e(this)[0]),w2ui[n.name]=n,n}var r=w2ui[e(this).attr("name")];return r?arguments.length>0?(r[i]&&r[i].apply(r,Array.prototype.slice.call(arguments,1)),this):r:null},t.prototype={onClick:null,onClose:null,onRender:null,onRefresh:null,onResize:null,onDestroy:null,tab:{id:null,text:null,route:null,hidden:!1,disabled:!1,closable:!1,tooltip:null,style:"",onClick:null,onRefresh:null,onClose:null},add:function(e){return this.insert(null,e)},insert:function(i,s){e.isArray(s)||(s=[s]);for(var n=0;n<s.length;n++){if(null==s[n].id)return void console.log('ERROR: The parameter "id" is required but not supplied. (obj: '+this.name+")");if(!w2utils.checkUniqueId(s[n].id,this.tabs,"tabs",this.name))return;var a=e.extend({},t.prototype.tab,s[n]);if(null==i)this.tabs.push(a);else{var r=this.get(i,!0);this.tabs=this.tabs.slice(0,r).concat([a],this.tabs.slice(r))}this.refresh(s[n].id),this.resize()}},remove:function(){for(var t=0,i=0;i<arguments.length;i++){var s=this.get(arguments[i]);if(!s)return!1;t++,this.tabs.splice(this.get(s.id,!0),1),e(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(s.id)).remove()}return this.resize(),t},select:function(e){return this.active!=e&&null!=this.get(e)&&(this.active=e,this.refresh(),!0)},set:function(t,i){var s=this.get(t,!0);return null!=s&&(e.extend(this.tabs[s],i),this.refresh(t),!0)},get:function(e,t){if(0===arguments.length){for(var i=[],s=0;s<this.tabs.length;s++)null!=this.tabs[s].id&&i.push(this.tabs[s].id);return i}for(var n=0;n<this.tabs.length;n++)if(this.tabs[n].id==e)return!0===t?n:this.tabs[n];return null},show:function(){for(var e=this,t=0,i=[],s=0;s<arguments.length;s++){var n=this.get(arguments[s]);n&&!1!==n.hidden&&(t++,n.hidden=!1,i.push(n.id))}return setTimeout(function(){for(var t=0;t<i.length;t++)e.refresh(i[t]);e.resize()},15),t},hide:function(){for(var e=this,t=0,i=[],s=0;s<arguments.length;s++){var n=this.get(arguments[s]);n&&!0!==n.hidden&&(t++,n.hidden=!0,i.push(n.id))}return setTimeout(function(){for(var t=0;t<i.length;t++)e.refresh(i[t]);e.resize()},15),t},enable:function(){for(var e=this,t=0,i=[],s=0;s<arguments.length;s++){var n=this.get(arguments[s]);n&&!1!==n.disabled&&(t++,n.disabled=!1,i.push(n.id))}return setTimeout(function(){for(var t=0;t<i.length;t++)e.refresh(i[t])},15),t},disable:function(){for(var e=this,t=0,i=[],s=0;s<arguments.length;s++){var n=this.get(arguments[s]);n&&!0!==n.disabled&&(t++,n.disabled=!0,i.push(n.id))}return setTimeout(function(){for(var t=0;t<i.length;t++)e.refresh(i[t])},15),t},tooltipShow:function(t,i,s){if(null!=this.tooltip){var n=e(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(t)),a=this.get(t),r=this.tooltip,o=a.tooltip;"function"==typeof o&&(o=o.call(this,a)),n.prop("_mouse_over",!0),setTimeout(function(){!0===n.prop("_mouse_over")&&!0!==n.prop("_mouse_tooltip")&&(n.prop("_mouse_tooltip",!0),n.w2tag(w2utils.lang(o),{position:r})),1==s&&n.w2tag(w2utils.lang(o),{position:r})},1)}},tooltipHide:function(t){if(null!=this.tooltip){var i=e(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(t));this.get(t),i.removeProp("_mouse_over"),setTimeout(function(){!0!==i.prop("_mouse_over")&&!0===i.prop("_mouse_tooltip")&&(i.removeProp("_mouse_tooltip"),i.w2tag())},1)}},refresh:function(t){var i=(new Date).getTime();"up"==this.flow?e(this.box).addClass("w2ui-tabs-up"):e(this.box).removeClass("w2ui-tabs-up");var s=this.trigger({phase:"before",type:"refresh",target:null!=t?t:this.name,object:this.get(t)});if(!0!==s.isCancelled){if(null==t)for(var n=0;n<this.tabs.length;n++)this.refresh(this.tabs[n].id);else{var a=this.get(t);if(null==a)return!1;null==a.text&&null!=a.caption&&(a.text=a.caption),null==a.tooltip&&null!=a.hint&&(a.tooltip=a.hint);var r=a.text;"function"==typeof r&&(r=r.call(this,a)),null==r&&(r="");var o=e(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(a.id)),l="";a.closable&&!a.disabled&&(l='<div class="w2ui-tab-close"     onmouseover = "w2ui[\''+this.name+"'].tooltipShow('"+a.id+"', event);\"    onmouseout  = \"w2ui['"+this.name+"'].tooltipHide('"+a.id+"', event);\"    onclick=\"w2ui['"+this.name+"'].animateClose('"+a.id+"', event);\"></div>");var d=l+'    <div class="w2ui-tab'+(this.active===a.id?" active":"")+(a.closable?" closable":"")+(a.class?" "+a.class:"")+'" style="'+a.style+'"         onmouseover = "'+(a.disabled?"":"w2ui['"+this.name+"'].tooltipShow('"+a.id+"', event);")+'"        onmouseout  = "'+(a.disabled?"":"w2ui['"+this.name+"'].tooltipHide('"+a.id+"', event);")+'"        onclick="w2ui[\''+this.name+"'].click('"+a.id+"', event);\">"+w2utils.lang(r)+"</div>";if(0===o.length){var u="";a.hidden&&(u+="display: none;"),a.disabled&&(u+="opacity: 0.2;");var c='<td id="tabs_'+this.name+"_tab_"+a.id+'" style="'+u+'" valign="middle">'+d+"</td>";this.get(t,!0)!==this.tabs.length-1&&e(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(this.tabs[parseInt(this.get(t,!0))+1].id)).length>0?e(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(this.tabs[parseInt(this.get(t,!0))+1].id)).before(c):e(this.box).find("#tabs_"+this.name+"_right").before(c)}else o.html(d),a.hidden?o.css("display","none"):o.css("display",""),a.disabled?o.css({opacity:"0.2"}):o.css({opacity:"1"})}return e("#tabs_"+this.name+"_right").html(this.right),this.trigger(e.extend(s,{phase:"after"})),(new Date).getTime()-i}},render:function(t){var i=(new Date).getTime(),s=this.trigger({phase:"before",type:"render",target:this.name,box:t});if(!0!==s.isCancelled){if(null!=t&&(e(this.box).find("> table #tabs_"+this.name+"_right").length>0&&e(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-tabs").html(""),this.box=t),!this.box)return!1;var n='<div class="w2ui-scroll-wrapper" onmousedown="var el=w2ui[\''+this.name+'\']; if (el) el.resize();"><table cellspacing="0" cellpadding="1" width="100%"><tbody>    <tr><td width="100%" id="tabs_'+this.name+'_right" align="right">'+this.right+'</td></tr></tbody></table></div><div class="w2ui-scroll-left" onclick="var el=w2ui[\''+this.name+"']; if (el) el.scroll('left');\"></div><div class=\"w2ui-scroll-right\" onclick=\"var el=w2ui['"+this.name+"']; if (el) el.scroll('right');\"></div>";return e(this.box).attr("name",this.name).addClass("w2ui-reset w2ui-tabs").html(n),e(this.box).length>0&&(e(this.box)[0].style.cssText+=this.style),this.trigger(e.extend(s,{phase:"after"})),this.refresh(),this.resize(),(new Date).getTime()-i}},scroll:function(t){var i,s,n,a=this,r=e(this.box).find(".w2ui-scroll-wrapper"),o=r.scrollLeft();switch(t){case"left":i=r.outerWidth(),s=r.find(":first").outerWidth(),(n=o-i+50)<=0&&(n=0),r.animate({scrollLeft:n},300);break;case"right":(n=o+(i=r.outerWidth())-50)>=(s=r.find(":first").outerWidth())-i&&(n=s-i),r.animate({scrollLeft:n},300)}setTimeout(function(){a.resize()},350)},resize:function(){var t=(new Date).getTime(),i=this.trigger({phase:"before",type:"resize",target:this.name});if(!0!==i.isCancelled){var s=e(this.box);s.find(".w2ui-scroll-left, .w2ui-scroll-right").hide();var n=s.find(".w2ui-scroll-wrapper");return n.find(":first").outerWidth()>n.outerWidth()&&(n.scrollLeft()>0&&s.find(".w2ui-scroll-left").show(),n.scrollLeft()<n.find(":first").outerWidth()-n.outerWidth()&&s.find(".w2ui-scroll-right").show()),this.trigger(e.extend(i,{phase:"after"})),(new Date).getTime()-t}},destroy:function(){var t=this.trigger({phase:"before",type:"destroy",target:this.name});!0!==t.isCancelled&&(e(this.box).find("> table #tabs_"+this.name+"_right").length>0&&e(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-tabs").html(""),delete w2ui[this.name],this.trigger(e.extend(t,{phase:"after"})))},click:function(t,i){var s=this.get(t);if(null==s||s.disabled)return!1;var n=this.trigger({phase:"before",type:"click",target:t,tab:s,object:s,originalEvent:i});if(!0!==n.isCancelled){if(e(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(this.active)+" .w2ui-tab").removeClass("active"),this.active=s.id,"string"==typeof s.route){var a=""!==s.route?String("/"+s.route).replace(/\/{2,}/g,"/"):"",r=w2utils.parseRoute(a);if(r.keys.length>0)for(var o=0;o<r.keys.length;o++)null!=this.routeData[r.keys[o].name]&&(a=a.replace(new RegExp(":"+r.keys[o].name,"g"),this.routeData[r.keys[o].name]));setTimeout(function(){window.location.hash=a},1)}this.trigger(e.extend(n,{phase:"after"})),this.refresh(t)}},animateClose:function(t,i){var s=this.get(t);if(null==s||s.disabled)return!1;var n=this.trigger({phase:"before",type:"close",target:t,object:this.get(t),originalEvent:i});if(!0!==n.isCancelled){var a=this;e(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(s.id)).css(w2utils.cssPrefix("transition",".2s")).css("opacity","0"),setTimeout(function(){var t=e(a.box).find("#tabs_"+a.name+"_tab_"+w2utils.escapeId(s.id)).width();e(a.box).find("#tabs_"+a.name+"_tab_"+w2utils.escapeId(s.id)).html('<div style="width: '+t+"px; "+w2utils.cssPrefix("transition",".2s",!0)+'"></div>'),setTimeout(function(){e(a.box).find("#tabs_"+a.name+"_tab_"+w2utils.escapeId(s.id)).find(":first-child").css({width:"0px"})},50)},200),setTimeout(function(){a.remove(t)},450),this.trigger(e.extend(n,{phase:"after"})),this.refresh()}},animateInsert:function(t,i){if(null!=this.get(t)&&e.isPlainObject(i)&&w2utils.checkUniqueId(i.id,this.tabs,"tabs",this.name)&&0===e(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(i.id)).length){null==i.text&&null!=i.caption&&(i.text=i.caption);var s='<div id="_tmp_tabs" class="w2ui-reset w2ui-tabs" style="position: absolute; top: -1000px;"><table cellspacing="0" cellpadding="1" width="100%"><tbody><tr><td id="_tmp_simple_tab" style="" valign="middle">'+(i.closable?'<div class="w2ui-tab-close"></div>':"")+'    <div class="w2ui-tab '+(this.active===i.id?"active":"")+'">'+i.text+"</div></td></tr></tbody></table></div>";e("body").append(s);var n='<div style="width: 1px; '+w2utils.cssPrefix("transition",".2s",!0)+'">&#160;</div>',a="";i.hidden&&(a+="display: none;"),i.disabled&&(a+="opacity: 0.2;");var r='<td id="tabs_'+this.name+"_tab_"+i.id+'" style="'+a+'" valign="middle">'+n+"</td>";this.get(t,!0)!==this.tabs.length&&e(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(this.tabs[parseInt(this.get(t,!0))].id)).length>0?e(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(this.tabs[parseInt(this.get(t,!0))].id)).before(r):e(this.box).find("#tabs_"+this.name+"_right").before(r);var o=this;setTimeout(function(){var t=e("#_tmp_simple_tab").width();e("#_tmp_tabs").remove(),e("#tabs_"+o.name+"_tab_"+w2utils.escapeId(i.id)+" > div").css("width",t+"px")},1),setTimeout(function(){o.insert(t,i)},200)}}},e.extend(t.prototype,w2utils.event),w2obj.tabs=t}(jQuery),function(e){var t=function(t){this.box=null,this.name=null,this.routeData={},this.items=[],this.right="",this.tooltip="top|left",e.extend(!0,this,w2obj.toolbar,t)};e.fn.w2toolbar=function(i){if(e.isPlainObject(i)){if(!w2utils.checkName(i,"w2toolbar"))return;var s=i.items||[],n=new t(i);e.extend(n,{items:[],handlers:[]});for(var a=0;a<s.length;a++)if(n.items[a]=e.extend({},t.prototype.item,s[a]),"menu-check"==n.items[a].type){r=n.items[a];if(Array.isArray(r.selected)||(r.selected=[]),Array.isArray(r.items))for(o=0;o<r.items.length;o++)(l=r.items[o]).checked&&-1==r.selected.indexOf(l.id)&&r.selected.push(l.id),l.checked||-1==r.selected.indexOf(l.id)||(l.checked=!0),null==l.checked&&(l.checked=!1)}else if("menu-radio"==n.items[a].type){var r=n.items[a];if(Array.isArray(r.items))for(var o=0;o<r.items.length;o++){var l=r.items[o];l.checked&&null==r.selected?r.selected=l.id:l.checked=!1,l.checked||r.selected!=l.id||(l.checked=!0),null==l.checked&&(l.checked=!1)}}return 0!==e(this).length&&n.render(e(this)[0]),w2ui[n.name]=n,n}var d=w2ui[e(this).attr("name")];return d?arguments.length>0?(d[i]&&d[i].apply(d,Array.prototype.slice.call(arguments,1)),this):d:null},t.prototype={onClick:null,onRender:null,onRefresh:null,onResize:null,onDestroy:null,item:{id:null,type:"button",text:null,html:"",tooltip:null,count:null,hidden:!1,disabled:!1,checked:!1,img:null,icon:null,route:null,arrow:!0,style:null,color:null,transparent:null,advanced:null,group:null,items:null,selected:null,overlay:{},onClick:null,onRefresh:null},add:function(e){this.insert(null,e)},insert:function(i,s){e.isArray(s)||(s=[s]);for(var n=0;n<s.length;n++){if(null==s[n].type)return void console.log('ERROR: The parameter "type" is required but not supplied in w2toolbar.add() method.');if(-1==e.inArray(String(s[n].type),["button","check","radio","drop","menu","menu-radio","menu-check","color","text-color","break","html","spacer"]))return void console.log('ERROR: The parameter "type" should be one of the following [button, check, radio, drop, menu, break, html, spacer] in w2toolbar.add() method.');if(null==s[n].id&&"break"!=s[n].type&&"spacer"!=s[n].type)return void console.log('ERROR: The parameter "id" is required but not supplied in w2toolbar.add() method.');if(!w2utils.checkUniqueId(s[n].id,this.items,"toolbar items",this.name))return;var a=e.extend({},t.prototype.item,s[n]);if(null==i)this.items.push(a);else{var r=this.get(i,!0);this.items=this.items.slice(0,r).concat([a],this.items.slice(r))}this.refresh(a.id),this.resize()}},remove:function(){for(var t=0,i=0;i<arguments.length;i++){var s=this.get(arguments[i]);if(s&&-1==String(arguments[i]).indexOf(":")){t++,e(this.box).find("#tb_"+this.name+"_item_"+w2utils.escapeId(s.id)).remove();var n=this.get(s.id,!0);null!=n&&this.items.splice(n,1)}}return this.resize(),t},set:function(t,i){var s=this.get(t);return null!=s&&(e.extend(s,i),this.refresh(String(t).split(":")[0]),!0)},get:function(e,t){if(0===arguments.length){for(var i=[],s=0;s<this.items.length;s++)null!=this.items[s].id&&i.push(this.items[s].id);return i}for(var n=String(e).split(":"),a=0;a<this.items.length;a++){var r=this.items[a];if(-1!=["menu","menu-radio","menu-check"].indexOf(r.type)&&2==n.length&&r.id==n[0])for(var o=0;o<r.items.length;o++){var l=r.items[o];if(l.id==n[1]||null==l.id&&l.text==n[1])return 1==t?o:l}else if(r.id==n[0])return 1==t?a:r}return null},show:function(){for(var e=this,t=0,i=[],s=0;s<arguments.length;s++){var n=this.get(arguments[s]);n&&(t++,n.hidden=!1,i.push(String(arguments[s]).split(":")[0]))}return setTimeout(function(){for(var t=0;t<i.length;t++)e.refresh(i[t]);e.resize()},15),t},hide:function(){for(var e=this,t=0,i=[],s=0;s<arguments.length;s++){var n=this.get(arguments[s]);n&&(t++,n.hidden=!0,i.push(String(arguments[s]).split(":")[0]))}return setTimeout(function(){for(var t=0;t<i.length;t++)e.refresh(i[t]),e.tooltipHide(i[t]);e.resize()},15),t},enable:function(){for(var e=this,t=0,i=[],s=0;s<arguments.length;s++){var n=this.get(arguments[s]);n&&(t++,n.disabled=!1,i.push(String(arguments[s]).split(":")[0]))}return setTimeout(function(){for(var t=0;t<i.length;t++)e.refresh(i[t])},15),t},disable:function(){for(var e=this,t=0,i=[],s=0;s<arguments.length;s++){var n=this.get(arguments[s]);n&&(t++,n.disabled=!0,i.push(String(arguments[s]).split(":")[0]))}return setTimeout(function(){for(var t=0;t<i.length;t++)e.refresh(i[t]),e.tooltipHide(i[t])},15),t},check:function(){for(var e=this,t=0,i=[],s=0;s<arguments.length;s++){var n=this.get(arguments[s]);n&&-1==String(arguments[s]).indexOf(":")&&(t++,n.checked=!0,i.push(String(arguments[s]).split(":")[0]))}return setTimeout(function(){for(var t=0;t<i.length;t++)e.refresh(i[t])},15),t},uncheck:function(){for(var t=this,i=0,s=[],n=0;n<arguments.length;n++){var a=this.get(arguments[n]);a&&-1==String(arguments[n]).indexOf(":")&&(-1!=["menu","menu-radio","menu-check","drop","color","text-color"].indexOf(a.type)&&a.checked&&setTimeout(function(){e("#tb_"+t.name+"_item_"+w2utils.escapeId(a.id)).w2overlay({name:t.name})},1),i++,a.checked=!1,s.push(String(arguments[n]).split(":")[0]))}return setTimeout(function(){for(var e=0;e<s.length;e++)t.refresh(s[e])},15),i},click:function(t,i){var s=this,n=String(t).split(":"),a=this.get(n[0]);if(n.length>1){var r=this.get(t);r&&!r.disabled&&s.menuClick({name:s.name,item:a,subItem:r,originalEvent:i})}else if(a&&!a.disabled){var o=this.trigger({phase:"before",type:"click",target:null!=t?t:this.name,item:a,object:a,originalEvent:i});if(!0===o.isCancelled)return;var l="#tb_"+this.name+"_item_"+w2utils.escapeId(a.id)+" table.w2ui-button";if(e(l).removeClass("down"),"radio"==a.type){for(var d=0;d<this.items.length;d++){var u=this.items[d];null!=u&&u.id!=a.id&&"radio"===u.type&&u.group==a.group&&u.checked&&(u.checked=!1,this.refresh(u.id))}a.checked=!0,e(l).addClass("checked")}if(-1!=["menu","menu-radio","menu-check","drop","color","text-color"].indexOf(a.type)&&(s.tooltipHide(t),a.checked?setTimeout(function(){e("#tb_"+s.name+"_item_"+w2utils.escapeId(a.id)).w2overlay({name:s.name}),a.checked=!1,s.refresh(a.id)},1):setTimeout(function(){function t(t){a.checked=!1,e(l).removeClass("checked")}var i=e("#tb_"+s.name+"_item_"+w2utils.escapeId(a.id));e.isPlainObject(a.overlay)||(a.overlay={});var n=(i.width()-50)/2;if(n>19&&(n=19),"drop"==a.type&&i.w2overlay(a.html,e.extend({name:s.name,left:n,top:3},a.overlay,{onHide:function(e){t()}})),-1!=["menu","menu-radio","menu-check"].indexOf(a.type)){var r="normal";"menu-radio"==a.type&&(r="radio",a.items.forEach(function(e){a.selected==e.id?e.checked=!0:e.checked=!1})),"menu-check"==a.type&&(r="check",a.items.forEach(function(t){e.isArray(a.selected)&&-1!=a.selected.indexOf(t.id)?t.checked=!0:t.checked=!1})),i.w2menu(e.extend({name:s.name,items:a.items,left:n,top:3},a.overlay,{type:r,select:function(e){s.menuClick({name:s.name,item:a,subItem:e.item,originalEvent:e.originalEvent,keepOpen:e.keepOpen})},onHide:function(e){t()}}))}-1!=["color","text-color"].indexOf(a.type)&&(null==a.transparent&&(a.transparent=!0),e(i).w2color({color:a.color,transparent:a.transparent,advanced:a.advanced,onHide:function(e){t(),s._tmpColor&&s.colorClick({name:s.name,item:a,color:s._tmpColor,final:!0}),delete s._tmpColor},onSelect:function(e){null!=e&&(s.colorClick({name:s.name,item:a,color:e}),s._tmpColor=e)}}))},1)),-1!=["check","menu","menu-radio","menu-check","drop","color","text-color"].indexOf(a.type)&&(a.checked=!a.checked,a.checked?e(l).addClass("checked"):e(l).removeClass("checked")),a.route){var c=String("/"+a.route).replace(/\/{2,}/g,"/"),h=w2utils.parseRoute(c);if(h.keys.length>0)for(var p=0;p<h.keys.length;p++)c=c.replace(new RegExp(":"+h.keys[p].name,"g"),this.routeData[h.keys[p].name]);setTimeout(function(){window.location.hash=c},1)}i&&-1!=["button","check","radio"].indexOf(a.type)&&this.tooltipShow(t,i,!0),this.trigger(e.extend(o,{phase:"after"}))}},scroll:function(t){var i,s,n,a=this,r=e(this.box).find(".w2ui-scroll-wrapper"),o=r.scrollLeft();switch(t){case"left":i=r.outerWidth(),s=r.find(":first").outerWidth(),(n=o-i+50)<=0&&(n=0),r.animate({scrollLeft:n},300);break;case"right":(n=o+(i=r.outerWidth())-50)>=(s=r.find(":first").outerWidth())-i&&(n=s-i),r.animate({scrollLeft:n},300)}setTimeout(function(){a.resize()},350)},render:function(t){var i=(new Date).getTime(),s=this.trigger({phase:"before",type:"render",target:this.name,box:t});if(!0!==s.isCancelled&&(null!=t&&(e(this.box).find("> table #tb_"+this.name+"_right").length>0&&e(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-toolbar").html(""),this.box=t),this.box)){for(var n='<div class="w2ui-scroll-wrapper" onmousedown="var el=w2ui[\''+this.name+'\']; if (el) el.resize();"><table cellspacing="0" cellpadding="0" width="100%"><tbody><tr>',a=0;a<this.items.length;a++){var r=this.items[a];null!=r&&(null==r.id&&(r.id="item_"+a),n+="spacer"==r.type?'<td width="100%" id="tb_'+this.name+"_item_"+r.id+'" align="right"></td>':'<td id="tb_'+this.name+"_item_"+r.id+'" style="'+(r.hidden?"display: none":"")+'"     class="'+(r.disabled?"disabled":"")+'" valign="middle"></td>')}return n+='<td width="100%" id="tb_'+this.name+'_right" align="right">'+this.right+"</td>",n+='</tr></tbody></table></div><div class="w2ui-scroll-left" onclick="var el=w2ui[\''+this.name+"']; if (el) el.scroll('left');\"></div><div class=\"w2ui-scroll-right\" onclick=\"var el=w2ui['"+this.name+"']; if (el) el.scroll('right');\"></div>",e(this.box).attr("name",this.name).addClass("w2ui-reset w2ui-toolbar").html(n),e(this.box).length>0&&(e(this.box)[0].style.cssText+=this.style),this.refresh(),this.resize(),this.trigger(e.extend(s,{phase:"after"})),(new Date).getTime()-i}},refresh:function(t){var i=(new Date).getTime(),s=this.trigger({phase:"before",type:"refresh",target:null!=t?t:this.name,item:this.get(t)});if(!0!==s.isCancelled){if(null!=t){var n=this.get(t);if(null==n)return!1;if("function"==typeof n.onRefresh){var a=this.trigger({phase:"before",type:"refresh",target:t,item:n,object:n});if(!0===a.isCancelled)return}var r=e(this.box).find("#tb_"+this.name+"_item_"+w2utils.escapeId(n.id)),o=this.getItemHTML(n);return this.tooltipHide(t,{}),0===r.length?(o="spacer"==n.type?'<td width="100%" id="tb_'+this.name+"_item_"+n.id+'" align="right"></td>':'<td id="tb_'+this.name+"_item_"+n.id+'" style="'+(n.hidden?"display: none":"")+'"     class="'+(n.disabled?"disabled":"")+'" valign="middle">'+o+"</td>",this.get(t,!0)==this.items.length-1?e(this.box).find("#tb_"+this.name+"_right").before(o):e(this.box).find("#tb_"+this.name+"_item_"+w2utils.escapeId(this.items[parseInt(this.get(t,!0))+1].id)).before(o)):(-1!=["menu","menu-radio","menu-check","drop","color","text-color"].indexOf(n.type)&&0==n.checked&&e("#w2ui-overlay-"+this.name).length>0&&e("#w2ui-overlay-"+this.name)[0].hide(),r.html(o),n.hidden?r.css("display","none"):r.css("display",""),n.disabled?r.addClass("disabled"):r.removeClass("disabled")),"function"==typeof n.onRefresh&&this.trigger(e.extend(a,{phase:"after"})),this.trigger(e.extend(s,{phase:"after"})),(new Date).getTime()-i}for(var l=0;l<this.items.length;l++){var d=this.items[l];null==d.id&&(d.id="item_"+l),this.refresh(d.id)}}},resize:function(){var t=(new Date).getTime(),i=this.trigger({phase:"before",type:"resize",target:this.name});if(!0!==i.isCancelled){var s=e(this.box);s.find(".w2ui-scroll-left, .w2ui-scroll-right").hide();var n=s.find(".w2ui-scroll-wrapper");return n.find(":first").outerWidth()>n.outerWidth()&&(n.scrollLeft()>0&&s.find(".w2ui-scroll-left").show(),n.scrollLeft()<n.find(":first").outerWidth()-n.outerWidth()&&s.find(".w2ui-scroll-right").show()),this.trigger(e.extend(i,{phase:"after"})),(new Date).getTime()-t}},destroy:function(){var t=this.trigger({phase:"before",type:"destroy",target:this.name});!0!==t.isCancelled&&(e(this.box).find("> table #tb_"+this.name+"_right").length>0&&e(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-toolbar").html(""),e(this.box).html(""),delete w2ui[this.name],this.trigger(e.extend(t,{phase:"after"})))},getItemHTML:function(e){var t="";null!=e.caption&&null==e.text&&(e.text=e.caption),null==e.text&&(e.text=""),null==e.tooltip&&null!=e.hint&&(e.tooltip=e.hint),null==e.tooltip&&(e.tooltip="");var i="<td>&#160;</td>",s=e.text;if("function"==typeof s&&(s=s.call(this,e)),e.img&&(i='<td><div class="w2ui-tb-image w2ui-icon '+e.img+'"></div></td>'),e.icon&&(i='<td><div class="w2ui-tb-image"><span class="'+e.icon+'"></span></div></td>'),""===t)switch(e.type){case"color":case"text-color":"string"==typeof e.color&&("#"==e.color.substr(0,1)&&(e.color=e.color.substr(1)),3!=e.color.length&&6!=e.color.length||(e.color="#"+e.color)),"color"==e.type&&(s='<div style="height: 12px; width: 12px; margin-top: 1px; border: 1px solid #8A8A8A; border-radius: 1px; box-shadow: 0px 0px 1px #fff;         background-color: '+(null!=e.color?e.color:"#fff")+'; float: left;"></div>'+(e.text?'<div style="margin-left: 17px;">'+w2utils.lang(e.text)+"</div>":"")),"text-color"==e.type&&(s='<div style="color: '+(null!=e.color?e.color:"#444")+';">'+(e.text?w2utils.lang(e.text):"<b>Aa</b>")+"</div>");case"menu":case"menu-check":case"menu-radio":case"button":case"check":case"radio":case"drop":t+='<table cellpadding="0" cellspacing="0"        class="w2ui-button '+(e.checked?"checked":"")+'"        onclick     = "var el=w2ui[\''+this.name+"']; if (el) el.click('"+e.id+'\', event);"        onmouseenter = "'+(e.disabled?"":"jQuery(this).addClass('over'); w2ui['"+this.name+"'].tooltipShow('"+e.id+"', event);")+'"       onmouseleave = "'+(e.disabled?"":"jQuery(this).removeClass('over').removeClass('down'); w2ui['"+this.name+"'].tooltipHide('"+e.id+"', event);")+'"       onmousedown = "'+(e.disabled?"":"jQuery(this).addClass('down');")+'"       onmouseup   = "'+(e.disabled?"":"jQuery(this).removeClass('down');")+'"><tbody><tr><td>  <table cellpadding="1" cellspacing="0"><tbody>  <tr>'+i+(""!==s?'<td class="w2ui-tb-caption" nowrap="nowrap" style="'+(e.style?e.style:"")+'">'+w2utils.lang(s)+"</td>":"")+(null!=e.count?'<td class="w2ui-tb-count" nowrap="nowrap"><span>'+e.count+"</span></td>":"")+(-1!=["menu","menu-radio","menu-check","drop","color","text-color"].indexOf(e.type)&&!1!==e.arrow?'<td class="w2ui-tb-down" nowrap="nowrap"><div></div></td>':"")+"  </tr></tbody></table></td></tr></tbody></table>";break;case"break":t+='<table cellpadding="0" cellspacing="0"><tbody><tr>    <td><div class="w2ui-break">&#160;</div></td></tr></tbody></table>';break;case"html":t+='<table cellpadding="0" cellspacing="0"><tbody><tr>    <td nowrap="nowrap">'+("function"==typeof e.html?e.html.call(this,e):e.html)+"</td></tr></tbody></table>"}return"<div>"+t+"</div>"},tooltipShow:function(t,i,s){if(null!=this.tooltip){var n=e(this.box).find("#tb_"+this.name+"_item_"+w2utils.escapeId(t)),a=this.get(t),r=this.tooltip,o=a.tooltip;"function"==typeof o&&(o=o.call(this,a)),clearTimeout(this._tooltipTimer),this._tooltipTimer=setTimeout(function(){if(!0!==n.prop("_mouse_tooltip")){if(n.prop("_mouse_tooltip",!0),-1!=["menu","menu-radio","menu-check","drop","color","text-color"].indexOf(a.type)&&1==a.checked)return;n.w2tag(w2utils.lang(o),{position:r})}},0),n.prop("_mouse_tooltip")&&1==s&&n.w2tag(w2utils.lang(o),{position:r})}},tooltipHide:function(t,i){if(null!=this.tooltip){var s=e(this.box).find("#tb_"+this.name+"_item_"+w2utils.escapeId(t));this.get(t),clearTimeout(this._tooltipTimer),setTimeout(function(){!0===s.prop("_mouse_tooltip")&&(s.removeProp("_mouse_tooltip"),s.w2tag())},1)}},menuClick:function(t){var i=this;if(t.item&&!t.item.disabled){var s=this.trigger({phase:"before",type:"click",target:t.item.id+":"+t.subItem.id,item:t.item,subItem:t.subItem,originalEvent:t.originalEvent});if(!0===s.isCancelled)return;var n=t.subItem,a=this.get(t.item.id);if("menu-radio"==a.type&&(a.selected=n.id,t.item.items.forEach(function(e){e.checked=!1}),n.checked=!0),"menu-check"==a.type)if(e.isArray(a.selected)||(a.selected=[]),null==n.group)-1==(o=a.selected.indexOf(n.id))?(a.selected.push(n.id),n.checked=!0):(a.selected.splice(o,1),n.checked=!1);else{var r=[];a.items.forEach(function(e){if(e.group===n.group){var t=a.selected.indexOf(e.id);-1!=t&&(e.id!=n.id&&r.push(e.id),a.selected.splice(t,1))}});var o=a.selected.indexOf(n.id);-1==o&&(a.selected.push(n.id),n.checked=!0)}if("string"==typeof n.route){var l=""!==n.route?String("/"+n.route).replace(/\/{2,}/g,"/"):"",d=w2utils.parseRoute(l);if(d.keys.length>0)for(var u=0;u<d.keys.length;u++)null!=i.routeData[d.keys[u].name]&&(l=l.replace(new RegExp(":"+d.keys[u].name,"g"),this.routeData[d.keys[u].name]));setTimeout(function(){window.location.hash=l},1)}this.refresh(t.item.id),this.trigger(e.extend(s,{phase:"after"}))}},colorClick:function(t){var i=this;if(t.item&&!t.item.disabled){var s=this.trigger({phase:"before",type:"click",target:t.item.id,item:t.item,color:t.color,final:t.final,originalEvent:t.originalEvent});if(!0===s.isCancelled)return;t.item.color=t.color,i.refresh(t.item.id),this.trigger(e.extend(s,{phase:"after"}))}}},e.extend(t.prototype,w2utils.event),w2obj.toolbar=t}(jQuery),function(e){var t=function(t){this.name=null,this.box=null,this.sidebar=null,this.parent=null,this.nodes=[],this.menu=[],this.routeData={},this.selected=null,this.img=null,this.icon=null,this.style="",this.topHTML="",this.bottomHTML="",this.flatButton=!1,this.keyboard=!0,this.flat=!1,this.hasFocus=!1,e.extend(!0,this,w2obj.sidebar,t)};e.fn.w2sidebar=function(i){if(e.isPlainObject(i)){if(!w2utils.checkName(i,"w2sidebar"))return;var s=i.nodes,n=new t(i);return e.extend(n,{handlers:[],nodes:[]}),null!=s&&n.add(n,s),0!==e(this).length&&n.render(e(this)[0]),n.sidebar=n,w2ui[n.name]=n,n}var a=w2ui[e(this).attr("name")];return a?arguments.length>0?(a[i]&&a[i].apply(a,Array.prototype.slice.call(arguments,1)),this):a:null},t.prototype={onClick:null,onDblClick:null,onContextMenu:null,onMenuClick:null,onExpand:null,onCollapse:null,onKeydown:null,onRender:null,onRefresh:null,onResize:null,onDestroy:null,onFocus:null,onBlur:null,onFlat:null,node:{id:null,text:"",count:null,img:null,icon:null,nodes:[],style:"",route:null,selected:!1,expanded:!1,hidden:!1,disabled:!1,group:!1,groupShowHide:!0,collapsible:!0,plus:!1,onClick:null,onDblClick:null,onContextMenu:null,onExpand:null,onCollapse:null,parent:null,sidebar:null},add:function(e,t){return 1==arguments.length&&(t=arguments[0],e=this),"string"==typeof e&&(e=this.get(e)),this.insert(e,null,t)},insert:function(i,s,n){var a,r,o,l,d;if(2==arguments.length)if(n=arguments[1],null!=(s=arguments[0])){if(null==(r=this.get(s)))return e.isArray(n)||(n=[n]),a=null!=n[0].caption?n[0].caption:n[0].text,console.log('ERROR: Cannot insert node "'+a+'" because cannot find node "'+s+'" to insert before.'),null;i=this.get(s).parent}else i=this;"string"==typeof i&&(i=this.get(i)),e.isArray(n)||(n=[n]);for(var u=0;u<n.length;u++)if(null!=typeof(l=n[u]).id)if(null==this.get(this,l.id)){if(o=e.extend({},t.prototype.node,l),o.sidebar=this,o.parent=i,d=o.nodes||[],o.nodes=[],null==s)i.nodes.push(o);else{if(null==(r=this.get(i,s,!0)))return a=null!=l.caption?l.caption:l.text,console.log('ERROR: Cannot insert node "'+a+'" because cannot find node "'+s+'" to insert before.'),null;i.nodes.splice(r,0,o)}d.length>0&&this.insert(o,null,d)}else a=null!=l.caption?l.caption:l.text,console.log("ERROR: Cannot insert node with id="+l.id+" (text: "+a+") because another node with the same id already exists.");else a=null!=l.caption?l.caption:l.text,console.log('ERROR: Cannot insert node "'+a+'" because it has no id.');return this.refresh(i.id),o},remove:function(){for(var e,t=0,i=0;i<arguments.length;i++)if(null!=(e=this.get(arguments[i]))){null!=this.selected&&this.selected===e.id&&(this.selected=null);var s=this.get(e.parent,arguments[i],!0);null!=s&&(e.parent.nodes[s].selected&&e.sidebar.unselect(e.id),e.parent.nodes.splice(s,1),t++)}return t>0&&1==arguments.length?this.refresh(e.parent.id):this.refresh(),t},set:function(t,i,s){if(2==arguments.length&&(s=i,i=t,t=this),"string"==typeof t&&(t=this.get(t)),null==t.nodes)return null;for(var n=0;n<t.nodes.length;n++){if(t.nodes[n].id===i){var a=s.nodes;return e.extend(t.nodes[n],s,{nodes:[]}),null!=a&&this.add(t.nodes[n],a),this.refresh(i),!0}if(this.set(t.nodes[n],i,s))return!0}return!1},get:function(e,t,i){if(0===arguments.length){for(var s=[],n=this.find({}),a=0;a<n.length;a++)null!=n[a].id&&s.push(n[a].id);return s}if((1==arguments.length||2==arguments.length&&!0===t)&&(i=t,t=e,e=this),"string"==typeof e&&(e=this.get(e)),null==e.nodes)return null;for(var r=0;r<e.nodes.length;r++){if(e.nodes[r].id==t)return!0===i?r:e.nodes[r];var o=this.get(e.nodes[r],t,i);if(o||0===o)return o}return null},find:function(e,t,i){if(1==arguments.length&&(t=e,e=this),i||(i=[]),"string"==typeof e&&(e=this.get(e)),null==e.nodes)return i;for(var s=0;s<e.nodes.length;s++){var n=!0;for(var a in t)e.nodes[s][a]!=t[a]&&(n=!1);n&&i.push(e.nodes[s]),e.nodes[s].nodes.length>0&&(i=this.find(e.nodes[s],t,i))}return i},hide:function(){for(var e=0,t=0;t<arguments.length;t++){var i=this.get(arguments[t]);null!=i&&(i.hidden=!0,e++)}return 1==arguments.length?this.refresh(arguments[0]):this.refresh(),e},show:function(){for(var e=0,t=0;t<arguments.length;t++){var i=this.get(arguments[t]);null!=i&&(i.hidden=!1,e++)}return 1==arguments.length?this.refresh(arguments[0]):this.refresh(),e},disable:function(){for(var e=0,t=0;t<arguments.length;t++){var i=this.get(arguments[t]);null!=i&&(i.disabled=!0,i.selected&&this.unselect(i.id),e++)}return 1==arguments.length?this.refresh(arguments[0]):this.refresh(),e},enable:function(){for(var e=0,t=0;t<arguments.length;t++){var i=this.get(arguments[t]);null!=i&&(i.disabled=!1,e++)}return 1==arguments.length?this.refresh(arguments[0]):this.refresh(),e},select:function(t){var i=this.get(t);return!(!i||this.selected==t&&i.selected||(this.unselect(this.selected),e(this.box).find("#node_"+w2utils.escapeId(t)).addClass("w2ui-selected").find(".w2ui-icon").addClass("w2ui-icon-selected"),i.selected=!0,this.selected=t,0))},unselect:function(t){0===arguments.length&&(t=this.selected);var i=this.get(t);return!!i&&(i.selected=!1,e(this.box).find("#node_"+w2utils.escapeId(t)).removeClass("w2ui-selected").find(".w2ui-icon").removeClass("w2ui-icon-selected"),this.selected==t&&(this.selected=null),!0)},toggle:function(e){var t=this.get(e);return null!=t&&(t.plus?(this.set(e,{plus:!1}),this.expand(e),void this.refresh(e)):0!==t.nodes.length&&!!t.collapsible&&(this.get(e).expanded?this.collapse(e):this.expand(e)))},collapse:function(t){var i=this,s=this.get(t),n=this.trigger({phase:"before",type:"collapse",target:t,object:s});if(!0!==n.isCancelled)return e(this.box).find("#node_"+w2utils.escapeId(t)+"_sub").slideUp(200),e(this.box).find("#node_"+w2utils.escapeId(t)+" .w2ui-node-dots:first-child").html('<div class="w2ui-expand">+</div>'),s.expanded=!1,this.trigger(e.extend(n,{phase:"after"})),setTimeout(function(){i.refresh(t)},200),!0},collapseAll:function(e){if(null==e&&(e=this),"string"==typeof e&&(e=this.get(e)),null==e.nodes)return!1;for(var t=0;t<e.nodes.length;t++)!0===e.nodes[t].expanded&&(e.nodes[t].expanded=!1),e.nodes[t].nodes&&e.nodes[t].nodes.length>0&&this.collapseAll(e.nodes[t]);return this.refresh(e.id),!0},expand:function(t){var i=this,s=this.get(t),n=this.trigger({phase:"before",type:"expand",target:t,object:s});if(!0!==n.isCancelled)return e(this.box).find("#node_"+w2utils.escapeId(t)+"_sub").slideDown(200),e(this.box).find("#node_"+w2utils.escapeId(t)+" .w2ui-node-dots:first-child").html('<div class="w2ui-expand">-</div>'),s.expanded=!0,this.trigger(e.extend(n,{phase:"after"})),setTimeout(function(){i.refresh(t)},200),!0},expandAll:function(e){if(null==e&&(e=this),"string"==typeof e&&(e=this.get(e)),null==e.nodes)return!1;for(var t=0;t<e.nodes.length;t++)!1===e.nodes[t].expanded&&(e.nodes[t].expanded=!0),e.nodes[t].nodes&&e.nodes[t].nodes.length>0&&this.expandAll(e.nodes[t]);this.refresh(e.id)},expandParents:function(e){var t=this.get(e);return null!=t&&(t.parent&&(t.parent.expanded||(t.parent.expanded=!0,this.refresh(t.parent.id)),this.expandParents(t.parent.id)),!0)},click:function(t,i){var s=this,n=this.get(t);if(null!=n&&!n.disabled&&!n.group){e(s.box).find(".w2ui-node.w2ui-selected").each(function(t,i){var n=e(i).attr("id").replace("node_",""),a=s.get(n);null!=a&&(a.selected=!1),e(i).removeClass("w2ui-selected").find(".w2ui-icon").removeClass("w2ui-icon-selected")});var a=e(s.box).find("#node_"+w2utils.escapeId(t)),r=e(s.box).find("#node_"+w2utils.escapeId(s.selected));a.addClass("w2ui-selected").find(".w2ui-icon").addClass("w2ui-icon-selected"),setTimeout(function(){var o=s.trigger({phase:"before",type:"click",target:t,originalEvent:i,node:n,object:n});if(!0===o.isCancelled)return a.removeClass("w2ui-selected").find(".w2ui-icon").removeClass("w2ui-icon-selected"),void r.addClass("w2ui-selected").find(".w2ui-icon").addClass("w2ui-icon-selected");if(null!=r&&(r.selected=!1),s.get(t).selected=!0,s.selected=t,"string"==typeof n.route){var l=""!==n.route?String("/"+n.route).replace(/\/{2,}/g,"/"):"",d=w2utils.parseRoute(l);if(d.keys.length>0)for(var u=0;u<d.keys.length;u++)null!=s.routeData[d.keys[u].name]&&(l=l.replace(new RegExp(":"+d.keys[u].name,"g"),s.routeData[d.keys[u].name]));setTimeout(function(){window.location.hash=l},1)}s.trigger(e.extend(o,{phase:"after"}))},1)}},focus:function(t){var i=this,s=this.trigger({phase:"before",type:"focus",target:this.name,originalEvent:t});return!0!==s.isCancelled&&(this.hasFocus=!0,e(this.box).find(".w2ui-selected").removeClass("w2ui-inactive"),setTimeout(function(){var t=e(i.box).find("#sidebar_"+i.name+"_focus");t.is(":focus")||t.focus()},10),void this.trigger(e.extend(s,{phase:"after"})))},blur:function(t){var i=this.trigger({phase:"before",type:"blur",target:this.name,originalEvent:t});return!0!==i.isCancelled&&(this.hasFocus=!1,e(this.box).find(".w2ui-selected").addClass("w2ui-inactive"),void this.trigger(e.extend(i,{phase:"after"})))},keydown:function(t){function i(e,t){null==e||e.hidden||e.disabled||e.group||(o.click(e.id,t),setTimeout(function(){o.scrollIntoView()},50))}function s(e,t){for(e=t(e);null!=e&&(e.hidden||e.disabled)&&!e.group;)e=t(e);return e}function n(e,t){if(null==e)return null;var i=e.parent,s=o.get(e.id,!0),a=null;if(e.expanded&&e.nodes.length>0&&!0!==t){var r=e.nodes[0];a=r.hidden||r.disabled||r.group?n(r):r}else a=i&&s+1<i.nodes.length?i.nodes[s+1]:n(i,!0);return null!=a&&(a.hidden||a.disabled||a.group)&&(a=n(a)),a}function a(e){if(null==e)return null;var t=e.parent,i=o.get(e.id,!0),s=i>0?r(t.nodes[i-1]):t;return null!=s&&(s.hidden||s.disabled||s.group)&&(s=a(s)),s}function r(e){if(e.expanded&&e.nodes.length>0){var t=e.nodes[e.nodes.length-1];return t.hidden||t.disabled||t.group?a(t):r(t)}return e}var o=this,l=o.get(o.selected);if(!0===o.keyboard){l||(l=o.nodes[0]);var d=o.trigger({phase:"before",type:"keydown",target:o.name,originalEvent:t});!0!==d.isCancelled&&(13!=t.keyCode&&32!=t.keyCode||l.nodes.length>0&&o.toggle(o.selected),37==t.keyCode&&(l.nodes.length>0&&l.expanded?o.collapse(o.selected):(i(l.parent),l.parent.group||o.collapse(l.parent.id))),39==t.keyCode&&(l.nodes.length>0||l.plus)&&!l.expanded&&o.expand(o.selected),38==t.keyCode&&i(s(l,a)),40==t.keyCode&&i(s(l,n)),-1!=e.inArray(t.keyCode,[13,32,37,38,39,40])&&(t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation()),o.trigger(e.extend(d,{phase:"after"})))}},scrollIntoView:function(t){if(null==t&&(t=this.selected),null!=this.get(t)){var i=e(this.box).find(".w2ui-sidebar-div"),s=e(this.box).find("#node_"+w2utils.escapeId(t)),n=s.offset().top-i.offset().top;(n+s.height()>i.height()||n<=0)&&i.animate({scrollTop:i.scrollTop()+n-i.height()/2+s.height()},250,"linear")}},dblClick:function(t,i){var s=this.get(t),n=this.trigger({phase:"before",type:"dblClick",target:t,originalEvent:i,object:s});!0!==n.isCancelled&&(this.toggle(t),this.trigger(e.extend(n,{phase:"after"})))},contextMenu:function(t,i){var s=this,n=s.get(t);t!=s.selected&&s.click(t);var a=s.trigger({phase:"before",type:"contextMenu",target:t,originalEvent:i,object:n,allowOnDisabled:!1});!0!==a.isCancelled&&(n.disabled&&!a.allowOnDisabled||(s.menu.length>0&&e(s.box).find("#node_"+w2utils.escapeId(t)).w2menu({items:s.menu,contextMenu:!0,originalEvent:i,onSelect:function(e){s.menuClick(t,parseInt(e.index),e.originalEvent)}}),i.preventDefault&&i.preventDefault(),s.trigger(e.extend(a,{phase:"after"}))))},menuClick:function(t,i,s){var n=this,a=n.trigger({phase:"before",type:"menuClick",target:t,originalEvent:s,menuIndex:i,menuItem:n.menu[i]});!0!==a.isCancelled&&n.trigger(e.extend(a,{phase:"after"}))},goFlat:function(){var t=this.trigger({phase:"before",type:"flat",goFlat:!this.flat});!0!==t.isCancelled&&(this.flat=!this.flat,this.refresh(),this.trigger(e.extend(t,{phase:"after"})))},render:function(t){var i=(new Date).getTime(),s=this,n=this.trigger({phase:"before",type:"render",target:this.name,box:t});if(!0!==n.isCancelled&&(null!=t&&(e(this.box).find("> div > div.w2ui-sidebar-div").length>0&&e(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-sidebar").html(""),this.box=t),this.box)){e(this.box).attr("name",this.name).addClass("w2ui-reset w2ui-sidebar").html('<div><input id="sidebar_'+this.name+'_focus" style="position: absolute; top: 0; right: 0; width: 1px; z-index: -1; opacity: 0"/><div class="w2ui-sidebar-top"></div><div class="w2ui-sidebar-div"></div><div class="w2ui-sidebar-bottom"></div></div>'),e(this.box).find("> div").css({width:e(this.box).width()+"px",height:e(this.box).height()+"px"}),e(this.box).length>0&&(e(this.box)[0].style.cssText+=this.style);var a="";1==this.flatButton&&(a='<div class="w2ui-flat-'+(this.flat?"right":"left")+'" onclick="w2ui[\''+this.name+"'].goFlat()\"></div>"),""===this.topHTML&&""===a||(e(this.box).find(".w2ui-sidebar-top").html(this.topHTML+a),e(this.box).find(".w2ui-sidebar-div").css("top",e(this.box).find(".w2ui-sidebar-top").height()+"px")),""!==this.bottomHTML&&(e(this.box).find(".w2ui-sidebar-bottom").html(this.bottomHTML),e(this.box).find(".w2ui-sidebar-div").css("bottom",e(this.box).find(".w2ui-sidebar-bottom").height()+"px"));var r;return e(this.box).find("#sidebar_"+this.name+"_focus").on("focus",function(e){clearTimeout(r),s.hasFocus||s.focus(e)}).on("blur",function(e){r=setTimeout(function(){s.hasFocus&&s.blur(e)},100)}).on("keydown",function(e){9!=e.keyCode&&w2ui[s.name].keydown.call(w2ui[s.name],e)}),e(this.box).off("mousedown").on("mousedown",function(t){setTimeout(function(){if(-1==["INPUT","TEXTAREA","SELECT"].indexOf(t.target.tagName.toUpperCase())){var i=e(s.box).find("#sidebar_"+s.name+"_focus");if(!i.is(":focus")){if(e(t.target).hasClass("w2ui-node")){var n=e(t.target).position().top+e(s.box).find(".w2ui-sidebar-top").height()+t.offsetY;i.css({top:n+"px",left:"0px"})}i.focus()}}},1)}),this.trigger(e.extend(n,{phase:"after"})),this.refresh(),(new Date).getTime()-i}},refresh:function(t){function i(e){var t="",i=e.img,s=e.icon;null==s&&null==i&&(null==s&&(s=d.icon),null==i&&(i=d.img));for(var n=e.parent,a=0;n&&null!=n.parent;)n.group&&a--,n=n.parent,a++;if(null!=e.caption&&(e.text=e.caption),e.group)t='<div class="w2ui-node-group w2ui-level-'+a+'" id="node_'+e.id+'"   onclick="w2ui[\''+d.name+"'].toggle('"+e.id+"')\"   oncontextmenu=\"w2ui['"+d.name+"'].contextMenu('"+e.id+"', event);\"   onmouseout=\"jQuery(this).find('span:nth-child(1)').css('color', 'transparent')\"    onmouseover=\"jQuery(this).find('span:nth-child(1)').css('color', 'inherit')\">"+(e.groupShowHide&&e.collapsible?"<span>"+(!e.hidden&&e.expanded?w2utils.lang("Hide"):w2utils.lang("Show"))+"</span>":"<span></span>")+("function"==typeof e.text?e.text.call(d,e):"<span>"+e.text+"</span>")+'</div><div class="w2ui-node-sub" id="node_'+e.id+'_sub" style="'+e.style+";"+(!e.hidden&&e.expanded?"":"display: none;")+'"></div>',d.flat&&(t='<div class="w2ui-node-group" id="node_'+e.id+'"><span>&#160;</span></div><div id="node_'+e.id+'_sub" style="'+e.style+";"+(!e.hidden&&e.expanded?"":"display: none;")+'"></div>');else{e.selected&&!e.disabled&&(d.selected=e.id),n="",i&&(n='<div class="w2ui-node-image w2ui-icon '+i+(e.selected&&!e.disabled?" w2ui-icon-selected":"")+'"></div>'),s&&(n='<div class="w2ui-node-image"><span class="'+s+'"></span></div>');var r=e.text;"function"==typeof e.text&&(r=e.text.call(d,e)),t='<div class="w2ui-node w2ui-level-'+a+" "+(e.selected?"w2ui-selected":"")+" "+(e.disabled?"w2ui-disabled":"")+'" id="node_'+e.id+'" style="'+(e.hidden?"display: none;":"")+'"    ondblclick="w2ui[\''+d.name+"'].dblClick('"+e.id+"', event);\"    oncontextmenu=\"w2ui['"+d.name+"'].contextMenu('"+e.id+"', event);\"    onClick=\"w2ui['"+d.name+"'].click('"+e.id+'\', event); "><table cellpadding="0" cellspacing="0" style="margin-left:'+18*a+"px; padding-right:"+18*a+'px"><tbody><tr><td class="w2ui-node-dots" nowrap="nowrap" onclick="w2ui[\''+d.name+"'].toggle('"+e.id+'\');         if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true;">    <div class="w2ui-expand">'+(e.nodes.length>0?e.expanded?"-":"+":e.plus?"+":"")+'</div></td><td class="w2ui-node-data" nowrap="nowrap">'+n+(e.count||0===e.count?'<div class="w2ui-node-count">'+e.count+"</div>":"")+'<div class="w2ui-node-caption">'+r+'</div></td></tr></tbody></table></div><div class="w2ui-node-sub" id="node_'+e.id+'_sub" style="'+e.style+";"+(!e.hidden&&e.expanded?"":"display: none;")+'"></div>',d.flat&&(t='<div class="w2ui-node w2ui-level-'+a+" "+(e.selected?"w2ui-selected":"")+" "+(e.disabled?"w2ui-disabled":"")+'" id="node_'+e.id+'" style="'+(e.hidden?"display: none;":"")+"\"    onmouseover=\"jQuery(this).find('.w2ui-node-data').w2tag(w2utils.base64decode('"+w2utils.base64encode(r+(e.count||0===e.count?' - <span class="w2ui-node-count">'+e.count+"</span>":""))+"'),                { id: '"+e.id+"', left: -5 })\"    onmouseout=\"jQuery(this).find('.w2ui-node-data').w2tag(null, { id: '"+e.id+"' })\"    ondblclick=\"w2ui['"+d.name+"'].dblClick('"+e.id+"', event);\"    oncontextmenu=\"w2ui['"+d.name+"'].contextMenu('"+e.id+"', event);\"    onClick=\"w2ui['"+d.name+"'].click('"+e.id+'\', event); "><div class="w2ui-node-data w2ui-node-flat">'+n+'</div></div><div class="w2ui-node-sub" id="node_'+e.id+'_sub" style="'+e.style+";"+(!e.hidden&&e.expanded?"":"display: none;")+'"></div>')}return t}var s=(new Date).getTime(),n=this.trigger({phase:"before",type:"refresh",target:null!=t?t:this.name,fullRefresh:null==t});if(!0!==n.isCancelled){var a="";if(1==this.flatButton&&(a='<div class="w2ui-flat-'+(this.flat?"right":"left")+'" onclick="w2ui[\''+this.name+"'].goFlat()\"></div>"),""===this.topHTML&&""===a||(e(this.box).find(".w2ui-sidebar-top").html(this.topHTML+a),e(this.box).find(".w2ui-sidebar-div").css("top",e(this.box).find(".w2ui-sidebar-top").height()+"px")),""!==this.bottomHTML&&(e(this.box).find(".w2ui-sidebar-bottom").html(this.bottomHTML),e(this.box).find(".w2ui-sidebar-div").css("bottom",e(this.box).find(".w2ui-sidebar-bottom").height()+"px")),e(this.box).find("> div").removeClass("w2ui-sidebar-flat").addClass(this.flat?"w2ui-sidebar-flat":"").css({width:e(this.box).width()+"px",height:e(this.box).height()+"px"}),this.nodes.length>0&&null==this.nodes[0].parent){c=this.nodes;this.nodes=[],this.add(this,c)}var r,o,l,d=this;if(null==t)r=this,l=".w2ui-sidebar-div";else{if(null==(r=this.get(t)))return;l="#node_"+w2utils.escapeId(r.id)+"_sub"}var u;if(r!==this){var c="#node_"+w2utils.escapeId(r.id);u=i(r),e(this.box).find(c).before('<div id="sidebar_'+this.name+'_tmp"></div>'),e(this.box).find(c).remove(),e(this.box).find(l).remove(),e("#sidebar_"+this.name+"_tmp").before(u),e("#sidebar_"+this.name+"_tmp").remove()}e(this.box).find(l).html("");for(var h=0;h<r.nodes.length;h++)if(o=r.nodes[h],u=i(o),e(this.box).find(l).append(u),0!==o.nodes.length)this.refresh(o.id);else{var p=this.trigger({phase:"before",type:"refresh",target:o.id});if(!0===p.isCancelled)return;this.trigger(e.extend(p,{phase:"after"}))}return this.trigger(e.extend(n,{phase:"after"})),(new Date).getTime()-s}},resize:function(){var t=(new Date).getTime(),i=this.trigger({phase:"before",type:"resize",target:this.name});if(!0!==i.isCancelled)return e(this.box).css("overflow","hidden"),e(this.box).find("> div").css({width:e(this.box).width()+"px",height:e(this.box).height()+"px"}),this.trigger(e.extend(i,{phase:"after"})),(new Date).getTime()-t},destroy:function(){var t=this.trigger({phase:"before",type:"destroy",target:this.name});!0!==t.isCancelled&&(e(this.box).find("> div > div.w2ui-sidebar-div").length>0&&e(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-sidebar").html(""),delete w2ui[this.name],this.trigger(e.extend(t,{phase:"after"})))},lock:function(e,t){var i=Array.prototype.slice.call(arguments,0);i.unshift(this.box),w2utils.lock.apply(window,i)},unlock:function(e){w2utils.unlock(this.box,e)}},e.extend(t.prototype,w2utils.event),w2obj.sidebar=t}(jQuery),function(e){var t=function(t){this.el=null,this.helpers={},this.type=t.type||"text",this.options=e.extend(!0,{},t),this.onSearch=t.onSearch||null,this.onRequest=t.onRequest||null,this.onLoad=t.onLoad||null,this.onError=t.onError||null,this.onClick=t.onClick||null,this.onAdd=t.onAdd||null,this.onNew=t.onNew||null,this.onRemove=t.onRemove||null,this.onMouseOver=t.onMouseOver||null,this.onMouseOut=t.onMouseOut||null,this.onIconClick=t.onIconClick||null,this.onScroll=t.onScroll||null,this.tmp={},delete this.options.type,delete this.options.onSearch,delete this.options.onRequest,delete this.options.onLoad,delete this.options.onError,delete this.options.onClick,delete this.options.onMouseOver,delete this.options.onMouseOut,delete this.options.onIconClick,delete this.options.onScroll,e.extend(!0,this,w2obj.field)};e.fn.w2field=function(i,s){if(0!==this.length)return 0===arguments.length?e(this).data("w2field"):("string"==typeof i&&"object"==typeof s&&(i=e.extend(!0,{},s,{type:i})),"string"==typeof i&&null==s&&(i={type:i}),i&&(i.type=String(i.type).toLowerCase()),this.each(function(s,n){if(null==(a=e(n).data("w2field"))){a=new t(i);return e.extend(a,{handlers:[]}),n&&(a.el=e(n)[0]),a.init(),e(n).data("w2field",a),a}if(a.clear(),"clear"!=i.type){var a=new t(i);return e.extend(a,{handlers:[]}),n&&(a.el=e(n)[0]),a.init(),e(n).data("w2field",a),a}}));var n=t.prototype;return n[i]?n[i].apply(n,Array.prototype.slice.call(arguments,1)):void 0},t.prototype={custom:{},addType:function(e,t){return e=String(e).toLowerCase(),this.custom[e]=t,!0},removeType:function(e){return e=String(e).toLowerCase(),!!this.custom[e]&&(delete this.custom[e],!0)},init:function(){var t,i=this,s=this.options;if("function"!=typeof this.custom[this.type])if(-1!=["INPUT","TEXTAREA"].indexOf(this.el.tagName.toUpperCase())){switch(this.type){case"text":case"int":case"float":case"money":case"currency":case"percent":case"alphanumeric":case"bin":case"hex":t={min:null,max:null,step:1,autoFormat:!0,currencyPrefix:w2utils.settings.currencyPrefix,currencySuffix:w2utils.settings.currencySuffix,currencyPrecision:w2utils.settings.currencyPrecision,decimalSymbol:w2utils.settings.decimalSymbol,groupSymbol:w2utils.settings.groupSymbol,arrows:!1,keyboard:!0,precision:null,silent:!0,prefix:"",suffix:""},this.options=e.extend(!0,{},t,s),(s=this.options).numberRE=new RegExp("["+s.groupSymbol+"]","g"),s.moneyRE=new RegExp("["+s.currencyPrefix+s.currencySuffix+s.groupSymbol+"]","g"),s.percentRE=new RegExp("["+s.groupSymbol+"%]","g"),-1!=["text","alphanumeric","hex","bin"].indexOf(this.type)&&(s.arrows=!1,s.keyboard=!1),this.addPrefix(),this.addSuffix();break;case"color":t={prefix:"",suffix:'<div style="width: '+(parseInt(e(this.el).css("font-size"))||12)+'px">&#160;</div>',arrows:!1,keyboard:!1,advanced:null,transparent:!0},e.extend(s,t),this.addPrefix(),this.addSuffix(),""!==e(this.el).val()&&setTimeout(function(){i.change()},1);break;case"date":t={format:w2utils.settings.dateFormat,keyboard:!0,silent:!0,start:"",end:"",blocked:{},colored:{},blockWeekDays:null},this.options=e.extend(!0,{},t,s),s=this.options,null==e(this.el).attr("placeholder")&&e(this.el).attr("placeholder",s.format);break;case"time":t={format:w2utils.settings.timeFormat,keyboard:!0,silent:!0,start:"",end:"",noMinutes:!1},this.options=e.extend(!0,{},t,s),s=this.options,null==e(this.el).attr("placeholder")&&e(this.el).attr("placeholder",s.format);break;case"datetime":t={format:w2utils.settings.dateFormat+" | "+w2utils.settings.timeFormat,keyboard:!0,silent:!0,start:"",end:"",blocked:[],colored:{},placeholder:null,btn_now:!0,noMinutes:!1},this.options=e.extend(!0,{},t,s),s=this.options,null==e(this.el).attr("placeholder")&&e(this.el).attr("placeholder",s.placeholder||s.format);break;case"list":case"combo":if(t={items:[],selected:{},url:null,recId:null,recText:null,method:null,interval:350,postData:{},minLength:1,cacheMax:250,maxDropHeight:350,maxDropWidth:null,match:"begins",silent:!0,icon:null,iconStyle:"",align:"both",altRows:!0,onSearch:null,onRequest:null,onLoad:null,onError:null,onIconClick:null,renderDrop:null,compare:null,filter:!0,prefix:"",suffix:"",openOnFocus:!1,markSearch:!1},s.items=this.normMenu(s.items),"list"==this.type){if(t.openOnFocus=!0,e(this.el).addClass("w2ui-select"),!e.isPlainObject(s.selected)&&s.items)for(var n=0;n<s.items.length;n++){var a=s.items[n];if(a&&a.id===s.selected){s.selected=e.extend(!0,{},a);break}}this.watchSize()}s=e.extend({},t,s),this.options=s,e.isPlainObject(s.selected)||(s.selected={}),e(this.el).data("selected",s.selected),s.url&&(s.items=[],this.request(0)),"list"==this.type&&this.addFocus(),this.addPrefix(),this.addSuffix(),setTimeout(function(){i.refresh()},10),e(this.el).attr("autocomplete","off"),null!=s.selected.text&&e(this.el).val(s.selected.text);break;case"enum":t={items:[],selected:[],max:0,url:null,recId:null,recText:null,interval:350,method:null,postData:{},minLength:1,cacheMax:250,maxWidth:250,maxHeight:350,maxDropHeight:350,maxDropWidth:null,match:"contains",silent:!0,align:"both",altRows:!0,openOnFocus:!1,markSearch:!0,renderDrop:null,renderItem:null,compare:null,filter:!0,style:"",onSearch:null,onRequest:null,onLoad:null,onError:null,onClick:null,onAdd:null,onNew:null,onRemove:null,onMouseOver:null,onMouseOut:null,onScroll:null},(s=e.extend({},t,s,{suffix:""})).items=this.normMenu(s.items),s.selected=this.normMenu(s.selected),this.options=s,e.isArray(s.selected)||(s.selected=[]),e(this.el).data("selected",s.selected),s.url&&(s.items=[],this.request(0)),this.addSuffix(),this.addMulti(),this.watchSize();break;case"file":t={selected:[],max:0,maxSize:0,maxFileSize:0,maxWidth:250,maxHeight:350,maxDropHeight:350,maxDropWidth:null,readContent:!0,silent:!0,align:"both",altRows:!0,renderItem:null,style:"",onClick:null,onAdd:null,onRemove:null,onMouseOver:null,onMouseOut:null},s=e.extend({},t,s),this.options=s,e.isArray(s.selected)||(s.selected=[]),e(this.el).data("selected",s.selected),null==e(this.el).attr("placeholder")&&e(this.el).attr("placeholder",w2utils.lang("Attach files by dragging and dropping or Click to Select")),this.addMulti(),this.watchSize()}this.tmp={onChange:function(e){i.change.call(i,e)},onClick:function(e){i.click.call(i,e)},onFocus:function(e){i.focus.call(i,e)},onBlur:function(e){i.blur.call(i,e)},onKeydown:function(e){i.keyDown.call(i,e)},onKeyup:function(e){i.keyUp.call(i,e)},onKeypress:function(e){i.keyPress.call(i,e)}},e(this.el).addClass("w2field w2ui-input").data("w2field",this).on("change.w2field",this.tmp.onChange).on("click.w2field",this.tmp.onClick).on("focus.w2field",this.tmp.onFocus).on("blur.w2field",this.tmp.onBlur).on("keydown.w2field",this.tmp.onKeydown).on("keyup.w2field",this.tmp.onKeyup).on("keypress.w2field",this.tmp.onKeypress).css(w2utils.cssPrefix("box-sizing","border-box")),this.change(e.Event("change"))}else console.log("ERROR: w2field could only be applied to INPUT or TEXTAREA.",this.el);else this.custom[this.type].call(this,s)},watchSize:function(){var t=this,i=e(t.el).data("tmp")||{};i.sizeTimer=setInterval(function(){e(t.el).parents("body").length>0?t.resize():clearInterval(i.sizeTimer)},200),e(t.el).data("tmp",i)},get:function(){return-1!=["list","enum","file"].indexOf(this.type)?e(this.el).data("selected"):e(this.el).val()},set:function(t,i){if(-1!=["list","enum","file"].indexOf(this.type)){if("list"!=this.type&&i)null==e(this.el).data("selected")&&e(this.el).data("selected",[]),e(this.el).data("selected").push(t),e(this.el).change();else{var s="enum"==this.type?[t]:t;e(this.el).data("selected",s).change()}this.refresh()}else e(this.el).val(t)},setIndex:function(t,i){if(-1!=["list","enum"].indexOf(this.type)){var s=this.options.items;if(s&&s[t]){if("list"!=this.type&&i)null==e(this.el).data("selected")&&e(this.el).data("selected",[]),e(this.el).data("selected").push(s[t]),e(this.el).change();else{var n="enum"==this.type?[s[t]]:s[t];e(this.el).data("selected",n).change()}return this.refresh(),!0}}return!1},clear:function(){var t=this.options;-1!=["money","currency"].indexOf(this.type)&&e(this.el).val(e(this.el).val().replace(t.moneyRE,"")),"percent"==this.type&&e(this.el).val(e(this.el).val().replace(/%/g,"")),"list"==this.type&&e(this.el).removeClass("w2ui-select"),this.type="clear";var i=e(this.el).data("tmp");if(this.tmp){null!=i&&(e(this.el).height("auto"),i&&i["old-padding-left"]&&e(this.el).css("padding-left",i["old-padding-left"]),i&&i["old-padding-right"]&&e(this.el).css("padding-right",i["old-padding-right"]),i&&i["old-background-color"]&&e(this.el).css("background-color",i["old-background-color"]),i&&i["old-border-color"]&&e(this.el).css("border-color",i["old-border-color"]),clearInterval(i.sizeTimer)),e(this.el).val(this.clean(e(this.el).val())).removeClass("w2field").removeData().off(".w2field");for(var s in this.helpers)e(this.helpers[s]).remove();this.helpers={}}},refresh:function(){var t=this,i=this.options,s=e(this.el).data("selected"),n=(new Date).getTime();if(-1!=["list"].indexOf(this.type)&&(e(t.el).parent().css("white-space","nowrap"),t.helpers.prefix&&t.helpers.prefix.hide(),setTimeout(function(){if(t.helpers.focus){!e.isEmptyObject(s)&&i.icon?(i.prefix='<span class="w2ui-icon '+i.icon+'"style="cursor: pointer; font-size: 14px; display: inline-block; margin-top: -1px; color: #7F98AD;'+i.iconStyle+'"></span>',t.addPrefix()):(i.prefix="",t.addPrefix());var n=t.helpers.focus.find("input");""===e(n).val()?(e(n).css("text-indent","-9999em").prev().css("opacity",0),e(t.el).val(s&&null!=s.text?w2utils.lang(s.text):"")):(e(n).css("text-indent",0).prev().css("opacity",1),e(t.el).val(""),setTimeout(function(){t.helpers.prefix&&t.helpers.prefix.hide();var s="position: absolute; opacity: 0; margin: 4px 0px 0px 2px; background-position: left !important;";i.icon?(e(n).css("margin-left","17px"),e(t.helpers.focus).find(".icon-search").attr("style",s+"width: 11px !important; opacity: 1; display: block")):(e(n).css("margin-left","0px"),e(t.helpers.focus).find(".icon-search").attr("style",s+"width: 0px !important; opacity: 0; display: none"))},1)),e(t.el).prop("readonly")||e(t.el).prop("disabled")?setTimeout(function(){e(t.helpers.prefix).css("opacity","0.6"),e(t.helpers.suffix).css("opacity","0.6")},1):setTimeout(function(){e(t.helpers.prefix).css("opacity","1"),e(t.helpers.suffix).css("opacity","1")},1)}},1)),-1!=["enum","file"].indexOf(this.type)){var a="";if(s)for(var r=0;r<s.length;r++){var o=s[r],l="";l="function"==typeof i.renderItem?i.renderItem(o,r,'<div class="w2ui-list-remove" title="'+w2utils.lang("Remove")+'" index="'+r+'">&#160;&#160;</div>'):'<div class="w2ui-list-remove" title="'+w2utils.lang("Remove")+'" index="'+r+'">&#160;&#160;</div>'+("enum"==t.type?o.text:o.name+'<span class="file-size"> - '+w2utils.formatSize(o.size)+"</span>"),a+='<li index="'+r+'" style="max-width: '+parseInt(i.maxWidth)+"px; "+(o.style?o.style:"")+'">'+l+"</li>"}var d=t.helpers.multi,u=d.find("ul");if(d.attr("style",d.attr("style")+";"+i.style),e(t.el).css("z-index","-1"),e(t.el).prop("readonly")||e(t.el).prop("disabled")?setTimeout(function(){d[0].scrollTop=0,d.addClass("w2ui-readonly").find("li").css("opacity","0.9").parent().find("li.nomouse").hide().find("input").prop("readonly",!0).parents("ul").find(".w2ui-list-remove").hide()},1):setTimeout(function(){d.removeClass("w2ui-readonly").find("li").css("opacity","1").parent().find("li.nomouse").show().find("input").prop("readonly",!1).parents("ul").find(".w2ui-list-remove").show()},1),d.find(".w2ui-enum-placeholder").remove(),u.find("li").not("li.nomouse").remove(),""!==a)u.prepend(a);else if(null!=e(t.el).attr("placeholder")&&""===d.find("input").val()){var c="padding-top: "+e(this.el).css("padding-top")+";padding-left: "+e(this.el).css("padding-left")+"; box-sizing: "+e(this.el).css("box-sizing")+"; line-height: "+e(this.el).css("line-height")+"; font-size: "+e(this.el).css("font-size")+"; font-family: "+e(this.el).css("font-family")+"; ";d.prepend('<div class="w2ui-enum-placeholder" style="'+c+'">'+e(t.el).attr("placeholder")+"</div>")}d.off("scroll.w2field").on("scroll.w2field",function(i){var s=t.trigger({phase:"before",type:"scroll",target:t.el,originalEvent:i});!0!==s.isCancelled&&t.trigger(e.extend(s,{phase:"after"}))}).find("li").data("mouse","out").on("click",function(i){var n="LI"==i.target.tagName.toUpperCase()?i.target:e(i.target).parents("LI"),a=s[e(n).attr("index")];if(!e(n).hasClass("nomouse"))if(i.stopPropagation(),e(i.target).hasClass("w2ui-list-remove")){if(e(t.el).prop("readonly")||e(t.el).prop("disabled"))return;if(!0===(r=t.trigger({phase:"before",type:"remove",target:t.el,originalEvent:i.originalEvent,item:a})).isCancelled)return;e().w2overlay(),s.splice(e(i.target).attr("index"),1),e(t.el).trigger("change"),e(i.target).parent().fadeOut("fast"),setTimeout(function(){t.refresh(),t.trigger(e.extend(r,{phase:"after"}))},300)}else{var r=t.trigger({phase:"before",type:"click",target:t.el,originalEvent:i.originalEvent,item:a});if(!0===r.isCancelled)return;if("file"==t.type){var o="";/image/i.test(a.type)&&(o='<div style="padding: 3px;">    <img src="'+(a.content?"data:"+a.type+";base64,"+a.content:"")+'" style="max-width: 300px;"         onload="var w = jQuery(this).width(); var h = jQuery(this).height();             if (w < 300 & h < 300) return;             if (w >= h && w > 300) jQuery(this).width(300);            if (w < h && h > 300) jQuery(this).height(300);"        onerror="this.style.display = \'none\'"    ></div>');var l='style="padding: 3px; text-align: right; color: #777;"',d='style="padding: 3px"';o+='<div style="padding: 8px;">    <table cellpadding="2"><tbody>    <tr><td '+l+">"+w2utils.lang("Name")+":</td><td "+d+">"+a.name+"</td></tr>    <tr><td "+l+">"+w2utils.lang("Size")+":</td><td "+d+">"+w2utils.formatSize(a.size)+"</td></tr>    <tr><td "+l+">"+w2utils.lang("Type")+":</td><td "+d+'>        <span style="width: 200px; display: block-inline; overflow: hidden; text-overflow: ellipsis; white-space: nowrap="nowrap";">'+a.type+"</span>    </td></tr>    <tr><td "+l+">"+w2utils.lang("Modified")+":</td><td "+d+">"+w2utils.date(a.modified)+"</td></tr>    </tbody></table></div>",e("#w2ui-overlay").remove(),e(n).w2overlay(o)}t.trigger(e.extend(r,{phase:"after"}))}}).on("mouseover",function(i){var n="LI"==i.target.tagName.toUpperCase()?i.target:e(i.target).parents("LI");if(!e(n).hasClass("nomouse")){if("out"==e(n).data("mouse")){var a=s[e(i.target).attr("index")],r=t.trigger({phase:"before",type:"mouseOver",target:t.el,originalEvent:i.originalEvent,item:a});if(!0===r.isCancelled)return;t.trigger(e.extend(r,{phase:"after"}))}e(n).data("mouse","over")}}).on("mouseout",function(i){var n="LI"==i.target.tagName.toUpperCase()?i.target:e(i.target).parents("LI");e(n).hasClass("nomouse")||(e(n).data("mouse","leaving"),setTimeout(function(){if("leaving"==e(n).data("mouse")){e(n).data("mouse","out");var a=s[e(i.target).attr("index")],r=t.trigger({phase:"before",type:"mouseOut",target:t.el,originalEvent:i.originalEvent,item:a});if(!0===r.isCancelled)return;t.trigger(e.extend(r,{phase:"after"}))}},0))}),e(this.el).height("auto");var h=e(d).find("> div.w2ui-multi-items").height()+2*w2utils.getSize(d,"+height");h<26&&(h=26),h>i.maxHeight&&(h=i.maxHeight),d.length>0&&(d[0].scrollTop=1e3);var p=w2utils.getSize(e(this.el),"height")-2;if(p>h&&(h=p),e(d).css({height:h+"px",overflow:h==i.maxHeight?"auto":"hidden"}),h<i.maxHeight&&e(d).prop("scrollTop",0),e(this.el).css({height:h+2+"px"}),"enum"==t.type){var f=t.helpers.multi.find("input");f.width(8*(f.val().length+2)+"px")}}return(new Date).getTime()-n},reset:function(){var e=this.type;this.clear(),this.type=e,this.init()},resize:function(){var t=this,i=e(t.el).width(),s=e(t.el).height();if(!(t.tmp.current_width==i&&s>0)){var n=this.helpers.focus,a=this.helpers.multi,r=this.helpers.suffix,o=this.helpers.prefix;if(n&&n.width(e(t.el).width()),a){var l=w2utils.getSize(t.el,"width")-parseInt(e(t.el).css("margin-left"),10)-parseInt(e(t.el).css("margin-right"),10);e(a).width(l)}r&&(t.options.suffix='<div class="arrow-down" style="margin-top: '+(parseInt(e(t.el).height())-6)/2+'px;"></div>',t.addSuffix()),o&&t.addPrefix(),t.tmp.current_width=i}},clean:function(t){if("number"==typeof t)return t;var i=this.options;return t=String(t).trim(),-1!=["int","float","money","currency","percent"].indexOf(this.type)&&("string"==typeof t&&(i.autoFormat&&-1!=["money","currency"].indexOf(this.type)&&(t=String(t).replace(i.moneyRE,"")),i.autoFormat&&"percent"==this.type&&(t=String(t).replace(i.percentRE,"")),i.autoFormat&&-1!=["int","float"].indexOf(this.type)&&(t=String(t).replace(i.numberRE,"")),t=t.replace(/\s+/g,"").replace(w2utils.settings.groupSymbol,"").replace(w2utils.settings.decimalSymbol,".")),parseFloat(t)==t&&(null!=i.min&&t<i.min&&(t=i.min,e(this.el).val(i.min)),null!=i.max&&t>i.max&&(t=i.max,e(this.el).val(i.max))),t=""!==t&&w2utils.isFloat(t)?Number(t):""),t},format:function(e){var t=this.options;if(t.autoFormat&&""!==e)switch(this.type){case"money":case"currency":""!==(e=w2utils.formatNumber(e,t.currencyPrecision,t.groupSymbol))&&(e=t.currencyPrefix+e+t.currencySuffix);break;case"percent":""!==(e=w2utils.formatNumber(e,t.precision,t.groupSymbol))&&(e+="%");break;case"float":e=w2utils.formatNumber(e,t.precision,t.groupSymbol);break;case"int":e=w2utils.formatNumber(e,0,t.groupSymbol)}return e},change:function(t){var i=this,s=i.options;if(-1!=["int","float","money","currency","percent"].indexOf(this.type)){var n=e(this.el).val(),a=this.format(this.clean(e(this.el).val()));if(""!==n&&n!=a)return e(this.el).val(a).change(),t.stopPropagation(),t.preventDefault(),!1}if("color"==this.type){var r=e(this.el).val();"rgb"!=r.substr(0,3).toLowerCase()&&(r="#"+r,6!=e(this.el).val().length&&3!=e(this.el).val().length&&(r="")),e(this.el).next().find("div").css("background-color",r),e(this.el).is(":focus")&&!0!==e(this.el).data("skipInit")&&this.updateOverlay()}if(-1!=["list","enum","file"].indexOf(this.type)&&(i.refresh(),setTimeout(function(){i.refresh()},5)),-1!=["date","time","datetime"].indexOf(this.type)){var o=parseInt(i.el.value);w2utils.isInt(i.el.value)&&o>3e3&&("time"==this.type&&e(i.el).val(w2utils.formatTime(new Date(o),s.format)).change(),"date"==this.type&&e(i.el).val(w2utils.formatDate(new Date(o),s.format)).change(),"datetime"==this.type&&e(i.el).val(w2utils.formatDateTime(new Date(o),s.format)).change())}},click:function(t){t.stopPropagation(),-1!=["list","combo","enum"].indexOf(this.type)&&(e(this.el).is(":focus")||this.focus(t)),-1!=["date","time","color","datetime"].indexOf(this.type)&&this.updateOverlay()},focus:function(t){var i=this;if(this.options,-1!==["color","date","time","datetime"].indexOf(i.type)){if(e(i.el).prop("readonly")||e(i.el).prop("disabled"))return;e("#w2ui-overlay").length>0&&e("#w2ui-overlay")[0].hide(),setTimeout(function(){i.updateOverlay()},150)}if(-1!=["list","combo","enum"].indexOf(i.type)){if(e(i.el).prop("readonly")||e(i.el).prop("disabled"))return;e("#w2ui-overlay").length>0&&e("#w2ui-overlay")[0].hide(),i.resize(),setTimeout(function(){return"list"==i.type&&e(i.el).is(":focus")?void e(i.helpers.focus).find("input").focus():(i.search(),void setTimeout(function(){i.updateOverlay()},1))},1)}"file"==i.type&&e(i.helpers.multi).css({outline:"auto 5px #7DB4F3","outline-offset":"-2px"})},blur:function(t){var i=this,s=i.options,n=e(i.el).val().trim(),a=e("#w2ui-overlay");if(-1!=["color","date","time","list","combo","enum","datetime"].indexOf(i.type)){var r=window.setTimeout(function(){!0!==a.data("keepOpen")&&a.hide()},0);e(".menu",a).one("focus",function(){clearTimeout(r),e(this).one("focusout",function(e){a.hide()})})}-1!=["int","float","money","currency","percent"].indexOf(i.type)&&(""===n||i.checkType(n)||(e(i.el).val("").change(),!1===s.silent&&(e(i.el).w2tag("Not a valid number"),setTimeout(function(){e(i.el).w2tag("")},3e3)))),-1!=["date","time","datetime"].indexOf(i.type)&&(""===n||i.inRange(i.el.value)?"date"!=i.type||""===n||w2utils.isDate(i.el.value,s.format)?"time"!=i.type||""===n||w2utils.isTime(i.el.value)?"datetime"!=i.type||""===n||w2utils.isDateTime(i.el.value,s.format)||(e(i.el).val("").removeData("selected").change(),!1===s.silent&&(e(i.el).w2tag("Not a valid date"),setTimeout(function(){e(i.el).w2tag("")},3e3))):(e(i.el).val("").removeData("selected").change(),!1===s.silent&&(e(i.el).w2tag("Not a valid time"),setTimeout(function(){e(i.el).w2tag("")},3e3))):(e(i.el).val("").removeData("selected").change(),!1===s.silent&&(e(i.el).w2tag("Not a valid date"),setTimeout(function(){e(i.el).w2tag("")},3e3))):(e(i.el).val("").removeData("selected").change(),!1===s.silent&&(e(i.el).w2tag("Not in range"),setTimeout(function(){e(i.el).w2tag("")},3e3)))),"enum"==i.type&&e(i.helpers.multi).find("input").val("").width(20),"file"==i.type&&e(i.helpers.multi).css({outline:"none"})},keyPress:function(e){var t=this;if(t.options,-1!=["int","float","money","currency","percent","hex","bin","color","alphanumeric"].indexOf(t.type)){if(e.metaKey||e.ctrlKey||e.altKey||e.charCode!=e.keyCode&&e.keyCode>0)return;var i=String.fromCharCode(e.charCode);if(!t.checkType(i,!0)&&13!=e.keyCode)return e.preventDefault(),e.stopPropagation?e.stopPropagation():e.cancelBubble=!0,!1}-1!=["date","time","datetime"].indexOf(t.type)&&9!==e.keyCode&&setTimeout(function(){t.updateOverlay()},1)},keyDown:function(t,i){var s=this,n=s.options,a=t.keyCode||i&&i.keyCode;if(-1!=["int","float","money","currency","percent"].indexOf(s.type)){if(!n.keyboard||e(s.el).prop("readonly")||e(s.el).prop("disabled"))return;var r=!1,o=parseFloat(e(s.el).val().replace(n.moneyRE,""))||0,l=n.step;switch((t.ctrlKey||t.metaKey)&&(l=10),a){case 38:if(t.shiftKey)break;e(s.el).val(o+l<=n.max||null==n.max?Number((o+l).toFixed(12)):n.max).change(),r=!0;break;case 40:if(t.shiftKey)break;e(s.el).val(o-l>=n.min||null==n.min?Number((o-l).toFixed(12)):n.min).change(),r=!0}r&&(t.preventDefault(),setTimeout(function(){s.el.setSelectionRange(s.el.value.length,s.el.value.length)},0))}if("date"==s.type){if(!n.keyboard||e(s.el).prop("readonly")||e(s.el).prop("disabled"))return;var r=!1,d=864e5,l=1;switch((t.ctrlKey||t.metaKey)&&(l=10),(h=w2utils.isDate(e(s.el).val(),n.format,!0))||(h=new Date,d=0),a){case 38:if(t.shiftKey)break;p=w2utils.formatDate(h.getTime()+d,n.format);10==l&&(p=w2utils.formatDate(new Date(h.getFullYear(),h.getMonth()+1,h.getDate()),n.format)),e(s.el).val(p).change(),r=!0;break;case 40:if(t.shiftKey)break;p=w2utils.formatDate(h.getTime()-d,n.format);10==l&&(p=w2utils.formatDate(new Date(h.getFullYear(),h.getMonth()-1,h.getDate()),n.format)),e(s.el).val(p).change(),r=!0}r&&(t.preventDefault(),setTimeout(function(){s.el.setSelectionRange(s.el.value.length,s.el.value.length),s.updateOverlay()},0))}if("time"==s.type){if(!n.keyboard||e(s.el).prop("readonly")||e(s.el).prop("disabled"))return;var r=!1,l=t.ctrlKey||t.metaKey?60:1,o=e(s.el).val(),u=s.toMin(o)||s.toMin((new Date).getHours()+":"+((new Date).getMinutes()-1));switch(a){case 38:if(t.shiftKey)break;u+=l,r=!0;break;case 40:if(t.shiftKey)break;u-=l,r=!0}r&&(e(s.el).val(s.fromMin(u)).change(),t.preventDefault(),setTimeout(function(){s.el.setSelectionRange(s.el.value.length,s.el.value.length)},0))}if("datetime"==s.type){if(!n.keyboard||e(s.el).prop("readonly")||e(s.el).prop("disabled"))return;var r=!1,d=864e5,l=1;(t.ctrlKey||t.metaKey)&&(l=10);var c=e(s.el).val(),h=w2utils.isDateTime(c,this.options.format,!0);switch(h||(h=new Date,d=0),a){case 38:if(t.shiftKey)break;p=w2utils.formatDateTime(h.getTime()+d,n.format);10==l&&(p=w2utils.formatDateTime(new Date(h.getFullYear(),h.getMonth()+1,h.getDate()),n.format)),e(s.el).val(p).change(),r=!0;break;case 40:if(t.shiftKey)break;var p=w2utils.formatDateTime(h.getTime()-d,n.format);10==l&&(p=w2utils.formatDateTime(new Date(h.getFullYear(),h.getMonth()-1,h.getDate()),n.format)),e(s.el).val(p).change(),r=!0}r&&(t.preventDefault(),setTimeout(function(){s.el.setSelectionRange(s.el.value.length,s.el.value.length),s.updateOverlay()},0))}if("color"==s.type){if(e(s.el).prop("readonly")||e(s.el).prop("disabled"))return;if((t.ctrlKey||t.metaKey)&&!t.shiftKey){var f=null,g=null;switch(a){case 38:f="up";break;case 40:f="down";break;case 39:f="right";break;case 37:f="left"}s.el.nav&&null!=f&&(g=s.el.nav(f),e(s.el).val(g).change(),t.preventDefault())}}if(-1!=["list","combo","enum"].indexOf(s.type)){if(e(s.el).prop("readonly")||e(s.el).prop("disabled"))return;var m=e(s.el).data("selected"),w=e(s.el),v=!1;switch(-1!=["list","enum"].indexOf(s.type)&&("list"==s.type&&(w=e(s.helpers.focus).find("input")),"enum"==s.type&&(w=e(s.helpers.multi).find("input")),-1==[37,38,39,40].indexOf(a)&&setTimeout(function(){s.refresh()},1),86==t.keyCode&&(t.ctrlKey||t.metaKey)&&setTimeout(function(){s.refresh(),s.search(),s.request()},50)),a){case 27:"list"==s.type&&(""!==w.val()&&w.val(""),t.stopPropagation());break;case 37:case 39:break;case 13:if(0===e("#w2ui-overlay").length)break;y=n.items[n.index];if("enum"==s.type)if(null!=y){if(!0===(b=s.trigger({phase:"before",type:"add",target:s.el,originalEvent:t.originalEvent,item:y})).isCancelled)return;y=b.item,m.length>=n.max&&n.max>0&&m.pop(),delete y.hidden,delete s.tmp.force_open,m.push(y),e(s.el).change(),w.val("").width(20),s.refresh(),s.trigger(e.extend(b,{phase:"after"}))}else{if(y={id:w.val(),text:w.val()},!0===(b=s.trigger({phase:"before",type:"new",target:s.el,originalEvent:t.originalEvent,item:y})).isCancelled)return;y=b.item,"function"==typeof s.onNew&&(m.length>=n.max&&n.max>0&&m.pop(),delete s.tmp.force_open,m.push(y),e(s.el).change(),w.val("").width(20),s.refresh()),s.trigger(e.extend(b,{phase:"after"}))}else y&&e(s.el).data("selected",y).val(y.text).change(),""===e(s.el).val()&&e(s.el).data("selected")&&e(s.el).removeData("selected").val("").change(),"list"==s.type&&(w.val(""),s.refresh()),s.tmp.force_hide=!0;break;case 8:case 46:if("enum"==s.type&&8==a&&""===w.val()&&m.length>0){var y=m[m.length-1],b=s.trigger({phase:"before",type:"remove",target:s.el,originalEvent:t.originalEvent,item:y});if(!0===b.isCancelled)return;m.pop(),e(s.el).trigger("change"),s.refresh(),s.trigger(e.extend(b,{phase:"after"}))}"list"==s.type&&""===w.val()&&(e(s.el).data("selected",{}).change(),s.refresh());break;case 38:for(n.index=w2utils.isInt(n.index)?parseInt(n.index):0,n.index--;n.index>0&&n.items[n.index].hidden;)n.index--;if(0===n.index&&n.items[n.index].hidden)for(;n.items[n.index]&&n.items[n.index].hidden;)n.index++;v=!0;break;case 40:for(n.index=w2utils.isInt(n.index)?parseInt(n.index):-1,n.index++;n.index<n.items.length-1&&n.items[n.index].hidden;)n.index++;if(n.index==n.items.length-1&&n.items[n.index].hidden)for(;n.items[n.index]&&n.items[n.index].hidden;)n.index--;""===w.val()&&0===e("#w2ui-overlay").length?s.tmp.force_open=!0:v=!0}if(v)return n.index<0&&(n.index=0),n.index>=n.items.length&&(n.index=n.items.length-1),s.updateOverlay(v),t.preventDefault(),void setTimeout(function(){if("enum"==s.type)(e=w.get(0)).setSelectionRange(e.value.length,e.value.length);else if("list"==s.type){var e=w.get(0);e.setSelectionRange(e.value.length,e.value.length)}else s.el.setSelectionRange(s.el.value.length,s.el.value.length)},0);"enum"==s.type&&w.width(8*(w.val().length+2)+"px")}},keyUp:function(t){var i=this;if(-1!=["list","combo","enum"].indexOf(this.type)){if(e(i.el).prop("readonly")||e(i.el).prop("disabled"))return;if(-1==[16,17,18,20,37,39,91].indexOf(t.keyCode)){var s=e(this.helpers.focus).find("input");0===s.length&&(s=e(this.el));var n=this.trigger({phase:"before",type:"search",originalEvent:t,target:s,search:s.val()});if(!0===n.isCancelled)return;this.tmp.force_hide||this.request(),1==s.val().length&&this.refresh(),0!==e("#w2ui-overlay").length&&-1!=[38,40].indexOf(t.keyCode)||this.search(),this.trigger(e.extend(n,{phase:"after"}))}}},clearCache:function(){this.options.items=[],this.tmp.xhr_loading=!1,this.tmp.xhr_search="",this.tmp.xhr_total=-1},request:function(t){var i=this,s=this.options,n=e(i.el).val()||"";if(s.url){if("enum"==i.type){a=e(i.helpers.multi).find("input");n=0===a.length?"":a.val()}if("list"==i.type){var a=e(i.helpers.focus).find("input");n=0===a.length?"":a.val()}if(0!==s.minLength&&n.length<s.minLength)return s.items=[],void this.updateOverlay();null==t&&(t=s.interval),null==i.tmp.xhr_search&&(i.tmp.xhr_search=""),null==i.tmp.xhr_total&&(i.tmp.xhr_total=-1),s.url&&!0!==e(i.el).prop("readonly")&&!0!==e(i.el).prop("disabled")&&(0===s.items.length&&0!==i.tmp.xhr_total||i.tmp.xhr_total==s.cacheMax&&n.length>i.tmp.xhr_search.length||n.length>=i.tmp.xhr_search.length&&n.substr(0,i.tmp.xhr_search.length)!=i.tmp.xhr_search||n.length<i.tmp.xhr_search.length)&&(i.tmp.xhr&&i.tmp.xhr.abort(),i.tmp.xhr_loading=!0,i.search(),clearTimeout(i.tmp.timeout),i.tmp.timeout=setTimeout(function(){var t=s.url,a={search:n,max:s.cacheMax};e.extend(a,s.postData);var r=i.trigger({phase:"before",type:"request",search:n,target:i.el,url:t,postData:a});if(!0!==r.isCancelled){var o={type:"GET",url:t=r.url,data:a=r.postData,dataType:"JSON"};s.method&&(o.type=s.method),"JSON"==w2utils.settings.dataType&&(o.type="POST",o.data=JSON.stringify(o.data),o.contentType="application/json"),"HTTPJSON"==w2utils.settings.dataType&&(o.data={request:JSON.stringify(o.data)}),null!=s.method&&(o.type=s.method),i.tmp.xhr=e.ajax(o).done(function(t,r,o){var l=i.trigger({phase:"before",type:"load",target:i.el,search:a.search,data:t,xhr:o});if(!0!==l.isCancelled){if("string"==typeof(t=l.data)&&(t=JSON.parse(t)),null==t.records&&null!=t.items&&(t.records=t.items,delete t.items),"success"==t.status&&null==t.records&&(t.records=[]),"success"!=t.status||!Array.isArray(t.records))return void console.log("ERROR: server did not return proper structure. It should return",{status:"success",records:[{id:1,text:"item"}]});t.records.length>s.cacheMax&&t.records.splice(s.cacheMax,1e5),null==s.recId&&null!=s.recid&&(s.recId=s.recid),(s.recId||s.recText)&&t.records.forEach(function(e){"string"==typeof s.recId&&(e.id=e[s.recId]),"function"==typeof s.recId&&(e.id=s.recId(e)),"string"==typeof s.recText&&(e.text=e[s.recText]),"function"==typeof s.recText&&(e.text=s.recText(e))}),i.tmp.xhr_loading=!1,i.tmp.xhr_search=n,i.tmp.xhr_total=t.records.length,s.items=i.normMenu(t.records),""===n&&0===t.records.length?i.tmp.emptySet=!0:i.tmp.emptySet=!1,i.search(),i.trigger(e.extend(l,{phase:"after"}))}}).fail(function(t,s,a){var r={status:s,error:a,rawResponseText:t.responseText},o=i.trigger({phase:"before",type:"error",target:i.el,search:n,error:r,xhr:t});if(!0!==o.isCancelled){if("abort"!=s){var l;try{l=e.parseJSON(t.responseText)}catch(e){}console.log("ERROR: Server communication failed.","\n   EXPECTED:",{status:"success",records:[{id:1,text:"item"}]},"\n         OR:",{status:"error",message:"error message"},"\n   RECEIVED:","object"==typeof l?l:t.responseText)}i.clearCache(),i.search(),i.trigger(e.extend(o,{phase:"after"}))}}),i.trigger(e.extend(r,{phase:"after"}))}},t))}},search:function(){var t=this,i=this.options,s=e(t.el).val(),n=t.el,a=[],r=e(t.el).data("selected");if("enum"==t.type){n=e(t.helpers.multi).find("input"),s=n.val();for(var o in r)r[o]&&a.push(r[o].id)}else if("list"==t.type){n=e(t.helpers.focus).find("input"),s=n.val();for(var o in r)r[o]&&a.push(r[o].id)}if(!0!==t.tmp.xhr_loading){for(var l=0,d=0;d<i.items.length;d++){var u=i.items[d];if(null!=i.compare)"function"==typeof i.compare&&(u.hidden=!1===i.compare.call(this,u,s));else{var c="",h="";-1!=["is","begins"].indexOf(i.match)&&(c="^"),-1!=["is","ends"].indexOf(i.match)&&(h="$");try{new RegExp(c+s+h,"i").test(u.text)||"..."==u.text?u.hidden=!1:u.hidden=!0}catch(e){}}!1===i.filter&&(u.hidden=!1),"enum"==t.type&&-1!=e.inArray(u.id,a)&&(u.hidden=!0),!0!==u.hidden&&(l++,delete u.hidden)}for(i.index=-1;i.items[i.index]&&i.items[i.index].hidden;)i.index++;l<=0&&(i.index=-1),i.spinner=!1,t.updateOverlay(),setTimeout(function(){var t=e("#w2ui-overlay").html()||"";i.markSearch&&-1!=t.indexOf("$.fn.w2menuHandler")&&e("#w2ui-overlay").w2marker(s)},1)}else i.items.splice(0,i.cacheMax),i.spinner=!0,t.updateOverlay()},updateOverlay:function(t){var i=this,s=this.options;if("color"==this.type){if(e(i.el).prop("readonly")||e(i.el).prop("disabled"))return;e(this.el).w2color({color:e(this.el).val(),transparent:s.transparent,advanced:s.advanced},function(t){null!=t&&e(i.el).val(t).change()})}if("date"==this.type){if(e(i.el).prop("readonly")||e(i.el).prop("disabled"))return;0===e("#w2ui-overlay").length&&e(i.el).w2overlay('<div class="w2ui-reset w2ui-calendar"></div>',{css:{"background-color":"#f5f5f5"},onShow:function(t){w2utils.isIE&&(console.log("IE"),e(".w2ui-calendar").on("mousedown",function(t){var i=e(t.target);1==i.length&&"w2ui-jump-year"==i[0].id&&e("#w2ui-overlay").data("keepOpen",!0)}))}});(o=w2utils.isDate(e(i.el).val(),i.options.format,!0))&&(a=o.getMonth()+1,r=o.getFullYear()),function t(s,n){e("#w2ui-overlay > div > div").html(i.getMonthHTML(s,n,e(i.el).val())),e("#w2ui-overlay .w2ui-calendar-title").on("mousedown",function(){if(e(this).next().hasClass("w2ui-calendar-jump"))e(this).next().remove();else{var s,n;e(this).after('<div class="w2ui-calendar-jump" style=""></div>'),e(this).next().hide().html(i.getYearHTML()).fadeIn(200),setTimeout(function(){e("#w2ui-overlay .w2ui-calendar-jump").find(".w2ui-jump-month, .w2ui-jump-year").on("click",function(){e(this).hasClass("w2ui-jump-month")&&(e(this).parent().find(".w2ui-jump-month").removeClass("selected"),e(this).addClass("selected"),n=e(this).attr("name")),e(this).hasClass("w2ui-jump-year")&&(e(this).parent().find(".w2ui-jump-year").removeClass("selected"),e(this).addClass("selected"),s=e(this).attr("name")),null!=s&&null!=n&&(e("#w2ui-overlay .w2ui-calendar-jump").fadeOut(100),setTimeout(function(){t(parseInt(n)+1,s)},100))}),e("#w2ui-overlay .w2ui-calendar-jump >:last-child").prop("scrollTop",2e3)},1)}}),e("#w2ui-overlay .w2ui-date").on("mousedown",function(){var t=e(this).attr("date");e(i.el).val(t).change(),e(this).css({"background-color":"#B6D5FB","border-color":"#aaa"})}).on("mouseup",function(){setTimeout(function(){e("#w2ui-overlay").length>0&&e("#w2ui-overlay").removeData("keepOpen")[0].hide()},10)}),e("#w2ui-overlay .previous").on("mousedown",function(){var e=i.options.current.split("/");e[0]=parseInt(e[0])-1,t(e[0],e[1])}),e("#w2ui-overlay .next").on("mousedown",function(){var e=i.options.current.split("/");e[0]=parseInt(e[0])+1,t(e[0],e[1])})}(a,r)}if("time"==this.type){if(e(i.el).prop("readonly")||e(i.el).prop("disabled"))return;0===e("#w2ui-overlay").length&&e(i.el).w2overlay('<div class="w2ui-reset w2ui-calendar-time" onclick="event.stopPropagation();"></div>',{css:{"background-color":"#fff"}});var n="h24"==this.options.format;e("#w2ui-overlay > div").html(i.getHourHTML()),e("#w2ui-overlay .w2ui-time").on("mousedown",function(t){e(this).css({"background-color":"#B6D5FB","border-color":"#aaa"});var s=e(this).attr("hour");e(i.el).val((s>12&&!n?s-12:s)+":00"+(n?"":s<12?" am":" pm")).change()}),null==this.options.noMinutes||!1===this.options.noMinutes?e("#w2ui-overlay .w2ui-time").on("mouseup",function(){var t=e(this).attr("hour");e("#w2ui-overlay").length>0&&e("#w2ui-overlay")[0].hide(),e(i.el).w2overlay('<div class="w2ui-reset w2ui-calendar-time"></div>',{css:{"background-color":"#fff"}}),e("#w2ui-overlay > div").html(i.getMinHTML(t)),e("#w2ui-overlay .w2ui-time").on("mousedown",function(){e(this).css({"background-color":"#B6D5FB","border-color":"#aaa"});var s=e(this).attr("min");e(i.el).val((t>12&&!n?t-12:t)+":"+(s<10?0:"")+s+(n?"":t<12?" am":" pm")).change()}).on("mouseup",function(){setTimeout(function(){e("#w2ui-overlay").length>0&&e("#w2ui-overlay").removeData("keepOpen")[0].hide()},10)})}):e("#w2ui-overlay .w2ui-time").on("mouseup",function(){setTimeout(function(){e("#w2ui-overlay").length>0&&e("#w2ui-overlay").removeData("keepOpen")[0].hide()},10)})}if("datetime"==this.type){if(e(i.el).prop("readonly")||e(i.el).prop("disabled"))return;e("#w2ui-overlay .w2ui-time").length>0&&e("#w2ui-overlay")[0].hide(),0===e("#w2ui-overlay").length&&e(i.el).w2overlay('<div class="w2ui-reset w2ui-calendar" onclick="event.stopPropagation();"></div>',{css:{"background-color":"#f5f5f5"},onShow:function(t){w2utils.isIE&&(console.log("IE"),e(".w2ui-calendar").on("mousedown",function(t){var i=e(t.target);1==i.length&&"w2ui-jump-year"==i[0].id&&e("#w2ui-overlay").data("keepOpen",!0)}))}});var a,r,o=w2utils.isDateTime(e(i.el).val(),i.options.format,!0);o&&(a=o.getMonth()+1,r=o.getFullYear());var l=null;!function t(n,a){e("#w2ui-overlay > div > div").html(i.getMonthHTML(n,a,e(i.el).val())+(s.btn_now?'<div class="w2ui-calendar-now now">'+w2utils.lang("Current Date & Time")+"</div>":"")),e("#w2ui-overlay .w2ui-calendar-title").on("mousedown",function(){if(e(this).next().hasClass("w2ui-calendar-jump"))e(this).next().remove();else{var s,n;e(this).after('<div class="w2ui-calendar-jump" style=""></div>'),e(this).next().hide().html(i.getYearHTML()).fadeIn(200),setTimeout(function(){e("#w2ui-overlay .w2ui-calendar-jump").find(".w2ui-jump-month, .w2ui-jump-year").on("click",function(){e(this).hasClass("w2ui-jump-month")&&(e(this).parent().find(".w2ui-jump-month").removeClass("selected"),e(this).addClass("selected"),n=e(this).attr("name")),e(this).hasClass("w2ui-jump-year")&&(e(this).parent().find(".w2ui-jump-year").removeClass("selected"),e(this).addClass("selected"),s=e(this).attr("name")),null!=s&&null!=n&&(e("#w2ui-overlay .w2ui-calendar-jump").fadeOut(100),setTimeout(function(){t(parseInt(n)+1,s)},100))}),e("#w2ui-overlay .w2ui-calendar-jump >:last-child").prop("scrollTop",2e3)},1)}}),e("#w2ui-overlay .w2ui-date").on("mousedown",function(){var t=e(this).attr("date");e(i.el).val(t).change(),e(this).css({"background-color":"#B6D5FB","border-color":"#aaa"}),l=new Date(e(this).attr("data-date"))}).on("mouseup",function(){var t,s;e("#w2ui-overlay").length>0&&e("#w2ui-overlay")[0].hide(),e(i.el).w2overlay('<div class="w2ui-reset w2ui-calendar-time"></div>',{css:{"background-color":"#fff"}}),i.options.format,e("#w2ui-overlay > div").html(i.getHourHTML()),e("#w2ui-overlay .w2ui-time").on("mousedown",function(s){e(this).css({"background-color":"#B6D5FB","border-color":"#aaa"}),t=e(this).attr("hour"),l.setHours(t);var n=w2utils.formatDateTime(l,i.options.format);e(i.el).val(n).change()}),null==i.options.noMinutes||!1===i.options.noMinutes?e("#w2ui-overlay .w2ui-time").on("mouseup",function(){var n=e(this).attr("hour");e("#w2ui-overlay").length>0&&e("#w2ui-overlay")[0].hide(),e(i.el).w2overlay('<div class="w2ui-reset w2ui-calendar-time"></div>',{css:{"background-color":"#fff"}}),e("#w2ui-overlay > div").html(i.getMinHTML(n)),e("#w2ui-overlay .w2ui-time").on("mousedown",function(){e(this).css({"background-color":"#B6D5FB","border-color":"#aaa"}),s=e(this).attr("min"),l.setHours(t,s);var n=w2utils.formatDateTime(l,i.options.format);e(i.el).val(n).change()}).on("mouseup",function(){setTimeout(function(){e("#w2ui-overlay").length>0&&e("#w2ui-overlay").removeData("keepOpen")[0].hide()},10)})}):e("#w2ui-overlay .w2ui-time").on("mouseup",function(){setTimeout(function(){e("#w2ui-overlay").length>0&&e("#w2ui-overlay").removeData("keepOpen")[0].hide()},10)})}),e("#w2ui-overlay .previous").on("mousedown",function(){var e=i.options.current.split("/");e[0]=parseInt(e[0])-1,t(e[0],e[1])}),e("#w2ui-overlay .next").on("mousedown",function(){var e=i.options.current.split("/");e[0]=parseInt(e[0])+1,t(e[0],e[1])}),e("#w2ui-overlay .now").on("mousedown",function(){var t=w2utils.formatDateTime(new Date,i.options.format);return e(i.el).val(t).change(),!1}).on("mouseup",function(){setTimeout(function(){e("#w2ui-overlay").length>0&&e("#w2ui-overlay").removeData("keepOpen")[0].hide()},10)})}(a,r)}if(-1!=["list","combo","enum"].indexOf(this.type)){var d=this.el,u=this.el;if("enum"==this.type&&(d=e(this.helpers.multi),u=e(d).find("input")),"list"==this.type){var c=e(u).data("selected");e.isPlainObject(c)&&!e.isEmptyObject(c)&&-1==s.index&&s.items.forEach(function(e,t){e.id===c.id&&(s.index=t)}),u=e(this.helpers.focus).find("input")}if(e(u).is(":focus")){if(!1===s.openOnFocus&&""===e(u).val()&&!0!==i.tmp.force_open)return void e().w2overlay();if(i.tmp.force_hide)return e().w2overlay(),void setTimeout(function(){delete i.tmp.force_hide},1);""!==e(u).val()&&delete i.tmp.force_open;var h=w2utils.lang("No matches");null!=s.url&&e(u).val().length<s.minLength&&!0!==i.tmp.emptySet&&(h=s.minLength+" "+w2utils.lang("letters or more...")),null!=s.url&&""===e(u).val()&&!0!==i.tmp.emptySet&&(h=w2utils.lang("Type to search...")),null==s.url&&0===s.items.length&&(h=w2utils.lang("Empty list")),null!=s.msgNoItems&&(h=s.msgNoItems),"function"==h&&(h=h(s)),e(d).w2menu(t?"refresh-index":"refresh",e.extend(!0,{},s,{search:!1,render:s.renderDrop,maxHeight:s.maxDropHeight,maxWidth:s.maxDropWidth,msgNoItems:h,onSelect:function(t){if("enum"==i.type){var n=e(i.el).data("selected");if(t.item){var a=i.trigger({phase:"before",type:"add",target:i.el,originalEvent:t.originalEvent,item:t.item});if(!0===a.isCancelled)return;n.length>=s.max&&s.max>0&&n.pop(),delete t.item.hidden,n.push(t.item),e(i.el).data("selected",n).change(),e(i.helpers.multi).find("input").val("").width(20),i.refresh(),e("#w2ui-overlay").length>0&&e("#w2ui-overlay")[0].hide(),i.trigger(e.extend(a,{phase:"after"}))}}else e(i.el).data("selected",t.item).val(t.item.text).change(),i.helpers.focus&&i.helpers.focus.find("input").val("")}}))}}},inRange:function(t,i){var s=!1;if("date"==this.type){if(f=w2utils.isDate(t,this.options.format,!0)){if(this.options.start||this.options.end){var n="string"==typeof this.options.start?this.options.start:e(this.options.start).val(),a="string"==typeof this.options.end?this.options.end:e(this.options.end).val(),r=w2utils.isDate(n,this.options.format,!0),o=w2utils.isDate(a,this.options.format,!0),l=new Date(f);r||(r=l),o||(o=l),l>=r&&l<=o&&(s=!0)}else s=!0;if(this.options.blocked&&-1!=e.inArray(t,this.options.blocked)&&(s=!1),null!=this.options.blockWeekDays&&void 0!=this.options.blockWeekDays&&void 0!=this.options.blockWeekDays.length)for(var d=this.options.blockWeekDays.length,u=0;u<d;u++)f.getDay()==this.options.blockWeekDays[u]&&(s=!1)}}else if("time"==this.type)if(this.options.start||this.options.end){var c=this.toMin(t),h=this.toMin(this.options.start),p=this.toMin(this.options.end);h||(h=c),p||(p=c),c>=h&&c<=p&&(s=!0)}else s=!0;else if("datetime"==this.type){var f=w2utils.isDateTime(t,this.options.format,!0);if(f){if(this.options.start||this.options.end){r="object"==typeof this.options.start&&this.options.start instanceof Date?this.options.start:""!==(n="string"==typeof this.options.start?this.options.start:e(this.options.start).val()).trim()?w2utils.isDateTime(n,this.options.format,!0):"",o="object"==typeof this.options.end&&this.options.end instanceof Date?this.options.end:""!==(a="string"==typeof this.options.end?this.options.end:e(this.options.end).val()).trim()?w2utils.isDateTime(a,this.options.format,!0):"";l=f;r||(r=l),o||(o=l),i&&r instanceof Date&&(r.setHours(0),r.setMinutes(0),r.setSeconds(0)),l>=r&&l<=o&&(s=!0)}else s=!0;if(s&&this.options.blocked)for(u=0;u<this.options.blocked.length;u++){var g=this.options.blocked[u];if("string"==typeof g&&(g=w2utils.isDateTime(g,this.options.format,!0)),"object"==typeof g&&g instanceof Date&&g.getFullYear()==f.getFullYear()&&g.getMonth()==f.getMonth()&&g.getDate()==f.getDate()){s=!1;break}}}}return s},checkType:function(e,t){var i=this;switch(i.type){case"int":return!(!t||-1==["-",i.options.groupSymbol].indexOf(e))||w2utils.isInt(e.replace(i.options.numberRE,""));case"percent":e=e.replace(/%/g,"");case"float":return!(!t||-1==["-",w2utils.settings.decimalSymbol,i.options.groupSymbol].indexOf(e))||w2utils.isFloat(e.replace(i.options.numberRE,""));case"money":case"currency":return!(!t||-1==["-",i.options.decimalSymbol,i.options.groupSymbol,i.options.currencyPrefix,i.options.currencySuffix].indexOf(e))||w2utils.isFloat(e.replace(i.options.moneyRE,""));case"bin":return w2utils.isBin(e);case"hex":return w2utils.isHex(e);case"alphanumeric":return w2utils.isAlphaNumeric(e)}return!0},addPrefix:function(){var t=this;setTimeout(function(){if("clear"!==t.type){var i,s=e(t.el).data("tmp")||{};s["old-padding-left"]&&e(t.el).css("padding-left",s["old-padding-left"]),s["old-padding-left"]=e(t.el).css("padding-left"),e(t.el).data("tmp",s),t.helpers.prefix&&e(t.helpers.prefix).remove(),""!==t.options.prefix&&(e(t.el).before('<div class="w2ui-field-helper">'+t.options.prefix+"</div>"),(i=e(t.el).prev()).css({color:e(t.el).css("color"),"font-family":e(t.el).css("font-family"),"font-size":e(t.el).css("font-size"),"padding-top":e(t.el).css("padding-top"),"padding-bottom":e(t.el).css("padding-bottom"),"padding-left":e(t.el).css("padding-left"),"padding-right":0,"margin-top":parseInt(e(t.el).css("margin-top"),10)+2+"px","margin-bottom":parseInt(e(t.el).css("margin-bottom"),10)+1+"px","margin-left":e(t.el).css("margin-left"),"margin-right":0}).on("click",function(i){if(t.options.icon&&"function"==typeof t.onIconClick){var s=t.trigger({phase:"before",type:"iconClick",target:t.el,el:e(this).find("span.w2ui-icon")[0]});if(!0===s.isCancelled)return;t.trigger(e.extend(s,{phase:"after"}))}else"list"==t.type?e(t.helpers.focus).find("input").focus():e(t.el).focus()}),e(t.el).css("padding-left",i.width()+parseInt(e(t.el).css("padding-left"),10)+"px"),t.helpers.prefix=i)}},1)},addSuffix:function(){var t,i,s=this;setTimeout(function(){if("clear"!==s.type){var n=e(s.el).data("tmp")||{};n["old-padding-right"]&&e(s.el).css("padding-right",n["old-padding-right"]),n["old-padding-right"]=e(s.el).css("padding-right"),e(s.el).data("tmp",n),i=parseInt(e(s.el).css("padding-right"),10),s.options.arrows&&(s.helpers.arrows&&e(s.helpers.arrows).remove(),e(s.el).after('<div class="w2ui-field-helper" style="border: 1px solid transparent">&#160;    <div class="w2ui-field-up" type="up">        <div class="arrow-up" type="up"></div>    </div>    <div class="w2ui-field-down" type="down">        <div class="arrow-down" type="down"></div>    </div></div>'),w2utils.getSize(s.el,"height"),(t=e(s.el).next()).css({color:e(s.el).css("color"),"font-family":e(s.el).css("font-family"),"font-size":e(s.el).css("font-size"),height:e(s.el).height()+parseInt(e(s.el).css("padding-top"),10)+parseInt(e(s.el).css("padding-bottom"),10)+"px",padding:0,"margin-top":parseInt(e(s.el).css("margin-top"),10)+1+"px","margin-bottom":0,"border-left":"1px solid silver"}).css("margin-left","-"+(t.width()+parseInt(e(s.el).css("margin-right"),10)+12)+"px").on("mousedown",function(t){function i(){clearTimeout(a.data("_field_update_timer")),a.off("mouseup",i)}function n(i){e(s.el).focus(),s.keyDown(e.Event("keydown"),{keyCode:"up"==e(t.target).attr("type")?38:40}),!1!==i&&e("body").data("_field_update_timer",setTimeout(n,60))}var a=e("body");a.on("mouseup",i),a.data("_field_update_timer",setTimeout(n,700)),n(!1)}),i+=t.width()+12,e(s.el).css("padding-right",i+"px"),s.helpers.arrows=t),""!==s.options.suffix&&(s.helpers.suffix&&e(s.helpers.suffix).remove(),e(s.el).after('<div class="w2ui-field-helper">'+s.options.suffix+"</div>"),(t=e(s.el).next()).css({color:e(s.el).css("color"),"font-family":e(s.el).css("font-family"),"font-size":e(s.el).css("font-size"),"padding-top":e(s.el).css("padding-top"),"padding-bottom":e(s.el).css("padding-bottom"),"padding-left":"3px","padding-right":e(s.el).css("padding-right"),"margin-top":parseInt(e(s.el).css("margin-top"),10)+2+"px","margin-bottom":parseInt(e(s.el).css("margin-bottom"),10)+1+"px"}).on("click",function(t){"list"==s.type?e(s.helpers.focus).find("input").focus():e(s.el).focus()}),t.css("margin-left","-"+(w2utils.getSize(t,"width")+parseInt(e(s.el).css("margin-right"),10)+2)+"px"),i+=t.width()+3,e(s.el).css("padding-right",i+"px"),s.helpers.suffix=t)}},1)},addFocus:function(){var t,i=this,s=(this.options,0);e(i.helpers.focus).remove();var n=e(i.el).attr("tabIndex");n&&-1!=n&&(i.el._tabIndex=n),i.el._tabIndex&&(n=i.el._tabIndex),null==n&&(n=-1);var a='<div class="w2ui-field-helper">    <div class="w2ui-icon icon-search" style="opacity: 0; display: none"></div>    <input type="text" autocomplete="off" tabIndex="'+n+'"/></div>';e(i.el).attr("tabindex",-1).before(a);var r=e(i.el).prev();i.helpers.focus=r,r.css({width:e(i.el).width(),"margin-top":e(i.el).css("margin-top"),"margin-left":parseInt(e(i.el).css("margin-left"))+parseInt(e(i.el).css("padding-left"))+"px","margin-bottom":e(i.el).css("margin-bottom"),"margin-right":e(i.el).css("margin-right")}).find("input").css({cursor:"default",width:"100%",outline:"none",opacity:1,margin:0,border:"1px solid transparent",padding:e(i.el).css("padding-top"),"padding-left":0,"margin-left":s>0?s+6:0,"background-color":"transparent"}),r.find("input").on("click",function(t){0===e("#w2ui-overlay").length&&i.focus(t),t.stopPropagation()}).on("focus",function(s){t=e(i.el).attr("placeholder"),e(i.el).css({outline:"auto 5px #7DB4F3","outline-offset":"-2px"}),e(this).val(""),e(i.el).triggerHandler("focus"),s.stopPropagation?s.stopPropagation():s.cancelBubble=!0}).on("blur",function(s){e(i.el).css("outline","none"),e(this).val(""),i.refresh(),e(i.el).triggerHandler("blur"),s.stopPropagation?s.stopPropagation():s.cancelBubble=!0,null!=t&&e(i.el).attr("placeholder",t)}).on("keydown",function(s){var n=this;i.keyDown(s),setTimeout(function(){""===n.value?e(i.el).attr("placeholder",t):e(i.el).attr("placeholder","")},10)}).on("keyup",function(e){i.keyUp(e)}).on("keypress",function(e){i.keyPress(e)}),r.on("click",function(t){e(this).find("input").focus()}),i.refresh()},addMulti:function(){var t=this;this.options,e(t.helpers.multi).remove();var i="",s="margin-top     : 0px; margin-bottom  : 0px; margin-left    : "+e(t.el).css("margin-left")+"; margin-right   : "+e(t.el).css("margin-right")+"; width          : "+(w2utils.getSize(t.el,"width")-parseInt(e(t.el).css("margin-left"),10)-parseInt(e(t.el).css("margin-right"),10))+"px;";if("enum"==t.type){var n=e(t.el).attr("tabIndex");n&&-1!=n&&(t.el._tabIndex=n),t.el._tabIndex&&(n=t.el._tabIndex),null==n&&(n=-1),i='<div class="w2ui-field-helper w2ui-list" style="'+s+'; box-sizing: border-box">    <div style="padding: 0px; margin: 0px; display: inline-block" class="w2ui-multi-items">    <ul>        <li style="padding-left: 0px; padding-right: 0px" class="nomouse">            <input type="text" style="width: 20px; margin: -3px 0 0; padding: 2px 0; border-color: white" autocomplete="off"'+(e(t.el).prop("readonly")?' readonly="readonly"':"")+(e(t.el).prop("disabled")?' disabled="disabled"':"")+' tabindex="'+n+'"/>        </li>    </ul>    </div></div>'}"file"==t.type&&(i='<div class="w2ui-field-helper w2ui-list" style="'+s+'; box-sizing: border-box">   <div style="position: absolute; left: 0px; right: 0px; top: 0px; bottom: 0px;">       <input class="file-input" type="file" style="width: 100%; height: 100%; opacity: 0;" name="attachment" multiple tabindex="-1"'+(e(t.el).prop("readonly")?' readonly="readonly"':"")+(e(t.el).prop("disabled")?' disabled="disabled"':"")+(e(t.el).attr("accept")?' accept="'+e(t.el).attr("accept")+'"':"")+'/>   </div>    <div style="position: absolute; padding: 0px; margin: 0px; display: inline-block" class="w2ui-multi-items">        <ul><li style="padding-left: 0px; padding-right: 0px" class="nomouse"></li></ul>    </div></div>');var a=e(t.el).data("tmp")||{};a["old-background-color"]=e(t.el).css("background-color"),a["old-border-color"]=e(t.el).css("border-color"),e(t.el).data("tmp",a),e(t.el).before(i).css({"background-color":"transparent","border-color":"transparent"});var r=e(t.el).prev();t.helpers.multi=r,"enum"==t.type&&(e(t.el).attr("tabindex",-1),r.find("input").on("click",function(i){0===e("#w2ui-overlay").length&&t.focus(i),e(t.el).triggerHandler("click")}).on("focus",function(i){e(r).css({outline:"auto 5px #7DB4F3","outline-offset":"-2px"}),e(t.el).triggerHandler("focus"),i.stopPropagation?i.stopPropagation():i.cancelBubble=!0}).on("blur",function(i){e(r).css("outline","none"),e(t.el).triggerHandler("blur"),i.stopPropagation?i.stopPropagation():i.cancelBubble=!0}).on("keyup",function(e){t.keyUp(e)}).on("keydown",function(e){t.keyDown(e)}).on("keypress",function(e){t.keyPress(e)}),r.on("click",function(t){e(this).find("input").focus()})),"file"==t.type&&(e(t.el).css("outline","none"),r.on("click",function(i){e(t.el).focus(),e(t.el).prop("readonly")||e(t.el).prop("disabled")||(t.blur(i),t.resize(),setTimeout(function(){r.find("input").click()},10))}).on("dragenter",function(i){e(t.el).prop("readonly")||e(t.el).prop("disabled")||e(r).addClass("w2ui-file-dragover")}).on("dragleave",function(i){e(t.el).prop("readonly")||e(t.el).prop("disabled")||0===e(i.target).parents(".w2ui-field-helper").length&&e(r).removeClass("w2ui-file-dragover")}).on("drop",function(i){if(!e(t.el).prop("readonly")&&!e(t.el).prop("disabled")){e(r).removeClass("w2ui-file-dragover");for(var s=i.originalEvent.dataTransfer.files,n=0,a=s.length;n<a;n++)t.addFile.call(t,s[n]);i.preventDefault(),i.stopPropagation()}}).on("dragover",function(e){e.preventDefault(),e.stopPropagation()}),r.find("input").on("click",function(e){e.stopPropagation()}).on("change",function(){if(void 0!==this.files)for(var e=0,i=this.files.length;e<i;e++)t.addFile.call(t,this.files[e])})),t.refresh()},addFile:function(t){var i,s=this,n=this.options,a=e(s.el).data("selected"),r={name:t.name,type:t.type,modified:t.lastModifiedDate,size:t.size,content:null,file:t},o=0,l=0;if(a)for(var d=0;d<a.length;d++){if(a[d].name==t.name&&a[d].size==t.size)return;o+=a[d].size,l++}var u=s.trigger({phase:"before",type:"add",target:s.el,file:r,total:l,totalSize:o});if(!0!==u.isCancelled){if(0!==n.maxFileSize&&r.size>n.maxFileSize)return i="Maximum file size is "+w2utils.formatSize(n.maxFileSize),!1===n.silent&&e(s.el).w2tag(i),void console.log("ERROR: "+i);if(0!==n.maxSize&&o+r.size>n.maxSize)return i=w2utils.lang("Maximum total size is")+" "+w2utils.formatSize(n.maxSize),void(!1===n.silent?e(s.el).w2tag(i):console.log("ERROR: "+i));if(0!==n.max&&l>=n.max)return i=w2utils.lang("Maximum number of files is")+" "+n.max,void(!1===n.silent?e(s.el).w2tag(i):console.log("ERROR: "+i));if(a.push(r),"undefined"!=typeof FileReader&&!0===n.readContent){var c=new FileReader;c.onload=function(t){var i=t.target.result,n=i.indexOf(",");r.content=i.substr(n+1),s.refresh(),e(s.el).trigger("change"),s.trigger(e.extend(u,{phase:"after"}))},c.readAsDataURL(t)}else s.refresh(),e(s.el).trigger("change"),s.trigger(e.extend(u,{phase:"after"}))}},normMenu:function(t){if(e.isArray(t)){for(s=0;s<t.length;s++)"string"==typeof t[s]?t[s]={id:t[s],text:t[s]}:(null!=t[s].text&&null==t[s].id&&(t[s].id=t[s].text),null==t[s].text&&null!=t[s].id&&(t[s].text=t[s].id),null!=t[s].caption&&(t[s].text=t[s].caption));return t}if("function"==typeof t)return this.normMenu(t());if("object"==typeof t){var i=[];for(var s in t)i.push({id:s,text:t[s]});return i}},getMonthHTML:function(e,t,i){var s=new Date,n=w2utils.settings.fullmonths,a=["31","28","31","30","31","30","31","31","30","31","30","31"],r=s.getFullYear()+"/"+(Number(s.getMonth())+1)+"/"+s.getDate(),o=w2utils.settings.fulldays.slice(),l=w2utils.settings.shortdays.slice();"M"!=w2utils.settings.weekStarts&&(o.unshift(o.pop()),l.unshift(l.pop()));var d=this.options;null==d&&(d={}),t=w2utils.isInt(t)?parseInt(t):s.getFullYear(),(e=w2utils.isInt(e)?parseInt(e):s.getMonth()+1)>12&&(e-=12,t++),(e<1||0===e)&&(e+=12,t--),t/4==Math.floor(t/4)?a[1]="29":a[1]="28",d.current=e+"/"+t;for(var u=(s=new Date(t,e-1,1)).getDay(),c="",h=0;h<l.length;h++)c+='<td title="'+o[h]+'">'+l[h]+"</td>";var p='<div class="w2ui-calendar-title title">    <div class="w2ui-calendar-previous previous"> <div></div> </div>    <div class="w2ui-calendar-next next"> <div></div> </div> '+n[e-1]+", "+t+'</div><table class="w2ui-calendar-days" cellspacing="0"><tbody>    <tr class="w2ui-day-title">'+c+"</tr>    <tr>",f=1;if("M"!=w2utils.settings.weekStarts&&u++,"datetime"===this.type){var g=w2utils.isDateTime(i,d.format,!0);i=w2utils.formatDate(g,w2utils.settings.dateFormat)}for(var m=1;m<43;m++){if(0===u&&1==m){for(var w=0;w<6;w++)p+='<td class="w2ui-day-empty">&#160;</td>';m+=6}else if(m<u||f>a[e-1]){p+='<td class="w2ui-day-empty">&#160;</td>',m%7==0&&(p+="</tr><tr>");continue}var v=t+"/"+e+"/"+f,y=new Date(v),b="";6===y.getDay()&&(b=" w2ui-saturday"),0===y.getDay()&&(b=" w2ui-sunday"),v==r&&(b+=" w2ui-today");var x,_,k=f,C="",T="";if("datetime"===this.type?(x=w2utils.formatDateTime(v,d.format),_=w2utils.formatDate(v,w2utils.settings.dateFormat)):(x=w2utils.formatDate(v,d.format),_=x),d.colored&&void 0!==d.colored[_]){var $=d.colored[_].split(":");T="background-color: "+$[0]+";",C="color: "+$[1]+";"}p+='<td class="'+(this.inRange(x,!0)?"w2ui-date "+(_==i?"w2ui-date-selected":""):"w2ui-blocked")+b+'"    style="'+C+T+'" date="'+x+'" data-date="'+y+'">'+k+"</td>",(m%7==0||0===u&&1==m)&&(p+="</tr><tr>"),f++}return p+="</tr></tbody></table>"},getYearHTML:function(){for(var e=w2utils.settings.shortmonths,t=w2utils.settings.dateStartYear,i=w2utils.settings.dateEndYear,s="",n="",a=0;a<e.length;a++)s+='<div class="w2ui-jump-month" name="'+a+'">'+e[a]+"</div>";for(var r=t;r<=i;r++)n+='<div class="w2ui-jump-year" name="'+r+'">'+r+"</div>";return'<div id="w2ui-jump-month">'+s+'</div><div id="w2ui-jump-year">'+n+"</div>"},getHourHTML:function(){var e=[],t=this.options;null==t&&(t={format:w2utils.settings.timeFormat});for(var i=t.format.indexOf("h24")>-1,s=0;s<24;s++){var n=(s>=12&&!i?s-12:s)+":00"+(i?"":s<12?" am":" pm");12!=s||i||(n="12:00 pm"),e[Math.floor(s/8)]||(e[Math.floor(s/8)]="");var a=this.fromMin(this.toMin(n)),r=this.fromMin(this.toMin(n)+59);if("datetime"===this.type){var o=w2utils.isDateTime(this.el.value,t.format,!0),l=t.format.split("|")[0].trim();a=w2utils.formatDate(o,l)+" "+a,r=w2utils.formatDate(o,l)+" "+r}e[Math.floor(s/8)]+='<div class="'+(this.inRange(a)||this.inRange(r)?"w2ui-time ":"w2ui-blocked")+'" hour="'+s+'">'+n+"</div>"}return'<div class="w2ui-calendar">   <div class="w2ui-calendar-title">'+w2utils.lang("Select Hour")+'</div>   <div class="w2ui-calendar-time"><table><tbody><tr>       <td>'+e[0]+"</td>       <td>"+e[1]+"</td>       <td>"+e[2]+"</td>   </tr></tbody></table></div></div>"},getMinHTML:function(e){null==e&&(e=0);var t=this.options;null==t&&(t={format:w2utils.settings.timeFormat});for(var i=t.format.indexOf("h24")>-1,s=[],n=0;n<60;n+=5){var a=(e>12&&!i?e-12:e)+":"+(n<10?0:"")+n+" "+(i?"":e<12?"am":"pm"),r=a,o=n<20?0:n<40?1:2;if(s[o]||(s[o]=""),"datetime"===this.type){var l=w2utils.isDateTime(this.el.value,t.format,!0),d=t.format.split("|")[0].trim();r=w2utils.formatDate(l,d)+" "+r}s[o]+='<div class="'+(this.inRange(r)?"w2ui-time ":"w2ui-blocked")+'" min="'+n+'">'+a+"</div>"}return'<div class="w2ui-calendar">   <div class="w2ui-calendar-title">'+w2utils.lang("Select Minute")+'</div>   <div class="w2ui-calendar-time"><table><tbody><tr>       <td>'+s[0]+"</td>       <td>"+s[1]+"</td>       <td>"+s[2]+"</td>   </tr></tbody></table></div></div>"},toMin:function(e){if("string"!=typeof e)return null;var t=e.split(":");return 2!==t.length?null:(t[0]=parseInt(t[0]),t[1]=parseInt(t[1]),-1!=e.indexOf("pm")&&12!=t[0]&&(t[0]+=12),60*t[0]+t[1])},fromMin:function(e){e>=1440&&(e%=1440),e<0&&(e=1440+e);var t=Math.floor(e/60),i=(e%60<10?"0":"")+e%60,s=this.options;return null==s&&(s={format:w2utils.settings.timeFormat}),-1!=s.format.indexOf("h24")?t+":"+i:(t<=12?t:t-12)+":"+i+" "+(t>=12?"pm":"am")}},e.extend(t.prototype,w2utils.event),w2obj.field=t}(jQuery),function($){var w2form=function(e){this.name=null,this.header="",this.box=null,this.url="",this.routeData={},this.formURL="",this.formHTML="",this.page=0,this.recid=0,this.fields=[],this.actions={},this.record={},this.original={},this.postData={},this.httpHeaders={},this.method=null,this.toolbar={},this.tabs={},this.style="",this.focus=0,this.multipart=!1,this.isGenerated=!1,this.last={xhr:null},$.extend(!0,this,w2obj.form,e)};$.fn.w2form=function(e){if($.isPlainObject(e)){var t=this;if(!w2utils.checkName(e,"w2form"))return;var i=e.record,s=e.original,n=e.fields,a=e.toolbar,r=e.tabs,o=new w2form(e);if($.extend(o,{record:{},original:{},fields:[],tabs:{},toolbar:{},handlers:[]}),$.isArray(r)){$.extend(!0,o.tabs,{tabs:[]});for(var l=0;l<r.length;l++){var d=r[l];"object"==typeof d?(o.tabs.tabs.push(d),!0===d.active&&(o.tabs.active=d.id)):o.tabs.tabs.push({id:d,caption:d})}}else $.extend(!0,o.tabs,r);if($.extend(!0,o.toolbar,a),n)for(c=0;c<n.length;c++){var u=$.extend(!0,{},n[c]);null==u.name&&null!=u.field&&(u.name=u.field),null==u.field&&null!=u.name&&(u.field=u.name),o.fields[c]=u}for(var c in i)$.isPlainObject(i[c])?o.record[c]=$.extend(!0,{},i[c]):o.record[c]=i[c];for(var c in s)$.isPlainObject(s[c])?o.original[c]=$.extend(!0,{},s[c]):o.original[c]=s[c];return t.length>0&&(o.box=t[0]),""!==o.formURL?$.get(o.formURL,function(e){o.formHTML=e,o.isGenerated=!0,0===$(o.box).length&&0===e.length||($(o.box).html(e),o.render(o.box))}):""!==o.formHTML||(0!==$(this).length&&""!==$.trim($(this).html())?o.formHTML=$(this).html():o.formHTML=o.generateHTML()),w2ui[o.name]=o,""===o.formURL&&(-1==String(o.formHTML).indexOf("w2ui-page")&&(o.formHTML='<div class="w2ui-page page-0">'+o.formHTML+"</div>"),$(o.box).html(o.formHTML),o.isGenerated=!0,o.render(o.box)),o}return(t=w2ui[$(this).attr("name")])?arguments.length>0?(t[e]&&t[e].apply(t,Array.prototype.slice.call(arguments,1)),this):t:null},w2form.prototype={onRequest:null,onLoad:null,onValidate:null,onSubmit:null,onProgress:null,onSave:null,onChange:null,onRender:null,onRefresh:null,onResize:null,onDestroy:null,onAction:null,onToolbar:null,onError:null,msgNotJSON:"Returned data is not in valid JSON format.",msgAJAXerror:"AJAX error. See console for more details.",msgRefresh:"Refreshing...",msgSaving:"Saving...",get:function(e,t){if(0===arguments.length){for(var i=[],s=0;s<this.fields.length;s++)null!=this.fields[s].name&&i.push(this.fields[s].name);return i}for(var n=0;n<this.fields.length;n++)if(this.fields[n].name==e)return!0===t?n:this.fields[n];return null},set:function(e,t){for(var i=0;i<this.fields.length;i++)if(this.fields[i].name==e)return $.extend(this.fields[i],t),this.refresh(),!0;return!1},show:function(){for(var e=0,t=0;t<arguments.length;t++){var i=this.get(arguments[t]);i&&i.hidden&&(i.hidden=!1,e++)}return e>0&&this.refresh(),e},hide:function(){for(var e=0,t=0;t<arguments.length;t++){var i=this.get(arguments[t]);i&&!i.hidden&&(i.hidden=!0,e++)}return e>0&&this.refresh(),e},enable:function(){for(var e=0,t=0;t<arguments.length;t++){var i=this.get(arguments[t]);i&&i.disabled&&(i.disabled=!1,e++)}return e>0&&this.refresh(),e},disable:function(){for(var e=0,t=0;t<arguments.length;t++){var i=this.get(arguments[t]);i&&!i.disabled&&(i.disabled=!0,e++)}return e>0&&this.refresh(),e},reload:function(e){("object"!=typeof this.url?this.url:this.url.get)&&0!==this.recid&&null!=this.recid?this.request(e):"function"==typeof e&&e()},clear:function(){this.recid=0,this.record={},$().w2tag(),this.refresh()},error:function(e){var t=this,i=this.trigger({target:this.name,type:"error",message:e,xhr:this.last.xhr});return!0===i.isCancelled?void("function"==typeof callBack&&callBack()):(setTimeout(function(){t.message(e)},1),void this.trigger($.extend(i,{phase:"after"})))},message:function(e){"string"==typeof e&&(e={width:e.length<300?350:550,height:e.length<300?170:250,body:'<div class="w2ui-centered">'+e+"</div>",buttons:'<button class="w2ui-btn" onclick="w2ui[\''+this.name+"'].message()\">Ok</button>",onOpen:function(e){setTimeout(function(){$(e.box).find(".w2ui-btn").focus()},25)}}),w2utils.message.call(this,{box:this.box,path:"w2ui."+this.name,title:".w2ui-form-header:visible",body:".w2ui-form-box"},e)},validate:function(e){null==e&&(e=!0),$().w2tag();for(var t=[],i=0;i<this.fields.length;i++){var s=this.fields[i];switch(null==this.record[s.name]&&(this.record[s.name]=""),s.type){case"int":this.record[s.name]&&!w2utils.isInt(this.record[s.name])&&t.push({field:s,error:w2utils.lang("Not an integer")});break;case"float":this.record[s.name]&&!w2utils.isFloat(this.record[s.name])&&t.push({field:s,error:w2utils.lang("Not a float")});break;case"money":this.record[s.name]&&!w2utils.isMoney(this.record[s.name])&&t.push({field:s,error:w2utils.lang("Not in money format")});break;case"color":case"hex":this.record[s.name]&&!w2utils.isHex(this.record[s.name])&&t.push({field:s,error:w2utils.lang("Not a hex number")});break;case"email":this.record[s.name]&&!w2utils.isEmail(this.record[s.name])&&t.push({field:s,error:w2utils.lang("Not a valid email")});break;case"checkbox":1==this.record[s.name]?this.record[s.name]=1:this.record[s.name]=0;break;case"date":s.options.format||(s.options.format=w2utils.settings.dateFormat),this.record[s.name]&&!w2utils.isDate(this.record[s.name],s.options.format)&&t.push({field:s,error:w2utils.lang("Not a valid date")+": "+s.options.format})}var n=this.record[s.name];s.required&&(""===n||$.isArray(n)&&0===n.length||$.isPlainObject(n)&&$.isEmptyObject(n))&&t.push({field:s,error:w2utils.lang("Required field")}),s.equalto&&this.record[s.name]!=this.record[s.equalto]&&t.push({field:s,error:w2utils.lang("Field should be equal to ")+s.equalto})}var a=this.trigger({phase:"before",target:this.name,type:"validate",errors:t});if(!0!==a.isCancelled){if(e)for(var r=0;r<a.errors.length;r++){var o=a.errors[r],l=$.extend({class:"w2ui-error"},o.options);null!=o.field&&("radio"==o.field.type?$($(o.field.el).parents("div")[0]).w2tag(o.error,l):-1!=["enum","file"].indexOf(o.field.type)?function(e){setTimeout(function(){var t=$(e.field.el).data("w2field").helpers.multi;$(e.field.el).w2tag(e.error,e.options),$(t).addClass("w2ui-error")},1)}(o):$(o.field.el).w2tag(o.error,l),this.goto(t[0].field.page))}return this.trigger($.extend(a,{phase:"after"})),t}},getChanges:function(){var e=function(t,i,s){for(var n in t)"object"==typeof t[n]?(s[n]=e(t[n],i[n]||{},{}),s[n]&&!$.isEmptyObject(s[n])||delete s[n]):t[n]!=i[n]&&(s[n]=t[n]);return s};return e(this.record,this.original,{})},request:function(postData,callBack){var obj=this;if("function"==typeof postData&&(callBack=postData,postData=null),null==postData&&(postData={}),this.url&&("object"!=typeof this.url||this.url.get)){null==this.recid&&(this.recid=0);var params={};params.cmd="get",params.recid=this.recid,params.name=this.name,$.extend(params,this.postData),$.extend(params,postData);var edata=this.trigger({phase:"before",type:"request",target:this.name,url:this.url,postData:params,httpHeaders:this.httpHeaders});if(!0===edata.isCancelled)return void("function"==typeof callBack&&callBack({status:"error",message:"Request aborted."}));this.record={},this.original={},this.lock(w2utils.lang(this.msgRefresh));var url=edata.url;if("object"==typeof edata.url&&edata.url.get&&(url=edata.url.get),this.last.xhr)try{this.last.xhr.abort()}catch(e){}if(!$.isEmptyObject(obj.routeData)){var info=w2utils.parseRoute(url);if(info.keys.length>0)for(var k=0;k<info.keys.length;k++)null!=obj.routeData[info.keys[k].name]&&(url=url.replace(new RegExp(":"+info.keys[k].name,"g"),obj.routeData[info.keys[k].name]))}var ajaxOptions={type:"POST",url:url,data:edata.postData,headers:edata.httpHeaders,dataType:"text"};switch(w2utils.settings.dataType){case"HTTP":ajaxOptions.data=String($.param(ajaxOptions.data,!1)).replace(/%5B/g,"[").replace(/%5D/g,"]");break;case"HTTPJSON":ajaxOptions.data={request:JSON.stringify(ajaxOptions.data)};break;case"RESTFULL":ajaxOptions.type="GET",ajaxOptions.data=String($.param(ajaxOptions.data,!1)).replace(/%5B/g,"[").replace(/%5D/g,"]");break;case"RESTFULLJSON":ajaxOptions.type="GET",ajaxOptions.data=JSON.stringify(ajaxOptions.data),ajaxOptions.contentType="application/json";break;case"JSON":ajaxOptions.type="POST",ajaxOptions.data=JSON.stringify(ajaxOptions.data),ajaxOptions.contentType="application/json"}this.method&&(ajaxOptions.type=this.method),this.last.xhr=$.ajax(ajaxOptions).done(function(data,status,xhr){obj.unlock();var edata=obj.trigger({phase:"before",target:obj.name,type:"load",xhr:xhr});if(!0!==edata.isCancelled){var data,responseText=obj.last.xhr.responseText;if("error"!=status){if(null!=responseText&&""!==responseText){if("object"==typeof responseText)data=responseText;else try{eval("data = "+responseText)}catch(e){}null==data&&(data={status:"error",message:w2utils.lang(obj.msgNotJSON),responseText:responseText}),"error"==data.status?obj.error(w2utils.lang(data.message)):(obj.record=$.extend({},data.record),obj.original=$.extend({},data.record))}}else obj.error("AJAX Error "+xhr.status+": "+xhr.statusText),data={status:"error",message:w2utils.lang(obj.msgAJAXerror),responseText:responseText};obj.trigger($.extend(edata,{phase:"after"})),obj.refresh(),"function"==typeof callBack&&callBack(data)}else"function"==typeof callBack&&callBack({status:"error",message:"Request aborted."})}).fail(function(e,t,i){var s={status:t,error:i,rawResponseText:e.responseText},n=obj.trigger({phase:"before",type:"error",error:s,xhr:e});if(!0!==n.isCancelled){if("abort"!=t){var a;try{a=$.parseJSON(e.responseText)}catch(e){}console.log("ERROR: Server communication failed.","\n   EXPECTED:",{status:"success",items:[{id:1,text:"item"}]},"\n         OR:",{status:"error",message:"error message"},"\n   RECEIVED:","object"==typeof a?a:e.responseText)}obj.trigger($.extend(n,{phase:"after"}))}}),this.trigger($.extend(edata,{phase:"after"}))}},submit:function(e,t){return this.save(e,t)},save:function(postData,callBack){var obj=this;$(this.box).find(":focus").change(),"function"==typeof postData&&(callBack=postData,postData=null);var errors=obj.validate(!0);if(0===errors.length){if(null==postData&&(postData={}),!obj.url||"object"==typeof obj.url&&!obj.url.save)return void console.log("ERROR: Form cannot be saved because no url is defined.");obj.lock(w2utils.lang(obj.msgSaving)+' <span id="'+obj.name+'_progress"></span>'),setTimeout(function(){function apend(e,t,i,s){function n(t,i,s){if("object"==typeof t&&t instanceof File&&e.append(s,t),"object"==typeof t)if(t&&t.constructor===Array)for(var a=0;a<t.length;a++){var r=i?i[a]:i;n(t[a],r,s+"["+a+"]")}else apend(e,t,i,s)}null==s&&(s="");for(var a in t){var r=""==s?a:"${p}[${prop}]",o=i?i[a]:i;n(t[a],o,r)}}var params={};params.cmd="save",params.recid=obj.recid,params.name=obj.name,$.extend(params,obj.postData),$.extend(params,postData),obj.multipart||obj.fields.forEach(function(e){"file"==e.type&&Array.isArray(obj.record[e.field])&&obj.record[e.field].forEach(function(e){delete e.file})}),params.record=$.extend(!0,{},obj.record);var edata=obj.trigger({phase:"before",type:"submit",target:obj.name,url:obj.url,postData:params,httpHeaders:obj.httpHeaders});if(!0!==edata.isCancelled){var url=edata.url;if("object"==typeof edata.url&&edata.url.save&&(url=edata.url.save),obj.last.xhr)try{obj.last.xhr.abort()}catch(e){}if(!$.isEmptyObject(obj.routeData)){var info=w2utils.parseRoute(url);if(info.keys.length>0)for(var k=0;k<info.keys.length;k++)null!=obj.routeData[info.keys[k].name]&&(url=url.replace(new RegExp(":"+info.keys[k].name,"g"),obj.routeData[info.keys[k].name]))}var ajaxOptions={type:"POST",url:url,data:edata.postData,headers:edata.httpHeaders,dataType:"text",xhr:function(){var e=new window.XMLHttpRequest;return e.upload.addEventListener("progress",function(e){if(e.lengthComputable){var t=obj.trigger({phase:"before",type:"progress",total:e.total,loaded:e.loaded,originalEvent:e});if(!0===t.isCancelled)return;var i=Math.round(e.loaded/e.total*100);$("#"+obj.name+"_progress").text(i+"%"),obj.trigger($.extend(t,{phase:"after"}))}},!1),e}};switch(w2utils.settings.dataType){case"HTTP":ajaxOptions.data=String($.param(ajaxOptions.data,!1)).replace(/%5B/g,"[").replace(/%5D/g,"]");break;case"HTTPJSON":ajaxOptions.data={request:JSON.stringify(ajaxOptions.data)};break;case"RESTFULL":0!==obj.recid&&null!=obj.recid&&(ajaxOptions.type="PUT"),ajaxOptions.data=String($.param(ajaxOptions.data,!1)).replace(/%5B/g,"[").replace(/%5D/g,"]");break;case"RESTFULLJSON":0!==obj.recid&&null!=obj.recid&&(ajaxOptions.type="PUT"),ajaxOptions.data=JSON.stringify(ajaxOptions.data),ajaxOptions.contentType="application/json";break;case"JSON":if(ajaxOptions.type="POST",ajaxOptions.contentType="application/json",obj.multipart){var fdata=new FormData;fdata.append("__body",JSON.stringify(ajaxOptions.data)),apend(fdata,ajaxOptions.data),ajaxOptions.data=fdata,ajaxOptions.contentType=!1,ajaxOptions.processData=!1}else ajaxOptions.data=JSON.stringify(ajaxOptions.data)}this.method&&(ajaxOptions.type=this.method),obj.last.xhr=$.ajax(ajaxOptions).done(function(data,status,xhr){obj.unlock();var edata=obj.trigger({phase:"before",target:obj.name,type:"save",xhr:xhr,status:status});if(!0!==edata.isCancelled){var data,responseText=xhr.responseText;if("error"!=status){if(null!=responseText&&""!==responseText){if("object"==typeof responseText)data=responseText;else try{eval("data = "+responseText)}catch(e){}null==data&&(data={status:"error",message:w2utils.lang(obj.msgNotJSON),responseText:responseText}),"error"==data.status?obj.error(w2utils.lang(data.message)):obj.original=$.extend({},obj.record)}}else obj.error("AJAX Error "+xhr.status+": "+xhr.statusText),data={status:"error",message:w2utils.lang(obj.msgAJAXerror),responseText:responseText};obj.trigger($.extend(edata,{phase:"after"})),obj.refresh(),"success"==data.status&&"function"==typeof callBack&&callBack(data)}}).fail(function(e,t,i){var s={status:t,error:i,rawResponseText:e.responseText},n=obj.trigger({phase:"before",type:"error",error:s,xhr:e});!0!==n.isCancelled&&(console.log("ERROR: server communication failed. The server should return",{status:"success"},"OR",{status:"error",message:"error message"},", instead the AJAX request produced this: ",s),obj.trigger($.extend(n,{phase:"after"})))}),obj.trigger($.extend(edata,{phase:"after"}))}},50)}},lock:function(e,t){var i=Array.prototype.slice.call(arguments,0);i.unshift(this.box),setTimeout(function(){w2utils.lock.apply(window,i)},10)},unlock:function(e){var t=this.box;setTimeout(function(){w2utils.unlock(t,e)},25)},goto:function(e){this.page!==e&&(null!=e&&(this.page=e),!0===$(this.box).data("auto-size")&&$(this.box).height(0),this.refresh())},generateHTML:function(){for(var e,t,i,s=[],n="",a=0;a<this.fields.length;a++){i="";var r=this.fields[a];null==r.html&&(r.html={}),null==r.options&&(r.options={}),r.html=$.extend(!0,{caption:"",span:6,attr:"",text:"",style:"",page:0,column:0},r.html),null==e&&(e=r.html.page),null==t&&(t=r.html.column),""===r.html.caption&&(r.html.caption=r.name);var o='<input name="'+r.name+'" class="w2ui-input" type="text" '+r.html.attr+' tabindex="'+(a+1)+'"/>';switch(r.type){case"pass":case"password":o='<input name="'+r.name+'" class="w2ui-input" type = "password" '+r.html.attr+' tabindex="'+(a+1)+'"/>';break;case"checkbox":o='<input name="'+r.name+'" class="w2ui-input" type="checkbox" '+r.html.attr+' tabindex="'+(a+1)+'"/>';break;case"radio":o="";l=r.options.items?r.options.items:r.html.items;$.isArray(l)||(l=[]),l.length>0&&(l=w2obj.field.prototype.normMenu(l));for(d=0;d<l.length;d++)o+='<label><input name="'+r.name+'" class="w2ui-input" type = "radio" '+r.html.attr+' value="'+l[d].id+'"/>&#160;'+l[d].text+"</label><br/>";break;case"select":o='<select name="'+r.name+'" class="w2ui-input" '+r.html.attr+' tabindex="'+(a+1)+'">';var l=r.options.items?r.options.items:r.html.items;$.isArray(l)||(l=[]),l.length>0&&(l=w2obj.field.prototype.normMenu(l));for(d=0;d<l.length;d++)o+='<option value="'+l[d].id+'">'+l[d].text+"</option>";o+="</select>";break;case"textarea":o='<textarea name="'+r.name+'" class="w2ui-input" '+r.html.attr+' tabindex="'+(a+1)+'"></textarea>';break;case"toggle":o='<input name="'+r.name+'" type="checkbox" '+r.html.attr+' class="w2ui-input w2ui-toggle" tabindex="'+(a+1)+'"/><div><div></div></div>';break;case"html":case"custom":case"empty":o=""}""!==n&&(e!=r.html.page||t!=r.html.column||r.html.group&&n!=r.html.group)&&(s[e][t]+="\n   </div>",n=""),r.html.group&&n!=r.html.group&&(i+='\n   <div class="w2ui-group-title">'+r.html.group+'</div>\n   <div class="w2ui-group">',n=r.html.group),i+='\n      <div class="w2ui-field '+(null!=r.html.span?"w2ui-span"+r.html.span:"")+'" style="'+r.html.style+'">\n         <label>'+w2utils.lang(r.html.caption)+"</label>\n         <div>"+o+w2utils.lang(r.html.text)+"</div>\n      </div>",null==s[r.html.page]&&(s[r.html.page]=[]),null==s[r.html.page][r.html.column]&&(s[r.html.page][r.html.column]=""),s[r.html.page][r.html.column]+=i,e=r.html.page,t=r.html.column}if(""!==n&&(s[e][t]+="\n   </div>"),this.tabs.tabs)for(var d=0;d<this.tabs.tabs.length;d++)null==s[d]&&(s[d]=[]);var u="";if(!$.isEmptyObject(this.actions)){u+='\n<div class="w2ui-buttons">';for(var c in this.actions){var h=this.actions[c],p={caption:"",style:"",class:""};$.isPlainObject(h)?(h.caption&&(p.caption=h.caption),h.style&&(p.style=h.style),h.class&&(p.class=h.class)):(p.caption=c,-1!=["save","update","create"].indexOf(c.toLowerCase())?p.class="w2ui-btn-blue":p.class=""),u+='\n    <button name="'+c+'" class="w2ui-btn '+p.class+'" style="'+p.style+'">'+w2utils.lang(p.caption)+"</button>"}u+="\n</div>"}i="";for(var f=0;f<s.length;f++){i+='<div class="w2ui-page page-'+f+'" '+(0===f?"":'style="display: none;"')+'><div class="w2ui-column-container" style="display: flex;">';for(var g=0;g<s[f].length;g++)i+='<div class="w2ui-column col-'+g+'">'+(s[f][g]||"")+"\n</div>";i+="\n</div></div>"}return i+=u},action:function(e,t){var i=this.actions[e],s=i;$.isPlainObject(i)&&i.onClick&&(s=i.onClick);var n=this.trigger({phase:"before",target:e,type:"action",click:s,originalEvent:t});!0!==n.isCancelled&&("function"==typeof s&&s.call(this,t),this.trigger($.extend(n,{phase:"after"})))},resize:function(){function e(){s.width($(t.box).width()).height($(t.box).height()),a.css("top",""!==t.header?w2utils.getSize(n,"height"):0),r.css("top",(""!==t.header?w2utils.getSize(n,"height"):0)+("object"==typeof t.toolbar&&$.isArray(t.toolbar.items)&&t.toolbar.items.length>0?w2utils.getSize(a,"height"):0)),o.css("top",(""!==t.header?w2utils.getSize(n,"height"):0)+("object"==typeof t.toolbar&&$.isArray(t.toolbar.items)&&t.toolbar.items.length>0?w2utils.getSize(a,"height")+5:0)+("object"==typeof t.tabs&&$.isArray(t.tabs.tabs)&&t.tabs.tabs.length>0?w2utils.getSize(r,"height")+5:0)),o.css("bottom",u.length>0?w2utils.getSize(u,"height"):0)}var t=this,i=this.trigger({phase:"before",target:this.name,type:"resize"});if(!0!==i.isCancelled){var s=$(this.box).find("> div.w2ui-form-box"),n=$(this.box).find("> div .w2ui-form-header"),a=$(this.box).find("> div .w2ui-form-toolbar"),r=$(this.box).find("> div .w2ui-form-tabs"),o=$(this.box).find("> div .w2ui-page"),l=$(this.box).find("> div .w2ui-page.page-"+this.page),d=$(this.box).find("> div .w2ui-page.page-"+this.page+" > div"),u=$(this.box).find("> div .w2ui-buttons");e(),0!==parseInt($(this.box).height())&&!0!==$(this.box).data("auto-size")||($(this.box).height((n.length>0?w2utils.getSize(n,"height"):0)+("object"==typeof this.tabs&&$.isArray(this.tabs.tabs)&&this.tabs.tabs.length>0?w2utils.getSize(r,"height"):0)+("object"==typeof this.toolbar&&$.isArray(this.toolbar.items)&&this.toolbar.items.length>0?w2utils.getSize(a,"height"):0)+(o.length>0?w2utils.getSize(d,"height")+w2utils.getSize(l,"+height")+12:0)+(u.length>0?w2utils.getSize(u,"height"):0)),$(this.box).data("auto-size",!0)),e(),this.toolbar&&this.toolbar.resize&&this.toolbar.resize(),this.tabs&&this.tabs.resize&&this.tabs.resize(),t.trigger($.extend(i,{phase:"after"}))}},refresh:function(e){var t=(new Date).getTime(),i=this;if(this.box&&this.isGenerated&&null!=$(this.box).html()){var s=this.trigger({phase:"before",target:this.name,type:"refresh",page:this.page,field:e});if(!0!==s.isCancelled){if(null!=e)var n=i.get(e,!0),a=n+1;else{$(this.box).find("input, textarea, select").each(function(e,t){var s=null!=$(t).attr("name")?$(t).attr("name"):$(t).attr("id"),n=i.get(s);if(n){var a=$(t).parents(".w2ui-page");if(a.length>0)for(var r=0;r<100;r++)if(a.hasClass("page-"+r)){n.page=r;break}}}),$(this.box).find(".w2ui-page").hide(),$(this.box).find(".w2ui-page.page-"+this.page).show(),$(this.box).find(".w2ui-form-header").html(this.header),"object"==typeof this.tabs&&$.isArray(this.tabs.tabs)&&this.tabs.tabs.length>0?($("#form_"+this.name+"_tabs").show(),this.tabs.active=this.tabs.tabs[this.page].id,this.tabs.refresh()):$("#form_"+this.name+"_tabs").hide(),"object"==typeof this.toolbar&&$.isArray(this.toolbar.items)&&this.toolbar.items.length>0?($("#form_"+this.name+"_toolbar").show(),this.toolbar.refresh()):$("#form_"+this.name+"_toolbar").hide();var n=0,a=this.fields.length}for(r=n;r<a;r++)null==(e=this.fields[r]).name&&null!=e.field&&(e.name=e.field),null==e.field&&null!=e.name&&(e.field=e.name),e.$el=$(this.box).find('[name="'+String(e.name).replace(/\\/g,"\\\\")+'"]'),e.el=e.$el[0],null==e.el&&console.log('ERROR: Cannot associate field "'+e.name+'" with html control. Make sure html control exists with the same name.'),e.el&&(e.el.id=e.name),(h=$(e).data("w2field"))&&h.clear(),$(e.$el).off("change").on("change",function(){var e=this.value,t=null!=i.record[this.name]?i.record[this.name]:"",s=i.get(this.name);if(-1!=["list","enum","file"].indexOf(s.type)&&$(this).data("selected")){var n=$(this).data("selected"),a=i.record[this.name];if($.isArray(n)){e=[];for(r=0;r<n.length;r++)e[r]=$.extend(!0,{},n[r])}if($.isPlainObject(n)&&(e=$.extend(!0,{},n)),$.isArray(a)){t=[];for(var r=0;r<a.length;r++)t[r]=$.extend(!0,{},a[r])}$.isPlainObject(a)&&(t=$.extend(!0,{},a))}if(-1!=["toggle","checkbox"].indexOf(s.type)&&(e=!!$(this).prop("checked")&&("on"==$(this).prop("value")||$(this).prop("value"))),-1!=["int","float","percent","money","currency"].indexOf(s.type)&&(e=$(this).data("w2field").clean(e)),e!==t){var o=i.trigger({phase:"before",target:this.name,type:"change",value_new:e,value_previous:t});if(!0===o.isCancelled)return void $(this).val(i.record[this.name]);var l=this.value;if("select"==this.type&&(l=this.value),"checkbox"==this.type&&(l=!!this.checked),"radio"==this.type&&s.$el.each(function(e,t){t.checked&&(l=t.value)}),-1!=["int","float","percent","money","currency","list","combo","enum","file","toggle"].indexOf(s.type)&&(l=e),-1!=["enum","file"].indexOf(s.type)&&l.length>0){var d=$(s.el).data("w2field").helpers.multi;$(d).removeClass("w2ui-error")}(""===l||null==l||$.isArray(l)&&0===l.length||$.isPlainObject(l)&&$.isEmptyObject(l))&&(l=null),i.record[this.name]=l,i.trigger($.extend(o,{phase:"after"}))}}),e.required?$(e.el).parent().parent().addClass("w2ui-required"):$(e.el).parent().parent().removeClass("w2ui-required"),null!=e.disabled&&(e.disabled?$(e.el).prop("readonly",!0):$(e.el).prop("readonly",!1)),e.hidden?$(e.el).parents(".w2ui-field").hide():$(e.el).parents(".w2ui-field").show();$(this.box).find("button, input[type=button]").each(function(e,t){$(t).off("click").on("click",function(e){var t=this.value;this.id&&(t=this.id),this.name&&(t=this.name),i.action(t,e)})});for(var r=n;r<a;r++){var e=this.fields[r],o=null!=this.record[e.name]?this.record[e.name]:"";if(e.el)switch($(e.el).hasClass("w2ui-input")||$(e.el).addClass("w2ui-input"),e.type=String(e.type).toLowerCase(),e.options||(e.options={}),e.type){case"text":case"textarea":case"email":case"pass":case"password":e.el.value=o;break;case"int":case"float":case"money":case"currency":case"percent":e.el.value=o,$(e.el).w2field($.extend({},e.options,{type:e.type}));break;case"hex":case"alphanumeric":case"color":case"date":case"time":e.el.value=o,$(e.el).w2field($.extend({},e.options,{type:e.type}));break;case"toggle":w2utils.isFloat(o)&&(o=parseFloat(o)),$(e.el).prop("checked",!!o),this.record[e.name]=!!o&&o;break;case"list":case"combo":if("list"==e.type){var l=$.isPlainObject(o)?o.id:$.isPlainObject(e.options.selected)?e.options.selected.id:o;e.options.items||(e.options.items=[]);var d=e.options.items;$.isArray(d)&&d.length>0&&!$.isPlainObject(d[0])&&(e.options.items=w2obj.field.prototype.normMenu(d));for(p=0;p<e.options.items.length;p++){var u=e.options.items[p];if(u.id==l){o=$.extend(!0,{},u),i.record[e.name]=o;break}}}else"combo"!=e.type||$.isPlainObject(o)?$.isPlainObject(o)&&null!=o.text?e.el.value=o.text:e.el.value="":e.el.value=o;$.isPlainObject(o)||(o={}),$(e.el).w2field($.extend({},e.options,{type:e.type,selected:o}));break;case"enum":case"file":$.isArray(o)||(o=[]),$(e.el).w2field($.extend({},e.options,{type:e.type,selected:o}));break;case"select":if(null!=(d=e.options.items)&&d.length>0){d=w2obj.field.prototype.normMenu(d),$(e.el).html("");for(var c=0;c<d.length;c++)$(e.el).append('<option value="'+d[c].id+'">'+d[c].text+"</option")}$(e.el).val(o);break;case"radio":$(e.$el).prop("checked",!1).each(function(e,t){$(t).val()==o&&$(t).prop("checked",!0)});break;case"checkbox":$(e.el).prop("checked",!!o);break;case"html":case"custom":case"empty":break;default:$(e.el).val(o),$(e.el).w2field($.extend({},e.options,{type:e.type}))}}for(var h=$(this.box).find(".w2ui-page"),p=0;p<h.length;p++)$(h[p]).find("> *").length>1&&$(h[p]).wrapInner("<div></div>");return this.trigger($.extend(s,{phase:"after"})),this.resize(),(new Date).getTime()-t}}},render:function(e){function t(){var e=$(s.box).find("div:not(.w2ui-field-helper) > input, select, textarea, div > label:nth-child(1) > :radio").not(".file-input");e.length>s.focus&&e[s.focus].focus()}var i=(new Date).getTime(),s=this;if("object"==typeof e&&($(this.box).find("#form_"+this.name+"_tabs").length>0&&$(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-form").html(""),this.box=e),this.isGenerated&&this.box){var n=this.trigger({phase:"before",target:this.name,type:"render",box:null!=e?e:this.box});if(!0!==n.isCancelled){$.isEmptyObject(this.original)&&!$.isEmptyObject(this.record)&&(this.original=$.extend(!0,{},this.record));var a='<div class="w2ui-form-box">'+(""!==this.header?'<div class="w2ui-form-header">'+this.header+"</div>":"")+'    <div id="form_'+this.name+'_toolbar" class="w2ui-form-toolbar" style="display: none"></div>    <div id="form_'+this.name+'_tabs" class="w2ui-form-tabs" style="display: none"></div>'+this.formHTML+"</div>";return $(this.box).attr("name",this.name).addClass("w2ui-reset w2ui-form").html(a),$(this.box).length>0&&($(this.box)[0].style.cssText+=this.style),"function"!=typeof this.toolbar.render&&(this.toolbar=$().w2toolbar($.extend({},this.toolbar,{name:this.name+"_toolbar",owner:this})),this.toolbar.on("click",function(e){var t=s.trigger({phase:"before",type:"toolbar",target:e.target,originalEvent:e});!0!==t.isCancelled&&s.trigger($.extend(t,{phase:"after"}))})),"object"==typeof this.toolbar&&"function"==typeof this.toolbar.render&&this.toolbar.render($("#form_"+this.name+"_toolbar")[0]),"function"!=typeof this.tabs.render&&(this.tabs=$().w2tabs($.extend({},this.tabs,{name:this.name+"_tabs",owner:this,active:this.tabs.active})),this.tabs.on("click",function(e){s.goto(this.get(e.target,!0))})),"object"==typeof this.tabs&&"function"==typeof this.tabs.render&&(this.tabs.render($("#form_"+this.name+"_tabs")[0]),this.tabs.active&&this.tabs.click(this.tabs.active)),this.trigger($.extend(n,{phase:"after"})),this.resize(),("object"!=typeof this.url?this.url:this.url.get)&&0!==this.recid&&null!=this.recid?this.request():this.refresh(),0===$(".w2ui-layout").length&&(this.tmp_resize=function(e){w2ui[s.name].resize()},$(window).off("resize","body").on("resize","body",this.tmp_resize)),this.focus>=0&&setTimeout(function(){0===$(s.box).find("input, select, textarea").length?setTimeout(t,500):t()},10),(new Date).getTime()-i}}},destroy:function(){var e=this.trigger({phase:"before",target:this.name,type:"destroy"});!0!==e.isCancelled&&("object"==typeof this.toolbar&&this.toolbar.destroy&&this.toolbar.destroy(),"object"==typeof this.tabs&&this.tabs.destroy&&this.tabs.destroy(),$(this.box).find("#form_"+this.name+"_tabs").length>0&&$(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-form").html(""),delete w2ui[this.name],this.trigger($.extend(e,{phase:"after"})),$(window).off("resize","body"))}},$.extend(w2form.prototype,w2utils.event),w2obj.form=w2form}(jQuery);